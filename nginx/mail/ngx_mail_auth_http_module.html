<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>mail/ngx_mail_auth_http_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="Auth,auth,HTTP,1.0,example"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_mail_auth_http_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#directives">Directives</a> <br>     <a href="#auth_http">auth_http</a> <br>     <a href="#auth_http_header">auth_http_header</a> <br>     <a href="#auth_http_pass_client_cert">auth_http_pass_client_cert</a> <br>     <a href="#auth_http_timeout">auth_http_timeout</a> <br> <a href="#protocol">Protocol</a> <br></td></tr></tbody></table><a name="directives"></a><center><h4>  指令 </h4></center><a name="auth_http"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_http</strong> <code class="notranslate"><i>URL</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置HTTP身份验证服务器的URL。  该协议<a href="#protocol">如下所述</a> 。 </p><a name="auth_http_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_http_header</strong> <code class="notranslate"><i>header</i></code> <code class="notranslate"><i>value</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  将指定的标头附加到发送到身份验证服务器的请求。  此标头可用作共享密钥，以验证请求是否来自nginx。  例如： </p><blockquote class="example"><pre class="notranslate">auth_http_header X-Auth-Key "secret_string";
</pre></blockquote><p></p><a name="auth_http_pass_client_cert"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_http_pass_client_cert</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">auth_http_pass_client_cert off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.7.11版本中。 </p></div><p>  将具有PEM格式（urlencoded）的<a href="ngx_mail_ssl_module.html#ssl_verify_client">客户端</a>证书的“Auth-SSL-Cert”标头附加到发送到身份验证服务器的请求。 </p><a name="auth_http_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_http_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">auth_http_timeout 60s;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置与身份验证服务器通信的超时。 </p><a name="protocol"></a><center><h4>  协议 </h4></center><p>   HTTP协议用于与身份验证服务器通信。  响应正文中的数据将被忽略，信息仅在标题中传递。 </p><p>  请求和响应的示例： </p><p>  请求： </p><blockquote class="example"><pre class="notranslate">GET /auth HTTP/1.0
Host: localhost
Auth-Method: plain # plain/apop/cram-md5/external
Auth-User: user
Auth-Pass: password
Auth-Protocol: imap # imap/pop3/smtp
Auth-Login-Attempt: 1
Client-IP: 192.0.2.42
Client-Host: client.example.org
</pre></blockquote><p>  反应良好： </p><blockquote class="example"><pre class="notranslate">HTTP/1.0 200 OK
Auth-Status: OK
Auth-Server: 198.51.100.1
Auth-Port: 143
</pre></blockquote><p>  不好的回应： </p><blockquote class="example"><pre class="notranslate">HTTP/1.0 200 OK
Auth-Status: Invalid login or password
Auth-Wait: 3
</pre></blockquote><p></p><p>  如果没有“Auth-Wait”标头，将返回错误并关闭连接。  当前实现为每次身份验证尝试分配内存。  仅在会话结束时释放内存。  因此，必须限制单个会话中无效身份验证尝试的次数 - 服务器必须在10-20次尝试后响应而不使用“Auth-Wait”标头（尝试号码在“Auth-Login-Attempt”标头中传递） 。 </p><p>  使用APOP或CRAM-MD5时，请求 - 响应将如下所示： </p><blockquote class="example"><pre class="notranslate">GET /auth HTTP/1.0
Host: localhost
Auth-Method: apop
Auth-User: user
Auth-Salt: &lt;238188073.1163692009@mail.example.com&gt;
Auth-Pass: auth_response
Auth-Protocol: imap
Auth-Login-Attempt: 1
Client-IP: 192.0.2.42
Client-Host: client.example.org
</pre></blockquote><p>  反应良好： </p><blockquote class="example"><pre class="notranslate">HTTP/1.0 200 OK
Auth-Status: OK
Auth-Server: 198.51.100.1
Auth-Port: 143
Auth-Pass: plain-text-pass
</pre></blockquote><p></p><p>  如果响应中存在“Auth-User”标头，它将覆盖用于通过后端进行身份验证的用户名。 </p><p>  对于SMTP，响应还考虑了“Auth-Error-Code”标头 - 如果存在，则在发生错误时用作响应代码。  否则，535 5.7.0代码将添加到“Auth-Status”标头中。 </p><p>  例如，如果从身份验证服务器收到以下响应： </p><blockquote class="example"><pre class="notranslate">HTTP/1.0 200 OK
Auth-Status: Temporary server problem, try again later
Auth-Error-Code: 451 4.3.0
Auth-Wait: 3
</pre></blockquote><p>  然后SMTP客户端将收到错误 </p><blockquote class="example"><pre class="notranslate">451 4.3.0 Temporary server problem, try again later
</pre></blockquote><p></p><p>  如果代理SMTP不需要身份验证，请求将如下所示： </p><blockquote class="example"><pre class="notranslate">GET /auth HTTP/1.0
Host: localhost
Auth-Method: none
Auth-User:
Auth-Pass:
Auth-Protocol: smtp
Auth-Login-Attempt: 1
Client-IP: 192.0.2.42
Client-Host: client.example.org
Auth-SMTP-Helo: client.example.org
Auth-SMTP-From: MAIL FROM: &lt;&gt;
Auth-SMTP-To: RCPT TO: &lt;postmaster@mail.example.com&gt;
</pre></blockquote><p></p><p>  对于SSL / TLS客户端连接（1.7.11），添加了“Auth-SSL”标头，“Auth-SSL-Verify”将包含客户端证书验证的结果（如果已<a href="ngx_mail_ssl_module.html#ssl_verify_client">启用）</a> ：“ <code class="notranslate">SUCCESS</code> ”，“ <code class="notranslate">FAILED:</code>如果证书不存在，则“和” <code class="notranslate">NONE</code> “。 </p><blockquote class="note">  在1.11.7版之前，“ <code class="notranslate">FAILED</code> ”结果不包含<code class="notranslate"><i>reason</i></code>字符串。 </blockquote><p>  当客户端证书存在时，其详细信息将在以下请求标头中传递：“Auth-SSL-Subject”，“Auth-SSL-Issuer”，“Auth-SSL-Serial”和“Auth-SSL-Fingerprint”。  如果启用了<a href="#auth_http_pass_client_cert">auth_http_pass_client_cert</a> ，则证书本身将在“Auth-SSL-Cert”标头中传递。  请求如下： </p><blockquote class="example"><pre class="notranslate">GET /auth HTTP/1.0
Host: localhost
Auth-Method: plain
Auth-User: user
Auth-Pass: password
Auth-Protocol: imap
Auth-Login-Attempt: 1
Client-IP: 192.0.2.42
Auth-SSL: on
Auth-SSL-Verify: SUCCESS
Auth-SSL-Subject: /CN=example.com
Auth-SSL-Issuer: /CN=example.com
Auth-SSL-Serial: C07AD56B846B5BFF
Auth-SSL-Fingerprint: 29d6a80a123d13355ed16b4b04605e29cb55a5ad
</pre></blockquote><p></p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>