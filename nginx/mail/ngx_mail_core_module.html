<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>mail/ngx_mail_core_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="listen,110,server,resolver,smtp"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_mail_core_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#listen">listen</a> <br>     <a href="#mail">mail</a> <br>     <a href="#protocol">protocol</a> <br>     <a href="#resolver">resolver</a> <br>     <a href="#resolver_timeout">resolver_timeout</a> <br>     <a href="#server">server</a> <br>     <a href="#server_name">server_name</a> <br>     <a href="#timeout">timeout</a> <br></td></tr></tbody></table><a name="summary"></a><p>  默认情况下不构建此模块，应使用<code class="notranslate">--with-mail</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">worker_processes 1;

error_log /var/log/nginx/error.log info;

events {
    worker_connections  1024;
}

mail {
    server_name       mail.example.com;
    auth_http         localhost:9000/cgi-bin/nginxauth.cgi;

    imap_capabilities IMAP4rev1 UIDPLUS IDLE LITERAL+ QUOTA;

    pop3_auth         plain apop cram-md5;
    pop3_capabilities LAST TOP USER PIPELINING UIDL;

    smtp_auth         login plain cram-md5;
    smtp_capabilities "SIZE 10485760" ENHANCEDSTATUSCODES 8BITMIME DSN;
    xclient           off;

    server {
        listen   25;
        protocol smtp;
    }
    server {
        listen   110;
        protocol pop3;
        proxy_pass_error_message on;
    }
    server {
        listen   143;
        protocol imap;
    }
    server {
        listen   587;
        protocol smtp;
    }
}
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="listen"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>listen</strong> 
    <code class="notranslate"><i>address</i></code> : <code class="notranslate"><i>port</i></code>
    [ <code class="notranslate">ssl</code> ]
    [ <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> ]
    [ <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> ]
    [ <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> ]
    [ <code class="notranslate">bind</code> ]
    [ <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> ]
    [ <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> |[ <code class="notranslate"><i>keepidle</i></code> ]:[ <code class="notranslate"><i>keepintvl</i></code> ]:[ <code class="notranslate"><i>keepcnt</i></code> ]];</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置服务器将接受请求的套接字的<code class="notranslate"><i>address</i></code>和<code class="notranslate"><i>port</i></code> 。  可以仅指定端口。  地址也可以是主机名，例如： </p><blockquote class="example"><pre class="notranslate">listen 127.0.0.1:110;
listen *:110;
listen 110;     # same as *:110
listen localhost:110;
</pre></blockquote><p>   IPv6地址（0.7.58）在方括号中指定： </p><blockquote class="example"><pre class="notranslate">listen [::1]:110;
listen [::]:110;
</pre></blockquote><p>   UNIX域套接字（1.3.5）使用“ <code class="notranslate">unix:</code> ”前缀指定： </p><blockquote class="example"><pre class="notranslate">listen unix:/var/run/nginx.sock;
</pre></blockquote><p></p><p>  不同的服务器必须侦听不同的<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对。 </p><p>   <code class="notranslate">ssl</code>参数允许指定此端口上接受的所有连接都应在SSL模式下工作。 </p><p>   <code class="notranslate">listen</code>指令可以有几个特定于与套接字相关的系统调用的附加参数。 </p><dl class="compact"><dt>   <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  在<code class="notranslate">listen()</code>调用中设置<code class="notranslate">backlog</code>参数，该参数限制挂起连接队列的最大长度（1.9.2）。  默认情况下， <code class="notranslate">backlog</code>在FreeBSD，DragonFly BSD和macOS上设置为-1，在其他平台上设置为511。 </dd><dt>   <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> </dt><dd>  设置侦听套接字的接收缓冲区大小（ <code class="notranslate">SO_RCVBUF</code>选项）（1.11.13）。 </dd><dt>   <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> </dt><dd>  设置侦听套接字的发送缓冲区大小（ <code class="notranslate">SO_SNDBUF</code>选项）（1.11.13）。 </dd><dt> <code class="notranslate">bind</code> </dt> <dd>  此参数指示对给定地址：端口对进行单独的<code class="notranslate">bind()</code>调用。  事实是，如果有几个具有相同端口但不同地址的<code class="notranslate">listen</code>指令，并且其中一个<code class="notranslate">listen</code>指令侦听给定端口（ <code class="notranslate">*:</code> <code class="notranslate"><i>port</i></code> ）的所有地址，则nginx将<code class="notranslate">bind()</code>仅限于<code class="notranslate">*:</code> <code class="notranslate"><i>port</i></code> 。  应该注意的是，在这种情况下将进行<code class="notranslate">getsockname()</code>系统调用以确定接受连接的地址。  如果使用<code class="notranslate">ipv6only</code>或<code class="notranslate">so_keepalive</code>参数，那么对于给定的<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对将始终进行单独的<code class="notranslate">bind()</code>调用。 </dd><dt>   <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> </dt><dd>  此参数确定（通过<code class="notranslate">IPV6_V6ONLY</code>套接字选项）侦听通配符地址<code class="notranslate">[::]</code>的IPv6套接字是仅接受IPv6连接还是仅接受IPv6和IPv4连接。  默认情况下，此参数处于启用状态。  它只能在开始时设置一次。 </dd><dt>   <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> |   <code class="notranslate">off</code> | [ <code class="notranslate"><i>keepidle</i></code> ]：[ <code class="notranslate"><i>keepintvl</i></code> ]：[ <code class="notranslate"><i>keepcnt</i></code> ] </dt><dd>  此参数配置侦听套接字的“TCP keepalive”行为。  如果省略此参数，则操作系统的设置将对套接字有效。  如果将其设置为值“ <code class="notranslate">on</code> ”，则为套接字打开<code class="notranslate">SO_KEEPALIVE</code>选项。  如果将其设置为值“ <code class="notranslate">off</code> ”，则为套接字关闭<code class="notranslate">SO_KEEPALIVE</code>选项。  某些操作系统支持使用<code class="notranslate">TCP_KEEPIDLE</code> ， <code class="notranslate">TCP_KEEPINTVL</code>和<code class="notranslate">TCP_KEEPCNT</code>套接字选项在每个套接字的基础上设置TCP keepalive参数。  在这样的系统上（目前，Linux 2.4 +，NetBSD 5+和FreeBSD 9.0-STABLE），可以使用<code class="notranslate"><i>keepidle</i></code> ， <code class="notranslate"><i>keepintvl</i></code>和<code class="notranslate"><i>keepcnt</i></code>参数配置它们。  可以省略一个或两个参数，在这种情况下，相应套接字选项的系统默认设置将生效。  例如， <blockquote class="example"><pre class="notranslate">so_keepalive=30m::10</pre></blockquote>  将空闲超时（ <code class="notranslate">TCP_KEEPIDLE</code> ）设置为30分钟，将探测间隔（ <code class="notranslate">TCP_KEEPINTVL</code> ）保留为系统默认值，并将探测计数（ <code class="notranslate">TCP_KEEPCNT</code> ）设置为10个探测。 </dd></dl><p></p><a name="mail"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>mail</strong> { ... }</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">main</code> <br>
                </td></tr></tbody></table></div><p>  提供指定邮件服务器指令的配置文件上下文。 </p><a name="protocol"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>protocol</strong> 
  <code class="notranslate">imap</code> |
  <code class="notranslate">pop3</code> |
  <code class="notranslate">smtp</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置代理服务器的协议。  支持的协议是<a href="ngx_mail_imap_module.html">IMAP</a> ， <a href="ngx_mail_pop3_module.html">POP3</a>和<a href="ngx_mail_smtp_module.html">SMTP</a> 。 </p><p>  如果未设置该指令，则可以根据<a href="#listen">listen</a>指令中指定的已知端口自动检测协议： </p><ul class="compact"><li>   <code class="notranslate">imap</code> ：143,993 </li><li>   <code class="notranslate">pop3</code> ：110,995 </li><li>   <code class="notranslate">smtp</code> ：25,587,465 </li></ul><p></p><p>  可以使用<a href="configure.html">配置</a>参数<code class="notranslate">--without-mail_imap_module</code> ， <code class="notranslate">--without-mail_pop3_module</code>和<code class="notranslate">--without-mail_smtp_module</code>禁用不必要的协议。 </p><a name="resolver"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>resolver</strong> 
<code class="notranslate"><i>address</i></code> ...
[ <code class="notranslate">valid</code> = <code class="notranslate"><i>time</i></code> ];</code> <br> <code class="notranslate"><strong>resolver</strong> <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">resolver off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  配置用于查找客户端主机名的名称服务器以将其传递给<a href="ngx_mail_auth_http_module.html">身份验证服务器</a> ，并在代理SMTP时配置<a href="ngx_mail_proxy_module.html#xclient">XCLIENT</a>命令。  例如： </p><blockquote class="example"><pre class="notranslate">resolver 127.0.0.1 [::1]:5353;
</pre></blockquote><p>  可以将地址指定为域名或IP地址，以及可选端口（1.3.1,1.2.2）。  如果未指定端口，则使用端口53。  以循环方式查询名称服务器。 </p><blockquote class="note">  在1.1.7版之前，只能配置一个名称服务器。  从版本1.3.1和1.2.2开始支持使用IPv6地址指定名称服务器。 </blockquote><p>  默认情况下，nginx使用响应的TTL值缓存答案。  可选的<code class="notranslate">valid</code>参数允许覆盖它： </p><blockquote class="example"><pre class="notranslate">resolver 127.0.0.1 [::1]:5353 valid=30s;
</pre></blockquote><p></p><blockquote class="note">  在版本1.1.9之前，无法调整缓存时间，并且nginx始终缓存5分钟的持续时间。 </blockquote><p></p><p>  特殊值<code class="notranslate">off</code>禁用解析。 </p><a name="resolver_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>resolver_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">resolver_timeout 30s;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置DNS操作的超时，例如： </p><blockquote class="example"><pre class="notranslate">resolver_timeout 5s;
</pre></blockquote><p></p><a name="server"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>server</strong> { ... }</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> <br>
                </td></tr></tbody></table></div><p>  设置服务器的配置。 </p><a name="server_name"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>server_name</strong> <code class="notranslate"><i>name</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">server_name hostname;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置使用的服务器名称： </p><ul class="compact"><li>  在初始POP3 / SMTP服务器问候语中; </li><li>  在SASL CRAM-MD5认证期间的盐; </li><li>  如果启用了<a href="ngx_mail_proxy_module.html#xclient">XCLIENT</a>命令的传递，则在连接到SMTP后端时在<code class="notranslate">EHLO</code>命令中。 </li></ul><p></p><p>  如果未指定该指令，则使用计算机的主机名。 </p><a name="timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">timeout 60s;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置代理到后端开始之前使用的超时。 </p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>