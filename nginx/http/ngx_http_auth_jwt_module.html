<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_auth_jwt_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="auth,jwt,location,closed,site"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_auth_jwt_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#auth_jwt">auth_jwt</a> <br>     <a href="#auth_jwt_claim_set">auth_jwt_claim_set</a> <br>     <a href="#auth_jwt_header_set">auth_jwt_header_set</a> <br>     <a href="#auth_jwt_key_file">auth_jwt_key_file</a> <br>     <a href="#auth_jwt_key_request">auth_jwt_key_request</a> <br>     <a href="#auth_jwt_leeway">auth_jwt_leeway</a> <br> <a href="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_auth_jwt_module</code>模块（1.11.3）通过使用指定的密钥验证提供的<a href="https://tools.ietf.org/html/rfc7519">JSON Web令牌</a> （JWT）来实现客户端授权。   JWT声明必须以<a href="https://tools.ietf.org/html/rfc7515">JSON Web签名</a> （JWS）结构进行编码。  该模块可用于<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a>身份验证。 </p><p>  该模块可以通过<a href="ngx_http_core_module.html#satisfy">满足</a>指令与其他访问模块组合，例如<a href="ngx_http_access_module.html">ngx_http_access_module</a> ， <a href="ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a>和<a href="ngx_http_auth_request_module.html">ngx_http_auth_request_module</a> 。 </p><p>  该模块支持以下加密<a href="https://www.iana.org/assignments/jose/jose.xhtml#web-signature-encryption-algorithms">算法</a> ： </p><ul class="compact"><li>   HS256，HS384，HS512 </li><li>   RS256，RS384，RS512 </li><li>   ES256，ES384，ES512 </li><li>   EdDSA（Ed25519和Ed448签名）（1.15.7） </li></ul><p>  在1.13.7版之前，仅支持HS256，RS256，ES256算法。 </p><p></p><blockquote class="note">  该模块作为我们<a href="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {
    auth_jwt          "closed site";
    auth_jwt_key_file conf/keys.json;
}
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="auth_jwt"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_jwt</strong> 
    <code class="notranslate"><i>string</i></code>
    [ <code class="notranslate">token=</code> <code class="notranslate"><i>$variable</i></code> ] |
    <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">auth_jwt off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">limit_except</code> <br>
                </td></tr></tbody></table></div><p>  启用JSON Web Token的验证。  指定的<code class="notranslate"><i>string</i></code>用作域。  参数值可以包含变量。 </p><p>  可选的<code class="notranslate">token</code>参数指定包含JSON Web Token的变量。  默认情况下，JWT作为<a href="https://tools.ietf.org/html/rfc6750">承载令牌</a>在“授权”标头中传递。   JWT也可以作为cookie或查询字符串的一部分传递： </p><blockquote class="example"><pre class="notranslate">auth_jwt "closed site" token=$cookie_auth_token;
</pre></blockquote><p></p><p>  特殊值<code class="notranslate">off</code>取消了从先前配置级别继承的<code class="notranslate">auth_jwt</code>伪指令的效果。 </p><a name="auth_jwt_claim_set"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_jwt_claim_set</strong> <code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>name</i></code> ...;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.11.10版中。 </p></div><p>  将<code class="notranslate"><i>variable</i></code>设置为由键名标识的JWT声明参数。  名称匹配从JSON树的顶级开始。  对于数组，变量保留由逗号分隔的数组元素列表。 </p><blockquote class="example"><pre class="notranslate">location / {
    auth_jwt           "closed site";
    auth_jwt_key_file  conf/keys.json;
    auth_jwt_claim_set $email info e-mail;
    auth_jwt_claim_set $job info "job title";
}
</pre></blockquote><p></p><blockquote class="note">  在1.13.7版之前，只能指定一个键名，并且数组的结果未定义。 </blockquote><p></p><a name="auth_jwt_header_set"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_jwt_header_set</strong> <code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>name</i></code> ...;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.11.10版中。 </p></div><p>  将<code class="notranslate"><i>variable</i></code>设置为由键名标识的JOSE标头参数。  名称匹配从JSON树的顶级开始。  对于数组，变量保留由逗号分隔的数组元素列表。 </p><blockquote class="note">  在1.13.7版之前，只能指定一个键名，并且数组的结果未定义。 </blockquote><p></p><a name="auth_jwt_key_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_jwt_key_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">limit_except</code> <br>
                </td></tr></tbody></table></div><p>  指定<a href="https://tools.ietf.org/html/rfc7517#section-5">JSON Web Key Set</a>格式的<code class="notranslate"><i>file</i></code> ，用于验证JWT签名。  参数值可以包含变量。 </p><a name="auth_jwt_key_request"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_jwt_key_request</strong> <code class="notranslate"><i>uri</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">limit_except</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.15.6版中。 </p></div><p>  允许从子请求中检索<a href="https://tools.ietf.org/html/rfc7517#section-5">JSON Web Key Set</a>文件以验证JWT签名，并设置子请求将发送到的URI。  为避免验证开销，建议缓存密钥文件： </p><blockquote class="example"><pre class="notranslate">proxy_cache_path /data/nginx/cache levels=1 keys_zone=foo:10m;

server {
    ...

    location / {
        auth_jwt             "closed site";
        auth_jwt_key_request /jwks_uri;
    }

    location = /jwks_uri {
        internal;
        proxy_cache foo;
        proxy_pass  http://idp.example.com/keys;
    }
}
</pre></blockquote><p></p><a name="auth_jwt_leeway"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_jwt_leeway</strong> <code class="notranslate"><i>time</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">auth_jwt_leeway 0s;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.13.10版本中。 </p></div><p>  设置最大允许余地，以在验证<a href="https://tools.ietf.org/html/rfc7519#section-4.1.4">exp</a>和<a href="https://tools.ietf.org/html/rfc7519#section-4.1.5">nbf</a> JWT声明时补偿时钟偏差。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_auth_jwt_module</code>模块支持嵌入变量： </p><p></p><dl class="compact"><dt id="var_jwt_header_">   <code class="notranslate">$jwt_header_</code> <code class="notranslate"><i>name</i></code> </dt><dd>  返回指定<a href="https://tools.ietf.org/html/rfc7515#section-4">JOSE标头</a>的值 </dd><dt id="var_jwt_claim_">   <code class="notranslate">$jwt_claim_</code> <code class="notranslate"><i>name</i></code> </dt><dd>  返回指定<a href="https://tools.ietf.org/html/rfc7519#section-4">JWT声明</a>的值 </dd></dl><p></p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>