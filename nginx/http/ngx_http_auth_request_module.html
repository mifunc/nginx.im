<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_auth_request_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="auth,request,proxy,location,..."/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_auth_request_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#auth_request">auth_request</a> <br>     <a href="#auth_request_set">auth_request_set</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_auth_request_module</code>模块（1.5.4+）基于子请求的结果实现客户端授权。  如果子请求返回2xx响应代码，则允许访问。  如果它返回401或403，则拒绝访问，并显示相应的错误代码。  子请求返回的任何其他响应代码都被视为错误。 </p><p>  对于401错误，客户端还从子请求响应中接收“WWW-Authenticate”头。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">--with-http_auth_request_module</code>配置参数启用它。 </p><p>  该模块可以通过<a href="ngx_http_core_module.html#satisfy">满足</a>指令与其他访问模块组合，例如<a href="ngx_http_access_module.html">ngx_http_access_module</a> ， <a href="ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a>和<a href="ngx_http_auth_jwt_module.html">ngx_http_auth_jwt_module</a> 。 </p><blockquote class="note">  在1.7.3版之前，无法缓存对授权子请求的响应（使用<a href="ngx_http_proxy_module.html#proxy_cache">proxy_cache</a> ， <a href="ngx_http_proxy_module.html#proxy_store">proxy_store</a>等）。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location /private/ {
    auth_request /auth;
    ...
}

location = /auth {
    proxy_pass ...
    proxy_pass_request_body off;
    proxy_set_header Content-Length "";
    proxy_set_header X-Original-URI $request_uri;
}
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="auth_request"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_request</strong> <code class="notranslate"><i>uri</i></code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">auth_request off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  根据子请求的结果启用授权，并设置子请求将发送到的URI。 </p><a name="auth_request_set"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>auth_request_set</strong> <code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>value</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  授权请求完成后，将请求<code class="notranslate"><i>variable</i></code>设置为给定<code class="notranslate"><i>value</i></code> 。  该值可能包含授权请求中的变量，例如<code class="notranslate">$upstream_http_*</code> 。 </p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>