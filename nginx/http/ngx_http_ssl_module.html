<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_ssl_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="ssl,key,server,certificate,session"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_ssl_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#ssl">ssl</a> <br>     <a href="#ssl_buffer_size">ssl_buffer_size</a> <br>     <a href="#ssl_certificate">ssl_certificate</a> <br>     <a href="#ssl_certificate_key">ssl_certificate_key</a> <br>     <a href="#ssl_ciphers">ssl_ciphers</a> <br>     <a href="#ssl_client_certificate">ssl_client_certificate</a> <br>     <a href="#ssl_crl">ssl_crl</a> <br>     <a href="#ssl_dhparam">ssl_dhparam</a> <br>     <a href="#ssl_early_data">ssl_early_data</a> <br>     <a href="#ssl_ecdh_curve">ssl_ecdh_curve</a> <br>     <a href="#ssl_password_file">ssl_password_file</a> <br>     <a href="#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a> <br>     <a href="#ssl_protocols">ssl_protocols</a> <br>     <a href="#ssl_session_cache">ssl_session_cache</a> <br>     <a href="#ssl_session_ticket_key">ssl_session_ticket_key</a> <br>     <a href="#ssl_session_tickets">ssl_session_tickets</a> <br>     <a href="#ssl_session_timeout">ssl_session_timeout</a> <br>     <a href="#ssl_stapling">ssl_stapling</a> <br>     <a href="#ssl_stapling_file">ssl_stapling_file</a> <br>     <a href="#ssl_stapling_responder">ssl_stapling_responder</a> <br>     <a href="#ssl_stapling_verify">ssl_stapling_verify</a> <br>     <a href="#ssl_trusted_certificate">ssl_trusted_certificate</a> <br>     <a href="#ssl_verify_client">ssl_verify_client</a> <br>     <a href="#ssl_verify_depth">ssl_verify_depth</a> <br> <a href="#errors">Error Processing</a> <br> <a href="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_ssl_module</code>模块为HTTPS提供必要的支持。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">--with-http_ssl_module</code>配置参数启用它。 </p><blockquote class="note">  该模块需要<a href="http://www.openssl.org">OpenSSL</a>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  为减少处理器负载，建议使用 </p><ul class="compact"><li>  设置<a href="ngx_core_module.html#worker_processes">工作进程数</a>等于处理器数， </li><li>  启用<a href="ngx_http_core_module.html#keepalive_timeout">保持活动</a>连接， </li><li>  启用<a href="#ssl_session_cache_shared">共享</a>会话缓存， </li><li>  禁用<a href="#ssl_session_cache_builtin">内置</a>会话缓存， </li><li>  并可能增加会话<a href="#ssl_session_timeout">生命周期</a> （默认为5分钟）： </li></ul><p></p><blockquote class="example"><pre class="notranslate"> <strong>worker_processes auto;</strong>

http {

    ...

    server {
        listen              443 ssl;
        <strong>keepalive_timeout   70;</strong>

        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;
        ssl_certificate     /usr/local/nginx/conf/cert.pem;
        ssl_certificate_key /usr/local/nginx/conf/cert.key;
        <strong>ssl_session_cache   shared:SSL:10m;</strong>
        <strong>ssl_session_timeout 10m;</strong>

        ...
    }
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="ssl"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  该指令在1.15.0版本中已过时。  应该使用<a href="ngx_http_core_module.html#listen">listen</a>指令的<code class="notranslate">ssl</code>参数。 </p><a name="ssl_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_buffer_size 16k;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.5.9版本中。 </p></div><p>  设置用于发送数据的缓冲区的大小。 </p><p>  默认情况下，缓冲区大小为16k，这对应于发送大响应时的最小开销。  要最小化第一个字节的时间，使用较小的值可能是有益的，例如： </p><blockquote class="example"><pre class="notranslate">ssl_buffer_size 4k;
</pre></blockquote><p></p><a name="ssl_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  指定具有给定虚拟服务器的PEM格式的证书的<code class="notranslate"><i>file</i></code> 。  如果除了主证书之外还应指定中间证书，则应按以下顺序在同一文件中指定它们：首先是主证书，然后是中间证书。   PEM格式的密钥可以放在同一文件中。 </p><p>  从版本1.11.0开始，可以多次指定此指令以加载不同类型的证书，例如，RSA和ECDSA： </p><blockquote class="example"><pre class="notranslate">server {
    listen              443 ssl;
    server_name         example.com;

    ssl_certificate     example.com.rsa.crt;
    ssl_certificate_key example.com.rsa.key;

    ssl_certificate     example.com.ecdsa.crt;
    ssl_certificate_key example.com.ecdsa.key;

    ...
}
</pre></blockquote><p></p><blockquote class="note">  只有OpenSSL 1.0.2或更高版本支持不同<a href="configuring_https_servers.html#chains">证书的</a>单独<a href="configuring_https_servers.html#chains">证书链</a> 。  对于旧版本，只能使用一个证书链。 </blockquote><p></p><p>  应该记住，由于HTTPS协议对最大互操作性的限制，虚拟服务器应该监听<a href="configuring_https_servers.html#name_based_https_servers">不同的IP地址</a> 。 </p><a name="ssl_certificate_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_certificate_key</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  指定具有给定虚拟服务器的PEM格式的密钥的<code class="notranslate"><i>file</i></code> 。 </p><p>  可以指定value <code class="notranslate">engine</code> ： <code class="notranslate"><i>name</i></code> ： <code class="notranslate"><i>id</i></code>而不是<code class="notranslate"><i>file</i></code> （1.7.9），该<code class="notranslate"><i>file</i></code>从OpenSSL引擎<code class="notranslate"><i>name</i></code>加载具有指定<code class="notranslate"><i>id</i></code>密钥。 </p><a name="ssl_ciphers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_ciphers</strong> <code class="notranslate"><i>ciphers</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_ciphers HIGH:!aNULL:!MD5;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  指定启用的密码。  密码以OpenSSL库理解的格式指定，例如： </p><blockquote class="example"><pre class="notranslate">ssl_ciphers ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
</pre></blockquote><p></p><p>  可以使用“ <code class="notranslate">openssl ciphers</code> ”命令查看完整列表。 </p><p></p><blockquote class="note">  以前版本的nginx默认使用<a href="configuring_https_servers.html#compatibility">不同的</a>密码。 </blockquote><p></p><a name="ssl_client_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_client_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  如果启用了<a href="#ssl_stapling">ssl_stapling，</a>则指定具有PEM格式的可信CA证书的<code class="notranslate"><i>file</i></code> ，该证书用于<a href="#ssl_verify_client">验证</a>客户端证书和OCSP响应。 </p><p>  证书列表将发送给客户。  如果不需要，可以使用<a href="#ssl_trusted_certificate">ssl_trusted_certificate</a>指令。 </p><a name="ssl_crl"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_crl</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在0.8.7版本中。 </p></div><p>  指定具有PEM格式的已吊销证书（CRL）的<code class="notranslate"><i>file</i></code> ，用于<a href="#ssl_verify_client">验证</a>客户端证书。 </p><a name="ssl_dhparam"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_dhparam</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在0.7.2版本中。 </p></div><p>  为DHE密码指定具有DH参数的<code class="notranslate"><i>file</i></code> 。 </p><p>  默认情况下，不设置任何参数，因此不会使用DHE密码。 </p><blockquote class="note">  在1.11.0版之前，默认使用内置参数。 </blockquote><p></p><a name="ssl_early_data"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_early_data</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_early_data off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.15.3版中。 </p></div><p>  启用或禁用TLS 1.3 <a href="https://tools.ietf.org/html/rfc8446#section-2.3">早期数据</a> 。 </p><blockquote class="note">  在早期数据中发送的请求会受到<a href="https://tools.ietf.org/html/rfc8470">重播攻击</a> 。  为了防止应用程序层发生此类攻击，应使用<a href="#var_ssl_early_data">$ ssl_early_data</a>变量。 </blockquote><p></p><blockquote class="example"><pre class="notranslate">proxy_set_header Early-Data $ssl_early_data;
</pre></blockquote><p></p><blockquote class="note">  使用OpenSSL 1.1.1或更高版本（1.15.4）和<a href="https://boringssl.googlesource.com/boringssl/">BoringSSL</a>时，支持该指令。 </blockquote><p></p><a name="ssl_ecdh_curve"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_ecdh_curve</strong> <code class="notranslate"><i>curve</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_ecdh_curve auto;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.1.0和1.0.6版本中。 </p></div><p>  指定ECDHE密码的<code class="notranslate"><i>curve</i></code> 。 </p><p>  使用OpenSSL 1.0.2或更高版本时，可以指定多条曲线（1.11.0），例如： </p><blockquote class="example"><pre class="notranslate">ssl_ecdh_curve prime256v1:secp384r1;
</pre></blockquote><p></p><p>  特殊值<code class="notranslate">auto</code> （1.11.0）指示nginx在使用OpenSSL 1.0.2或更高版本时使用内置在OpenSSL库中的列表，或者使用旧版本的<code class="notranslate">prime256v1</code> 。 </p><p></p><blockquote class="note">  在版本1.11.0之前，默认使用<code class="notranslate">prime256v1</code>曲线。 </blockquote><p></p><a name="ssl_password_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_password_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.7.3版本中。 </p></div><p>  指定具有密钥密码的<code class="notranslate"><i>file</i></code> ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">http {
    ssl_password_file /etc/keys/global.pass;
    ...

    server {
        server_name www1.example.com;
        ssl_certificate_key /etc/keys/first.key;
    }

    server {
        server_name www2.example.com;

        # named pipe can also be used instead of a file
        ssl_password_file /etc/keys/fifo;
        ssl_certificate_key /etc/keys/second.key;
    }
}
</pre></blockquote><p></p><a name="ssl_prefer_server_ciphers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_prefer_server_ciphers</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_prefer_server_ciphers off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  指定在使用SSLv3和TLS协议时，服务器密码应优先于客户端密码。 </p><a name="ssl_protocols"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_protocols</strong> 
    [ <code class="notranslate">SSLv2</code> ]
    [ <code class="notranslate">SSLv3</code> ]
    [ <code class="notranslate">TLSv1</code> ]
    [ <code class="notranslate">TLSv1.1</code> ]
    [ <code class="notranslate">TLSv1.2</code> ]
    [ <code class="notranslate">TLSv1.3</code> ];</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  启用指定的协议。 </p><blockquote class="note">   <code class="notranslate">TLSv1.1</code>和<code class="notranslate">TLSv1.2</code>参数（ <code class="notranslate">TLSv1.2</code> ）仅在使用OpenSSL 1.0.1或更高版本时有效。 </blockquote><p></p><blockquote class="note">  仅当使用使用TLSv1.3支持构建的OpenSSL 1.1.1时， <code class="notranslate">TLSv1.3</code>参数（1.13.0）才有效。 </blockquote><p></p><a name="ssl_session_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_session_cache</strong> 
    <code class="notranslate">off</code> |
    <code class="notranslate">none</code> |
    [ <code class="notranslate">builtin</code> [: <code class="notranslate"><i>size</i></code> ]]
    [ <code class="notranslate">shared</code> : <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code> ];</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_session_cache none;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置存储会话参数的缓存的类型和大小。  缓存可以是以下任何类型： </p><dl class="compact"><dt> <code class="notranslate">off</code> </dt> <dd>  严格禁止使用会话缓存：nginx明确告诉客户端会话可能不会被重用。 </dd><dt> <code class="notranslate">none</code> </dt> <dd>  轻轻地禁止使用会话缓存：nginx告诉客户端会话可以重用，但实际上并不会将会话参数存储在缓存中。 </dd><dt id="ssl_session_cache_builtin"> <code class="notranslate">builtin</code> </dt> <dd>  一个用OpenSSL构建的缓存;  仅由一个工作进程使用。  缓存大小在会话中指定。  如果未给出大小，则等于20480个会话。  使用内置缓存可能会导致内存碎片。 </dd><dt id="ssl_session_cache_shared"> <code class="notranslate">shared</code> </dt> <dd>  所有工作进程之间共享的缓存。  高速缓存大小以字节为单位指定;  一兆字节可以存储大约4000个会话。  每个共享缓存都应具有任意名称。  可以在多个虚拟服务器中使用具有相同名称的缓存。 </dd></dl><p></p><p>  两种缓存类型可以同时使用，例如： </p><blockquote class="example"><pre class="notranslate">ssl_session_cache builtin:1000 shared:SSL:10m;
</pre></blockquote><p>  但只使用没有内置缓存的共享缓存应该更有效。 </p><a name="ssl_session_ticket_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_session_ticket_key</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.5.7版本中。 </p></div><p>  设置具有用于加密和解密TLS会话票证的密钥的<code class="notranslate"><i>file</i></code> 。  如果必须在多个服务器之间共享相同的密钥，则该指令是必需的。  默认情况下，使用随机生成的密钥。 </p><p>  如果指定了多个密钥，则仅使用第一个密钥来加密TLS会话票证。  这允许配置键旋转，例如： </p><blockquote class="example"><pre class="notranslate">ssl_session_ticket_key current.key;
ssl_session_ticket_key previous.key;
</pre></blockquote><p></p><p>  该<code class="notranslate"><i>file</i></code>必须包含80或48个字节的随机数据，并且可以使用以下命令创建： </p><blockquote class="example"><pre class="notranslate">openssl rand 80 &gt; ticket.key
</pre></blockquote><p>  根据文件大小，AES256（对于80字节密钥，1.11.8）或AES128（对于48字节密钥）用于加密。 </p><a name="ssl_session_tickets"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_session_tickets</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_session_tickets on;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.5.9版本中。 </p></div><p>  通过<a href="https://tools.ietf.org/html/rfc5077">TLS会话票证</a>启用或禁用会话恢复。 </p><a name="ssl_session_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_session_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_session_timeout 5m;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  指定客户端可以重用会话参数的时间。 </p><a name="ssl_stapling"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_stapling</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_stapling off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.3.7版本中。 </p></div><p>  启用或禁用服务器<a href="https://tools.ietf.org/html/rfc6066#section-8">对OCSP响应</a>的<a href="https://tools.ietf.org/html/rfc6066#section-8">装订</a> 。  例： </p><blockquote class="example"><pre class="notranslate">ssl_stapling on;
resolver 192.0.2.1;
</pre></blockquote><p></p><p>  要使OCSP装订起作用，应该知道服务器证书颁发者的证书。  如果<a href="#ssl_certificate">ssl_certificate</a>文件不包含中间证书，则服务器证书颁发者的证书应存在于<a href="#ssl_trusted_certificate">ssl_trusted_certificate</a>文件中。 </p><p>  要解析OCSP响应程序主机名，还应指定<a href="ngx_http_core_module.html#resolver">解析程序</a>指令。 </p><a name="ssl_stapling_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_stapling_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.3.7版本中。 </p></div><p>  设置后，将从指定的<code class="notranslate"><i>file</i></code>获取装订的OCSP响应，而不是查询服务器证书中指定的OCSP响应程序。 </p><p>  该文件应为DER格式，由“ <code class="notranslate">openssl ocsp</code> ”命令生成。 </p><a name="ssl_stapling_responder"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_stapling_responder</strong> <code class="notranslate"><i>url</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.3.7版本中。 </p></div><p>  覆盖“ <a href="https://tools.ietf.org/html/rfc5280#section-4.2.2.1">Authority Information Access</a> ”证书扩展中指定的OCSP响应程序的URL。 </p><p>  仅支持“ <code class="notranslate">http://</code> ”OCSP响应者： </p><blockquote class="example"><pre class="notranslate">ssl_stapling_responder http://ocsp.example.com/;
</pre></blockquote><p></p><a name="ssl_stapling_verify"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_stapling_verify</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_stapling_verify off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.3.7版本中。 </p></div><p>  启用或禁用服务器对OCSP响应的验证。 </p><p>  要使验证<a href="#ssl_trusted_certificate">生效，</a>应使用<a href="#ssl_trusted_certificate">ssl_trusted_certificate</a>指令将服务器证书颁发者的证书，根证书和所有中间证书配置为受信任。 </p><a name="ssl_trusted_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_trusted_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.3.7版本中。 </p></div><p>  如果启用了<a href="#ssl_stapling">ssl_stapling，</a>则指定具有PEM格式的可信CA证书的<code class="notranslate"><i>file</i></code> ，该证书用于<a href="#ssl_verify_client">验证</a>客户端证书和OCSP响应。 </p><p>  与<a href="#ssl_client_certificate">ssl_client_certificate</a>设置的证书<a href="#ssl_client_certificate">不同</a> ，这些证书的列表不会发送给客户端。 </p><a name="ssl_verify_client"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_verify_client</strong> 
    <code class="notranslate">on</code> | <code class="notranslate">off</code> |
    <code class="notranslate">optional</code> | <code class="notranslate">optional_no_ca</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_verify_client off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  启用客户端证书验证。  验证结果存储在<a href="#var_ssl_client_verify">$ ssl_client_verify</a>变量中。 </p><p>   <code class="notranslate">optional</code>参数（0.8.7+）请求客户端证书，并在证书存在时验证它。 </p><p>   <code class="notranslate">optional_no_ca</code>参数（1.3.8,1.2.5）请求客户端证书，但不要求它由受信任的CA证书签名。  这适用于nginx外部的服务执行实际证书验证的情况。  可以通过<a href="#var_ssl_client_cert">$ ssl_client_cert</a>变量访问证书的内容。 </p><a name="ssl_verify_depth"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>ssl_verify_depth</strong> <code class="notranslate"><i>number</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">ssl_verify_depth 1;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置客户端证书链中的验证深度。 </p><a name="errors"></a><center><h4>  错误处理 </h4></center><p>   <code class="notranslate">ngx_http_ssl_module</code>模块支持几个非标准错误代码，可以使用<a href="ngx_http_core_module.html#error_page">error_page</a>指令用于重定向： </p><dl class="compact"><dt>   495 </dt><dd>  客户端证书验证期间发生错误; </dd><dt>   496 </dt><dd>  客户未提交所需证书; </dd><dt>   497 </dt><dd>  已将常规请求发送到HTTPS端口。 </dd></dl><p></p><p>  重定向发生在完全解析请求并且变量（例如<code class="notranslate">$request_uri</code> ， <code class="notranslate">$uri</code> ， <code class="notranslate">$args</code>和其他变量）可用之后。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_ssl_module</code>模块支持几个嵌入变量： </p><dl class="compact"><dt id="var_ssl_cipher"> <code class="notranslate">$ssl_cipher</code> </dt> <dd>  返回用于建立的SSL连接的密码字符串; </dd><dt id="var_ssl_ciphers"> <code class="notranslate">$ssl_ciphers</code> </dt> <dd>  返回客户端支持的密码列表（1.11.7）。  已知密码按名称列出，未知以十六进制显示，例如： <blockquote class="example"><pre class="notranslate">AES128-SHA:AES256-SHA:0x00ff
</pre></blockquote><blockquote class="note">  仅在使用OpenSSL 1.0.2或更高版本时才完全支持该变量。  对于旧版本，该变量仅适用于新会话，仅列出已知密码。 </blockquote></dd><dt id="var_ssl_client_escaped_cert"> <code class="notranslate">$ssl_client_escaped_cert</code> </dt> <dd>  以PEM格式（urlencoded）返回已建立SSL连接的客户端证书（1.13.5）; </dd><dt id="var_ssl_client_cert"> <code class="notranslate">$ssl_client_cert</code> </dt> <dd>  为已建立的SSL连接返回PEM格式的客户端证书，除了第一行前面的每一行都带有制表符;  这适用于<a href="ngx_http_proxy_module.html#proxy_set_header">proxy_set_header</a>指令; <blockquote class="note">  不推荐使用该变量，应该使用<code class="notranslate">$ssl_client_escaped_cert</code>变量。 </blockquote></dd><dt id="var_ssl_client_fingerprint"> <code class="notranslate">$ssl_client_fingerprint</code> </dt> <dd>  返回已建立SSL连接的客户端证书的SHA1指纹（1.7.1）; </dd><dt id="var_ssl_client_i_dn"> <code class="notranslate">$ssl_client_i_dn</code> </dt> <dd>  根据<a href="https://tools.ietf.org/html/rfc2253">RFC 2253</a> （1.11.6），为已建立的SSL连接返回客户端证书的“issuer DN”字符串; </dd><dt id="var_ssl_client_i_dn_legacy"> <code class="notranslate">$ssl_client_i_dn_legacy</code> </dt> <dd>  返回已建立SSL连接的客户端证书的“issuer DN”字符串; <blockquote class="note">  在1.11.6版之前，变量名称为<code class="notranslate">$ssl_client_i_dn</code> 。 </blockquote></dd><dt id="var_ssl_client_raw_cert"> <code class="notranslate">$ssl_client_raw_cert</code> </dt> <dd>  返回已建立SSL连接的PEM格式的客户端证书; </dd><dt id="var_ssl_client_s_dn"> <code class="notranslate">$ssl_client_s_dn</code> </dt> <dd>  根据<a href="https://tools.ietf.org/html/rfc2253">RFC 2253</a> （1.11.6），为已建立的SSL连接返回客户端证书的“subject DN”字符串; </dd><dt id="var_ssl_client_s_dn_legacy"> <code class="notranslate">$ssl_client_s_dn_legacy</code> </dt> <dd>  返回已建立SSL连接的客户端证书的“subject DN”字符串; <blockquote class="note">  在1.11.6版之前，变量名称为<code class="notranslate">$ssl_client_s_dn</code> 。 </blockquote></dd><dt id="var_ssl_client_serial"> <code class="notranslate">$ssl_client_serial</code> </dt> <dd>  返回已建立的SSL连接的客户端证书的序列号; </dd><dt id="var_ssl_client_v_end"> <code class="notranslate">$ssl_client_v_end</code> </dt> <dd>  返回客户端证书的结束日期（1.11.7）; </dd><dt id="var_ssl_client_v_remain"> <code class="notranslate">$ssl_client_v_remain</code> </dt> <dd>  返回客户端证书到期前的天数（1.11.7）; </dd><dt id="var_ssl_client_v_start"> <code class="notranslate">$ssl_client_v_start</code> </dt> <dd>  返回客户端证书的开始日期（1.11.7）; </dd><dt id="var_ssl_client_verify"> <code class="notranslate">$ssl_client_verify</code> </dt> <dd>  返回客户端证书验证的结果：“ <code class="notranslate">SUCCESS</code> ”，“ <code class="notranslate">FAILED:</code> <code class="notranslate"><i>reason</i></code> ”，如果证书不存在则返回“ <code class="notranslate">NONE</code> ”; <blockquote class="note">  在1.11.7版之前，“ <code class="notranslate">FAILED</code> ”结果不包含<code class="notranslate"><i>reason</i></code>字符串。 </blockquote></dd><dt id="var_ssl_curves"> <code class="notranslate">$ssl_curves</code> </dt> <dd>  返回客户端支持的曲线列表（1.11.7）。  已知曲线按名称列出，未知以十六进制显示，例如： <blockquote class="example"><pre class="notranslate">0x001d:prime256v1:secp521r1:secp384r1
</pre></blockquote><blockquote class="note">  仅在使用OpenSSL 1.0.2或更高版本时才支持该变量。  对于旧版本，变量值将为空字符串。 </blockquote><blockquote class="note">  该变量仅适用于新会话。 </blockquote></dd><dt id="var_ssl_early_data"> <code class="notranslate">$ssl_early_data</code> </dt> <dd>  如果使用TLS 1.3 <a href="#ssl_early_data">早期数据</a>并且握手未完成则返回“ <code class="notranslate">1</code> ”，否则返回“”（1.15.3）。 </dd><dt id="var_ssl_protocol"> <code class="notranslate">$ssl_protocol</code> </dt> <dd>  返回已建立的SSL连接的协议; </dd><dt id="var_ssl_server_name"> <code class="notranslate">$ssl_server_name</code> </dt> <dd>  返回通过<a href="http://en.wikipedia.org/wiki/Server_Name_Indication">SNI</a> （1.7.0）请求的服务器名称; </dd><dt id="var_ssl_session_id"> <code class="notranslate">$ssl_session_id</code> </dt> <dd>  返回已建立的SSL连接的会话标识; </dd><dt id="var_ssl_session_reused"> <code class="notranslate">$ssl_session_reused</code> </dt> <dd>  如果重用SSL会话，则返回“ <code class="notranslate">r</code> ”，或“ <code class="notranslate">.</code>   “否则（1.5.11）。 </dd></dl><p></p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>