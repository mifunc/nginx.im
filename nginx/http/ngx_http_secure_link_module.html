<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_secure_link_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="secure,link,md5,secret,location"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_secure_link_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#directives">Directives</a> <br>     <a href="#secure_link">secure_link</a> <br>     <a href="#secure_link_md5">secure_link_md5</a> <br>     <a href="#secure_link_secret">secure_link_secret</a> <br> <a href="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_secure_link_module</code>模块（0.7.18）用于检查请求链路的真实性，保护资源免受未经授权的访问，并限制链路生存期。 </p><p>  通过将请求中传递的校验和值与为请求计算的值进行比较来验证所请求链接的真实性。  如果链接的生命周期有限且时间已过，则该链接将被视为过时。  这些检查的状态在<code class="notranslate">$secure_link</code>变量中可用。 </p><p>  该模块提供两种备选操作模式。  第一种模式由<a href="#secure_link_secret">secure_link_secret</a>指令启用，用于检查请求链接的真实性以及保护资源免受未经授权的访问。  第二种模式（0.8.50）由<a href="#secure_link">secure_link</a>和<a href="#secure_link_md5">secure_link_md5</a>指令启用，也用于限制链接的生命周期。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">--with-http_secure_link_module</code>配置参数启用它。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="secure_link"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>secure_link</strong> <code class="notranslate"><i>expression</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  定义一个包含变量的字符串，从中提取链接的校验和值和生命周期。 </p><p>   <code class="notranslate"><i>expression</i></code>中使用的变量通常与请求相关联;  见下面的<a href="#secure_link_md5">例子</a> 。 </p><p>  将从字符串中提取的校验和值与<a href="#secure_link_md5">secure_link_md5</a>指令定义的表达式的MD5哈希值进行比较。  如果校验和不同，则<code class="notranslate">$secure_link</code>变量设置为空字符串。  如果校验和相同，则检查链路生存期。  如果链接的生命周期有限且时间已过，则<code class="notranslate">$secure_link</code>变量设置为“ <code class="notranslate">0</code> ”。  否则，它被设置为“ <code class="notranslate">1</code> ”。  请求中传递的MD5哈希值在<a href="https://tools.ietf.org/html/rfc4648#section-5">base64url中</a>编码。 </p><p>  如果链接的生命周期有限，则到期时间设置为自Epoch（Thu，1970年1月1日1970:00 00:00:00 GMT）以来的秒数。  该值在MD5哈希之后的表达式中指定，并以逗号分隔。  请求中传递的到期时间可通过<code class="notranslate">$secure_link_expires</code>变量获得，以便在<a href="#secure_link_md5">secure_link_md5</a>指令中使用。  如果未指定到期时间，则链接具有无限生存期。 </p><a name="secure_link_md5"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>secure_link_md5</strong> <code class="notranslate"><i>expression</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  定义将为其计算MD5哈希值并与请求中传递的值进行比较的表达式。 </p><p>  表达式应包含链接（资源）和秘密成分的安全部分。  如果链接的生命周期有限，则表达式还应包含<code class="notranslate">$secure_link_expires</code> 。 </p><p>  为防止未经授权的访问，表达式可能包含有关客户端的一些信息，例如其地址和浏览器版本。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">location /s/ {
    secure_link $arg_md5,$arg_expires;
    secure_link_md5 "$secure_link_expires$uri$remote_addr secret";

    if ($secure_link = "") {
        return 403;
    }

    if ($secure_link = "0") {
        return 410;
    }

    ...
}
</pre></blockquote><p>   “ <code class="notranslate">/s/link?md5=_e4Nc3iduzkWRm01TBBNYw&amp;expires=2147483647</code> ”链接限制对IP地址为127.0.0.1的客户端的“ <code class="notranslate">/s/link</code> ”访问。  该链接的使用寿命有限，直到2038年1月19日（GMT）。 </p><p>  在UNIX上， <code class="notranslate"><i>md5</i></code>请求参数值可以获取为： </p><blockquote class="example"><pre class="notranslate">echo -n '2147483647/s/link127.0.0.1 secret' | \
    openssl md5 -binary | openssl base64 | tr +/ -_ | tr -d =
</pre></blockquote><p></p><a name="secure_link_secret"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>secure_link_secret</strong> <code class="notranslate"><i>word</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  定义用于检查所请求链接的真实性的密码。 </p><p>  请求链接的完整URI如下所示： </p><blockquote class="example"><pre class="notranslate">/ <code class="notranslate"><i>prefix</i></code> / <code class="notranslate"><i>hash</i></code> / <code class="notranslate"><i>link</i></code>
</pre></blockquote><p>   <code class="notranslate"><i>hash</i></code>是为链接和秘密字的串联计算的MD5哈希的十六进制表示，而<code class="notranslate"><i>prefix</i></code>是没有斜杠的任意字符串。 </p><p>  如果请求的链接通过了真实性检查，则<code class="notranslate">$secure_link</code>变量将设置为从请求URI中提取的链接。  否则， <code class="notranslate">$secure_link</code>变量设置为空字符串。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">location /p/ {
    secure_link_secret secret;

    if ($secure_link = "") {
        return 403;
    }

    rewrite ^ /secure/$secure_link;
}

location /secure/ {
    internal;
}
</pre></blockquote><p>   “ <code class="notranslate">/p/5e814704a28d9bc1914ff19fa0c4a00a/link</code> ”的请求将在内部重定向到“ <code class="notranslate">/secure/link</code> ”。 </p><p>  在UNIX上，此示例的哈希值可以获得为： </p><blockquote class="example"><pre class="notranslate">echo -n 'linksecret' | openssl md5 -hex
</pre></blockquote><p></p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p></p><dl><dt id="var_secure_link"> <code class="notranslate">$secure_link</code> </dt> <dd>  链接检查的状态。  具体值取决于所选的操作模式。 </dd><dt id="var_secure_link_expires"> <code class="notranslate">$secure_link_expires</code> </dt> <dd>  请求中传递的链接的生命周期;  仅用于<a href="#secure_link_md5">secure_link_md5</a>指令。 </dd></dl><p></p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>