<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_session_log_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="log,session,zone,format,combined"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_session_log_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#session_log">session_log</a> <br>     <a href="#session_log_format">session_log_format</a> <br>     <a href="#session_log_zone">session_log_zone</a> <br> <a href="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_session_log_module</code>模块启用日志记录会话（即多个HTTP请求的聚合），而不是单个HTTP请求。 </p><p></p><blockquote class="note">  该模块作为我们<a href="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  以下配置根据请求客户端地址和“User-Agent”请求标头字段设置会话日志并将请求映射到会话： </p><blockquote class="example"><pre class="notranslate">    session_log_zone /path/to/log format=combined
                     zone=one:1m timeout=30s
                     md5=$binary_remote_addr$http_user_agent;

    location /media/ {
        session_log one;
    }
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="session_log"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>session_log</strong> <code class="notranslate"><i>name</i></code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">session_log off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  允许使用指定的会话日志。  特殊值<code class="notranslate">off</code>取消从先前配置级别继承的所有<code class="notranslate">session_log</code>指令。 </p><a name="session_log_format"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>session_log_format</strong> 
    <code class="notranslate"><i>name</i></code>
    <code class="notranslate"><i>string</i></code> ...;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">session_log_format combined "...";</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> <br>
                </td></tr></tbody></table></div><p>  指定日志的输出格​​式。   <code class="notranslate">$body_bytes_sent</code>变量的值在会话中的所有请求中聚合。  可用于记录的所有其他变量的值对应于会话中的第一个请求。 </p><a name="session_log_zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>session_log_zone</strong> 
    <code class="notranslate"><i>path</i></code>
    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code>
    [ <code class="notranslate">format</code> = <code class="notranslate"><i>format</i></code> ]
    [ <code class="notranslate">timeout</code> = <code class="notranslate"><i>time</i></code> ]
    [ <code class="notranslate">id</code> = <code class="notranslate"><i>id</i></code> ]
    [ <code class="notranslate">md5</code> = <code class="notranslate"><i>md5</i></code> ]
;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> <br>
                </td></tr></tbody></table></div><p>  设置日志文件的路径，并配置用于存储当前活动会话的共享内存区域。 </p><p>  只要会话中的最后一个请求自指定<code class="notranslate">timeout</code> （默认为30秒）以来经过的时间，会话就被视为活动状态。  会话不再处于活动状态时，会将其写入日志。 </p><p>   <code class="notranslate">id</code>参数标识请求映射到的会话。   <code class="notranslate">id</code>参数设置为MD5哈希的十六进制表示（例如，使用变量从cookie获取）。  如果未指定此参数或不表示有效的MD5哈希，则nginx将根据<code class="notranslate">md5</code>参数的值计算MD5哈希，并使用此哈希创建新会话。   <code class="notranslate">id</code>和<code class="notranslate">md5</code>参数都可以包含变量。 </p><p>   <code class="notranslate">format</code>参数设置<a href="#session_log_format">session_log_format</a>指令配置的自定义会话日志格式。  如果未指定format，则使用预定义的“ <code class="notranslate">combined</code> ”格式。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_session_log_module</code>模块支持两个嵌入变量： </p><dl class="compact"><dt id="var_session_log_id"> <code class="notranslate">$session_log_id</code> </dt> <dd>  当前会话ID; </dd><dt id="var_session_log_binary_id"> <code class="notranslate">$session_log_binary_id</code> </dt> <dd>  二进制形式的当前会话ID（16字节）。 </dd></dl><p></p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>