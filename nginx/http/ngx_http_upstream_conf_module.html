<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_upstream_conf_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="upstream,127.0,0.1,backend,conf"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_upstream_conf_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#upstream_conf">upstream_conf</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_upstream_conf_module</code>模块允许通过简单的HTTP接口即时配置上游服务器组，而无需重新启动nginx。   <a href="ngx_http_upstream_module.html#zone">http</a>或<a href="stream/ngx_stream_upstream_module.html#zone">流</a>服务器组必须驻留在共享内存中。 </p><blockquote class="note">  该模块作为我们<a href="http://nginx.com/products/">商业订阅的</a>一部分提供，直到1.13.10。  它被1.13.3中的<a href="ngx_http_api_module.html">ngx_http_api_module</a>模块取代。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">upstream backend {
    zone upstream_backend 64k;

    ...
}

server {
    location /upstream_conf {
        <strong>upstream_conf</strong> ;
        allow 127.0.0.1;
        deny all;
    }
}
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="upstream_conf"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>upstream_conf</strong> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  打开周围位置的上游配置的HTTP接口。  应<a href="ngx_http_core_module.html#satisfy">限制</a>访问此位置。 </p><p>  配置命令可用于： </p><ul class="compact"><li>  查看组配置; </li><li>  查看，修改或删除服务器; </li><li>  添加新服务器。 </li></ul><p></p><blockquote class="note">  由于组中的地址不需要是唯一的，因此组中的特定服务器由其ID引用。  添加新服务器或查看组配置时，会自动分配ID并显示ID。 </blockquote><p></p><p>  配置命令由作为请求参数传递的参数组成，例如： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?upstream=backend
</pre></blockquote><p></p><p>  支持以下参数： </p><dl><dt> <code class="notranslate">stream=</code> </dt> <dd>  选择<a href="stream/ngx_stream_upstream_module.html">流</a>上游服务器组。  如果没有此参数，请选择<a href="ngx_http_upstream_module.html">http</a>上游服务器组。 </dd><dt>   <code class="notranslate">upstream=</code> <code class="notranslate"><i>name</i></code> </dt><dd>  选择要使用的组。  此参数是必需的。 </dd><dt>   <code class="notranslate">id=</code> <code class="notranslate"><i>number</i></code> </dt><dd>  选择用于查看，修改或删除的服务器。 </dd><dt> <code class="notranslate">remove=</code> </dt> <dd>  从组中删除服务器。 </dd><dt> <code class="notranslate">add=</code> </dt> <dd>  向组中添加新服务器。 </dd><dt> <code class="notranslate">backup=</code> </dt> <dd>  需要添加备份服务器。 <blockquote class="note">  在1.7.2版之前，还需要<code class="notranslate">backup=</code>来查看，修改或删除现有备份服务器。 </blockquote></dd><dt>   <code class="notranslate">server=</code> <code class="notranslate"><i>address</i></code> </dt><dd>  与<a href="ngx_http_upstream_module.html#server">http</a>或<a href="stream/ngx_stream_upstream_module.html#server">流</a>上游服务器的“ <code class="notranslate">address</code> ”参数相同。 <p>  添加服务器时，可以将其指定为域名。  在这种情况下，将监视与域名对应的IP地址的更改并自动应用于上游配置，而无需重新启动nginx（1.7.2）。  这需要<a href="ngx_http_core_module.html#resolver">http</a>或<a href="stream/ngx_stream_core_module.html#resolver">流</a>块中的“ <code class="notranslate">resolver</code> ”指令。  另请参阅<a href="ngx_http_upstream_module.html#resolve">http</a>或<a href="stream/ngx_stream_upstream_module.html#resolve">流</a>上游服务器的“ <code class="notranslate">resolve</code> ”参数。 </p></dd><dt>   <code class="notranslate">service=</code> <code class="notranslate"><i>name</i></code> </dt><dd>  与<a href="ngx_http_upstream_module.html#service">http</a>或<a href="stream/ngx_stream_upstream_module.html#service">流</a>上游服务器的“ <code class="notranslate">service</code> ”参数相同（1.9.13）。 </dd><dt>   <code class="notranslate">weight=</code> <code class="notranslate"><i>number</i></code> </dt><dd>  与<a href="ngx_http_upstream_module.html#weight">http</a>或<a href="stream/ngx_stream_upstream_module.html#weight">流</a>上游服务器的“ <code class="notranslate">weight</code> ”参数相同。 </dd><dt>   <code class="notranslate">max_conns=</code> <code class="notranslate"><i>number</i></code> </dt><dd>  与<a href="ngx_http_upstream_module.html#max_conns">http</a>或<a href="stream/ngx_stream_upstream_module.html#max_conns">流</a>上游服务器的“ <code class="notranslate">max_conns</code> ”参数相同。 </dd><dt>   <code class="notranslate">max_fails=</code> <code class="notranslate"><i>number</i></code> </dt><dd>  与<a href="ngx_http_upstream_module.html#max_fails">http</a>或<a href="stream/ngx_stream_upstream_module.html#max_fails">流</a>上游服务器的“ <code class="notranslate">max_fails</code> ”参数相同。 </dd><dt>   <code class="notranslate">fail_timeout=</code> <code class="notranslate"><i>time</i></code> </dt><dd>  与<a href="ngx_http_upstream_module.html#fail_timeout">http</a>或<a href="stream/ngx_stream_upstream_module.html#fail_timeout">流</a>上游服务器的“ <code class="notranslate">fail_timeout</code> ”参数相同。 </dd><dt>   <code class="notranslate">slow_start=</code> <code class="notranslate"><i>time</i></code> </dt><dd>  与<a href="ngx_http_upstream_module.html#slow_start">http</a>或<a href="stream/ngx_stream_upstream_module.html#slow_start">流</a>上游服务器的“ <code class="notranslate">slow_start</code> ”参数相同。 </dd><dt> <code class="notranslate">down=</code> </dt> <dd>  与<a href="ngx_http_upstream_module.html#down">http</a>或<a href="stream/ngx_stream_upstream_module.html#down">流</a>上游服务器的“ <code class="notranslate">down</code> ”参数相同。 </dd><dt id="drain"> <code class="notranslate">drain=</code> </dt> <dd>  将<a href="ngx_http_upstream_module.html">http</a>上游服务器置于“排空”模式（1.7.5）。  在此模式下，只有<a href="ngx_http_upstream_module.html#sticky">绑定</a>到服务器的请求才会被代理。 </dd><dt> <code class="notranslate">up=</code> </dt> <dd>  与<a href="ngx_http_upstream_module.html#down">http</a>或<a href="stream/ngx_stream_upstream_module.html#down">流</a>上游服务器的“ <code class="notranslate">down</code> ”参数相反。 </dd><dt>   <code class="notranslate">route=</code> <code class="notranslate"><i>string</i></code> </dt><dd>  与<a href="ngx_http_upstream_module.html#route">http</a>上游服务器的“ <code class="notranslate">route</code> ”参数相同。 </dd></dl><p>  前三个参数选择一个对象。  这可以是整个http或流上游服务器组，也可以是特定服务器。  如果没有其他参数，则会显示所选组或服务器的配置。 </p><p>  例如，要查看整个组的配置，请发送： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?upstream=backend
</pre></blockquote><p>  要查看特定服务器的配置，还要指定其ID： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42
</pre></blockquote><p></p><p>  要添加新服务器，请在“ <code class="notranslate">server=</code> ”参数中指定其地址。  如果未指定其他参数，将添加服务器，并将其他参数设置为其默认值（请参阅<a href="ngx_http_upstream_module.html#server">http</a>或<a href="stream/ngx_stream_upstream_module.html#server">流</a> “ <code class="notranslate">server</code> ”指令）。 </p><p>  例如，要添加新的主服务器，请发送： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;server=127.0.0.1:8080
</pre></blockquote><p>  要添加新的备份服务器，请发送： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;backup=&amp;server=127.0.0.1:8080
</pre></blockquote><p>  要添加新的主服务器，请将其参数设置为非默认值并将其标记为“ <code class="notranslate">down</code> ”，发送： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;server=127.0.0.1:8080&amp;weight=2&amp;down=
</pre></blockquote><p>  要删除服务器，请指定其ID： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?remove=&amp;upstream=backend&amp;id=42
</pre></blockquote><p>  要将现有服务器标记为“ <code class="notranslate">down</code> ”，请发送： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;down=
</pre></blockquote><p>  要修改现有服务器的地址，请发送： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;server=192.0.2.3:8123
</pre></blockquote><p>  要修改现有服务器的其他参数，请发送： </p><blockquote class="example"><pre class="notranslate">http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;max_fails=3&amp;weight=4
</pre></blockquote><p>  以上示例适用于<a href="ngx_http_upstream_module.html">http</a>上游服务器组。   <a href="stream/ngx_stream_upstream_module.html">流</a>上游服务器组的类似示例需要“ <code class="notranslate">stream=</code> ”参数。 </p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>