<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_map_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="example,com,map,http,default"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_map_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#map">map</a> <br>     <a href="#map_hash_bucket_size">map_hash_bucket_size</a> <br>     <a href="#map_hash_max_size">map_hash_max_size</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_map_module</code>模块创建的变量的值取决于其他变量的值。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">map $http_host $name {
    hostnames;

    default       0;

    example.com   1;
    *.example.com 1;
    example.org   2;
    *.example.org 2;
    .example.net  3;
    wap.*         4;
}

map $http_user_agent $mobile {
    default       0;
    "~Opera Mini" 1;
}
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="map"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>map</strong> 
    <code class="notranslate"><i>string</i></code>
    <code class="notranslate"><i>$variable</i></code> { ... }</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> <br>
                </td></tr></tbody></table></div><p>  创建一个新变量，其值取决于第一个参数中指定的一个或多个源变量的值。 </p><blockquote class="note">  在0.9.0版之前，只能在第一个参数中指定单个变量。 </blockquote><p></p><p></p><blockquote class="note">  由于变量仅在使用时进行评估，因此即使是大量“ <code class="notranslate">map</code> ”变量的声明也不会增加请求处理的额外成本。 </blockquote><p></p><p>  地图块内的参数指定源和结果值之间的映射。 </p><p>  源值指定为字符串或正则表达式（0.9.6）。 </p><p>  字符串匹配忽略大小写。 </p><p>  对于区分大小写的匹配，正则表达式应该从“ <code class="notranslate">~</code> ”符号开始，或者对于不区分大小写的匹配，应该从“ <code class="notranslate">~*</code> ”符号（1.0.4）开始。  正则表达式可以包含命名和位置捕获，以后可以在其他指令中使用结果变量。 </p><p>  如果源值与下面描述的特殊参数名称之一匹配，则应使用“ <code class="notranslate">\</code> ”符号作为前缀。 </p><p>  结果值可以包含文本，变量（0.9.0）及其组合（1.11.0）。 </p><p>  还支持以下特殊参数： </p><dl class="compact"><dt>   <code class="notranslate">default</code> <code class="notranslate"><i>value</i></code> </dt><dd>  如果源值与任何指定的变量都不匹配，则设置结果值。  如果未指定default，则默认结果值将为空字符串。 </dd><dt> <code class="notranslate">hostnames</code> </dt> <dd>  表示源值可以是带有前缀或后缀掩码的主机名： <blockquote class="example"><pre class="notranslate">*.example.com 1;
example.*     1;
</pre></blockquote>  以下两条记录 <blockquote class="example"><pre class="notranslate">example.com   1;
*.example.com 1;
</pre></blockquote>  可以合并： <blockquote class="example"><pre class="notranslate">.example.com  1;
</pre></blockquote>  应在值列表之前指定此参数。 </dd><dt>   <code class="notranslate">include</code> <code class="notranslate"><i>file</i></code> </dt><dd>  包含一个包含值的文件。  可能有几个夹杂物。 </dd><dt id="volatile"> <code class="notranslate">volatile</code> </dt> <dd>  表示该变量不可缓存（1.11.7）。 </dd></dl><p></p><p>  如果源值与多个指定变量匹配，例如掩码和正则表达式匹配，则将按以下优先级顺序选择第一个匹配变量： </p><ol class="compact"><li>  没有掩码的字符串值 </li><li>  带有前缀掩码的最长字符串值，例如“ <code class="notranslate">*.example.com</code> ” </li><li>  带有后缀掩码的最长字符串值，例如“ <code class="notranslate">mail.*</code> ” </li><li>  第一个匹配正则表达式（按配置文件中的出现顺序） </li><li>  默认值 </li></ol><p></p><a name="map_hash_bucket_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>map_hash_bucket_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">map_hash_bucket_size 32|64|128;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> <br>
                </td></tr></tbody></table></div><p>  设置<a href="#map">映射</a>变量哈希表的存储区大小。  默认值取决于处理器的缓存行大小。  设置哈希表的详细信息在单独的<a href="hash.html">文档</a>中提供。 </p><a name="map_hash_max_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>map_hash_max_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">map_hash_max_size 2048;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> <br>
                </td></tr></tbody></table></div><p>  设置<a href="#map">映射</a>变量哈希表的最大<code class="notranslate"><i>size</i></code> 。  设置哈希表的详细信息在单独的<a href="hash.html">文档</a>中提供。 </p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>