<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_realip_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="real,ip,set,192.168,header"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_realip_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#set_real_ip_from">set_real_ip_from</a> <br>     <a href="#real_ip_header">real_ip_header</a> <br>     <a href="#real_ip_recursive">real_ip_recursive</a> <br> <a href="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_realip_module</code>模块用于将客户端地址和可选端口更改为在指定的头字段中发送的端口。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">--with-http_realip_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">set_real_ip_from  192.168.1.0/24;
set_real_ip_from  192.168.2.1;
set_real_ip_from  2001:0db8::/32;
real_ip_header    X-Forwarded-For;
real_ip_recursive on;
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="set_real_ip_from"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>set_real_ip_from</strong> 
    <code class="notranslate"><i>address</i></code> |
    <code class="notranslate"><i>CIDR</i></code> |
    <code class="notranslate">unix:</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  定义已知可发送正确替换地址的可信地址。  如果指定了特殊值<code class="notranslate">unix:</code>则所有UNIX域套接字都将受信任。  也可以使用主机名（1.13.1）指定可信地址。 </p><blockquote class="note">  从版本1.3.0和1.2.1开始支持IPv6地址。 </blockquote><p></p><a name="real_ip_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>real_ip_header</strong> 
    <code class="notranslate"><i>field</i></code> |
    <code class="notranslate">X-Real-IP</code> |
    <code class="notranslate">X-Forwarded-For</code> |
    <code class="notranslate">proxy_protocol</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">real_ip_header X-Real-IP;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  定义请求标头字段，其值将用于替换客户端地址。 </p><p>  包含可选端口的请求标头字段值也用于替换客户端端口（1.11.0）。  应根据<a href="https://tools.ietf.org/html/rfc3986">RFC 3986</a>指定地址和端口。 </p><p>   <code class="notranslate">proxy_protocol</code>参数（1.5.12）将客户端地址更改为PROXY协议头中的地址。  必须先通过在<a href="ngx_http_core_module.html#listen">listen</a>指令中设置<code class="notranslate">proxy_protocol</code>参数来启用PROXY协议。 </p><a name="real_ip_recursive"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>real_ip_recursive</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">real_ip_recursive off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.3.0和1.2.1版本中。 </p></div><p>  如果禁用递归搜索，则匹配其中一个可信地址的原始客户端地址将替换为<a href="#real_ip_header">real_ip_header</a>指令定义的请求头字段中发送的最后一个地址。  如果启用了递归搜索，则匹配其中一个可信地址的原始客户端地址将替换为请求头字段中发送的最后一个非受信任地址。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p></p><dl class="compact"><dt id="var_realip_remote_addr"> <code class="notranslate">$realip_remote_addr</code> </dt> <dd>  保留原始客户地址（1.9.7） </dd><dt id="var_realip_remote_port"> <code class="notranslate">$realip_remote_port</code> </dt> <dd>  保留原始客户端端口（1.11.0） </dd></dl><p></p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>