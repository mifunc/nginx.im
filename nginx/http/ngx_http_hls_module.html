<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_hls_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="hls,mp4,test,start,end"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_hls_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#hls">hls</a> <br>     <a href="#hls_buffers">hls_buffers</a> <br>     <a href="#hls_forward_args">hls_forward_args</a> <br>     <a href="#hls_fragment">hls_fragment</a> <br>     <a href="#hls_mp4_buffer_size">hls_mp4_buffer_size</a> <br>     <a href="#hls_mp4_max_buffer_size">hls_mp4_max_buffer_size</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_hls_module</code>模块为MP4和MOV媒体文件提供HTTP实时流（HLS）服务器端支持。  此类文件通常具有<code class="notranslate">.mp4</code> ， <code class="notranslate">.m4v</code> ， <code class="notranslate">.m4a</code> ， <code class="notranslate">.mov</code>或<code class="notranslate">.qt</code>文件扩展名。  该模块支持H.264视频编解码器，AAC和MP3音频编解码器。 </p><p>  对于每个媒体文件，支持两个URI： </p><ul class="compact"><li>  带有“ <code class="notranslate">.m3u8</code> ”文件扩展名的播放列表URI。   URI可以接受可选参数： <ul class="compact"><li>   “ <code class="notranslate">start</code> ”和“ <code class="notranslate">end</code> ”以秒为单位定义播放列表边界（1.9.0）。 </li><li>   “ <code class="notranslate">offset</code> ”将初始播放位置移动到以秒为单位的时间偏移（1.9.0）。  正值设置从播放列表开头的时间偏移量。  负值设置播放列表中最后一个片段末尾的时间偏移量。 </li><li>   “ <code class="notranslate">len</code> ”以秒为单位定义片段长度。 </li></ul></li><li>  带有“ <code class="notranslate">.ts</code> ”文件扩展名的片段URI。   URI可以接受可选参数： <ul class="compact"><li>   “ <code class="notranslate">start</code> ”和“ <code class="notranslate">end</code> ”以秒为单位定义片段边界。 </li></ul></li></ul><p></p><p></p><blockquote class="note">  该模块作为我们<a href="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {
    hls;
    hls_fragment            5s;
    hls_buffers             10 10m;
    hls_mp4_buffer_size     1m;
    hls_mp4_max_buffer_size 5m;
    root /var/video/;
}
</pre></blockquote><p>  使用此配置，“/ <code class="notranslate">/var/video/test.mp4</code> ”文件支持以下URI： </p><blockquote class="example"><pre class="notranslate">http://hls.example.com/test.mp4.m3u8?offset=1.000&amp;start=1.000&amp;end=2.200
http://hls.example.com/test.mp4.m3u8?len=8.000
http://hls.example.com/test.mp4.ts?start=1.000&amp;end=2.200
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="hls"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>hls</strong> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  打开周围位置的HLS流。 </p><a name="hls_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>hls_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">hls_buffers 8 2m;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  设置用于读取和写入数据帧的缓冲区的最大<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> 。 </p><a name="hls_forward_args"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>hls_forward_args</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">hls_forward_args off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table><p>  该指令出现在1.5.12版本中。 </p></div><p>  将播放列表请求中的参数添加到片段的URI中。  这对于在请求片段时或在使用<a href="ngx_http_secure_link_module.html">ngx_http_secure_link_module</a>模块保护HLS流时执行客户端授权可能很有用。 </p><p>  例如，如果客户端请求播放列表<code class="notranslate">http://example.com/hls/test.mp4.m3u8?a=1&amp;b=2</code> ，则参数<code class="notranslate">a=1</code>和<code class="notranslate">b=2</code>将添加到参数后的片段的URI中<code class="notranslate">start</code>和<code class="notranslate">end</code> ： </p><blockquote class="example"><pre class="notranslate">#EXTM3U
#EXT-X-VERSION:3
#EXT-X-TARGETDURATION:15
#EXT-X-PLAYLIST-TYPE:VOD

#EXTINF:9.333,
test.mp4.ts?start=0.000&amp;end=9.333&amp;a=1&amp;b=2
#EXTINF:7.167,
test.mp4.ts?start=9.333&amp;end=16.500&amp;a=1&amp;b=2
#EXTINF:5.416,
test.mp4.ts?start=16.500&amp;end=21.916&amp;a=1&amp;b=2
#EXTINF:5.500,
test.mp4.ts?start=21.916&amp;end=27.416&amp;a=1&amp;b=2
#EXTINF:15.167,
test.mp4.ts?start=27.416&amp;end=42.583&amp;a=1&amp;b=2
#EXTINF:9.626,
test.mp4.ts?start=42.583&amp;end=52.209&amp;a=1&amp;b=2

#EXT-X-ENDLIST
</pre></blockquote><p></p><p>  如果使用<a href="ngx_http_secure_link_module.html">ngx_http_secure_link_module</a>模块保护HLS流，则不应在<a href="ngx_http_secure_link_module.html#secure_link_md5">secure_link_md5</a>表达式中使用<code class="notranslate">$uri</code> ，因为这会在请求片段时导致错误。  应该使用<a href="ngx_http_map_module.html#map">基URI</a>而不是<code class="notranslate">$uri</code> （ <code class="notranslate">$hls_uri</code>中为<code class="notranslate">$hls_uri</code> ）： </p><blockquote class="example"><pre class="notranslate">http {
    ...

    map $uri $hls_uri {
        ~^(?&lt;base_uri&gt;.*).m3u8$ $base_uri;
        ~^(?&lt;base_uri&gt;.*).ts$   $base_uri;
        default                 $uri;
    }

    server {
        ...

        location /hls/ {
            hls;
            hls_forward_args on;

            alias /var/videos/;

            secure_link $arg_md5,$arg_expires;
            secure_link_md5 "$secure_link_expires$hls_uri$remote_addr secret";

            if ($secure_link = "") {
                return 403;
            }

            if ($secure_link = "0") {
                return 410;
            }
        }
    }
}
</pre></blockquote><p></p><a name="hls_fragment"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>hls_fragment</strong> <code class="notranslate"><i>time</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">hls_fragment 5s;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  为没有“ <code class="notranslate">len</code> ”参数的请求的播放列表URI定义默认片段长度。 </p><a name="hls_mp4_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>hls_mp4_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">hls_mp4_buffer_size 512k;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  设置用于处理MP4和MOV文件的缓冲区的初始<code class="notranslate"><i>size</i></code> 。 </p><a name="hls_mp4_max_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>hls_mp4_max_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">hls_mp4_max_buffer_size 10m;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table></div><p>  在元数据处理期间，可能需要更大的缓冲区。  它的大小不能超过指定的<code class="notranslate"><i>size</i></code> ，否则nginx将返回服务器错误500（内部服务器错误），并记录以下消息： </p><blockquote class="example"><pre class="notranslate">"/some/movie/file.mp4" mp4 moov atom is too large:
12583268, you may want to increase hls_mp4_max_buffer_size
</pre></blockquote><p></p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>