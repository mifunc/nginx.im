<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>http/ngx_http_charset_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="charset,small,text,koi8,map"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_http_charset_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#charset">charset</a> <br>     <a href="#charset_map">charset_map</a> <br>     <a href="#charset_types">charset_types</a> <br>     <a href="#override_charset">override_charset</a> <br>     <a href="#source_charset">source_charset</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_charset_module</code>模块将指定的字符集添加到“Content-Type”响应头字段。  此外，该模块可以将数据从一个字符集转换为另一个字符集，但有一些限制： </p><ul class="compact"><li>  转换是以一种方式执行的 - 从服务器到客户端， </li><li>  只能转换单字节字符集 </li><li>  或者来自UTF-8的单字节字符集。 </li></ul><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">include        conf/koi-win;

charset        windows-1251;
source_charset koi8-r;
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="charset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>charset</strong> <code class="notranslate"><i>charset</i></code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">charset off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br>
                </td></tr></tbody></table></div><p>  将指定的charset添加到“Content-Type”响应头字段。  如果此charset与<a href="#source_charset">source_charset</a>指令中指定的charset不同，则执行转换。 </p><p>  参数<code class="notranslate">off</code>取消将charset添加到“Content-Type”响应头字段。 </p><p>  可以使用变量定义charset： </p><blockquote class="example"><pre class="notranslate">charset $charset;
</pre></blockquote><p>  在这种情况下，变量的所有可能值需要以<a href="#charset_map">charset_map</a> ， <a href="#charset">charset</a>或<a href="#source_charset">source_charset</a>指令的形式存在于配置中至少一次。  对于<code class="notranslate">utf-8</code> ， <code class="notranslate">windows-1251</code>和<code class="notranslate">koi8-r</code> charsets，将文件<code class="notranslate">conf/koi-win</code> ， <code class="notranslate">conf/koi-utf</code>和<code class="notranslate">conf/win-utf</code>包含在<code class="notranslate">conf/koi-win</code>就足够了。  对于其他字符集，只需制作虚构的转换表即可，例如： </p><blockquote class="example"><pre class="notranslate">charset_map iso-8859-5 _ { }
</pre></blockquote><p></p><p>  此外，可以在“X-Accel-Charset”响应头字段中设置字符集。  可以使用<a href="ngx_http_proxy_module.html#proxy_ignore_headers">proxy_ignore_headers</a> ， <a href="ngx_http_fastcgi_module.html#fastcgi_ignore_headers">fastcgi_ignore_headers</a> ， <a href="ngx_http_uwsgi_module.html#uwsgi_ignore_headers">uwsgi_ignore_headers</a> ， <a href="ngx_http_scgi_module.html#scgi_ignore_headers">scgi_ignore_headers</a>和<a href="ngx_http_grpc_module.html#grpc_ignore_headers">grpc_ignore_headers</a>指令禁用此功能。 </p><a name="charset_map"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>charset_map</strong> <code class="notranslate"><i>charset1</i></code> <code class="notranslate"><i>charset2</i></code> { ... }</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> <br>
                </td></tr></tbody></table></div><p>  描述从一个字符集到另一个字符集的转换表。  使用相同的数据构建反向转换表。  字符代码以十六进制给出。   80-FF范围内的缺失字符被替换为“ <code class="notranslate">?</code>   ”。  从UTF-8转换时，单字节字符集中缺少的字符将替换为“ <code class="notranslate">&amp;#XXXX;</code>   ”。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">charset_map koi8-r windows-1251 {
    C0 FE ; # small yu
    C1 E0 ; # small a
    C2 E1 ; # small b
    C3 F6 ; # small ts
    ...
}
</pre></blockquote><p></p><p>  在将转换表描述为UTF-8时，应在第二列中给出UTF-8字符集的代码，例如： </p><blockquote class="example"><pre class="notranslate">charset_map koi8-r utf-8 {
    C0 D18E ; # small yu
    C1 D0B0 ; # small a
    C2 D0B1 ; # small b
    C3 D186 ; # small ts
    ...
}
</pre></blockquote><p></p><p>  在分配文件<code class="notranslate">conf/koi-win</code> ， <code class="notranslate">conf/koi-utf</code>和<code class="notranslate">conf/win-utf</code>中提供了从<code class="notranslate">koi8-r</code>到<code class="notranslate">windows-1251</code> ，从<code class="notranslate">koi8-r</code>和<code class="notranslate">windows-1251</code>到<code class="notranslate">utf-8</code>完整转换表。 </p><a name="charset_types"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>charset_types</strong> <code class="notranslate"><i>mime-type</i></code> ...;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">charset_types text/html text/xml text/plain text/vnd.wap.wml
application/javascript application/rss+xml;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br>
                </td></tr></tbody></table><p>  该指令出现在0.7.9版本中。 </p></div><p>  除了“ <code class="notranslate">text/html</code> ”之外，还可以在具有指定MIME类型的响应中启用模块处理。  特殊值“ <code class="notranslate">*</code> ”匹配任何MIME类型（0.8.29）。 </p><p></p><blockquote class="note">  在版本1.5.4之前，“ <code class="notranslate">application/x-javascript</code> ”被用作默认MIME类型而不是“ <code class="notranslate">application/javascript</code> ”。 </blockquote><p></p><a name="override_charset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>override_charset</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">override_charset off;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br>
                </td></tr></tbody></table></div><p>  确定当答案已在“Content-Type”响应头字段中携带字符集时，是否应对从代理或FastCGI / uwsgi / SCGI / gRPC服务器接收的答案执行转换。  如果启用了转换，则将接收到的响应中指定的字符集用作源字符集。 </p><blockquote class="note">  应当注意，如果在子请求中接收到响应，则始终执行从响应字符集到主请求字符集的转换，而不管<code class="notranslate">override_charset</code>指令设置如何。 </blockquote><p></p><a name="source_charset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>source_charset</strong> <code class="notranslate"><i>charset</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br>
                </td></tr></tbody></table></div><p>  定义响应的源字符集。  如果此charset与<a href="#charset">charset</a>指令中指定的<a href="#charset">charset</a>不同，则执行转换。 </p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>