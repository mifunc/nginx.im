<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>stream/ngx_stream_geoip_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="example,com,geoip,dat,city"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_stream_geoip_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#geoip_country">geoip_country</a> <br>     <a href="#geoip_city">geoip_city</a> <br>     <a href="#geoip_org">geoip_org</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_geoip_module</code>模块（1.11.3）使用预编译的<a href="http://www.maxmind.com">MaxMind</a>数据库创建具有取决于客户端IP地址的值的变量。 </p><p>  使用支持IPv6的数据库时，IPv4地址将被查找为IPv4映射的IPv6地址。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">--with-stream_geoip_module</code>配置参数启用它。 </p><blockquote class="note">  该模块需要<a href="http://www.maxmind.com/app/c">MaxMind GeoIP</a>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">stream {
    geoip_country         GeoIP.dat;
    geoip_city            GeoLiteCity.dat;

    map $geoip_city_continent_code $nearest_server {
        default        example.com;
        EU          eu.example.com;
        NA          na.example.com;
        AS          as.example.com;
    }
   ...
}
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="geoip_country"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>geoip_country</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">stream</code> <br>
                </td></tr></tbody></table></div><p>  指定用于根据客户端IP地址确定国家/地区的数据库。  使用此数据库时，以下变量可用： </p><dl class="compact"><dt id="var_geoip_country_code"> <code class="notranslate">$geoip_country_code</code> </dt> <dd>  两个字母的国家/地区代码，例如“ <code class="notranslate">RU</code> ”，“ <code class="notranslate">US</code> ”。 </dd><dt id="var_geoip_country_code3"> <code class="notranslate">$geoip_country_code3</code> </dt> <dd>  三个字母的国家/地区代码，例如“ <code class="notranslate">RUS</code> ”，“ <code class="notranslate">USA</code> ”。 </dd><dt id="var_geoip_country_name"> <code class="notranslate">$geoip_country_name</code> </dt> <dd>  国名，例如“ <code class="notranslate">Russian Federation</code> ”，“ <code class="notranslate">United States</code> ”。 </dd></dl><p></p><a name="geoip_city"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>geoip_city</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">stream</code> <br>
                </td></tr></tbody></table></div><p>  指定用于根据客户端IP地址确定国家，地区和城市的数据库。  使用此数据库时，以下变量可用： </p><dl class="compact"><dt id="var_geoip_area_code"> <code class="notranslate">$geoip_area_code</code> </dt> <dd>  电话区号（仅限美国）。 <blockquote class="note">  此变量可能包含过时的信息，因为不推荐使用相应的数据库字段。 </blockquote></dd><dt id="var_geoip_city_continent_code"> <code class="notranslate">$geoip_city_continent_code</code> </dt> <dd>  两个字母的大陆代码，例如“ <code class="notranslate">EU</code> ”，“ <code class="notranslate">NA</code> ”。 </dd><dt id="var_geoip_city_country_code"> <code class="notranslate">$geoip_city_country_code</code> </dt> <dd>  两个字母的国家/地区代码，例如“ <code class="notranslate">RU</code> ”，“ <code class="notranslate">US</code> ”。 </dd><dt id="var_geoip_city_country_code3"> <code class="notranslate">$geoip_city_country_code3</code> </dt> <dd>  三个字母的国家/地区代码，例如“ <code class="notranslate">RUS</code> ”，“ <code class="notranslate">USA</code> ”。 </dd><dt id="var_geoip_city_country_name"> <code class="notranslate">$geoip_city_country_name</code> </dt> <dd>  国名，例如“ <code class="notranslate">Russian Federation</code> ”，“ <code class="notranslate">United States</code> ”。 </dd><dt id="var_geoip_dma_code"> <code class="notranslate">$geoip_dma_code</code> </dt> <dd>  根据Google AdWords API中的<a href="https://developers.google.com/adwords/api/appendix/cities-DMAregions">地理位置定位</a> ，美国的DMA区域代码（也称为“都市代码”）。 </dd><dt id="var_geoip_latitude"> <code class="notranslate">$geoip_latitude</code> </dt> <dd>  纬度。 </dd><dt id="var_geoip_longitude"> <code class="notranslate">$geoip_longitude</code> </dt> <dd>  经度。 </dd><dt id="var_geoip_region"> <code class="notranslate">$geoip_region</code> </dt> <dd>  双符号国家区域代码（地区，领土，州，省，联邦土地等），例如“ <code class="notranslate">48</code> ”，“ <code class="notranslate">DC</code> ”。 </dd><dt id="var_geoip_region_name"> <code class="notranslate">$geoip_region_name</code> </dt> <dd>  国家地区名称（地区，领土，州，省，联邦土地等），例如“ <code class="notranslate">Moscow City</code> ”，“ <code class="notranslate">District of Columbia</code> ”。 </dd><dt id="var_geoip_city"> <code class="notranslate">$geoip_city</code> </dt> <dd>  城市名称，例如“ <code class="notranslate">Moscow</code> ”，“ <code class="notranslate">Washington</code> ”。 </dd><dt id="var_geoip_postal_code"> <code class="notranslate">$geoip_postal_code</code> </dt> <dd>  邮政编码。 </dd></dl><p></p><a name="geoip_org"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>geoip_org</strong> <code class="notranslate"><i>file</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">stream</code> <br>
                </td></tr></tbody></table></div><p>  指定用于根据客户端IP地址确定组织的数据库。  使用此数据库时，以下变量可用： </p><dl class="compact"><dt id="var_geoip_org"> <code class="notranslate">$geoip_org</code> </dt> <dd>  组织名称，例如“墨尔本大学”。 </dd></dl><p></p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>