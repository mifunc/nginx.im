<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>stream/ngx_stream_limit_conn_module-nginx中文手册</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="None"/>
<meta name="keywords" content="addr,limit,conn,zone,binary"/>
</head>
<body>
<div id="content"><h2 class="notranslate">Module ngx_stream_limit_conn_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a href="#example">Example Configuration</a> <br> <a href="#directives">Directives</a> <br>     <a href="#limit_conn">limit_conn</a> <br>     <a href="#limit_conn_log_level">limit_conn_log_level</a> <br>     <a href="#limit_conn_zone">limit_conn_zone</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_limit_conn_module</code>模块（1.9.3）用于限制每个定义密钥的连接数，特别是来自单个IP地址的连接数。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">stream {
    limit_conn_zone $binary_remote_addr zone=addr:10m;

    ...

    server {

        ...

        limit_conn           addr 1;
        limit_conn_log_level error;
    }
}
</pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="limit_conn"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>limit_conn</strong> <code class="notranslate"><i>zone</i></code> <code class="notranslate"><i>number</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  设置共享内存区域和给定键值的最大允许连接数。  超过此限制时，服务器将关闭连接。  例如，指令 </p><blockquote class="example"><pre class="notranslate">limit_conn_zone $binary_remote_addr zone=addr:10m;

server {
    ...
    limit_conn addr 1;
}
</pre></blockquote><p>  每次只允许一个IP地址连接一个。 </p><p>  如果指定了几个<code class="notranslate">limit_conn</code>指令，则将应用任何已配置的限制。 </p><p>  当且仅当当前级别没有<code class="notranslate">limit_conn</code>指令时，指令才从前一级继承。 </p><a name="limit_conn_log_level"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>limit_conn_log_level</strong> 
<code class="notranslate">info</code> |
<code class="notranslate">notice</code> |
<code class="notranslate">warn</code> |
<code class="notranslate">error</code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            <pre class="notranslate">limit_conn_log_level error;</pre>
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br>
                </td></tr></tbody></table></div><p>  为服务器限制连接数的情况设置所需的日志记录级别。 </p><a name="limit_conn_zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate">
            Syntax:
                </th><td class="notranslate">
            <code class="notranslate"><strong>limit_conn_zone</strong> 
    <code class="notranslate"><i>key</i></code>
    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code> ;</code> <br>
                </td></tr><tr><th class="notranslate">
            Default:
                </th><td class="notranslate">
            
            —
        
                </td></tr><tr><th class="notranslate">
            Context:
                </th><td class="notranslate">
            <code class="notranslate">stream</code> <br>
                </td></tr></tbody></table></div><p>  设置共享内存区域的参数，该区域将保留各种键的状态。  特别是，状态包括当前的连接数。   <code class="notranslate"><i>key</i></code>可以包含文本，变量及其组合（1.11.2）。  不计算具有空键值的连接。  用法示例： </p><blockquote class="example"><pre class="notranslate">limit_conn_zone $binary_remote_addr zone=addr:10m;
</pre></blockquote><p>  这里，密钥是<code class="notranslate">$binary_remote_addr</code>变量设置的客户端IP地址。   <code class="notranslate">$binary_remote_addr</code>的大小为IPv4地址的4个字节或IPv6地址的16个字节。  存储状态在32位平台上总是占用32或64字节，在64位平台上占用64字节。  一兆字节区域可以保留大约32,000个32字节状态或大约16,000个64字节状态。  如果区域存储耗尽，服务器将关闭连接。 </p> 
<span></span><div style="display: none;"></div></div>
</body>
</html>