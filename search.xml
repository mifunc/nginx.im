<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title></title>
      <url>/ngx/stream/stream_processing.html</url>
      <content type="html"><![CDATA[<p></p><h2>   nginx如何处理TCP / UDP会话 </h2><p>  来自客户端的TCP / UDP会话在称为<b>阶段的</b>连续步骤中处理： </p><dl class="compact"><dt id="postaccept_phase"> <code class="notranslate">Post-accept</code> </dt> <dd>  接受客户端连接后的第一阶段。  在此阶段调用<a hhref="ngx_stream_realip_module.html">ngx_stream_realip_module</a>模块。 </dd><dt id="preaccess_phase"> <code class="notranslate">Pre-access</code> </dt> <dd>  初步检查访问。  在此阶段调用<a hhref="ngx_stream_limit_conn_module.html">ngx_stream_limit_conn_module</a>模块。 </dd><dt id="access_phase"> <code class="notranslate">Access</code> </dt> <dd>  实际数据处理前的客户端访问限制。  在此阶段调用<a hhref="ngx_stream_access_module.html">ngx_stream_access_module</a>模块。 </dd><dt id="ssl_phase"> <code class="notranslate">SSL</code> </dt> <dd>   TLS / SSL终止。  在此阶段调用<a hhref="ngx_stream_ssl_module.html">ngx_stream_ssl_module</a>模块。 </dd><dt id="preread_phase"> <code class="notranslate">Preread</code> </dt> <dd>  将初始数据字节<a hhref="ngx_stream_core_module.html#preread_buffer_size">读</a>入<a hhref="ngx_stream_core_module.html#preread_buffer_size">预读缓冲区，</a>以允许诸如<a hhref="ngx_stream_ssl_preread_module.html">ngx_stream_ssl_preread_module之类的</a>模块在处理之前分析数据。 </dd><dt id="content_phase"> <code class="notranslate">Content</code> </dt> <dd>  实际处理数据的强制阶段（通常<a hhref="ngx_stream_proxy_module.html">代理</a>到<a hhref="ngx_stream_upstream_module.html">上游</a>服务器）或指定值<a hhref="ngx_stream_return_module.html">返回</a>给客户端。 </dd><dt id="log_phase"> <code class="notranslate">Log</code> </dt> <dd>  记录客户端会话处理结果的最后阶段。  在此阶段调用<a hhref="ngx_stream_log_module.html">ngx_stream_log_module</a>模块。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_zone_sync_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_zone_sync_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#zone_sync">zone_sync</a> <br>     <a hhref="#zone_sync_buffers">zone_sync_buffers</a> <br>     <a hhref="#zone_sync_connect_retry_interval">zone_sync_connect_retry_interval</a> <br>     <a hhref="#zone_sync_connect_timeout">zone_sync_connect_timeout</a> <br>     <a hhref="#zone_sync_interval">zone_sync_interval</a> <br>     <a hhref="#zone_sync_recv_buffer_size">zone_sync_recv_buffer_size</a> <br>     <a hhref="#zone_sync_server">zone_sync_server</a> <br>     <a hhref="#zone_sync_ssl">zone_sync_ssl</a> <br>     <a hhref="#zone_sync_ssl_certificate">zone_sync_ssl_certificate</a> <br>     <a hhref="#zone_sync_ssl_certificate_key">zone_sync_ssl_certificate_key</a> <br>     <a hhref="#zone_sync_ssl_ciphers">zone_sync_ssl_ciphers</a> <br>     <a hhref="#zone_sync_ssl_crl">zone_sync_ssl_crl</a> <br>     <a hhref="#zone_sync_ssl_name">zone_sync_ssl_name</a> <br>     <a hhref="#zone_sync_ssl_password_file">zone_sync_ssl_password_file</a> <br>     <a hhref="#zone_sync_ssl_protocols">zone_sync_ssl_protocols</a> <br>     <a hhref="#zone_sync_ssl_server_name">zone_sync_ssl_server_name</a> <br>     <a hhref="#zone_sync_ssl_trusted_certificate">zone_sync_ssl_trusted_certificate</a> <br>     <a hhref="#zone_sync_ssl_verify">zone_sync_ssl_verify</a> <br>     <a hhref="#zone_sync_ssl_verify_depth">zone_sync_ssl_verify_depth</a> <br>     <a hhref="#zone_sync_timeout">zone_sync_timeout</a> <br> <a hhref="#stream_zone_sync_status">API endpoints</a> <br> <a hhref="#controlling_cluster_node">Starting, stopping, removing a cluster node</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_zone_sync_module</code>模块（1.13.8）为在集群节点之间同步<a hhref="ngx_stream_upstream_module.html#zone">共享内存区域的</a>内容提供必要的支持。  要为特定区域启用同步，相应的模块必须支持此功能。  目前，可以在<a hhref="http/ngx_http_keyval_module.html">http</a>和<a hhref="stream/ngx_stream_keyval_module.html">流中</a>同步HTTP <a hhref="http/ngx_http_upstream_module.html#sticky">粘性</a>会话，有关<a hhref="http/ngx_http_limit_req_module.html">过多HTTP请求的</a>信息和键值对。 </p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  最小配置： </p><blockquote class="example"><pre class="notranslate">http {<br>    …<p></p>
<pre><code>upstream backend {
   server backend1.example.com:8080;
   server backend2.example.com:8081;

   sticky learn
          create=$upstream_cookie_examplecookie
          lookup=$cookie_examplecookie
          zone=client_sessions:1m &lt;strong&gt;sync&lt;/strong&gt; ;
}

...
</code></pre><p>}</p>
<p>stream {<br>    …</p>
<pre><code>server {
    zone_sync;

    listen 127.0.0.1:8090;

    # cluster of 2 nodes
    zone_sync_server a.example.com;
    zone_sync_server b.example.com;

}
</code></pre><p></p></pre></blockquote><p>  启用了SSL并且由DNS定义的集群成员的更复杂配置： </p><blockquote class="example"><pre class="notranslate">…<p></p>
<p>stream {<br>    …</p>
<pre><code>resolver 127.0.0.1 valid=10s;

server {
    zone_sync;

    # the name resolves to multiple addresses that correspond to cluster nodes
    zone_sync_server cluster.example.com resolve;

    listen 127.0.0.1:4433 ssl;

    ssl_certificate     localhost.crt;
    ssl_certificate_key localhost.key;

    zone_sync_ssl on;

    zone_sync_ssl_certificate     localhost.crt;
    zone_sync_ssl_certificate_key localhost.key;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="zone_sync"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>zone_sync</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用集群节点之间的共享内存区域同步。  使用&lt;a hhref=&quot;#zone_sync_server&quot;&gt;zone_sync_server&lt;/a&gt;指令定义集群节点。 &lt;/p&gt;&lt;a name=&quot;zone_sync_buffers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_buffers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_buffers 256 4k|8k;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置用于推送区域内容的每个区域缓冲区的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 &lt;/p&gt;&lt;a name=&quot;zone_sync_connect_retry_interval&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_connect_retry_interval&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_connect_retry_interval 1s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义到另一个群集节点的连接尝试之间的间隔。 &lt;/p&gt;&lt;a name=&quot;zone_sync_connect_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_connect_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_connect_timeout 5s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义与另一个群集节点建立连接的超时。 &lt;/p&gt;&lt;a name=&quot;zone_sync_interval&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_interval&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_interval 1s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义在共享内存区域中轮询更新的时间间隔。 &lt;/p&gt;&lt;a name=&quot;zone_sync_recv_buffer_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_recv_buffer_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_recv_buffer_size 4k|8k;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置用于解析传入的同步消息流的每连接接收缓冲区的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 &lt;/p&gt;&lt;a name=&quot;zone_sync_server&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_server&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt; [ &lt;code class=&quot;notranslate&quot;&gt;resolve&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义群集节点的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt; 。  可以将地址指定为具有强制端口的域名或IP地址，或者指定为“ &lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt; ”前缀后指定的UNIX域套接字路径。  解析为多个IP地址的域名一次定义多个节点。 &lt;/p&gt;&lt;a name=&quot;resolve&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;resolve&lt;/code&gt;参数指示nginx监视与节点域名对应的IP地址的更改，并自动修改配置，而无需重新启动nginx。 &lt;/p&gt;&lt;p&gt;  群集节点可以动态指定为带有&lt;code class=&quot;notranslate&quot;&gt;resolve&lt;/code&gt;参数的单个&lt;code class=&quot;notranslate&quot;&gt;zone_sync_server&lt;/code&gt;指令，也可以静态指定为一系列不带参数的指令。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  每个群集节点只应指定一次。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  所有群集节点都应使用相同的配置。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  为了使&lt;code class=&quot;notranslate&quot;&gt;resolve&lt;/code&gt;参数起作用，必须在&lt;a hhref=&quot;ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt;块中指定&lt;a hhref=&quot;ngx_stream_core_module.html#resolver&quot;&gt;解析器&lt;/a&gt;指令。  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;stream {
resolver 10.0.0.1;

server {
    zone_sync;
    zone_sync_server cluster.example.com resolve;
    ...
}
</code></pre><p>}<br></p><p></p><a name="zone_sync_ssl"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>zone_sync_ssl</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">zone_sync_ssl off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  启用S​​SL / TLS协议以连接到另一个群集服务器。 </p><a name="zone_sync_ssl_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>zone_sync_ssl_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该证书用于对另一个群集服务器进行身份验证。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_certificate_key&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_certificate_key&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于对另一个群集服务器进行身份验证。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_ciphers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_ciphers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ciphers&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_ssl_ciphers DEFAULT;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定用于连接到另一个群集服务器的已启用密码。  密码以OpenSSL库理解的格式指定。 &lt;/p&gt;&lt;p&gt;  可以使用“ &lt;code class=&quot;notranslate&quot;&gt;openssl ciphers&lt;/code&gt; ”命令查看完整列表。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_crl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_crl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的已吊销证书（CRL）的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#zone_sync_ssl_verify&quot;&gt;验证&lt;/a&gt;另一个群集服务器的证书。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_ssl_name host from zone_sync_server;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.7版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  允许覆盖用于&lt;a hhref=&quot;#zone_sync_ssl_verify&quot;&gt;验证&lt;/a&gt;群集服务器证书的服务器名称，并在与群集服务器建立连接时&lt;a hhref=&quot;#zone_sync_ssl_server_name&quot;&gt;通过SNI传递&lt;/a&gt; 。 &lt;/p&gt;&lt;p&gt;  默认情况下，使用&lt;a hhref=&quot;#zone_sync_server&quot;&gt;zone_sync_server&lt;/a&gt;地址的主机部分，如果指定了&lt;a hhref=&quot;#resolve&quot;&gt;resolve&lt;/a&gt;参数，则使用已解析的IP地址。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_password_file&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_password_file&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有密钥密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_protocols&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_protocols&lt;/strong&gt; 
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv3&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.3&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用指定的协议以连接到另一个群集服务器。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_server_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_server_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_ssl_server_name off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.7版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  在与另一个群集服务器建立连接时，启用或禁用通过&lt;a hhref=&quot;http://en.wikipedia.org/wiki/Server_Name_Indication&quot;&gt;TLS服务器名称指示扩展&lt;/a&gt; （SNI，RFC 6066）传递服务器名称。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_trusted_certificate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_trusted_certificate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该证书用于&lt;a hhref=&quot;#zone_sync_ssl_verify&quot;&gt;验证&lt;/a&gt;另一个群集服务器的证书。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_verify&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_verify&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_ssl_verify off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用其他群集服务器证书的验证。 &lt;/p&gt;&lt;a name=&quot;zone_sync_ssl_verify_depth&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_ssl_verify_depth&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_ssl_verify_depth 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  在另一个群集服务器证书链中设置验证深度。 &lt;/p&gt;&lt;a name=&quot;zone_sync_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;zone_sync_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;timeout&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;zone_sync_timeout 5s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置与另一个群集节点连接时两次连续读取或写入操作之间的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;timeout&lt;/i&gt;&lt;/code&gt; 。  如果在此时间内没有传输数据，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;stream_zone_sync_status&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;   API端点 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;  节点的同步状态可通过API的&lt;a hhref=&quot;http/ngx_http_api_module.html#stream_zone_sync_&quot;&gt;/ stream / zone_sync /&lt;/a&gt; endpoint获得，它返回&lt;a hhref=&quot;http/ngx_http_api_module.html#def_nginx_stream_zone_sync&quot;&gt;以下&lt;/a&gt;度量标准。 &lt;/p&gt;&lt;a name=&quot;controlling_cluster_node&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  启动，停止，删除群集节点 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;  要启动新节点，请使用新节点的IP地址更新群集主机名的DNS记录并启动实例。  新节点将从DNS或静态配置中发现其他节点，并将开始向它们发送更新。  其他节点最终将使用DNS发现新节点并开始向其推送更新。  在静态配置的情况下，需要重新加载其他节点以便将更新发送到新节点。 &lt;/p&gt;&lt;p&gt;  要停止节点，请将&lt;code class=&quot;notranslate&quot;&gt;QUIT&lt;/code&gt;信号发送到实例。  该节点将完成区域同步并正常关闭打开的连接。 &lt;/p&gt;&lt;p&gt;  要删除节点，请更新群集主机名的DNS记录，并删除该节点的IP地址。  所有其他节点最终将发现节点已被删除，关闭与节点的连接，并且将不再尝试连接到节点。  移除节点后，可以如上所述停止节点。  在静态配置的情况下，需要重新加载其他节点以便停止向已删除节点发送更新。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_upstream_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_upstream_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#upstream">upstream</a> <br>     <a hhref="#server">server</a> <br>     <a hhref="#zone">zone</a> <br>     <a hhref="#state">state</a> <br>     <a hhref="#hash">hash</a> <br>     <a hhref="#least_conn">least_conn</a> <br>     <a hhref="#least_time">least_time</a> <br>     <a hhref="#random">random</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_upstream_module</code>模块（1.9.0）用于定义可由<a hhref="ngx_stream_proxy_module.html#proxy_pass">proxy_pass</a>指令引用的服务器组。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">upstream <strong>backend</strong> {<br>    hash $remote_addr consistent;<p></p>
<pre><code>server backend1.example.com:12345  weight=5;
server backend2.example.com:12345;
server unix:/tmp/backend3;

server backup1.example.com:12345   backup;
server backup2.example.com:12345   backup;
</code></pre><p>}</p>
<p>server {<br>    listen 12346;<br>    proxy_pass <strong>backend</strong> ;<br>}<br></p></pre></blockquote><p></p><p>  具有定期<a hhref="ngx_stream_upstream_hc_module.html">运行状况检查的</a>动态可配置组可作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分： </p><blockquote class="example"><pre class="notranslate">resolver 10.0.0.1;<p></p>
<p>upstream <strong>dynamic</strong> {<br>    zone upstream_dynamic 64k;</p>
<pre><code>server backend1.example.com:12345 weight=5;
server backend2.example.com:12345 fail_timeout=5s slow_start=30s;
server 192.0.2.1:12345            max_fails=3;
server backend3.example.com:12345 resolve;
server backend4.example.com       service=http resolve;

server backup1.example.com:12345  backup;
server backup2.example.com:12345  backup;
</code></pre><p>}</p>
<p>server {<br>    listen 12346;<br>    proxy_pass <strong>dynamic</strong> ;<br>    health_check;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="upstream"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>upstream</strong> <code class="notranslate"><i>name</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义一组服务器。  服务器可以侦听不同的端口。  此外，可以混合侦听TCP和UNIX域套接字的服务器。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;upstream backend {
server backend1.example.com:12345 weight=5;
server 127.0.0.1:12345            max_fails=3 fail_timeout=30s;
server unix:/tmp/backend2;
server backend3.example.com:12345 resolve;

server backup1.example.com:12345  backup;
</code></pre><p>}<br></p><p></p><p>  默认情况下，使用加权循环平衡方法在服务器之间分配连接。  在上面的示例中，每个7个连接将按如下方式分发：5个连接到<code class="notranslate">backend1.example.com:12345</code>并且每个连接到第二个和第三个服务器。  如果在与服务器通信期间发生错误，则连接将传递到下一个服务器，依此类推，直到将尝试所有正常运行的服务器。  如果与所有服务器的通信失败，则将关闭连接。 </p><a name="server"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server</strong> <code class="notranslate"><i>address</i></code> [ <code class="notranslate"><i>parameters</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义服务器的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt;和其他&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameters&lt;/i&gt;&lt;/code&gt; 。  可以将地址指定为具有强制端口的域名或IP地址，或者指定为“ &lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt; ”前缀后指定的UNIX域套接字路径。  解析为多个IP地址的域名一次定义多个服务器。 &lt;/p&gt;&lt;p&gt;  可以定义以下参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;weight&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;weight&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置服务器的权重，默认为1。 &lt;/dd&gt;&lt;dt id=&quot;max_conns&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  限制与代理服务器的最大并发连接&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; （1.11.5）。  默认值为零，表示没有限制。  如果服务器组不驻留在&lt;a hhref=&quot;#zone&quot;&gt;共享内存中&lt;/a&gt; ，则每个工作进程的限制都有效。 &lt;blockquote class=&quot;note&quot;&gt;  在1.11.5版之前，此参数作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分提供。 &lt;/blockquote&gt;&lt;/dd&gt;&lt;dt id=&quot;max_fails&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;max_fails&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置在&lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt;参数设置的持续时间内发生的与服务器通信的不成功尝试次数，以考虑服务器在&lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt;参数设置的持续时间内不可用。  默认情况下，不成功尝试次数设置为1.零值禁用尝试的计费。  这里，在与服务器建立连接时，尝试失败是错误或超时。 &lt;/dd&gt;&lt;dt id=&quot;fail_timeout&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  套 &lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;  指定数量的不成功尝试与服务器通信的时间应该考虑服务器不可用; &lt;/li&gt;&lt;li&gt;  以及服务器被视为不可用的时间段。 &lt;/li&gt;&lt;/ul&gt;  默认情况下，参数设置为10秒。 &lt;/dd&gt;&lt;dt id=&quot;backup&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;backup&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  将服务器标记为备份服务器。  当主服务器不可用时，将传递与备份服务器的连接。 &lt;/dd&gt;&lt;dt id=&quot;down&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;down&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  将服务器标记为永久不可用。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  此外，以下参数作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分提供： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;resolve&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;resolve&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  监视与服务器域名对应的IP地址的更改，并自动修改上游配置，而无需重新启动nginx。  服务器组必须驻留在&lt;a hhref=&quot;#zone&quot;&gt;共享内存中&lt;/a&gt; 。 &lt;p&gt;  要使此参数起作用，必须在&lt;a hhref=&quot;ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt;块中指定&lt;a hhref=&quot;ngx_stream_core_module.html#resolver&quot;&gt;解析程序&lt;/a&gt;指令。  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;stream {
resolver 10.0.0.1;

upstream u {
    zone ...;
    ...
    server example.com:12345 resolve;
}
</code></pre><p>}<br></p><p></p><dt id="service">   <code class="notranslate">service</code> = <code class="notranslate"><i>name</i></code> </dt><dd>  能够解析DNS <a hhref="https://tools.ietf.org/html/rfc2782">SRV</a>记录并设置服务<code class="notranslate"><i>name</i></code> （1.9.13）。  要使此参数起作用，必须为服务器指定<a hhref="#resolve">resolve</a>参数并指定不带端口号的主机名。 <p>  如果服务名称不包含点（“ <code class="notranslate">.</code> ”），则构造符合<a hhref="https://tools.ietf.org/html/rfc2782">RFC</a>的名称，并将TCP协议添加到服务前缀。  例如，要查找<code class="notranslate">_http._tcp.backend.example.com</code> SRV记录，必须指定该指令： </p><blockquote class="example"><pre class="notranslate">server backend.example.com service=http resolve;<br></pre></blockquote><p>  如果服务名称包含一个或多个点，则通过加入服务前缀和服务器名称来构造名称。  例如，要查找<code class="notranslate">_http._tcp.backend.example.com</code>和<code class="notranslate">server1.backend.example.com</code> SRV记录，必须指定指令： </p><blockquote class="example"><pre class="notranslate">server backend.example.com service=_http._tcp resolve;<br>server example.com service=server1.backend resolve;<br></pre></blockquote><p></p><p>  最高优先级SRV记录（具有相同最低优先级值的记录）将被解析为主服务器，其余SRV记录将被解析为备份服务器。  如果为服务器指定了<a hhref="#backup">backup</a>参数，则高优先级SRV记录将解析为备份服务器，其余SRV记录将被忽略。 </p></dd><dt id="slow_start">   <code class="notranslate">slow_start</code> = <code class="notranslate"><i>time</i></code> </dt><dd>  设置服务器将其权重从零恢复到标称值的时间，当不健康的服务器变得<a hhref="ngx_stream_upstream_hc_module.html#health_check">健康时</a> ，或者服务器在一段时间被认为<a hhref="#fail_timeout">不可用</a>后变得可用时。  默认值为零，即禁用慢启动。 <blockquote class="note">  该参数不能与<a hhref="#hash">散列</a>负载平衡方法一起使用。 </blockquote></dd><p></p><p></p><blockquote class="note">  如果组中只有一个服务器，则忽略<code class="notranslate">max_fails</code> ， <code class="notranslate">fail_timeout</code>和<code class="notranslate">slow_start</code>参数，并且永远不会将此类服务器视为不可用。 </blockquote><p></p><a name="zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>zone</strong> <code class="notranslate"><i>name</i></code> [ <code class="notranslate"><i>size</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义共享内存区域的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ，该区域保持组工作进程之间共享的组配置和运行时状态。  几个组可能共享同一个区域。  在这种情况下，仅指定一次&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;就足够了。 &lt;/p&gt;&lt;p&gt;  此外，作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分，此类组允许更改组成员身份或修改特定服务器的设置，而无需重新启动nginx。  可通过&lt;a hhref=&quot;http/ngx_http_api_module.html&quot;&gt;API&lt;/a&gt;模块（1.13.3）访问该配置。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.13.3版之前，只能通过&lt;a hhref=&quot;http/ngx_http_upstream_conf_module.html#upstream_conf&quot;&gt;upstream_conf&lt;/a&gt;处理的特殊位置访问配置。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;state&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;state&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.7版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定保持动态可配置组状态的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  例子： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;state /var/lib/nginx/state/servers.conf; # path for Linux
</code></pre><p>state /var/db/nginx/state/servers.conf;  # path for FreeBSD<br></p><p></p><p>  该状态目前仅限于具有其参数的服务器列表。  解析配置时会读取文件，每次<a hhref="http/ngx_http_api_module.html#stream_upstreams_stream_upstream_name_servers_">更改</a>上游配置时都会更新该文件。  应避免直接更改文件内容。  该指令不能与<a hhref="#server">server</a>指令一起使用。 </p><p></p><blockquote class="note">   <a hhref="control.html#reconfiguration">配置重新加载</a>或<a hhref="control.html#upgrade">二进制升级</a>期间所做的更改可能会丢失。 </blockquote><p></p><p></p><blockquote class="note">  该指令作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="hash"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>hash</strong> <code class="notranslate"><i>key</i></code> [ <code class="notranslate">consistent</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定服务器组的负载平衡方法，其中客户端 - 服务器映射基于散列&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合（1.11.2）。  用法示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;hash $remote_addr;
</code></pre><p></p><p>  请注意，从组中添加或删除服务器可能会导致将大多数密钥重新映射到不同的服务器。  该方法与<a hhref="https://metacpan.org/pod/Cache::Memcached">Cache :: Memcached</a> Perl库兼容。 </p><p>  如果指定了<code class="notranslate">consistent</code>参数，则将使用<a hhref="https://www.metabrew.com/article/libketama-consistent-hashing-algo-memcached-clients">ketama</a>一致性哈希方法。  该方法确保在向组添加服务器或从组中删除服务器时，只有少数密钥将重新映射到不同的服务器。  这有助于为缓存服务器实现更高的缓存命中率。  该方法与<a hhref="https://metacpan.org/pod/Cache::Memcached::Fast">Cache :: Memcached :: Fast</a> Perl库兼容，并将<code class="notranslate"><i>ketama_points</i></code>参数设置为160。 </p><a name="least_conn"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>least_conn</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定组应使用负载平衡方法，其中将连接传递到具有最少活动连接的服务器，同时考虑服务器的权重。  如果有多个这样的服务器，则使用加权循环平衡方法依次尝试它们。 &lt;/p&gt;&lt;a name=&quot;least_time&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;least_time&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;connect&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;first_byte&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;last_byte&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;inflight&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定组应使用负载平衡方法，其中连接以最少的平均时间和最少的活动连接传递到服务器，同时考虑服务器的权重。  如果有多个这样的服务器，则使用加权循环平衡方法依次尝试它们。 &lt;/p&gt;&lt;p&gt;  如果指定了&lt;code class=&quot;notranslate&quot;&gt;connect&lt;/code&gt;参数，则使用&lt;a hhref=&quot;#var_upstream_connect_time&quot;&gt;连接&lt;/a&gt;到上游服务器的时间。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;first_byte&lt;/code&gt;参数，则使用接收数据的&lt;a hhref=&quot;#var_upstream_first_byte_time&quot;&gt;第一个字节&lt;/a&gt;的时间。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;last_byte&lt;/code&gt;则使用接收&lt;a hhref=&quot;#var_upstream_session_time&quot;&gt;最后一个&lt;/a&gt;数据&lt;a hhref=&quot;#var_upstream_session_time&quot;&gt;字节&lt;/a&gt;的时间。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;inflight&lt;/code&gt;参数（1.11.6），则还会考虑不完整的连接。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.11.6版之前，默认情况下会考虑不完整的连接。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  该指令作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分提供。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;random&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;random&lt;/strong&gt; [ &lt;code class=&quot;notranslate&quot;&gt;two&lt;/code&gt; [ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;method&lt;/i&gt;&lt;/code&gt; ]];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.1版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定组应使用负载平衡方法，其中将连接传递给随机选择的服务器，同时考虑服务器的权重。 &lt;/p&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;two&lt;/code&gt;参数指示nginx随机选择&lt;a hhref=&quot;https://homes.cs.washington.edu/~karlin/papers/balls.pdf&quot;&gt;两个&lt;/a&gt;服务器，然后使用指定的&lt;code class=&quot;notranslate&quot;&gt;method&lt;/code&gt;选择服务器。  默认方法是&lt;code class=&quot;notranslate&quot;&gt;least_conn&lt;/code&gt; ，它将连接传递给具有最少活动连接数的服务器。 &lt;/p&gt;&lt;a name=&quot;random_least_time&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;least_time&lt;/code&gt;方法将连接传递给平均时间最短且活动连接数最少的服务器。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;least_time=connect&lt;/code&gt;参数，则使用&lt;a hhref=&quot;#var_upstream_connect_time&quot;&gt;连接&lt;/a&gt;到上游服务器的时间。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;least_time=first_byte&lt;/code&gt;参数，则使用接收数据的&lt;a hhref=&quot;#var_upstream_first_byte_time&quot;&gt;第一个字节&lt;/a&gt;的时间。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;least_time=last_byte&lt;/code&gt;则使用接收&lt;a hhref=&quot;#var_upstream_session_time&quot;&gt;最后一个&lt;/a&gt;数据&lt;a hhref=&quot;#var_upstream_session_time&quot;&gt;字节&lt;/a&gt;的时间。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;least_time&lt;/code&gt;方法可作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅&lt;/a&gt;的一部分。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_stream_upstream_module&lt;/code&gt;模块支持以下嵌入变量： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_upstream_addr&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_addr&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留IP地址和端口，或上游服务器的UNIX域套接字的路径（1.11.4）。  如果在代理期间联系了多个服务器，则它们的地址用逗号分隔，例如“ &lt;code class=&quot;notranslate&quot;&gt;192.168.1.1:12345, 192.168.1.2:12345, unix:/tmp/sock&lt;/code&gt; ”。  如果无法选择服务器，则变量将保留服务器组的名称。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_bytes_received&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_bytes_received&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从上游服务器（1.11.4）接收的字节数。  来自多个连接的值由逗号分隔，例如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_bytes_sent&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_bytes_sent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  发送到上游服务器的字节数（1.11.4）。  来自多个连接的值由逗号分隔，例如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_connect_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_connect_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  时间连接到上游服务器（1.11.4）;  时间以秒为单位，分辨率为毫秒。  多个连接的时间由逗号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_first_byte_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_first_byte_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  接收数据的第一个字节的时间（1.11.4）;  时间以秒为单位，分辨率为毫秒。  多个连接的时间由逗号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_session_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_session_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  会话持续时间（以秒为单位），分辨率为毫秒（1.11.4）。  多个连接的时间由逗号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_upstream_hc_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_upstream_hc_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#health_check">health_check</a> <br>     <a hhref="#health_check_timeout">health_check_timeout</a> <br>     <a hhref="#match">match</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_upstream_hc_module</code>模块（1.9.0）允许对<a hhref="ngx_stream_upstream_module.html#upstream">组</a>中的服务器启用定期运行状况检查。  服务器组必须驻留在<a hhref="ngx_stream_upstream_module.html#zone">共享内存中</a> 。 </p><p>  如果运行状况检查失败，则服务器将被视为运行状况不佳。  如果为同一组服务器定义了多个运行状况检查，则任何检查的单个故障都将使相应的服务器被视为不健康。  客户端连接不会传递到处于“检查”状态的不健康服务器和服务器。 </p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">upstream tcp {<br>    zone upstream_tcp 64k;<p></p>
<pre><code>server backend1.example.com:12345 weight=5;
server backend2.example.com:12345 fail_timeout=5s slow_start=30s;
server 192.0.2.1:12345            max_fails=3;

server backup1.example.com:12345  backup;
server backup2.example.com:12345  backup;
</code></pre><p>}</p>
<p>server {<br>    listen     12346;<br>    proxy_pass tcp;<br>    health_check;<br>}<br></p></pre></blockquote><p>  使用此配置，nginx将检查每五秒钟与<code class="notranslate">tcp</code>组中每个服务器建立TCP连接的能力。  当无法建立与服务器的连接时，运行状况检查将失败，并且服务器将被视为运行状况不佳。 </p><p>  可以为UDP协议配置运行状况检查： </p><blockquote class="example"><pre class="notranslate">upstream dns_upstream {<p></p>
<pre><code>zone   dns_zone 64k;

server dns1.example.com:53;
server dns2.example.com:53;
server dns3.example.com:53;
</code></pre><p>}</p>
<p>server {<br>    listen       53 udp;<br>    proxy_pass   dns_upstream;<br>    health_check udp;<br>}<br></p></pre></blockquote><p>  在这种情况下，预期缺少ICMP“ <code class="notranslate">Destination Unreachable</code> ”消息以回复发送的字符串“ <code class="notranslate">nginx health check</code> ”。 </p><p>  还可以配置运行状况检查以测试从服务器获取的数据。  测试使用<a hhref="#match">match</a>伪指令单独配置，并在<a hhref="#health_check">health_check</a>指令的<code class="notranslate">match</code>参数中引用。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="health_check"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>health_check</strong> [ <code class="notranslate"><i>parameters</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用对&lt;a hhref=&quot;ngx_stream_upstream_module.html#upstream&quot;&gt;组中&lt;/a&gt;服务器的定期运行状况检查。 &lt;/p&gt;&lt;p&gt;  支持以下可选参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;health_check_interval&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;interval&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置两次连续运行状况检查之间的间隔，默认为5秒。 &lt;/dd&gt;&lt;dt id=&quot;health_check_jitter&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;jitter&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置每个健康检查随机延迟的时间，默认情况下，没有延迟。 &lt;/dd&gt;&lt;dt id=&quot;health_check_fails&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;fails&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置特定服务器的连续失败运行状况检查的数量，在此之后，此服务器将被视为运行状况不佳，默认情况下为1。 &lt;/dd&gt;&lt;dt id=&quot;health_check_passes&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;passes&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置特定服务器的连续传递运行状况检查的数量，在此之后服务器将被视为运行状况，默认情况下为1。 &lt;/dd&gt;&lt;dt id=&quot;health_check_mandatory&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;mandatory&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  设置服务器的初始“检查”状态，直到第一次健康检查完成（1.11.7）。  客户端连接不会传递到处于“检查”状态的服务器。  如果未指定参数，则服务器最初将被视为健康。 &lt;/dd&gt;&lt;dt id=&quot;health_check_match&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;match&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  指定配置成功连接应传递的测试的&lt;code class=&quot;notranslate&quot;&gt;match&lt;/code&gt;块，以便进行运行状况检查。  默认情况下，对于TCP，仅检查与服务器建立TCP连接的能力。  对于&lt;a hhref=&quot;#health_check_udp&quot;&gt;UDP&lt;/a&gt; ，预期缺少ICMP“ &lt;code class=&quot;notranslate&quot;&gt;Destination Unreachable&lt;/code&gt; ”消息以回复发送的字符串“ &lt;code class=&quot;notranslate&quot;&gt;nginx health check&lt;/code&gt; ”。 &lt;blockquote class=&quot;note&quot;&gt;  在1.11.7版之前，默认情况下，UDP运行状况检查需要带有&lt;a hhref=&quot;#match_send&quot;&gt;send&lt;/a&gt;和&lt;a hhref=&quot;#match_expect&quot;&gt;expect&lt;/a&gt;参数的&lt;a hhref=&quot;#hc_match&quot;&gt;匹配&lt;/a&gt;块。 &lt;/blockquote&gt;&lt;/dd&gt;&lt;dt id=&quot;health_check_port&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;port&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  定义连接到服务器以执行运行状况检查时使用的端口（1.9.7）。  默认情况下，等于&lt;a hhref=&quot;ngx_stream_upstream_module.html#server&quot;&gt;服务器&lt;/a&gt;端口。 &lt;/dd&gt;&lt;dt id=&quot;health_check_udp&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;udp&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  指定&lt;code class=&quot;notranslate&quot;&gt;UDP&lt;/code&gt;协议应该用于运行状况检查而不是默认的&lt;code class=&quot;notranslate&quot;&gt;TCP&lt;/code&gt;协议（1.9.13）。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;health_check_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;health_check_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;timeout&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;health_check_timeout 5s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  覆盖&lt;a hhref=&quot;ngx_stream_proxy_module.html#proxy_timeout&quot;&gt;运行&lt;/a&gt;状况检查的&lt;a hhref=&quot;ngx_stream_proxy_module.html#proxy_timeout&quot;&gt;proxy_timeout&lt;/a&gt;值。 &lt;/p&gt;&lt;a name=&quot;match&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;match&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;  { ... }&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义用于验证服务器对运行状况检查的响应的命名测试集。 &lt;/p&gt;&lt;p&gt;  可以配置以下参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;match_send&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;send&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ; &lt;/dt&gt;&lt;dd&gt;  将&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt;发送到服务器; &lt;/dd&gt;&lt;dt id=&quot;match_expect&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;expect&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; |   &lt;code class=&quot;notranslate&quot;&gt;~&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;regex&lt;/i&gt;&lt;/code&gt; ; &lt;/dt&gt;&lt;dd&gt;  文字字符串（1.9.12）或从服务器获取的数据应匹配的正则表达式。  使用前面的“ &lt;code class=&quot;notranslate&quot;&gt;~*&lt;/code&gt; ”修饰符（对于不区分大小写的匹配）或“ &lt;code class=&quot;notranslate&quot;&gt;~&lt;/code&gt; ”修饰符（对于区分大小写的匹配）指定正则表达式。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;send&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;expect&lt;/code&gt;参数都可以包含十六进制文字，前缀为“ &lt;code class=&quot;notranslate&quot;&gt;\x&lt;/code&gt; ”，后跟两个十六进制数字，例如“ &lt;code class=&quot;notranslate&quot;&gt;\x80&lt;/code&gt; ”（1.9.12）。 &lt;/p&gt;&lt;p&gt;  在下列情况下通过健康检查 &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   TCP连接成功建立; &lt;/li&gt;&lt;li&gt;   &lt;code class=&quot;notranslate&quot;&gt;send&lt;/code&gt;参数中的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; （如果已指定）已发送; &lt;/li&gt;&lt;li&gt;  如果指定，从服务器获取的数据与&lt;code class=&quot;notranslate&quot;&gt;expect&lt;/code&gt;参数中的字符串或正则表达式匹配; &lt;/li&gt;&lt;li&gt;  经过的时间不超过&lt;a hhref=&quot;#health_check_timeout&quot;&gt;health_check_timeout&lt;/a&gt;指令中指定的值。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;upstream backend {
zone     upstream_backend 10m;
server   127.0.0.1:12345;
</code></pre><p>}</p>
<p>match http {<br>    send     “GET / HTTP/1.0\r\nHost: localhost\r\n\r\n”;<br>    expect ~ “200 OK”;<br>}</p>
<p>server {<br>    listen       12346;<br>    proxy_pass   backend;<br>    health_check match=http;<br>}<br></p><p></p><p></p><blockquote class="note">  仅检查从服务器获得的第一个<a hhref="ngx_stream_proxy_module.html#proxy_buffer_size">proxy_buffer_size</a>字节数据。 </blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_ssl_preread_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_ssl_preread_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#ssl_preread">ssl_preread</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_ssl_preread_module</code>模块（1.11.5）允许从<a hhref="https://tools.ietf.org/html/rfc5246#section-7.4.1.2">ClientHello</a>消息中提取信息而不终止SSL / TLS，例如，通过<a hhref="https://tools.ietf.org/html/rfc6066#section-3">SNI</a>请求的服务器名称或在<a hhref="https://tools.ietf.org/html/rfc7301">ALPN中</a>通告的协议。  默认情况下不构建此模块，应使用<code class="notranslate">–with-stream_ssl_preread_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  根据服务器名称选择上游： </p><blockquote class="example"><pre class="notranslate">map $ssl_preread_server_name $name {<br>    backend.example.com      backend;<br>    default                  backend2;<br>}<p></p>
<p>upstream backend {<br>    server 192.168.0.1:12345;<br>    server 192.168.0.2:12345;<br>}</p>
<p>upstream backend2 {<br>    server 192.168.0.3:12345;<br>    server 192.168.0.4:12345;<br>}</p>
<p>server {<br>    listen      12346;<br>    proxy_pass  $name;<br>    ssl_preread on;<br>}<br></p></pre></blockquote><p></p><p>  根据协议选择上游： </p><blockquote class="example"><pre class="notranslate">map $ssl_preread_alpn_protocols $proxy {<br>    ~\bh2\b           127.0.0.1:8001;<br>    ~\bhttp/1.1\b     127.0.0.1:8002;<br>    ~\bxmpp-client\b  127.0.0.1:8003;<br>}<p></p>
<p>server {<br>    listen      9000;<br>    proxy_pass  $proxy;<br>    ssl_preread on;<br>}<br></p></pre></blockquote><p></p><p>  根据SSL协议版本选择上游： </p><blockquote class="example"><pre class="notranslate">map $ssl_preread_protocol $upstream {<br>    “”        ssh.example.com:22;<br>    “TLSv1.2” new.example.com:443;<br>    default   tls.example.com:443;<br>}<p></p>
<h1 id="ssh-and-https-on-the-same-port"><a href="#ssh-and-https-on-the-same-port" class="headerlink" title="ssh and https on the same port"></a>ssh and https on the same port</h1><p>server {<br>    listen      192.168.0.1:443;<br>    proxy_pass  $upstream;<br>    ssl_preread on;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="ssl_preread"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_preread</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_preread off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  允许在<a hhref="stream_processing.html#preread_phase">预读</a>阶段从ClientHello消息中提取信息。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p></p><dl class="compact"><dt id="var_ssl_preread_protocol"> <code class="notranslate">$ssl_preread_protocol</code> </dt> <dd>  客户端支持的最高SSL协议版本（1.15.2） </dd><dt id="var_ssl_preread_server_name"> <code class="notranslate">$ssl_preread_server_name</code> </dt> <dd>  通过SNI请求的服务器名称 </dd><dt id="var_ssl_preread_alpn_protocols"> <code class="notranslate">$ssl_preread_alpn_protocols</code> </dt> <dd>  客户端通过ALPN（1.13.10）公布的协议列表。  值以逗号分隔。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_ssl_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_ssl_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#ssl_certificate">ssl_certificate</a> <br>     <a hhref="#ssl_certificate_key">ssl_certificate_key</a> <br>     <a hhref="#ssl_ciphers">ssl_ciphers</a> <br>     <a hhref="#ssl_client_certificate">ssl_client_certificate</a> <br>     <a hhref="#ssl_crl">ssl_crl</a> <br>     <a hhref="#ssl_dhparam">ssl_dhparam</a> <br>     <a hhref="#ssl_ecdh_curve">ssl_ecdh_curve</a> <br>     <a hhref="#ssl_handshake_timeout">ssl_handshake_timeout</a> <br>     <a hhref="#ssl_password_file">ssl_password_file</a> <br>     <a hhref="#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a> <br>     <a hhref="#ssl_protocols">ssl_protocols</a> <br>     <a hhref="#ssl_session_cache">ssl_session_cache</a> <br>     <a hhref="#ssl_session_ticket_key">ssl_session_ticket_key</a> <br>     <a hhref="#ssl_session_tickets">ssl_session_tickets</a> <br>     <a hhref="#ssl_session_timeout">ssl_session_timeout</a> <br>     <a hhref="#ssl_trusted_certificate">ssl_trusted_certificate</a> <br>     <a hhref="#ssl_verify_client">ssl_verify_client</a> <br>     <a hhref="#ssl_verify_depth">ssl_verify_depth</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_ssl_module</code>模块（1.9.0）为流代理服务器提供必要的支持，以使用SSL / TLS协议。  默认情况下不构建此模块，应使用<code class="notranslate">–with-stream_ssl_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  为减少处理器负载，建议使用 </p><ul class="compact"><li>  设置<a hhref="ngx_core_module.html#worker_processes">工作进程数</a>等于处理器数， </li><li>  启用<a hhref="#ssl_session_cache_shared">共享</a>会话缓存， </li><li>  禁用<a hhref="#ssl_session_cache_builtin">内置</a>会话缓存， </li><li>  并可能增加会话<a hhref="#ssl_session_timeout">生命周期</a> （默认为5分钟）： </li></ul><p></p><blockquote class="example"><pre class="notranslate"> <strong>worker_processes auto;</strong><p></p>
<p>stream {</p>
<pre><code>...

server {
    listen              12345 ssl;

    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;
    ssl_certificate     /usr/local/nginx/conf/cert.pem;
    ssl_certificate_key /usr/local/nginx/conf/cert.key;
    &lt;strong&gt;ssl_session_cache   shared:SSL:10m;&lt;/strong&gt;
    &lt;strong&gt;ssl_session_timeout 10m;&lt;/strong&gt;

    ...
}
</code></pre><p></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="ssl_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有给定服务器的PEM格式的证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。  如果除了主证书之外还应指定中间证书，则应按以下顺序在同一文件中指定它们：首先是主证书，然后是中间证书。   PEM格式的密钥可以放在同一文件中。 &lt;/p&gt;&lt;p&gt;  从版本1.11.0开始，可以多次指定此指令以加载不同类型的证书，例如，RSA和ECDSA： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;server {
listen              12345 ssl;

ssl_certificate     example.com.rsa.crt;
ssl_certificate_key example.com.rsa.key;

ssl_certificate     example.com.ecdsa.crt;
ssl_certificate_key example.com.ecdsa.key;

...
</code></pre><p>}<br></p><p></p><blockquote class="note">  只有OpenSSL 1.0.2或更高版本支持不同证书的单独证书链。  对于旧版本，只能使用一个证书链。 </blockquote><p></p><a name="ssl_certificate_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_certificate_key</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有给定服务器的PEM格式的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  可以指定value &lt;code class=&quot;notranslate&quot;&gt;engine&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;而不是&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;从OpenSSL引擎&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;加载具有指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;密钥。 &lt;/p&gt;&lt;a name=&quot;ssl_ciphers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_ciphers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ciphers&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;ssl_ciphers HIGH:!aNULL:!MD5;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定启用的密码。  密码以OpenSSL库理解的格式指定，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_ciphers ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
</code></pre><p></p><p></p><p>  可以使用“ <code class="notranslate">openssl ciphers</code> ”命令查看完整列表。 </p><a name="ssl_client_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_client_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.8版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书。 &lt;/p&gt;&lt;p&gt;  证书列表将发送给客户。  如果不需要，可以使用&lt;a hhref=&quot;#ssl_trusted_certificate&quot;&gt;ssl_trusted_certificate&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;ssl_crl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_crl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.8版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的已吊销证书（CRL）的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书。 &lt;/p&gt;&lt;a name=&quot;ssl_dhparam&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_dhparam&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为DHE密码指定具有DH参数的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  默认情况下，不设置任何参数，因此不会使用DHE密码。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.11.0版之前，默认使用内置参数。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;ssl_ecdh_curve&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_ecdh_curve&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;curve&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;ssl_ecdh_curve auto;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定ECDHE密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;curve&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  使用OpenSSL 1.0.2或更高版本时，可以指定多条曲线（1.11.0），例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_ecdh_curve prime256v1:secp384r1;
</code></pre><p></p><p></p><p>  特殊值<code class="notranslate">auto</code> （1.11.0）指示nginx在使用OpenSSL 1.0.2或更高版本时使用内置在OpenSSL库中的列表，或者使用旧版本的<code class="notranslate">prime256v1</code> 。 </p><p></p><blockquote class="note">  在版本1.11.0之前，默认使用<code class="notranslate">prime256v1</code>曲线。 </blockquote><p></p><a name="ssl_handshake_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_handshake_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_handshake_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  指定SSL握手完成的超时。 </p><a name="ssl_password_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_password_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有密钥密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;stream {
ssl_password_file /etc/keys/global.pass;
...

server {
    listen 127.0.0.1:12345;
    ssl_certificate_key /etc/keys/first.key;
}

server {
    listen 127.0.0.1:12346;

    # named pipe can also be used instead of a file
    ssl_password_file /etc/keys/fifo;
    ssl_certificate_key /etc/keys/second.key;
}
</code></pre><p>}<br></p><p></p><a name="ssl_prefer_server_ciphers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_prefer_server_ciphers</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_prefer_server_ciphers off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  指定在使用SSLv3和TLS协议时，服务器密码应优先于客户端密码。 </p><a name="ssl_protocols"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_protocols</strong><br>    [ <code class="notranslate">SSLv2</code> ]<br>    [ <code class="notranslate">SSLv3</code> ]<br>    [ <code class="notranslate">TLSv1</code> ]<br>    [ <code class="notranslate">TLSv1.1</code> ]<br>    [ <code class="notranslate">TLSv1.2</code> ]<br>    [ <code class="notranslate">TLSv1.3</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  启用指定的协议。 </p><blockquote class="note">   <code class="notranslate">TLSv1.1</code>和<code class="notranslate">TLSv1.2</code>参数仅在使用OpenSSL 1.0.1或更高版本时有效。 </blockquote><p></p><blockquote class="note">  仅当使用使用TLSv1.3支持构建的OpenSSL 1.1.1时， <code class="notranslate">TLSv1.3</code>参数（1.13.0）才有效。 </blockquote><p></p><a name="ssl_session_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_cache</strong><br>    <code class="notranslate">off</code> |<br>    <code class="notranslate">none</code> |<br>    [ <code class="notranslate">builtin</code> [: <code class="notranslate"><i>size</i></code> ]]<br>    [ <code class="notranslate">shared</code> : <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_cache none;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置存储会话参数的缓存的类型和大小。  缓存可以是以下任何类型： </p><dl class="compact"><dt> <code class="notranslate">off</code> </dt> <dd>  严格禁止使用会话缓存：nginx明确告诉客户端会话可能不会被重用。 </dd><dt> <code class="notranslate">none</code> </dt> <dd>  轻轻地禁止使用会话缓存：nginx告诉客户端会话可以重用，但实际上并不会将会话参数存储在缓存中。 </dd><dt id="ssl_session_cache_builtin"> <code class="notranslate">builtin</code> </dt> <dd>  一个用OpenSSL构建的缓存;  仅由一个工作进程使用。  缓存大小在会话中指定。  如果未给出大小，则等于20480个会话。  使用内置缓存可能会导致内存碎片。 </dd><dt id="ssl_session_cache_shared"> <code class="notranslate">shared</code> </dt> <dd>  所有工作进程之间共享的缓存。  高速缓存大小以字节为单位指定;  一兆字节可以存储大约4000个会话。  每个共享缓存都应具有任意名称。  可以在多个服务器中使用具有相同名称的缓存。 </dd></dl><p></p><p>  两种缓存类型可以同时使用，例如： </p><blockquote class="example"><pre class="notranslate">ssl_session_cache builtin:1000 shared:SSL:10m;<br></pre></blockquote><p>  但只使用没有内置缓存的共享缓存应该更有效。 </p><a name="ssl_session_ticket_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_ticket_key</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置具有用于加密和解密TLS会话票证的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。  如果必须在多个服务器之间共享相同的密钥，则该指令是必需的。  默认情况下，使用随机生成的密钥。 &lt;/p&gt;&lt;p&gt;  如果指定了多个密钥，则仅使用第一个密钥来加密TLS会话票证。  这允许配置键旋转，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_session_ticket_key current.key;
</code></pre><p>ssl_session_ticket_key previous.key;<br></p><p></p><p>  该<code class="notranslate"><i>file</i></code>必须包含80或48个字节的随机数据，并且可以使用以下命令创建： </p><blockquote class="example"><pre class="notranslate">openssl rand 80 &gt; ticket.key<br></pre></blockquote><p>  根据文件大小，AES256（对于80字节密钥，1.11.8）或AES128（对于48字节密钥）用于加密。 </p><a name="ssl_session_tickets"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_tickets</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_tickets on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  通过<a hhref="https://tools.ietf.org/html/rfc5077">TLS会话票证</a>启用或禁用会话恢复。 </p><a name="ssl_session_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_timeout 5m;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  指定客户端可以重用会话参数的时间。 </p><a name="ssl_trusted_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_trusted_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.8版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书。 &lt;/p&gt;&lt;p&gt;  与&lt;a hhref=&quot;#ssl_client_certificate&quot;&gt;ssl_client_certificate&lt;/a&gt;设置的证书&lt;a hhref=&quot;#ssl_client_certificate&quot;&gt;不同&lt;/a&gt; ，这些证书的列表不会发送给客户端。 &lt;/p&gt;&lt;a name=&quot;ssl_verify_client&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_verify_client&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;optional&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;optional_no_ca&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;ssl_verify_client off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.8版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用客户端证书验证。  验证结果存储在&lt;a hhref=&quot;#var_ssl_client_verify&quot;&gt;$ ssl_client_verify&lt;/a&gt;变量中。  如果在客户端证书验证期间发生错误或客户端未提供所需证书，则会关闭连接。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;optional&lt;/code&gt;参数请求客户端证书，并在证书存在时验证它。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;optional_no_ca&lt;/code&gt;参数请求客户端证书，但不要求它由可信CA证书签名。  这适用于nginx外部的服务执行实际证书验证的情况。  可以通过&lt;a hhref=&quot;#var_ssl_client_cert&quot;&gt;$ ssl_client_cert&lt;/a&gt;变量访问证书的内容。 &lt;/p&gt;&lt;a name=&quot;ssl_verify_depth&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_verify_depth&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;ssl_verify_depth 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.8版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置客户端证书链中的验证深度。 &lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_stream_ssl_module&lt;/code&gt;模块支持自1.11.2以来的变量。 &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_ssl_cipher&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$ssl_cipher&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  返回用于建立的SSL连接的密码字符串; &lt;/dd&gt;&lt;dt id=&quot;var_ssl_ciphers&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$ssl_ciphers&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  返回客户端支持的密码列表（1.11.7）。  已知密码按名称列出，未知以十六进制显示，例如： &lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;AES128-SHA:AES256-SHA:0x00ff
</code></pre><p><blockquote class="note">  仅在使用OpenSSL 1.0.2或更高版本时才完全支持该变量。  对于旧版本，该变量仅适用于新会话，仅列出已知密码。 </blockquote><dt id="var_ssl_client_cert"> <code class="notranslate">$ssl_client_cert</code> </dt> <dd>  为已建立的SSL连接返回PEM格式的客户端证书，除了第一行前面的每一行都带有制表符（1.11.8）; </dd><dt id="var_ssl_client_fingerprint"> <code class="notranslate">$ssl_client_fingerprint</code> </dt> <dd>  返回已建立的SSL连接的客户端证书的SHA1指纹（1.11.8）; </dd><dt id="var_ssl_client_i_dn"> <code class="notranslate">$ssl_client_i_dn</code> </dt> <dd>  根据<a hhref="https://tools.ietf.org/html/rfc2253">RFC 2253</a> （1.11.8），为已建立的SSL连接返回客户端证书的“issuer DN”字符串; </dd><dt id="var_ssl_client_raw_cert"> <code class="notranslate">$ssl_client_raw_cert</code> </dt> <dd>  为已建立的SSL连接返回PEM格式的客户端证书（1.11.8）; </dd><dt id="var_ssl_client_s_dn"> <code class="notranslate">$ssl_client_s_dn</code> </dt> <dd>  根据<a hhref="https://tools.ietf.org/html/rfc2253">RFC 2253</a> （1.11.8），为已建立的SSL连接返回客户端证书的“subject DN”字符串; </dd><dt id="var_ssl_client_serial"> <code class="notranslate">$ssl_client_serial</code> </dt> <dd>  返回已建立的SSL连接的客户端证书的序列号（1.11.8）; </dd><dt id="var_ssl_client_v_end"> <code class="notranslate">$ssl_client_v_end</code> </dt> <dd>  返回客户端证书的结束日期（1.11.8）; </dd><dt id="var_ssl_client_v_remain"> <code class="notranslate">$ssl_client_v_remain</code> </dt> <dd>  返回客户端证书到期前的天数（1.11.8）; </dd><dt id="var_ssl_client_v_start"> <code class="notranslate">$ssl_client_v_start</code> </dt> <dd>  返回客户端证书的开始日期（1.11.8）; </dd><dt id="var_ssl_client_verify"> <code class="notranslate">$ssl_client_verify</code> </dt> <dd>  返回客户端证书验证（1.11.8）的结果：“ <code class="notranslate">SUCCESS</code> ”，“ <code class="notranslate">FAILED:</code> <code class="notranslate"><i>reason</i></code> ”，如果证书不存在则返回“ <code class="notranslate">NONE</code> ”; </dd><dt id="var_ssl_curves"> <code class="notranslate">$ssl_curves</code> </dt> <dd>  返回客户端支持的曲线列表（1.11.7）。  已知曲线按名称列出，未知以十六进制显示，例如： <blockquote class="example"><pre class="notranslate">0x001d:prime256v1:secp521r1:secp384r1<br></pre></blockquote><blockquote class="note">  仅在使用OpenSSL 1.0.2或更高版本时才支持该变量。  对于旧版本，变量值将为空字符串。 </blockquote><blockquote class="note">  该变量仅适用于新会话。 </blockquote></dd><dt id="var_ssl_protocol"> <code class="notranslate">$ssl_protocol</code> </dt> <dd>  返回已建立的SSL连接的协议; </dd><dt id="var_ssl_server_name"> <code class="notranslate">$ssl_server_name</code> </dt> <dd>  返回通过<a hhref="http://en.wikipedia.org/wiki/Server_Name_Indication">SNI</a>请求的服务器名称; </dd><dt id="var_ssl_session_id"> <code class="notranslate">$ssl_session_id</code> </dt> <dd>  返回已建立的SSL连接的会话标识; </dd><dt id="var_ssl_session_reused"> <code class="notranslate">$ssl_session_reused</code> </dt> <dd>  如果重用SSL会话，则返回“ <code class="notranslate">r</code> ”，或“ <code class="notranslate">.</code>   “ 除此以外。 </dd></p><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_split_clients_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_split_clients_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#split_clients">split_clients</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_split_clients_module</code>模块（1.11.3）创建适用于A / B测试的变量，也称为拆分测试。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">stream {<br>    …<br>    split_clients “${remote_addr}AAA” $upstream {<br>                  0.5%                feature_test1;<br>                  2.0%                feature_test2;<p></p>
<pre><code>              *                   production;
}

server {
    ...
    proxy_pass $upstream;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="split_clients"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>split_clients</strong><br>    <code class="notranslate"><i>string</i></code><br>    <code class="notranslate"><i>$variable</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为A / B测试创建变量，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;split_clients &quot;${remote_addr}AAA&quot; $variant {
   0.5%               .one;
   2.0%               .two;
   *                  &quot;&quot;;
</code></pre><p>}<br></p><p>  使用MurmurHash2对原始字符串的值进行哈希处理。  在给出的示例中，从0到21474835（0.5％）的哈希值对应于<code class="notranslate">$variant</code>变量的值<code class="notranslate">“.one”</code> ，从21474836到107374180（2％）的哈希值对应于值<code class="notranslate">“.two”</code>和哈希值从107374181到4294967295的值对应于值<code class="notranslate">“”</code> （空字符串）。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_return_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_return_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#return">return</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_return_module</code>模块（1.11.2）允许向客户端发送指定值，然后关闭连接。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">server {<br>    listen 12345;<br>    return $time_iso8601;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="return"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>return</strong> <code class="notranslate"><i>value</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定要发送到客户端的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; 。  该值可以包含文本，变量及其组合。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_realip_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_realip_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#set_real_ip_from">set_real_ip_from</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_realip_module</code>模块用于将客户端地址和端口更改为PROXY协议头（1.11.4）中发送的端口和端口。  必须先通过在<code class="notranslate">listen</code>指令中设置<a hhref="ngx_stream_core_module.html#proxy_protocol">proxy_protocol</a>参数来启用PROXY协议。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-stream_realip_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">listen 12345 proxy_protocol;<p></p>
<p>set_real_ip_from  192.168.1.0/24;<br>set_real_ip_from  192.168.2.1;<br>set_real_ip_from  2001:0db8::/32;<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="set_real_ip_from"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>set_real_ip_from</strong><br>    <code class="notranslate"><i>address</i></code> |<br>    <code class="notranslate"><i>CIDR</i></code> |<br>    <code class="notranslate">unix:</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义已知可发送正确替换地址的可信地址。  如果指定了特殊值&lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt;则所有UNIX域套接字都将受信任。 &lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;&lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_realip_remote_addr&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$realip_remote_addr&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留原始客户端地址 &lt;/dd&gt;&lt;dt id=&quot;var_realip_remote_port&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$realip_remote_port&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留原始客户端端口 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_proxy_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_proxy_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#proxy_bind">proxy_bind</a> <br>     <a hhref="#proxy_buffer_size">proxy_buffer_size</a> <br>     <a hhref="#proxy_connect_timeout">proxy_connect_timeout</a> <br>     <a hhref="#proxy_download_rate">proxy_download_rate</a> <br>     <a hhref="#proxy_next_upstream">proxy_next_upstream</a> <br>     <a hhref="#proxy_next_upstream_timeout">proxy_next_upstream_timeout</a> <br>     <a hhref="#proxy_next_upstream_tries">proxy_next_upstream_tries</a> <br>     <a hhref="#proxy_pass">proxy_pass</a> <br>     <a hhref="#proxy_protocol">proxy_protocol</a> <br>     <a hhref="#proxy_requests">proxy_requests</a> <br>     <a hhref="#proxy_responses">proxy_responses</a> <br>     <a hhref="#proxy_socket_keepalive">proxy_socket_keepalive</a> <br>     <a hhref="#proxy_ssl">proxy_ssl</a> <br>     <a hhref="#proxy_ssl_certificate">proxy_ssl_certificate</a> <br>     <a hhref="#proxy_ssl_certificate_key">proxy_ssl_certificate_key</a> <br>     <a hhref="#proxy_ssl_ciphers">proxy_ssl_ciphers</a> <br>     <a hhref="#proxy_ssl_crl">proxy_ssl_crl</a> <br>     <a hhref="#proxy_ssl_name">proxy_ssl_name</a> <br>     <a hhref="#proxy_ssl_password_file">proxy_ssl_password_file</a> <br>     <a hhref="#proxy_ssl_protocols">proxy_ssl_protocols</a> <br>     <a hhref="#proxy_ssl_server_name">proxy_ssl_server_name</a> <br>     <a hhref="#proxy_ssl_session_reuse">proxy_ssl_session_reuse</a> <br>     <a hhref="#proxy_ssl_trusted_certificate">proxy_ssl_trusted_certificate</a> <br>     <a hhref="#proxy_ssl_verify">proxy_ssl_verify</a> <br>     <a hhref="#proxy_ssl_verify_depth">proxy_ssl_verify_depth</a> <br>     <a hhref="#proxy_timeout">proxy_timeout</a> <br>     <a hhref="#proxy_upload_rate">proxy_upload_rate</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_proxy_module</code>模块（1.9.0）允许通过TCP，UDP（1.9.13）和UNIX域套接字代理数据流。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">server {<br>    listen 127.0.0.1:12345;<br>    proxy_pass 127.0.0.1:8080;<br>}<p></p>
<p>server {<br>    listen 12345;<br>    proxy_connect_timeout 1s;<br>    proxy_timeout 1m;<br>    proxy_pass example.com:12345;<br>}</p>
<p>server {<br>    listen 53 udp reuseport;<br>    proxy_timeout 20s;<br>    proxy_pass dns.example.com:53;<br>}</p>
<p>server {<br>    listen [::1]:12345;<br>    proxy_pass unix:/tmp/stream.socket;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="proxy_bind"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_bind</strong><br>    <code class="notranslate"><i>address</i></code><br>    [ <code class="notranslate">transparent</code> ] |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.2版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  使与代理服务器的传出连接源自指定的本地IP &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt; 。  参数值可以包含变量（1.11.2）。  特殊值&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;取消了从先前配置级别继承的&lt;code class=&quot;notranslate&quot;&gt;proxy_bind&lt;/code&gt;指令的效果，允许系统自动分配本地IP地址。 &lt;/p&gt;&lt;a name=&quot;proxy_bind_transparent&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;transparent&lt;/code&gt;参数（1.11.0）允许到代理服务器的传出连接源自非本地IP地址，例如，来自客户端的真实IP地址： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_bind $remote_addr transparent;
</code></pre><p></p><p>  为了使此参数有效，通常需要使用<a hhref="ngx_core_module.html#user">超级用户</a>权限运行nginx工作进程。  在Linux上，不需要（1.13.8），就像指定了<code class="notranslate">transparent</code>参数一样，工作进程从主进程继承<code class="notranslate">CAP_NET_RAW</code>功能。  还需要配置内核路由表以拦截来自代理服务器的网络流量。 </p><a name="proxy_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_buffer_size 16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.9.4版本中。 </p></div><p>  设置用于从代理服务器读取数据的缓冲区的<code class="notranslate"><i>size</i></code> 。  还设置用于从客户端读取数据的缓冲区的<code class="notranslate"><i>size</i></code> 。 </p><a name="proxy_connect_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_connect_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_connect_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  定义与代理服务器建立连接的超时。 </p><a name="proxy_download_rate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_download_rate</strong> <code class="notranslate"><i>rate</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_download_rate 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.9.3版本中。 </p></div><p>  限制从代理服务器读取数据的速度。   <code class="notranslate"><i>rate</i></code>以每秒字节数指定。  零值禁用速率限制。  每个连接设置限制，因此如果nginx同时打开到代理服务器的两个连接，则总速率将是指定限制的两倍。 </p><a name="proxy_next_upstream"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_next_upstream</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_next_upstream on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  当无法建立与代理服务器的连接时，确定是否将客户端连接传递给下一个服务器。 </p><p>  将连接传递到下一个服务器可能会受到<a hhref="#proxy_next_upstream_tries">尝试次数</a>和<a hhref="#proxy_next_upstream_timeout">时间的限制</a> 。 </p><a name="proxy_next_upstream_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_next_upstream_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_next_upstream_timeout 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  限制将连接传递给<a hhref="#proxy_next_upstream">下一个服务器所</a>允许的时间。   <code class="notranslate">0</code>值关闭此限制。 </p><a name="proxy_next_upstream_tries"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_next_upstream_tries</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_next_upstream_tries 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  限制将连接传递到<a hhref="#proxy_next_upstream">下一个服务器</a>的可能尝试次数。   <code class="notranslate">0</code>值关闭此限制。 </p><a name="proxy_pass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_pass</strong> <code class="notranslate"><i>address</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置代理服务器的地址。  地址可以指定为域名或IP地址，以及端口： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_pass localhost:12345;
</code></pre><p></p><p>  或者作为UNIX域套接字路径： </p><blockquote class="example"><pre class="notranslate">proxy_pass unix:/tmp/stream.socket;<br></pre></blockquote><p></p><p>  如果域名解析为多个地址，则所有这些地址都将以循环方式使用。  此外，可以将地址指定为<a hhref="ngx_stream_upstream_module.html">服务器组</a> 。 </p><p>  也可以使用变量（1.11.3）指定地址： </p><blockquote class="example"><pre class="notranslate">proxy_pass $upstream;<br></pre></blockquote><p>  在这种情况下，在所描述的<a hhref="ngx_stream_upstream_module.html">服务器组中</a>搜索服务器名称，并且如果未找到，则使用<a hhref="ngx_stream_core_module.html#resolver">解析器</a>来确定服务器名称。 </p><a name="proxy_protocol"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_protocol</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_protocol off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.9.2版本中。 </p></div><p>  启用<a hhref="http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt">PROXY协议</a>以连接到代理服务器。 </p><a name="proxy_requests"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_requests</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_requests 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.15.7版中。 </p></div><p>  设置客户端与现有UDP流会话之间的绑定被删除的客户端数据报的数量。  在收到指定数量的数据报后，来自同一客户端的下一个数据报将启动一个新会话。  当所有客户端数据报都传输到代理服务器并且收到预期的<a hhref="#proxy_responses">响应</a>数时，或者当它达到<a hhref="#proxy_timeout">超时</a>时，会话终止。 </p><a name="proxy_responses"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_responses</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.13版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果使用&lt;a hhref=&quot;ngx_stream_core_module.html#udp&quot;&gt;UDP&lt;/a&gt;协议，则设置代理服务器响应客户端数据报所需的数据报数。  该号码用作会话终止的提示。  默认情况下，数据报的数量不受限制。 &lt;/p&gt;&lt;p&gt;  如果指定零值，则不期望响应。  但是，如果收到响应且会话仍未完成，则将处理响应。 &lt;/p&gt;&lt;a name=&quot;proxy_socket_keepalive&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_socket_keepalive&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_socket_keepalive off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  配置到代理服务器的传出连接的“TCP keepalive”行为。  默认情况下，操作系统的设置对套接字有效。  如果指令设置为值“ &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; ”，则为套接字打开&lt;code class=&quot;notranslate&quot;&gt;SO_KEEPALIVE&lt;/code&gt;套接字选项。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用S​​SL / TLS协议以连接到代理服务器。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_certificate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_certificate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该证书用于对代理服务器进行身份验证。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_certificate_key&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_certificate_key&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于对代理服务器进行身份验证。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_ciphers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_ciphers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ciphers&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_ciphers DEFAULT;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定与代理服务器的连接的已启用密码。  密码以OpenSSL库理解的格式指定。 &lt;/p&gt;&lt;p&gt;  可以使用“ &lt;code class=&quot;notranslate&quot;&gt;openssl ciphers&lt;/code&gt; ”命令查看完整列表。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_crl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_crl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的已吊销证书（CRL）的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#proxy_ssl_verify&quot;&gt;验证&lt;/a&gt;代理服务器的证书。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_name host from proxy_pass;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许覆盖用于&lt;a hhref=&quot;#proxy_ssl_verify&quot;&gt;验证&lt;/a&gt;代理服务器证书的服务器名称，并在与代理服务器建立连接时&lt;a hhref=&quot;#proxy_ssl_server_name&quot;&gt;通过SNI传递&lt;/a&gt; 。  也可以使用变量（1.11.3）指定服务器名称。 &lt;/p&gt;&lt;p&gt;  默认情况下，使用&lt;a hhref=&quot;#proxy_pass&quot;&gt;proxy_pass&lt;/a&gt;地址的主机部分。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_password_file&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_password_file&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有密钥密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_protocols&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_protocols&lt;/strong&gt; 
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv3&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.3&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用指定的协议以连接到代理服务器。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_server_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_server_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_server_name off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  在与代理服务器建立连接时，启用或禁用通过&lt;a hhref=&quot;http://en.wikipedia.org/wiki/Server_Name_Indication&quot;&gt;TLS服务器名称指示扩展&lt;/a&gt; （SNI，RFC 6066）传递服务器名称。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_session_reuse&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_session_reuse&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_session_reuse on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定在使用代理服务器时是否可以重用SSL会话。  如果日志中出现“ &lt;code class=&quot;notranslate&quot;&gt;SSL3_GET_FINISHED:digest check failed&lt;/code&gt; ”错误，请尝试禁用会话重用。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_trusted_certificate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_trusted_certificate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#proxy_ssl_verify&quot;&gt;验证&lt;/a&gt;代理服务器的证书。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_verify&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_verify&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_verify off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用代理服务器证书的验证。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_verify_depth&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_verify_depth&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_verify_depth 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  在代理服务器证书链中设置验证深度。 &lt;/p&gt;&lt;a name=&quot;proxy_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;timeout&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_timeout 10m;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置客户端或代理服务器连接上两次连续读取或写入操作之间的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;timeout&lt;/i&gt;&lt;/code&gt; 。  如果在此时间内没有传输数据，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;proxy_upload_rate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_upload_rate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;rate&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_upload_rate 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.3版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制从客户端读取数据的速度。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;rate&lt;/i&gt;&lt;/code&gt;以每秒字节数指定。  零值禁用速率限制。  根据连接设置限制，因此如果客户端同时打开两个连接，则总速率将是指定限制的两倍。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_map_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_map_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#map">map</a> <br>     <a hhref="#map_hash_bucket_size">map_hash_bucket_size</a> <br>     <a hhref="#map_hash_max_size">map_hash_max_size</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_map_module</code>模块（1.11.2）创建的变量的值取决于其他变量的值。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">map $remote_addr $limit {<br>    127.0.0.1    “”;<br>    default      $binary_remote_addr;<br>}<p></p>
<p>limit_conn_zone $limit zone=addr:10m;<br>limit_conn addr 1;<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="map"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>map</strong><br>    <code class="notranslate"><i>string</i></code><br>    <code class="notranslate"><i>$variable</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  创建一个新变量，其值取决于第一个参数中指定的一个或多个源变量的值。 &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  由于变量仅在使用时进行评估，因此即使是大量“ &lt;code class=&quot;notranslate&quot;&gt;map&lt;/code&gt; ”变量的声明也不会给连接处理增加任何额外成本。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  地图块内的参数指定源和结果值之间的映射。 &lt;/p&gt;&lt;p&gt;  源值指定为字符串或正则表达式。 &lt;/p&gt;&lt;p&gt;  字符串匹配忽略大小写。 &lt;/p&gt;&lt;p&gt;  正则表达式应该从“ &lt;code class=&quot;notranslate&quot;&gt;~&lt;/code&gt; ”符号开始，用于区分大小写的匹配，或者从“ &lt;code class=&quot;notranslate&quot;&gt;~*&lt;/code&gt; ”符号开始，用于不区分大小写的匹配。  正则表达式可以包含命名和位置捕获，以后可以在其他指令中使用结果变量。 &lt;/p&gt;&lt;p&gt;  如果源值与下面描述的特殊参数名称之一匹配，则应使用“ &lt;code class=&quot;notranslate&quot;&gt;\&lt;/code&gt; ”符号作为前缀。 &lt;/p&gt;&lt;p&gt;  结果值可以包含文本，变量及其组合。 &lt;/p&gt;&lt;p&gt;  还支持以下特殊参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;default&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  如果源值与任何指定的变量都不匹配，则设置结果值。  如果未指定default，则默认结果值将为空字符串。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;hostnames&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  表示源值可以是带有前缀或后缀掩码的主机名： &lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;*.example.com 1;
</code></pre><p>example.<em>     1;<br>  以下两条记录 <blockquote class="example"><pre class="notranslate">example.com   1;
</pre></blockquote></em>.example.com 1;<br>  可以合并： <blockquote class="example"><pre class="notranslate">.example.com  1;<br></pre></blockquote>  应在值列表之前指定此参数。 <dt>   <code class="notranslate">include</code> <code class="notranslate"><i>file</i></code> </dt><dd>  包含一个包含值的文件。  可能有几个夹杂物。 </dd><dt id="volatile"> <code class="notranslate">volatile</code> </dt> <dd>  表示该变量不可缓存（1.11.7）。 </dd></p><p></p><p>  如果源值与多个指定变量匹配，例如掩码和正则表达式匹配，则将按以下优先级顺序选择第一个匹配变量： </p><ol class="compact"><li>  没有掩码的字符串值 </li><li>  带有前缀掩码的最长字符串值，例如“ <code class="notranslate"><em>.example.com</em></code> ” </li><li>  带有后缀掩码的最长字符串值，例如“ <code class="notranslate">mail.</code> ” </li><li>  第一个匹配正则表达式（按配置文件中的出现顺序） </li><li>  默认值 </li></ol><p></p><a name="map_hash_bucket_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>map_hash_bucket_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">map_hash_bucket_size 32|64|128;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> <br><br>                </td></tr></tbody></table></div><p>  设置<a hhref="#map">映射</a>变量哈希表的存储区大小。  默认值取决于处理器的缓存行大小。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="map_hash_max_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>map_hash_max_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">map_hash_max_size 2048;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> <br><br>                </td></tr></tbody></table></div><p>  设置<a hhref="#map">映射</a>变量哈希表的最大<code class="notranslate"><i>size</i></code> 。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_log_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_log_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#access_log">access_log</a> <br>     <a hhref="#log_format">log_format</a> <br>     <a hhref="#open_log_file_cache">open_log_file_cache</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_log_module</code>模块（1.11.4）以指定的格式写入会话日志。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">log_format basic ‘$remote_addr [$time_local] ‘<br>                 ‘$protocol $status $bytes_sent $bytes_received ‘<br>                 ‘$session_time’;<p></p>
<p>access_log /spool/logs/nginx-access.log basic buffer=32k;<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="access_log"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>access_log</strong><br>    <code class="notranslate"><i>path</i></code><br>    <code class="notranslate"><i>format</i></code><br>    [ <code class="notranslate">buffer</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">gzip[= <code class="notranslate"><i>level</i></code> ]</code> ]<br>    [ <code class="notranslate">flush</code> = <code class="notranslate"><i>time</i></code> ]<br>    [ <code class="notranslate">if</code> = <code class="notranslate"><i>condition</i></code> ];</code> <br> <code class="notranslate"><strong>access_log</strong> <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">access_log off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置缓冲日志写入的路径， <a hhref="#log_format">格式</a>和配置。  可以在同一级别指定多个日志。  可以通过在第一个参数中指定“ <code class="notranslate">syslog:</code> ”前缀来配置记录到<a hhref="syslog.html">syslog</a> 。  特殊值<code class="notranslate">off</code>取消当前级别的所有<code class="notranslate">access_log</code>指令。 </p><p>  如果使用<code class="notranslate">buffer</code>或<code class="notranslate">gzip</code>参数，则将缓冲对log的写入。 </p><blockquote class="note">  缓冲区大小不得超过磁盘文件的原子写入大小。  对于FreeBSD，这个大小是无限的。 </blockquote><p></p><p>  启用缓冲后，数据将写入文件： </p><ul class="compact"><li>  如果下一个日志行不适合缓冲区; </li><li>  如果缓冲的数据早于<code class="notranslate">flush</code>参数指定的数据; </li><li>  当工作进程<a hhref="control.html">重新打开</a>日志文件或正在关闭时。 </li></ul><p></p><p>  如果使用<code class="notranslate">gzip</code>参数，则在写入文件之前将压缩缓冲的数据。  压缩级别可以设置为1（最快，压缩较少）和9（最慢，最佳压缩）。  默认情况下，缓冲区大小等于64K字节，压缩级别设置为1.由于数据是以原子块压缩的，因此日志文件可以随时通过“ <code class="notranslate">zcat</code> ”解压缩或读取。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">access_log /path/to/log.gz basic gzip flush=5m;<br></pre></blockquote><p></p><p></p><blockquote class="note">  要使gzip压缩起作用，必须使用zlib库构建nginx。 </blockquote><p></p><p>  文件路径可以包含变量，但是这样的日志有一些约束： </p><ul class="compact"><li>  工作进程使用其凭据的<a hhref="ngx_core_module.html#user">用户</a>应具有在具有此类日志的目录中创建文件的权限; </li><li>  缓冲写入不起作用; </li><li>  每个日志写入都会打开和关闭该文件。  但是，由于常用文件的描述符可以存储在<a hhref="#open_log_file_cache">缓存中</a> ，因此写入旧文件可以在<a hhref="#open_log_file_cache">open_log_file_cache</a>指令的<code class="notranslate">valid</code>参数指定的时间内继续写入 </li></ul><p></p><p>   <code class="notranslate">if</code>参数启用条件记录。  如果<code class="notranslate"><i>condition</i></code>计算为“0”或空字符串，则不会记录会话。 </p><a name="log_format"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>log_format</strong><br>    <code class="notranslate"><i>name</i></code><br>    [ <code class="notranslate">escape</code> = <code class="notranslate">default</code> | <code class="notranslate">json</code> | <code class="notranslate">none</code> ]<br>    <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定日志格式，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;log_format proxy &apos;$remote_addr [$time_local] &apos;
     &apos;$protocol $status $bytes_sent $bytes_received &apos;
     &apos;$session_time &quot;$upstream_addr&quot; &apos;
     &apos;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&apos;;
</code></pre><p></p><p></p><a name="log_format_escape"></a><p>   <code class="notranslate">escape</code>参数（1.11.8）允许设置在变量中转义的<code class="notranslate">json</code>或<code class="notranslate">default</code>字符，默认情况下，使用<code class="notranslate">default</code>转义。   <code class="notranslate">none</code>参数（1.13.10）禁用转义。 </p><a name="open_log_file_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>open_log_file_cache</strong><br><code class="notranslate">max</code> = <code class="notranslate"><i>N</i></code><br>[ <code class="notranslate">inactive</code> = <code class="notranslate"><i>time</i></code> ]<br>[ <code class="notranslate">min_uses</code> = <code class="notranslate"><i>N</i></code> ]<br>[ <code class="notranslate">valid</code> = <code class="notranslate"><i>time</i></code> ];</code> <br> <code class="notranslate"><strong>open_log_file_cache</strong> <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">open_log_file_cache off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  定义一个缓存，用于存储名称中包含变量的常用日志的文件描述符。  该指令具有以下参数： </p><dl class="compact"><dt> <code class="notranslate">max</code> </dt> <dd>  设置缓存中的最大描述符数;  如果缓存变满，则最近最少使用（LRU）描述符将被关闭 </dd><dt> <code class="notranslate">inactive</code> </dt> <dd>  如果在此期间没有访问权限，则设置关闭缓存描述符的时间;  默认情况下，10秒 </dd><dt> <code class="notranslate">min_uses</code> </dt> <dd>  设置在<code class="notranslate">inactive</code>参数定义的时间内使文件使用的最小数量，以使描述符在缓存中保持打开状态;  默认情况下，1 </dd><dt> <code class="notranslate">valid</code> </dt> <dd>  设置应该检查文件是否仍然存在同名的时间;  默认情况下，60秒 </dd><dt> <code class="notranslate">off</code> </dt> <dd>  禁用缓存 </dd></dl><p></p><p>  用法示例： </p><blockquote class="example"><pre class="notranslate">open_log_file_cache max=1000 inactive=20s valid=1m min_uses=2;<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_limit_conn_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_limit_conn_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#limit_conn">limit_conn</a> <br>     <a hhref="#limit_conn_log_level">limit_conn_log_level</a> <br>     <a hhref="#limit_conn_zone">limit_conn_zone</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_limit_conn_module</code>模块（1.9.3）用于限制每个定义密钥的连接数，特别是来自单个IP地址的连接数。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">stream {<br>    limit_conn_zone $binary_remote_addr zone=addr:10m;<p></p>
<pre><code>...

server {

    ...

    limit_conn           addr 1;
    limit_conn_log_level error;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="limit_conn"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_conn</strong> <code class="notranslate"><i>zone</i></code> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置共享内存区域和给定键值的最大允许连接数。  超过此限制时，服务器将关闭连接。  例如，指令 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;limit_conn_zone $binary_remote_addr zone=addr:10m;
</code></pre><p>server {<br>    …<br>    limit_conn addr 1;<br>}<br></p><p>  每次只允许一个IP地址连接一个。 </p><p>  如果指定了几个<code class="notranslate">limit_conn</code>指令，则将应用任何已配置的限制。 </p><p>  当且仅当当前级别没有<code class="notranslate">limit_conn</code>指令时，指令才从前一级继承。 </p><a name="limit_conn_log_level"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_conn_log_level</strong><br><code class="notranslate">info</code> |<br><code class="notranslate">notice</code> |<br><code class="notranslate">warn</code> |<br><code class="notranslate">error</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">limit_conn_log_level error;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  为服务器限制连接数的情况设置所需的日志记录级别。 </p><a name="limit_conn_zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_conn_zone</strong><br>    <code class="notranslate"><i>key</i></code><br>    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置共享内存区域的参数，该区域将保留各种键的状态。  特别是，状态包括当前的连接数。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合（1.11.2）。  不计算具有空键值的连接。  用法示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;limit_conn_zone $binary_remote_addr zone=addr:10m;
</code></pre><p></p><p>  这里，密钥是<code class="notranslate">$binary_remote_addr</code>变量设置的客户端IP地址。   <code class="notranslate">$binary_remote_addr</code>的大小为IPv4地址的4个字节或IPv6地址的16个字节。  存储状态在32位平台上总是占用32或64字节，在64位平台上占用64字节。  一兆字节区域可以保留大约32,000个32字节状态或大约16,000个64字节状态。  如果区域存储耗尽，服务器将关闭连接。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_keyval_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_keyval_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#keyval">keyval</a> <br>     <a hhref="#keyval_zone">keyval_zone</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_keyval_module</code>模块（1.13.7）创建的变量的值取自<a hhref="http/ngx_http_api_module.html#stream_keyvals_">API</a>管理的键值对。 </p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<p></p>
<pre><code>server {
    ...
    location /api {
        api write=on;
    }
}
</code></pre><p>}</p>
<p>stream {</p>
<pre><code>keyval_zone zone=one:32k state=one.keyval;
keyval      $ssl_server_name $name zone=one;

server {
    listen              12345 ssl;
    proxy_pass          $name;
    ssl_certificate     /usr/local/nginx/conf/cert.pem;
    ssl_certificate_key /usr/local/nginx/conf/cert.key;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="keyval"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>keyval</strong><br>    <code class="notranslate"><i>key</i></code><br>    <code class="notranslate"><i>$variable</i></code><br>    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  创建一个新的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;$variable&lt;/i&gt;&lt;/code&gt;其值由&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;数据库中的键查找。  字符串匹配忽略大小写。  数据库存储在&lt;code class=&quot;notranslate&quot;&gt;zone&lt;/code&gt;参数指定的共享内存区域中。 &lt;/p&gt;&lt;a name=&quot;keyval_zone&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;keyval_zone&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;zone&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; : &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;state&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;sync&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置保留键值数据库的共享内存区域的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  键值对由&lt;a hhref=&quot;http/ngx_http_api_module.html#stream_keyvals_&quot;&gt;API&lt;/a&gt;管理。 &lt;/p&gt;&lt;a name=&quot;keyval_state&quot;&gt;&lt;/a&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;state&lt;/code&gt;参数指定一个&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;以JSON格式保持键值数据库的当前状态，并使其在nginx重新启动时保持不变。 &lt;/p&gt;&lt;a name=&quot;keyval_timeout&quot;&gt;&lt;/a&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;参数（1.15.0）设置从区域中删除键值对的时间。 &lt;/p&gt;&lt;a name=&quot;keyval_sync&quot;&gt;&lt;/a&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;sync&lt;/code&gt;参数（1.15.0）可以&lt;a hhref=&quot;ngx_stream_zone_sync_module.html#zone_sync&quot;&gt;同步&lt;/a&gt;共享内存区域。  同步需要设置&lt;a hhref=&quot;#keyval_timeout&quot;&gt;超时&lt;/a&gt;参数。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_js_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_js_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#js_access">js_access</a> <br>     <a hhref="#js_filter">js_filter</a> <br>     <a hhref="#js_include">js_include</a> <br>     <a hhref="#js_preread">js_preread</a> <br>     <a hhref="#js_set">js_set</a> <br> <a hhref="#properties">Session Object Properties</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_js_module</code>模块用于在<a hhref="njs/index.html">njs中</a>实现处理程序 - 这是JavaScript语言的一个子集。 </p><p>  默认情况下不构建此模块。  可<a hhref="njs/install.html">在此处</a>下载和安装说明。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="note">  此示例适用于njs <a hhref="njs/changes.html#njs0.2.4">0.2.4</a>及更高版本。  对于njs 0.2.3及更早版本，请使用<a hhref="njs/examples.html#legacy">此</a>示例。 </blockquote><p></p><blockquote class="example"><pre class="notranslate">load_module modules/ngx_stream_js_module.so;<br>…<p></p>
<p>stream {<br>    js_include stream.js;</p>
<pre><code>js_set $bar bar;
js_set $req_line req_line;

server {
    listen 12345;

    js_preread preread;
    return     $req_line;
}

server {
    listen 12346;

    js_access  access;
    proxy_pass 127.0.0.1:8000;
    js_filter  header_inject;
}
</code></pre><p>}</p>
<p>http {<br>    server {<br>        listen 8000;<br>        location / {<br>            return 200 $http_foo\n;<br>        }<br>    }<br>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">stream.js</code>文件： </p><blockquote class="example"><pre class="notranslate">var line = ‘’;<p></p>
<p>function bar(s) {<br>    var v = s.variables;<br>    s.log(“hello from bar() handler!”);<br>    return “bar-var” + v.remote_port + “; pid=” + v.pid;<br>}</p>
<p>function preread(s) {<br>    s.on(‘upload’, function (data, flags) {<br>        var n = data.indexOf(‘\n’);<br>        if (n != -1) {<br>            line = data.substr(0, n);<br>            s.done();<br>        }<br>    });<br>}</p>
<p>function req_line(s) {<br>    return line;<br>}</p>
<p>// Read HTTP request line.<br>// Collect bytes in ‘req’ until<br>// request line is read.<br>// Injects HTTP header into a client’s request</p>
<p>var my_header =  ‘Foo: foo’;<br>function header_inject(s) {<br>    var req = ‘’;<br>    s.on(‘upload’, function(data, flags) {<br>        req += data;<br>        var n = req.search(‘\n’);<br>        if (n != -1) {<br>            var rest = req.substr(n + 1);<br>            req = req.substr(0, n + 1);<br>            s.send(req + my_header + ‘\r\n’ + rest, flags);<br>            s.off(‘upload’);<br>        }<br>    });<br>}</p>
<p>function access(s) {<br>    if (s.remoteAddress.match(‘^192.*’)) {<br>        s.abort();<br>        return;<br>    }</p>
<pre><code>s.allow();
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="js_access"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>js_access</strong> <code class="notranslate"><i>function</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将在&lt;a hhref=&quot;stream_processing.html#access_phase&quot;&gt;访问&lt;/a&gt;阶段调用的njs函数。 &lt;/p&gt;&lt;a name=&quot;js_filter&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;js_filter&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;function&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置数据过滤器。 &lt;/p&gt;&lt;a name=&quot;js_include&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;js_include&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定在njs中实现服务器和变量处理程序的文件。 &lt;/p&gt;&lt;a name=&quot;js_preread&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;js_preread&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;function&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将在&lt;a hhref=&quot;stream_processing.html#preread_phase&quot;&gt;预读&lt;/a&gt;阶段调用的njs函数。 &lt;/p&gt;&lt;a name=&quot;js_set&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;js_set&lt;/strong&gt; 
</code></pre><p><code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>function</i></code> ; <br><br>                </p></td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为指定的变量设置njs函数。 &lt;/p&gt;&lt;a name=&quot;properties&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  会话对象属性 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;  每个流njs处理程序接收一个参数，即流会话&lt;a hhref=&quot;njs/reference.html#stream&quot;&gt;对象&lt;/a&gt; 。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_geo_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_geo_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#geo">geo</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_geo_module</code>模块（1.11.3）使用取决于客户端IP地址的值创建变量。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">geo $geo {<br>    default        0;<p></p>
<pre><code>127.0.0.1      2;
192.168.1.0/24 1;
10.1.0.0/16    1;

::1            2;
2001:0db8::/32 1;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="geo"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>geo</strong> [ <code class="notranslate"><i>$address</i></code> ] <code class="notranslate"><i>$variable</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  描述指定变量的值对客户端IP地址的依赖性。  默认情况下，地址取自&lt;code class=&quot;notranslate&quot;&gt;$remote_addr&lt;/code&gt;变量，但也可以从另一个变量中获取，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;geo $arg_remote_addr $geo {
...;
</code></pre><p>}<br></p><p></p><p></p><blockquote class="note">  由于变量仅在使用时进行评估，因此即使存在大量已声明的“ <code class="notranslate">geo</code> ”变量也不会导致连接处理的任何额外成本。 </blockquote><p></p><p>  如果变量的值不表示有效的IP地址，则使用“ <code class="notranslate">255.255.255.255</code> ”地址。 </p><p>  地址被指定为CIDR表示法中的前缀（包括单个地址）或作为范围。 </p><p>  还支持以下特殊参数： </p><dl class="compact"><dt> <code class="notranslate">delete</code> </dt> <dd>  删除指定的网络。 </dd><dt> <code class="notranslate">default</code> </dt> <dd>  如果客户端地址与任何指定的地址不匹配，则设置为该变量的值。  当以CIDR表示法指定地址时，可以使用“ <code class="notranslate">0.0.0.0/0</code> ”和“ <code class="notranslate">::/0</code> ”而不是<code class="notranslate">default</code> 。  如果未指定default，则默认值为空字符串。 </dd><dt> <code class="notranslate">include</code> </dt> <dd>  包括一个包含地址和值的文件。  可能有几个夹杂物。 </dd><dt> <code class="notranslate">ranges</code> </dt> <dd>  表示地址被指定为范围。  这个参数应该是第一个。  要加快地理基地的加载速度，地址应按升序排列。 </dd></dl><p></p><p>  例： </p><blockquote class="example"><pre class="notranslate">geo $country {<br>    default        ZZ;<br>    include        conf/geo.conf;<br>    delete         127.0.0.0/16;<p></p>
<pre><code>127.0.0.0/24   US;
127.0.0.1/32   RU;
10.1.0.0/16    RU;
192.168.1.0/24 UK;
</code></pre><p>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">conf/geo.conf</code>文件可以包含以下行： </p><blockquote class="example"><pre class="notranslate">10.2.0.0/16    RU;<br>192.168.2.0/24 RU;<br></pre></blockquote><p></p><p>  使用最具体匹配的值。  例如，对于127.0.0.1地址，将选择值“ <code class="notranslate">RU</code> ”，而不是“ <code class="notranslate">US</code> ”。 </p><p>  范围示例： </p><blockquote class="example"><pre class="notranslate">geo $country {<br>    ranges;<br>    default                   ZZ;<br>    127.0.0.0-127.0.0.0       US;<br>    127.0.0.1-127.0.0.1       RU;<br>    127.0.0.1-127.0.0.255     US;<br>    10.1.0.0-10.1.255.255     RU;<br>    192.168.1.0-192.168.1.255 UK;<br>}<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_geoip_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_geoip_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#geoip_country">geoip_country</a> <br>     <a hhref="#geoip_city">geoip_city</a> <br>     <a hhref="#geoip_org">geoip_org</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_geoip_module</code>模块（1.11.3）使用预编译的<a hhref="http://www.maxmind.com">MaxMind</a>数据库创建具有取决于客户端IP地址的值的变量。 </p><p>  使用支持IPv6的数据库时，IPv4地址将被查找为IPv4映射的IPv6地址。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-stream_geoip_module</code>配置参数启用它。 </p><blockquote class="note">  该模块需要<a hhref="http://www.maxmind.com/app/c">MaxMind GeoIP</a>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">stream {<br>    geoip_country         GeoIP.dat;<br>    geoip_city            GeoLiteCity.dat;<p></p>
<pre><code>map $geoip_city_continent_code $nearest_server {
    default        example.com;
    EU          eu.example.com;
    NA          na.example.com;
    AS          as.example.com;
}
</code></pre><p>   …<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="geoip_country"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>geoip_country</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定用于根据客户端IP地址确定国家/地区的数据库。  使用此数据库时，以下变量可用： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_geoip_country_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_country_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  两个字母的国家/地区代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;RU&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;US&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_country_code3&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_country_code3&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  三个字母的国家/地区代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;RUS&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;USA&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_country_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_country_name&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  国名，例如“ &lt;code class=&quot;notranslate&quot;&gt;Russian Federation&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;United States&lt;/code&gt; ”。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;geoip_city&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;geoip_city&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定用于根据客户端IP地址确定国家，地区和城市的数据库。  使用此数据库时，以下变量可用： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_geoip_area_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_area_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  电话区号（仅限美国）。 &lt;blockquote class=&quot;note&quot;&gt;  此变量可能包含过时的信息，因为不推荐使用相应的数据库字段。 &lt;/blockquote&gt;&lt;/dd&gt;&lt;dt id=&quot;var_geoip_city_continent_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city_continent_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  两个字母的大陆代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;EU&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;NA&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_city_country_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city_country_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  两个字母的国家/地区代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;RU&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;US&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_city_country_code3&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city_country_code3&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  三个字母的国家/地区代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;RUS&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;USA&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_city_country_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city_country_name&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  国名，例如“ &lt;code class=&quot;notranslate&quot;&gt;Russian Federation&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;United States&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_dma_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_dma_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  根据Google AdWords API中的&lt;a hhref=&quot;https://developers.google.com/adwords/api/appendix/cities-DMAregions&quot;&gt;地理位置定位&lt;/a&gt; ，美国的DMA区域代码（也称为“都市代码”）。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_latitude&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_latitude&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  纬度。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_longitude&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_longitude&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  经度。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_region&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_region&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  双符号国家区域代码（地区，领土，州，省，联邦土地等），例如“ &lt;code class=&quot;notranslate&quot;&gt;48&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;DC&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_region_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_region_name&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  国家地区名称（地区，领土，州，省，联邦土地等），例如“ &lt;code class=&quot;notranslate&quot;&gt;Moscow City&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;District of Columbia&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_city&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  城市名称，例如“ &lt;code class=&quot;notranslate&quot;&gt;Moscow&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;Washington&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_postal_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_postal_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  邮政编码。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;geoip_org&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;geoip_org&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定用于根据客户端IP地址确定组织的数据库。  使用此数据库时，以下变量可用： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_geoip_org&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_org&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  组织名称，例如“墨尔本大学”。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_core_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_core_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#listen">listen</a> <br>     <a hhref="#preread_buffer_size">preread_buffer_size</a> <br>     <a hhref="#preread_timeout">preread_timeout</a> <br>     <a hhref="#proxy_protocol_timeout">proxy_protocol_timeout</a> <br>     <a hhref="#resolver">resolver</a> <br>     <a hhref="#resolver_timeout">resolver_timeout</a> <br>     <a hhref="#server">server</a> <br>     <a hhref="#stream">stream</a> <br>     <a hhref="#tcp_nodelay">tcp_nodelay</a> <br>     <a hhref="#variables_hash_bucket_size">variables_hash_bucket_size</a> <br>     <a hhref="#variables_hash_max_size">variables_hash_max_size</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_core_module</code>模块自版本1.9.0起可用。  默认情况下不构建此模块，应使用<code class="notranslate">–with-stream</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">worker_processes auto;<p></p>
<p>error_log /var/log/nginx/error.log info;</p>
<p>events {<br>    worker_connections  1024;<br>}</p>
<p>stream {<br>    upstream backend {<br>        hash $remote_addr consistent;</p>
<pre><code>    server backend1.example.com:12345 weight=5;
    server 127.0.0.1:12345            max_fails=3 fail_timeout=30s;
    server unix:/tmp/backend3;
}

upstream dns {
   server 192.168.0.1:53535;
   server dns.example.com:53;
}

server {
    listen 12345;
    proxy_connect_timeout 1s;
    proxy_timeout 3s;
    proxy_pass backend;
}

server {
    listen 127.0.0.1:53 udp reuseport;
    proxy_timeout 20s;
    proxy_pass dns;
}

server {
    listen [::1]:12345;
    proxy_pass unix:/tmp/stream.socket;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="listen"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>listen</strong><br>    <code class="notranslate"><i>address</i></code> : <code class="notranslate"><i>port</i></code><br>    [ <code class="notranslate">ssl</code> ]<br>    [ <code class="notranslate">udp</code> ]<br>    [ <code class="notranslate">proxy_protocol</code> ]<br>    [ <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">bind</code> ]<br>    [ <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> ]<br>    [ <code class="notranslate">reuseport</code> ]<br>    [ <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> |[ <code class="notranslate"><i>keepidle</i></code> ]:[ <code class="notranslate"><i>keepintvl</i></code> ]:[ <code class="notranslate"><i>keepcnt</i></code> ]];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置服务器将接受连接的套接字的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;port&lt;/i&gt;&lt;/code&gt; 。  可以仅指定端口。  地址也可以是主机名，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;listen 127.0.0.1:12345;
</code></pre><p>listen <em>:12345;<br>listen 12345;     # same as </em>:12345<br>listen localhost:12345;<br></p><p>   IPv6地址在方括号中指定： </p><blockquote class="example"><pre class="notranslate">listen [::1]:12345;<br>listen [::]:12345;<br></pre></blockquote><p>   UNIX域套接字使用“ <code class="notranslate">unix:</code> ”前缀指定： </p><blockquote class="example"><pre class="notranslate">listen unix:/var/run/nginx.sock;<br></pre></blockquote><p></p><p>   <code class="notranslate">ssl</code>参数允许指定此端口上接受的所有连接都应在SSL模式下工作。 </p><a name="udp"></a><p>   <code class="notranslate">udp</code>参数配置一个侦听套接字以处理数据报（1.9.13）。 </p><a name="proxy_protocol"></a><p>   <code class="notranslate">proxy_protocol</code>参数（1.11.4）允许指定此端口上接受的所有连接都应使用<a hhref="http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt">PROXY协议</a> 。 </p><blockquote class="note">  自版本1.13.11起支持PROXY协议版本2。 </blockquote><p></p><p>   <code class="notranslate">listen</code>指令可以有几个特定于与套接字相关的系统调用的附加参数。 </p><dl class="compact"><dt>   <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  在<code class="notranslate">listen()</code>调用中设置<code class="notranslate">backlog</code>参数，该参数限制挂起连接队列的最大长度（1.9.2）。  默认情况下， <code class="notranslate">backlog</code>在FreeBSD，DragonFly BSD和macOS上设置为-1，在其他平台上设置为511。 </dd><dt>   <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> </dt><dd>  设置侦听套接字的接收缓冲区大小（ <code class="notranslate">SO_RCVBUF</code>选项）（1.11.13）。 </dd><dt>   <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> </dt><dd>  设置侦听套接字的发送缓冲区大小（ <code class="notranslate">SO_SNDBUF</code>选项）（1.11.13）。 </dd><dt> <code class="notranslate">bind</code> </dt> <dd>  此参数指示对给定地址：端口对进行单独的<code class="notranslate">bind()</code>调用。  事实是，如果有几个具有相同端口但不同地址的<code class="notranslate">listen</code>指令，并且其中一个<code class="notranslate">listen</code>指令侦听给定端口（ <code class="notranslate"><em>:</em></code> <code class="notranslate"><i>port</i></code> ）的所有地址，则nginx将<code class="notranslate">bind()</code>仅限于<code class="notranslate">:</code> <code class="notranslate"><i>port</i></code> 。  应该注意的是，在这种情况下将进行<code class="notranslate">getsockname()</code>系统调用以确定接受连接的地址。  如果使用<code class="notranslate">ipv6only</code>或<code class="notranslate">so_keepalive</code>参数，那么对于给定的<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对将始终进行单独的<code class="notranslate">bind()</code>调用。 </dd><dt>   <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> </dt><dd>  此参数确定（通过<code class="notranslate">IPV6_V6ONLY</code>套接字选项）侦听通配符地址<code class="notranslate">[::]</code>的IPv6套接字是仅接受IPv6连接还是仅接受IPv6和IPv4连接。  默认情况下，此参数处于启用状态。  它只能在开始时设置一次。 </dd><dt id="reuseport"> <code class="notranslate">reuseport</code> </dt> <dd>  此参数（1.9.1）指示为每个工作进程创建一个单独的侦听套接字（使用Linux 3.9+和DragonFly BSD上的<code class="notranslate">SO_REUSEPORT</code>套接字选项，或FreeBSD 12+上的<code class="notranslate">SO_REUSEPORT_LB</code> ），允许内核在工作进程之间分配传入连接。  目前仅适用于Linux 3.9 +，DragonFly BSD和FreeBSD 12+（1.15.1）。 <blockquote class="note">  不恰当地使用此选项可能会产生安全<a hhref="http://man7.org/linux/man-pages/man7/socket.7.html">隐患</a> 。 </blockquote></dd><dt>   <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> |   <code class="notranslate">off</code> | [ <code class="notranslate"><i>keepidle</i></code> ]：[ <code class="notranslate"><i>keepintvl</i></code> ]：[ <code class="notranslate"><i>keepcnt</i></code> ] </dt><dd>  此参数配置侦听套接字的“TCP keepalive”行为。  如果省略此参数，则操作系统的设置将对套接字有效。  如果将其设置为值“ <code class="notranslate">on</code> ”，则为套接字打开<code class="notranslate">SO_KEEPALIVE</code>选项。  如果将其设置为值“ <code class="notranslate">off</code> ”，则为套接字关闭<code class="notranslate">SO_KEEPALIVE</code>选项。  某些操作系统支持使用<code class="notranslate">TCP_KEEPIDLE</code> ， <code class="notranslate">TCP_KEEPINTVL</code>和<code class="notranslate">TCP_KEEPCNT</code>套接字选项在每个套接字的基础上设置TCP keepalive参数。  在这样的系统上（目前，Linux 2.4 +，NetBSD 5+和FreeBSD 9.0-STABLE），可以使用<code class="notranslate"><i>keepidle</i></code> ， <code class="notranslate"><i>keepintvl</i></code>和<code class="notranslate"><i>keepcnt</i></code>参数配置它们。  可以省略一个或两个参数，在这种情况下，相应套接字选项的系统默认设置将生效。  例如， <blockquote class="example"><pre class="notranslate">so_keepalive=30m::10</pre></blockquote>  将空闲超时（ <code class="notranslate">TCP_KEEPIDLE</code> ）设置为30分钟，将探测间隔（ <code class="notranslate">TCP_KEEPINTVL</code> ）保留为系统默认值，并将探测计数（ <code class="notranslate">TCP_KEEPCNT</code> ）设置为10个探测。 </dd></dl><p></p><p>  不同的服务器必须侦听不同的<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对。 </p><a name="preread_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>preread_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">preread_buffer_size 16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.5版中。 </p></div><p>  指定<a hhref="stream_processing.html#preread_phase">预读</a>缓冲区的<code class="notranslate"><i>size</i></code> 。 </p><a name="preread_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>preread_timeout</strong> <code class="notranslate"><i>timeout</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">preread_timeout 30s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.5版中。 </p></div><p>  指定<a hhref="stream_processing.html#preread_phase">预读</a>阶段的<code class="notranslate"><i>timeout</i></code> 。 </p><a name="proxy_protocol_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_protocol_timeout</strong> <code class="notranslate"><i>timeout</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_protocol_timeout 30s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.4版中。 </p></div><p>  指定读取PROXY协议标头以完成的<code class="notranslate"><i>timeout</i></code> 。  如果在此时间内未传输整个标头，则关闭连接。 </p><a name="resolver"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>resolver</strong><br>    <code class="notranslate"><i>address</i></code> …<br>    [ <code class="notranslate">valid</code> = <code class="notranslate"><i>time</i></code> ]<br>    [ <code class="notranslate">ipv6</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.3版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  将用于解析上游服务器名称的名称服务器配置到地址中，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;resolver 127.0.0.1 [::1]:5353;
</code></pre><p></p><p>  可以将地址指定为域名或IP地址，以及可选端口。  如果未指定端口，则使用端口53。  以循环方式查询名称服务器。 </p><p>  默认情况下，nginx将在解析时查找IPv4和IPv6地址。  如果不需要查找IPv6地址，可以指定<code class="notranslate">ipv6=off</code>参数。 </p><p>  默认情况下，nginx使用响应的TTL值缓存答案。  可选的<code class="notranslate">valid</code>参数允许覆盖它： </p><blockquote class="example"><pre class="notranslate">resolver 127.0.0.1 [::1]:5353 valid=30s;<br></pre></blockquote><p></p><blockquote class="note">  在1.11.3版之前，该指令作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="resolver_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>resolver_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">resolver_timeout 30s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">stream</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.3版中。 </p></div><p>  设置名称解析的超时，例如： </p><blockquote class="example"><pre class="notranslate">resolver_timeout 5s;<br></pre></blockquote><p></p><blockquote class="note">  在1.11.3版之前，该指令作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="server"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server</strong> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置服务器的配置。 &lt;/p&gt;&lt;a name=&quot;stream&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;stream&lt;/strong&gt; { ... }&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  提供指定流服务器指令的配置文件上下文。 &lt;/p&gt;&lt;a name=&quot;tcp_nodelay&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;tcp_nodelay&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;tcp_nodelay on;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.4版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用&lt;code class=&quot;notranslate&quot;&gt;TCP_NODELAY&lt;/code&gt;选项的使用。  为客户端和代理服务器连接启用该选项。 &lt;/p&gt;&lt;a name=&quot;variables_hash_bucket_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;variables_hash_bucket_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;variables_hash_bucket_size 64;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.2版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置变量哈希表的桶大小。  设置哈希表的详细信息在单独的&lt;a hhref=&quot;hash.html&quot;&gt;文档&lt;/a&gt;中提供。 &lt;/p&gt;&lt;a name=&quot;variables_hash_max_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;variables_hash_max_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;variables_hash_max_size 1024;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.2版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置变量哈希表的最大&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  设置哈希表的详细信息在单独的&lt;a hhref=&quot;hash.html&quot;&gt;文档&lt;/a&gt;中提供。 &lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_stream_core_module&lt;/code&gt;模块支持自1.11.2以来的变量。 &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_binary_remote_addr&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$binary_remote_addr&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  客户端地址采用二进制形式，值的长度始终为IPv4地址的4个字节或IPv6地址的16个字节 &lt;/dd&gt;&lt;dt id=&quot;var_bytes_received&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$bytes_received&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从客户端收到的字节数（1.11.4） &lt;/dd&gt;&lt;dt id=&quot;var_bytes_sent&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$bytes_sent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  发送到客户端的字节数 &lt;/dd&gt;&lt;dt id=&quot;var_connection&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$connection&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  连接序列号 &lt;/dd&gt;&lt;dt id=&quot;var_hostname&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$hostname&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  主机名 &lt;/dd&gt;&lt;dt id=&quot;var_msec&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$msec&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  以毫秒为单位的当前时间（以毫秒为单位） &lt;/dd&gt;&lt;dt id=&quot;var_nginx_version&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$nginx_version&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   nginx版本 &lt;/dd&gt;&lt;dt id=&quot;var_pid&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$pid&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  工作进程的PID &lt;/dd&gt;&lt;dt id=&quot;var_protocol&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$protocol&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  用于与客户端通信的协议： &lt;code class=&quot;notranslate&quot;&gt;TCP&lt;/code&gt;或&lt;code class=&quot;notranslate&quot;&gt;UDP&lt;/code&gt; （1.11.4） &lt;/dd&gt;&lt;dt id=&quot;var_proxy_protocol_addr&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$proxy_protocol_addr&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  来自PROXY协议头的客户端地址，否则为空字符串（1.11.4） &lt;p&gt;  必须先通过在&lt;a hhref=&quot;#listen&quot;&gt;listen&lt;/a&gt;指令中设置&lt;code class=&quot;notranslate&quot;&gt;proxy_protocol&lt;/code&gt;参数来启用PROXY协议。 &lt;/p&gt;&lt;/dd&gt;&lt;dt id=&quot;var_proxy_protocol_port&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$proxy_protocol_port&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  来自PROXY协议头的客户端端口，否则为空字符串（1.11.4） &lt;p&gt;  必须先通过在&lt;a hhref=&quot;#listen&quot;&gt;listen&lt;/a&gt;指令中设置&lt;code class=&quot;notranslate&quot;&gt;proxy_protocol&lt;/code&gt;参数来启用PROXY协议。 &lt;/p&gt;&lt;/dd&gt;&lt;dt id=&quot;var_remote_addr&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$remote_addr&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  客户地址 &lt;/dd&gt;&lt;dt id=&quot;var_remote_port&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$remote_port&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  客户端端口 &lt;/dd&gt;&lt;dt id=&quot;var_server_addr&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$server_addr&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  接受连接的服务器的地址 &lt;p&gt;  计算此变量的值通常需要一次系统调用。  为避免系统调用， &lt;a hhref=&quot;#listen&quot;&gt;listen&lt;/a&gt;指令必须指定地址并使用&lt;code class=&quot;notranslate&quot;&gt;bind&lt;/code&gt;参数。 &lt;/p&gt;&lt;/dd&gt;&lt;dt id=&quot;var_server_port&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$server_port&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  接受连接的服务器的端口 &lt;/dd&gt;&lt;dt id=&quot;var_session_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$session_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  会话持续时间（以秒为单位），分辨率为毫秒（1.11.4）; &lt;/dd&gt;&lt;dt id=&quot;var_status&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$status&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  会话状态（1.11.4），可以是以下之一： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;200&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  会话成功完成 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;400&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  无法解析客户端数据，例如&lt;a hhref=&quot;#proxy_protocol&quot;&gt;PROXY协议&lt;/a&gt;头 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;403&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  例如，当&lt;a hhref=&quot;ngx_stream_access_module.html&quot;&gt;某些客户端地址的&lt;/a&gt;访问受限时，禁止访问 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;500&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  内部服务器错误 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;502&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  坏网关，例如，如果无法选择或到达上游服务器。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;503&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务不可用，例如，当访问受&lt;a hhref=&quot;ngx_stream_limit_conn_module.html&quot;&gt;连接数&lt;/a&gt;限制时 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;var_time_iso8601&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$time_iso8601&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当地时间采用ISO 8601标准格式 &lt;/dd&gt;&lt;dt id=&quot;var_time_local&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$time_local&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  通用日志格式的本地时间 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/stream/ngx_stream_access_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_stream_access_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#allow">allow</a> <br>     <a hhref="#deny">deny</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_stream_access_module</code>模块（1.9.2）允许限制对某些客户端地址的访问。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">server {<br>    …<br>    deny  192.168.1.1;<br>    allow 192.168.1.0/24;<br>    allow 10.1.1.0/16;<br>    allow 2001:0db8::/32;<br>    deny  all;<br>}<br></pre></blockquote><p></p><p>  按顺序检查规则，直到找到第一个匹配项。  在此示例中，仅允许IPv4网络<code class="notranslate">10.1.1.0/16</code>和<code class="notranslate">192.168.1.0/24</code>不包括地址<code class="notranslate">192.168.1.1</code> ）和IPv6网络<code class="notranslate">2001:0db8::/32</code> 。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="allow"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>allow</strong><br>    <code class="notranslate"><i>address</i></code> |<br>    <code class="notranslate"><i>CIDR</i></code> |<br>    <code class="notranslate">unix:</code> |<br>    <code class="notranslate">all</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许访问指定的网络或地址。  如果指定了特殊值&lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt;则允许访问所有UNIX域套接字。 &lt;/p&gt;&lt;a name=&quot;deny&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;deny&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;CIDR&lt;/i&gt;&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;all&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  拒绝访问指定的网络或地址。  如果指定了特殊值&lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt;则拒绝所有UNIX域套接字的访问。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/njs/install.html</url>
      <content type="html"><![CDATA[<p></p><h2>  下载并安装 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#install_package">Installing as a Linux package</a> <br> <a hhref="#install_sources">Building from the sources</a> <br></td></tr></tbody></table><a name="install_package"></a><center><h4>  作为Linux软件包安装 </h4></center><p>  对于Linux，可以使用njs模块<a hhref="linux_packages.html#dynmodules">包</a> ： </p><ul class="compact"><li>   <code class="notranslate">nginx-module-njs</code> -  njs <a hhref="ngx_core_module.html#load_module">动态</a>模块 </li><li>   <code class="notranslate">nginx-module-njs-dbg</code> - <code class="notranslate">nginx-module-njs</code>包的调试符号 </li></ul><p></p><a name="install_sources"></a><center><h4>  从源头构建 </h4></center><p>  可以使用以下命令克隆具有njs源的<a hhref="http://hg.nginx.org/njs">存储库</a> :(需要<a hhref="https://www.mercurial-scm.org">Mercurial</a>客户端）： </p><blockquote class="example"><pre class="notranslate">hg clone <a href="http://hg.nginx.org/njs" target="_blank" rel="noopener">http://hg.nginx.org/njs</a><br></pre></blockquote><p>  然后应使用<code class="notranslate">–add-module</code>配置参数编译<code class="notranslate">–add-module</code> ： </p><blockquote class="example"><pre class="notranslate">./configure –add-module= <code class="notranslate"><i>path-to-njs</i></code> /nginx<br></pre></blockquote><p>  模块也可以构建为<a hhref="ngx_core_module.html#load_module">动态</a> ： </p><blockquote class="example"><pre class="notranslate">./configure –add-dynamic-module= <code class="notranslate"><i>path-to-njs</i></code> /nginx<br></pre></blockquote><p></p><p>  要仅构建njs命令行<a hhref="cli.html">实用程序</a> ，请运行<code class="notranslate">./configure</code>并从njs根目录<code class="notranslate">make njs</code>命令。  该实用程序以<code class="notranslate">./build/njs</code> 。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/njs/index.html</url>
      <content type="html"><![CDATA[<p></p><h2>   njs脚本语言 </h2><a name="summary"></a><p>   njs是JavaScript语言的一个子集，允许扩展nginx功能。   njs是根据<a hhref="http://www.ecma-international.org/ecma-262/5.1/">ECMAScript 5.1</a> （严格模式）创建的，带有一些<a hhref="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript 6</a>及更高版本的扩展。  合规性仍在<a hhref="compatibility.html">不断发展</a> 。 </p><a name="links"></a><p></p><ul class="compact"><li>   <a hhref="install.html">下载并安装</a> </li><li>   <a hhref="changes.html">变化</a> </li><li>   <a hhref="reference.html">参考</a> </li><li>   <a hhref="examples.html">例子</a> </li><li>   <a hhref="compatibility.html">兼容性</a> </li><li>   <a hhref="cli.html">命令行界面</a> </li></ul><p></p><p></p><ul class="compact"><li>   <a hhref="http/ngx_http_js_module.html">ngx_http_js_module</a> </li><li>   <a hhref="stream/ngx_stream_js_module.html">ngx_stream_js_module</a> </li></ul><p></p><a name="usecases"></a><center><h4>  用例 </h4></center><p></p><ul class="compact"><li>  在请求到达上游服务器之前，njs中的复杂访问控制和安全性检查 </li><li>  操纵响应标头 </li><li>  编写灵活的异步内容处理程序和过滤器 </li></ul><p>  有关更多njs用例，请参阅<a hhref="examples.html">示例</a>和<a hhref="https://www.nginx.com/blog/tag/nginx-javascript-module/">博客文章</a> 。 </p><a name="example"></a><center><h4>  基本HTTP示例 </h4></center><p>  要在nginx中使用njs： </p><ul class="compact"><li><p>   <a hhref="install.html">安装</a> njs脚本语言 </p></li><li id="hello_world"><p>  创建一个njs脚本文件，例如<code class="notranslate">hello_world.js</code> 。  有关njs属性和方法的列表，请参见<a hhref="reference.html">参考</a> 。 </p><blockquote class="example"><pre class="notranslate">function hello(r) {<br>    r.return(200, “Hello world!”);<br>}<br></pre></blockquote><p></p></li><li><p>  在<code class="notranslate">nginx.conf</code>文件中，启用<a hhref="http/ngx_http_js_module.html">ngx_http_js_module</a>模块并使用<code class="notranslate">hello_world.js</code>脚本文件指定<a hhref="http/ngx_http_js_module.html#js_include">js_include</a>指令： </p><blockquote class="example"><pre class="notranslate">load_module modules/ngx_http_js_module.so;<p></p>
<p>events {}</p>
<p>http {<br>    js_include hello_world.js;</p>
<pre><code>server {
    listen 8000;

    location / {
        js_content hello;
    }
}
</code></pre><p>}</p>
<p></p></pre></blockquote><p></p></li></ul><p>  还有一个独立的<a hhref="cli.html">命令行</a>实用程序，可以独立于nginx用于njs开发和调试。 </p><a name="presentation"></a><center><h4>  在2018年的nginx.conf上发表演讲 </h4></center><p><br><span></span><div style="display: none;"></div></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/njs/examples.html</url>
      <content type="html"><![CDATA[<p></p><h2>  例子 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#helloword">Hello World</a> <br> <a hhref="#urldecode">URL Decoding</a> <br> <a hhref="#urlencode">URL Encoding</a> <br> <a hhref="#redirect">Internal Redirect</a> <br> <a hhref="#fast_response">Returning Fastest Response from Proxy</a> <br> <a hhref="#jwt">Creating HS JWT</a> <br> <a hhref="#subrequest">Accessing API from a Subrequest</a> <br> <a hhref="#secure_link">Creating secure_link Hash</a> <br> <a hhref="#legacy">Legacy Examples</a> <br>     <a hhref="#legacy_stream">Injecting HTTP header using stream proxy</a> <br></td></tr></tbody></table><a name="helloword"></a><center><h4>  你好，世界 </h4></center><p>   <code class="notranslate">nginx.conf</code> ： </p><blockquote class="example"><pre class="notranslate">load_module modules/ngx_http_js_module.so;<p></p>
<p>events {}</p>
<p>http {<br>    js_include hello_world.js;</p>
<pre><code>server {
    listen 8000;

    location / {
        js_content hello;
    }
}
</code></pre><p>}</p>
<p></p></pre></blockquote><p></p><p>   <code class="notranslate">hello_world.js</code> ： </p><blockquote class="example"><pre class="notranslate">function hello(r) {<br>    r.return(200, “Hello world!”);<br>}<br></pre></blockquote><p></p><a name="urldecode"></a><center><h4>  网址解码 </h4></center><p>   <code class="notranslate">nginx.conf</code> ： </p><blockquote class="example"><pre class="notranslate">js_include urldecode.js;<p></p>
<p>js_set $decoded_foo decoded_foo;<br></p></pre></blockquote><p></p><p>   <code class="notranslate">urldecode.js</code> ： </p><blockquote class="example"><pre class="notranslate">function decoded_foo(r) {<br>    return decodeURIComponent(r.args.foo);<br>}<br></pre></blockquote><p></p><a name="urlencode"></a><center><h4>  网址编码 </h4></center><p>   <code class="notranslate">nginx.conf</code> ： </p><blockquote class="example"><pre class="notranslate">js_include urlencode.js;<p></p>
<p>js_set $encoded_foo encoded_foo;<br>…</p>
<p>location / {<br>    proxy_pass <a href="http://example.com?foo=$encoded_foo" target="_blank" rel="noopener">http://example.com?foo=$encoded_foo</a>;<br>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">urlencode.js</code> ： </p><blockquote class="example"><pre class="notranslate">function encoded_foo(r) {<br>    return encodeURIComponent(‘foo &amp; bar?’);<br>}<br></pre></blockquote><p></p><a name="redirect"></a><center><h4>  内部重定向 </h4></center><p>   <code class="notranslate">nginx.conf</code> ： </p><blockquote class="example"><pre class="notranslate">js_include redirect.js;<p></p>
<p>location /redirect {<br>    js_content redirect;<br>}</p>
<p>location @named {<br>    return 200 named;<br>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">redirect.js</code> ： </p><blockquote class="example"><pre class="notranslate">function redirect(r) {<br>    r.internalRedirect(‘@named’);<br>}<br></pre></blockquote><p></p><a name="fast_response"></a><center><h4>  从代理返回最快的响应 </h4></center><p>   <code class="notranslate">nginx.conf</code> ： </p><blockquote class="example"><pre class="notranslate">js_include fastresponse.js;<p></p>
<p>location /start {<br>    js_content content;<br>}</p>
<p>location /foo {<br>    proxy_pass <a href="http://backend1" target="_blank" rel="noopener">http://backend1</a>;<br>}</p>
<p>location /bar {<br>    proxy_pass <a href="http://backend2" target="_blank" rel="noopener">http://backend2</a>;<br>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">fastresponse.js</code> ： </p><blockquote class="example"><pre class="notranslate">function content(r) {<br>    var n = 0;<p></p>
<pre><code>function done(res) {
    if (n++ == 0) {
        r.return(res.status, res.responseBody);
    }
}

r.subrequest(&apos;/foo&apos;, r.variables.args, done);
r.subrequest(&apos;/bar&apos;, r.variables.args, done);
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="jwt"></a><center><h4>  创建HS JWT </h4></center><p>   <code class="notranslate">nginx.conf</code> ： </p><blockquote class="example"><pre class="notranslate">js_include hs_jwt.js;<p></p>
<p>js_set $jwt jwt;<br></p></pre></blockquote><p></p><p>   <code class="notranslate">hs_jwt.js</code> ： </p><blockquote class="example"><pre class="notranslate">function create_hs256_jwt(claims, key, valid) {<br>    var header = { “typ” : “JWT”, “alg” : “HS256”, “exp” : Date.now() + valid };<p></p>
<pre><code>var s = JSON.stringify(header).toBytes().toString(&apos;base64url&apos;) + &apos;.&apos;
        + JSON.stringify(claims).toBytes().toString(&apos;base64url&apos;);

var h = require(&apos;crypto&apos;).createHmac(&apos;sha256&apos;, key);

return s + &apos;.&apos; + h.update(s).digest().toString(&apos;base64url&apos;);
</code></pre><p>}</p>
<p>function jwt(r) {<br>    var claims = {<br>        “iss” : “nginx”,<br>        “sub” : “alice”,<br>        “foo” : 123,<br>        “bar” : “qq”,<br>        “zyx” : false<br>    };</p>
<pre><code>return create_hs256_jwt(claims, &apos;foo&apos;, 600);
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="subrequest"></a><center><h4>  从子请求访问API </h4></center><p>   <code class="notranslate">nginx.conf</code> ： </p><blockquote class="example"><pre class="notranslate">js_include subrequest.js;<p></p>
<p>keyval_zone zone=foo:10m;<br>…</p>
<p>location /keyval {<br>    js_content set_keyval;<br>}</p>
<p>location /version {<br>    js_content version;<br>}</p>
<p>location /api {<br>    api write=on;<br>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">subrequest.js</code> ： </p><blockquote class="example"><pre class="notranslate">function set_keyval(r) {<br>    r.subrequest(‘/api/3/http/keyvals/foo’,<br>        { method: ‘POST’,<br>          body: JSON.stringify({ foo: 789, bar: “ss dd 00” })},<p></p>
<pre><code>function(res) {
    if (res.status &amp;gt;= 300) {
        r.return(res.status, res.responseBody);
        return;
    }
    r.return(500);
});
</code></pre><p>}</p>
<p>function version(r) {<br>    r.subrequest(‘/api/3/nginx’, { method: ‘GET’ }, function(res) {<br>        if (res.status != 200) {<br>            r.return(res.status);<br>            return;<br>        }</p>
<pre><code>    var json = JSON.parse(res.responseBody);
    r.return(200, json.version);
});
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="secure_link"></a><center><h4>  创建secure_link哈希 </h4></center><p>   <code class="notranslate">nginx.conf</code> ： </p><blockquote class="example"><pre class="notranslate">js_include hash.js;<p></p>
<p>js_set $new_foo create_secure_link;<br>…</p>
<p>location / {<br>    secure_link $cookie_foo;<br>    secure_link_md5 “$uri mykey”;<br>    …<br>}</p>
<p>location @login {<br>    add_header Set-Cookie “foo=$new_foo; Max-Age=60”;<br>    return 302 /;<br>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">hash.js</code> ： </p><blockquote class="example"><pre class="notranslate">function create_secure_link(r) {<br>    return require(‘crypto’).createHash(‘md5’)<br>                            .update(r.uri).update(“ mykey”)<br>                            .digest(‘base64url’);<br>}<br></pre></blockquote><p></p><a name="legacy"></a><center><h4>  遗留的例子 </h4></center><a name="legacy_stream"></a><center><h4>  使用流代理注入HTTP标头 </h4></center><p>  从njs <a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，流配置<a hhref="stream/ngx_stream_js_module.html#example">示例</a>已更改。  对于njs 0.2.3及更早版本，请使用此配置示例： </p><blockquote class="example"><pre class="notranslate">load_module modules/ngx_stream_js_module.so;<br>…<p></p>
<p>stream {<br>    js_include stream.js;</p>
<pre><code>js_set $foo foo;
js_set $bar bar;

server {
    listen 12345;

    js_preread qux;
    return     $foo;
}

server {
    listen 12346;

    js_access  xyz;
    proxy_pass 127.0.0.1:8000;
    js_filter  baz;
}
</code></pre><p>}</p>
<p>http {<br>    server {<br>        listen 8000;<br>        location / {<br>            return 200 $http_foo\n;<br>        }<br>    }<br>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">stream.js</code>文件： </p><blockquote class="example"><pre class="notranslate">var req = ‘’;<br>var matched = 0;<br>var line = ‘’;<p></p>
<p>function qux(s) {<br>    var n = s.buffer.indexOf(‘\n’);<br>    if (n == -1) {<br>        return s.AGAIN;<br>    }</p>
<pre><code>line = s.buffer.substr(0, n);
</code></pre><p>}</p>
<p>function foo(s) {<br>    return line;<br>}</p>
<p>function bar(s) {<br>    var v = s.variables;<br>    s.log(“hello from bar() handler!”);<br>    return “foo-var” + v.remote_port + “; pid=” + v.pid;<br>}</p>
<p>// The filter processes one buffer per call.<br>// The buffer is available in s.buffer both for<br>// reading and writing.  Called for both directions.</p>
<p>function baz(s) {<br>    if (s.fromUpstream || matched) {<br>        return;<br>    }</p>
<pre><code>// Disable certain addresses.

if (s.remoteAddress.match(&apos;^192.*&apos;)) {
    return s.ERROR;
}

// Read HTTP request line.
// Collect bytes in &apos;req&apos; until request
// line is read.  Clear current buffer to
// disable output.

req = req + s.buffer;
s.buffer = &apos;&apos;;

var n = req.search(&apos;\n&apos;);

if (n != -1) {
    // Inject a new HTTP header.
    var rest = req.substr(n + 1);
    req = req.substr(0, n + 1);

    var addr = s.remoteAddress;

    s.log(&apos;req:&apos; + req);
    s.log(&apos;rest:&apos; + rest);

    // Output the result and skip further
    // processing.

    s.buffer = req + &apos;Foo: addr_&apos; + addr + &apos;\r\n&apos; + rest;
    matched = 1;
}
</code></pre><p>}</p>
<p>function xyz(s) {<br>    if (s.remoteAddress.match(‘^192.*’)) {<br>        return s.ABORT;<br>    }<br>}<br></p></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/mail/ngx_mail_ssl_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_mail_ssl_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#ssl">ssl</a> <br>     <a hhref="#ssl_certificate">ssl_certificate</a> <br>     <a hhref="#ssl_certificate_key">ssl_certificate_key</a> <br>     <a hhref="#ssl_ciphers">ssl_ciphers</a> <br>     <a hhref="#ssl_client_certificate">ssl_client_certificate</a> <br>     <a hhref="#ssl_crl">ssl_crl</a> <br>     <a hhref="#ssl_dhparam">ssl_dhparam</a> <br>     <a hhref="#ssl_ecdh_curve">ssl_ecdh_curve</a> <br>     <a hhref="#ssl_password_file">ssl_password_file</a> <br>     <a hhref="#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a> <br>     <a hhref="#ssl_protocols">ssl_protocols</a> <br>     <a hhref="#ssl_session_cache">ssl_session_cache</a> <br>     <a hhref="#ssl_session_ticket_key">ssl_session_ticket_key</a> <br>     <a hhref="#ssl_session_tickets">ssl_session_tickets</a> <br>     <a hhref="#ssl_session_timeout">ssl_session_timeout</a> <br>     <a hhref="#ssl_trusted_certificate">ssl_trusted_certificate</a> <br>     <a hhref="#ssl_verify_client">ssl_verify_client</a> <br>     <a hhref="#ssl_verify_depth">ssl_verify_depth</a> <br>     <a hhref="#starttls">starttls</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_mail_ssl_module</code>模块为邮件代理服务器提供必要的支持，以使用SSL / TLS协议。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-mail_ssl_module</code>配置参数启用它。 </p><blockquote class="note">  该模块需要<a hhref="http://www.openssl.org">OpenSSL</a>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  为减少处理器负载，建议使用 </p><ul class="compact"><li>  设置<a hhref="ngx_core_module.html#worker_processes">工作进程数</a>等于处理器数， </li><li>  启用<a hhref="#ssl_session_cache_shared">共享</a>会话缓存， </li><li>  禁用<a hhref="#ssl_session_cache_builtin">内置</a>会话缓存， </li><li>  并可能增加会话<a hhref="#ssl_session_timeout">生命周期</a> （默认为5分钟）： </li></ul><p></p><blockquote class="example"><pre class="notranslate"> <strong>worker_processes auto;</strong><p></p>
<p>mail {</p>
<pre><code>...

server {
    listen              993 ssl;

    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;
    ssl_certificate     /usr/local/nginx/conf/cert.pem;
    ssl_certificate_key /usr/local/nginx/conf/cert.key;
    &lt;strong&gt;ssl_session_cache   shared:SSL:10m;&lt;/strong&gt;
    &lt;strong&gt;ssl_session_timeout 10m;&lt;/strong&gt;

    ...
}
</code></pre><p></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="ssl"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  该指令在1.15.0版本中已过时。  应该使用<a hhref="ngx_mail_core_module.html#listen">listen</a>指令的<code class="notranslate">ssl</code>参数。 </p><a name="ssl_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有给定服务器的PEM格式的证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。  如果除了主证书之外还应指定中间证书，则应按以下顺序在同一文件中指定它们：首先是主证书，然后是中间证书。   PEM格式的密钥可以放在同一文件中。 &lt;/p&gt;&lt;p&gt;  从版本1.11.0开始，可以多次指定此指令以加载不同类型的证书，例如，RSA和ECDSA： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;server {
listen              993 ssl;

ssl_certificate     example.com.rsa.crt;
ssl_certificate_key example.com.rsa.key;

ssl_certificate     example.com.ecdsa.crt;
ssl_certificate_key example.com.ecdsa.key;

...
</code></pre><p>}<br></p><p></p><blockquote class="note">  只有OpenSSL 1.0.2或更高版本支持不同证书的单独证书链。  对于旧版本，只能使用一个证书链。 </blockquote><p></p><a name="ssl_certificate_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_certificate_key</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有给定服务器的PEM格式的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  可以指定value &lt;code class=&quot;notranslate&quot;&gt;engine&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;而不是&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; （1.7.9），该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;从OpenSSL引擎&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;加载具有指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;密钥。 &lt;/p&gt;&lt;a name=&quot;ssl_ciphers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_ciphers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ciphers&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;ssl_ciphers HIGH:!aNULL:!MD5;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定启用的密码。  密码以OpenSSL库理解的格式指定，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_ciphers ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
</code></pre><p></p><p></p><p>  可以使用“ <code class="notranslate">openssl ciphers</code> ”命令查看完整列表。 </p><p></p><blockquote class="note">  以前版本的nginx默认使用<a hhref="http/configuring_https_servers.html#compatibility">不同的</a>密码。 </blockquote><p></p><a name="ssl_client_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_client_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书。 &lt;/p&gt;&lt;p&gt;  证书列表将发送给客户。  如果不需要，可以使用&lt;a hhref=&quot;#ssl_trusted_certificate&quot;&gt;ssl_trusted_certificate&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;ssl_crl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_crl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的已吊销证书（CRL）的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书。 &lt;/p&gt;&lt;a name=&quot;ssl_dhparam&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_dhparam&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.7.2版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  为DHE密码指定具有DH参数的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  默认情况下，不设置任何参数，因此不会使用DHE密码。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.11.0版之前，默认使用内置参数。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;ssl_ecdh_curve&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_ecdh_curve&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;curve&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;ssl_ecdh_curve auto;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.1.0和1.0.6版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定ECDHE密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;curve&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  使用OpenSSL 1.0.2或更高版本时，可以指定多条曲线（1.11.0），例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_ecdh_curve prime256v1:secp384r1;
</code></pre><p></p><p></p><p>  特殊值<code class="notranslate">auto</code> （1.11.0）指示nginx在使用OpenSSL 1.0.2或更高版本时使用内置在OpenSSL库中的列表，或者使用旧版本的<code class="notranslate">prime256v1</code> 。 </p><p></p><blockquote class="note">  在版本1.11.0之前，默认使用<code class="notranslate">prime256v1</code>曲线。 </blockquote><p></p><a name="ssl_password_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_password_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.3版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有密钥密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;mail {
ssl_password_file /etc/keys/global.pass;
...

server {
    server_name mail1.example.com;
    ssl_certificate_key /etc/keys/first.key;
}

server {
    server_name mail2.example.com;

    # named pipe can also be used instead of a file
    ssl_password_file /etc/keys/fifo;
    ssl_certificate_key /etc/keys/second.key;
}
</code></pre><p>}<br></p><p></p><a name="ssl_prefer_server_ciphers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_prefer_server_ciphers</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_prefer_server_ciphers off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  指定在使用SSLv3和TLS协议时，服务器密码应优先于客户端密码。 </p><a name="ssl_protocols"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_protocols</strong><br>    [ <code class="notranslate">SSLv2</code> ]<br>    [ <code class="notranslate">SSLv3</code> ]<br>    [ <code class="notranslate">TLSv1</code> ]<br>    [ <code class="notranslate">TLSv1.1</code> ]<br>    [ <code class="notranslate">TLSv1.2</code> ]<br>    [ <code class="notranslate">TLSv1.3</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  启用指定的协议。 </p><blockquote class="note">   <code class="notranslate">TLSv1.1</code>和<code class="notranslate">TLSv1.2</code>参数（ <code class="notranslate">TLSv1.2</code> ）仅在使用OpenSSL 1.0.1或更高版本时有效。 </blockquote><p></p><blockquote class="note">  仅当使用使用TLSv1.3支持构建的OpenSSL 1.1.1时， <code class="notranslate">TLSv1.3</code>参数（1.13.0）才有效。 </blockquote><p></p><a name="ssl_session_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_cache</strong><br>    <code class="notranslate">off</code> |<br>    <code class="notranslate">none</code> |<br>    [ <code class="notranslate">builtin</code> [: <code class="notranslate"><i>size</i></code> ]]<br>    [ <code class="notranslate">shared</code> : <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_cache none;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置存储会话参数的缓存的类型和大小。  缓存可以是以下任何类型： </p><dl class="compact"><dt> <code class="notranslate">off</code> </dt> <dd>  严格禁止使用会话缓存：nginx明确告诉客户端会话可能不会被重用。 </dd><dt> <code class="notranslate">none</code> </dt> <dd>  轻轻地禁止使用会话缓存：nginx告诉客户端会话可以重用，但实际上并不会将会话参数存储在缓存中。 </dd><dt id="ssl_session_cache_builtin"> <code class="notranslate">builtin</code> </dt> <dd>  一个用OpenSSL构建的缓存;  仅由一个工作进程使用。  缓存大小在会话中指定。  如果未给出大小，则等于20480个会话。  使用内置缓存可能会导致内存碎片。 </dd><dt id="ssl_session_cache_shared"> <code class="notranslate">shared</code> </dt> <dd>  所有工作进程之间共享的缓存。  高速缓存大小以字节为单位指定;  一兆字节可以存储大约4000个会话。  每个共享缓存都应具有任意名称。  可以在多个服务器中使用具有相同名称的缓存。 </dd></dl><p></p><p>  两种缓存类型可以同时使用，例如： </p><blockquote class="example"><pre class="notranslate">ssl_session_cache builtin:1000 shared:SSL:10m;<br></pre></blockquote><p>  但只使用没有内置缓存的共享缓存应该更有效。 </p><a name="ssl_session_ticket_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_ticket_key</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置具有用于加密和解密TLS会话票证的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。  如果必须在多个服务器之间共享相同的密钥，则该指令是必需的。  默认情况下，使用随机生成的密钥。 &lt;/p&gt;&lt;p&gt;  如果指定了多个密钥，则仅使用第一个密钥来加密TLS会话票证。  这允许配置键旋转，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_session_ticket_key current.key;
</code></pre><p>ssl_session_ticket_key previous.key;<br></p><p></p><p>  该<code class="notranslate"><i>file</i></code>必须包含80或48个字节的随机数据，并且可以使用以下命令创建： </p><blockquote class="example"><pre class="notranslate">openssl rand 80 &gt; ticket.key<br></pre></blockquote><p>  根据文件大小，AES256（对于80字节密钥，1.11.8）或AES128（对于48字节密钥）用于加密。 </p><a name="ssl_session_tickets"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_tickets</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_tickets on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.9版本中。 </p></div><p>  通过<a hhref="https://tools.ietf.org/html/rfc5077">TLS会话票证</a>启用或禁用会话恢复。 </p><a name="ssl_session_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_timeout 5m;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  指定客户端可以重用会话参数的时间。 </p><a name="ssl_trusted_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_trusted_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书。 &lt;/p&gt;&lt;p&gt;  与&lt;a hhref=&quot;#ssl_client_certificate&quot;&gt;ssl_client_certificate&lt;/a&gt;设置的证书&lt;a hhref=&quot;#ssl_client_certificate&quot;&gt;不同&lt;/a&gt; ，这些证书的列表不会发送给客户端。 &lt;/p&gt;&lt;a name=&quot;ssl_verify_client&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_verify_client&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;optional&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;optional_no_ca&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;ssl_verify_client off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用客户端证书验证。  验证结果在&lt;a hhref=&quot;ngx_mail_auth_http_module.html#auth_http&quot;&gt;验证&lt;/a&gt;请求的“Auth-SSL-Verify”标头中传递。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;optional&lt;/code&gt;参数请求客户端证书，并在证书存在时验证它。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;optional_no_ca&lt;/code&gt;参数请求客户端证书，但不要求它由可信CA证书签名。  这适用于nginx外部的服务执行实际证书验证的情况。  可以通过&lt;a hhref=&quot;ngx_mail_auth_http_module.html#auth_http_pass_client_cert&quot;&gt;发送&lt;/a&gt;到身份验证服务器的请求访问证书的内容。 &lt;/p&gt;&lt;a name=&quot;ssl_verify_depth&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_verify_depth&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;ssl_verify_depth 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置客户端证书链中的验证深度。 &lt;/p&gt;&lt;a name=&quot;starttls&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;starttls&lt;/strong&gt; 
</code></pre><p>  <code class="notranslate">on</code> |<br>  <code class="notranslate">off</code> |<br>  <code class="notranslate">only</code> ; <br><br>                </p></td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">starttls off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p></p><dl class="compact"><dt> <code class="notranslate">on</code> </dt> <dd>  允许使用POP3的<code class="notranslate">STLS</code>命令和IMAP和SMTP的<code class="notranslate">STARTTLS</code>命令; </dd><dt> <code class="notranslate">off</code> </dt> <dd>  拒绝使用<code class="notranslate">STLS</code>和<code class="notranslate">STARTTLS</code>命令; </dd><dt> <code class="notranslate">only</code> </dt> <dd>  需要初步的TLS过渡。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/mail/ngx_mail_smtp_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_mail_smtp_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#directives">Directives</a> <br>     <a hhref="#smtp_auth">smtp_auth</a> <br>     <a hhref="#smtp_capabilities">smtp_capabilities</a> <br>     <a hhref="#smtp_client_buffer">smtp_client_buffer</a> <br>     <a hhref="#smtp_greeting_delay">smtp_greeting_delay</a> <br></td></tr></tbody></table><a name="directives"></a><center><h4>  指令 </h4></center><a name="smtp_auth"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>smtp_auth</strong> <code class="notranslate"><i>method</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">smtp_auth login plain;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  为SMTP客户端设置允许的<a hhref="https://tools.ietf.org/html/rfc2554">SASL身份验证</a>方法。  支持的方法是： </p><dl class="compact"><dt> <code class="notranslate">login</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/draft-murchison-sasl-login-00">AUTH LOGIN</a> </dd><dt> <code class="notranslate">plain</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc4616">AUTH PLAIN</a> </dd><dt> <code class="notranslate">cram-md5</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc2195">AUTH CRAM-MD5</a> 。  为了使此方法有效，密码必须以未加密的方式存储。 </dd><dt> <code class="notranslate">external</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc4422">AUTH EXTERNAL</a> （1.11.6）。 </dd><dt> <code class="notranslate">none</code> </dt> <dd>  不需要身份验证。 </dd></dl><p></p><a name="smtp_capabilities"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>smtp_capabilities</strong> <code class="notranslate"><i>extension</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置传递给客户端以响应&lt;code class=&quot;notranslate&quot;&gt;EHLO&lt;/code&gt;命令的SMTP协议扩展列表。   &lt;a hhref=&quot;#smtp_auth&quot;&gt;smtp_auth&lt;/a&gt;指令和&lt;a hhref=&quot;https://tools.ietf.org/html/rfc3207&quot;&gt;STARTTLS&lt;/a&gt;中指定的身份验证方法将根据&lt;a hhref=&quot;ngx_mail_ssl_module.html#starttls&quot;&gt;starttls&lt;/a&gt;指令值自动添加到此列表中。 &lt;/p&gt;&lt;p&gt;  指定客户端所代理的MTA支持的扩展是有意义的（如果这些扩展与身份验证后使用的命令相关，当nginx透明地代理客户端连接到后端时）。 &lt;/p&gt;&lt;p&gt;  目前的标准化扩展列表发布在&lt;a hhref=&quot;http://www.iana.org/assignments/mail-parameters&quot;&gt;www.iana.org&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;smtp_client_buffer&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;smtp_client_buffer&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;smtp_client_buffer 4k|8k;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置用于读取SMTP命令的缓冲区的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 &lt;/p&gt;&lt;a name=&quot;smtp_greeting_delay&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;smtp_greeting_delay&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;smtp_greeting_delay 0;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许在发送SMTP问候语之前设置延迟，以便在发送SMTP命令之前拒绝未能等待问候语的客户端。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/mail/ngx_mail_proxy_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_mail_proxy_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#directives">Directives</a> <br>     <a hhref="#proxy_buffer">proxy_buffer</a> <br>     <a hhref="#proxy_pass_error_message">proxy_pass_error_message</a> <br>     <a hhref="#proxy_timeout">proxy_timeout</a> <br>     <a hhref="#xclient">xclient</a> <br></td></tr></tbody></table><a name="directives"></a><center><h4>  指令 </h4></center><a name="proxy_buffer"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_buffer</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_buffer 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于代理的缓冲区的大小。  默认情况下，缓冲区大小等于一个内存页面。  根据平台，它是4K或8K。 </p><a name="proxy_pass_error_message"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_pass_error_message</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_pass_error_message off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  指示是否将后端身份验证期间获取的错误消息传递给客户端。 </p><p>  通常，如果nginx中的身份验证成功，则后端无法返回错误。  如果它仍然返回错误，则表示发生了一些内部错误。  在这种情况下，后端消息可以包含不应向客户端显示的信息。  但是，对于某些POP3服务器，使用正确密码的错误进行响应是正常行为。  例如，CommuniGatePro通过定期输出<a hhref="http://www.stalker.com/CommuniGatePro/POP.html#Alerts">身份验证错误</a>通知用户<a hhref="http://www.stalker.com/CommuniGatePro/Alerts.html#Quota">邮箱溢出</a>或其他事件。  在这种情况下应该启用该指令。 </p><a name="proxy_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_timeout</strong> <code class="notranslate"><i>timeout</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_timeout 24h;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置客户端或代理服务器连接上两次连续读取或写入操作之间的<code class="notranslate"><i>timeout</i></code> 。  如果在此时间内没有传输数据，则关闭连接。 </p><a name="xclient"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>xclient</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">xclient on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  连接到SMTP后端时，启用或禁用带有客户端参数的<a hhref="http://www.postfix.org/XCLIENT_README.html">XCLIENT</a>命令的传递。 </p><p>  使用<code class="notranslate">XCLIENT</code> ，MTA能够将客户端信息写入日志，并根据此数据应用各种限制。 </p><p>  如果启用了<code class="notranslate">XCLIENT</code> ，则nginx在连接到后端时会传递以下命令： </p><ul class="compact"><li>   <code class="notranslate">EHLO</code>与<a hhref="ngx_mail_core_module.html#server_name">服务器名称</a> </li><li> <code class="notranslate">XCLIENT</code> </li> <li>   <code class="notranslate">EHLO</code>或<code class="notranslate">HELO</code> ，由客户通过 </li></ul><p></p><p>  如果客户端IP地址<a hhref="ngx_mail_core_module.html#resolver">找到</a>的名称指向同一地址，则会在<code class="notranslate">XCLIENT</code>命令的<code class="notranslate">NAME</code>参数中传递该<code class="notranslate">NAME</code> 。  如果找不到名称，指向不同的地址，或未指定<a hhref="ngx_mail_core_module.html#resolver">解析器</a> ，则在<code class="notranslate">NAME</code>参数中传递<code class="notranslate">[UNAVAILABLE]</code> 。  如果在解析过程中发生错误，则使用<code class="notranslate">[TEMPUNAVAIL]</code>值。 </p><p>  如果禁用了<code class="notranslate">XCLIENT</code> ，那么如果客户端已通过<code class="notranslate">EHLO</code> ，则nginx在连接到后端时传递带有<a hhref="ngx_mail_core_module.html#server_name">服务器名称</a>的<code class="notranslate">EHLO</code>命令，否则传递带有服务器名称的<code class="notranslate">HELO</code> 。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/mail/ngx_mail_pop3_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_mail_pop3_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#directives">Directives</a> <br>     <a hhref="#pop3_auth">pop3_auth</a> <br>     <a hhref="#pop3_capabilities">pop3_capabilities</a> <br></td></tr></tbody></table><a name="directives"></a><center><h4>  指令 </h4></center><a name="pop3_auth"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>pop3_auth</strong> <code class="notranslate"><i>method</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">pop3_auth plain;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  为POP3客户端设置允许的身份验证方法。  支持的方法是： </p><dl class="compact"><dt> <code class="notranslate">plain</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc1939">USER / PASS</a> ， <a hhref="https://tools.ietf.org/html/rfc4616">AUTH PLAIN</a> ， <a hhref="https://tools.ietf.org/html/draft-murchison-sasl-login-00">AUTH LOGIN</a> 。  无法禁用这些方法。 </dd><dt> <code class="notranslate">apop</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc1939">APOP</a> 。  为了使此方法有效，密码必须以未加密的方式存储。 </dd><dt> <code class="notranslate">cram-md5</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc2195">AUTH CRAM-MD5</a> 。  为了使此方法有效，密码必须以未加密的方式存储。 </dd><dt> <code class="notranslate">external</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc4422">AUTH EXTERNAL</a> （1.11.6）。 </dd></dl><p></p><a name="pop3_capabilities"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>pop3_capabilities</strong> <code class="notranslate"><i>extension</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">pop3_capabilities TOP USER UIDL;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置为响应<code class="notranslate">CAPA</code>命令而传递给客户端的<a hhref="https://tools.ietf.org/html/rfc2449">POP3协议</a>扩展列表。   <a hhref="#pop3_auth">pop3_auth</a>指令（ <a hhref="https://tools.ietf.org/html/rfc2449">SASL</a>扩展名）和<a hhref="https://tools.ietf.org/html/rfc2595">STLS</a>中指定的身份验证方法将根据<a hhref="ngx_mail_ssl_module.html#starttls">starttls</a>指令值自动添加到此列表中。 </p><p>  指定客户端所代理的POP3后端支持的扩展是有意义的（如果这些扩展与身份验证后使用的命令相关，当nginx透明地代理客户端连接到后端时）。 </p><p>  目前的标准化扩展列表发布在<a hhref="http://www.iana.org/assignments/pop3-extension-mechanism">www.iana.org</a> 。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/mail/ngx_mail_imap_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_mail_imap_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#directives">Directives</a> <br>     <a hhref="#imap_auth">imap_auth</a> <br>     <a hhref="#imap_capabilities">imap_capabilities</a> <br>     <a hhref="#imap_client_buffer">imap_client_buffer</a> <br></td></tr></tbody></table><a name="directives"></a><center><h4>  指令 </h4></center><a name="imap_auth"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>imap_auth</strong> <code class="notranslate"><i>method</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">imap_auth plain;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  为IMAP客户端设置允许的身份验证方法。  支持的方法是： </p><dl class="compact"><dt> <code class="notranslate">login</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/draft-murchison-sasl-login-00">AUTH = LOGIN</a> </dd><dt> <code class="notranslate">plain</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc4616">AUTH =普通</a> </dd><dt> <code class="notranslate">cram-md5</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc2195">AUTH = CRAM-MD5</a> 。  为了使此方法有效，密码必须以未加密的方式存储。 </dd><dt> <code class="notranslate">external</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc4422">AUTH = EXTERNAL</a> （1.11.6）。 </dd></dl><p></p><a name="imap_capabilities"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>imap_capabilities</strong> <code class="notranslate"><i>extension</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">imap_capabilities IMAP4 IMAP4rev1 UIDPLUS;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置传递给客户端以响应<code class="notranslate">CAPABILITY</code>命令的<a hhref="https://tools.ietf.org/html/rfc3501">IMAP协议</a>扩展列表。   <a hhref="#imap_auth">imap_auth</a>指令和<a hhref="https://tools.ietf.org/html/rfc2595">STARTTLS</a>中指定的身份验证方法会根据<a hhref="ngx_mail_ssl_module.html#starttls">starttls</a>指令值自动添加到此列表中。 </p><p>  指定客户端所代理的IMAP后端支持的扩展是有意义的（如果这些扩展与身份验证后使用的命令相关，当nginx透明地代理客户端连接到后端时）。 </p><p>  目前的标准化扩展列表发布在<a hhref="http://www.iana.org/assignments/imap4-capabilities">www.iana.org</a> 。 </p><a name="imap_client_buffer"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>imap_client_buffer</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">imap_client_buffer 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取IMAP命令的缓冲区的<code class="notranslate"><i>size</i></code> 。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/mail/ngx_mail_core_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_mail_core_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#listen">listen</a> <br>     <a hhref="#mail">mail</a> <br>     <a hhref="#protocol">protocol</a> <br>     <a hhref="#resolver">resolver</a> <br>     <a hhref="#resolver_timeout">resolver_timeout</a> <br>     <a hhref="#server">server</a> <br>     <a hhref="#server_name">server_name</a> <br>     <a hhref="#timeout">timeout</a> <br></td></tr></tbody></table><a name="summary"></a><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-mail</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">worker_processes 1;<p></p>
<p>error_log /var/log/nginx/error.log info;</p>
<p>events {<br>    worker_connections  1024;<br>}</p>
<p>mail {<br>    server_name       mail.example.com;<br>    auth_http         localhost:9000/cgi-bin/nginxauth.cgi;</p>
<pre><code>imap_capabilities IMAP4rev1 UIDPLUS IDLE LITERAL+ QUOTA;

pop3_auth         plain apop cram-md5;
pop3_capabilities LAST TOP USER PIPELINING UIDL;

smtp_auth         login plain cram-md5;
smtp_capabilities &quot;SIZE 10485760&quot; ENHANCEDSTATUSCODES 8BITMIME DSN;
xclient           off;

server {
    listen   25;
    protocol smtp;
}
server {
    listen   110;
    protocol pop3;
    proxy_pass_error_message on;
}
server {
    listen   143;
    protocol imap;
}
server {
    listen   587;
    protocol smtp;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="listen"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>listen</strong><br>    <code class="notranslate"><i>address</i></code> : <code class="notranslate"><i>port</i></code><br>    [ <code class="notranslate">ssl</code> ]<br>    [ <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">bind</code> ]<br>    [ <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> ]<br>    [ <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> |[ <code class="notranslate"><i>keepidle</i></code> ]:[ <code class="notranslate"><i>keepintvl</i></code> ]:[ <code class="notranslate"><i>keepcnt</i></code> ]];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置服务器将接受请求的套接字的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;port&lt;/i&gt;&lt;/code&gt; 。  可以仅指定端口。  地址也可以是主机名，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;listen 127.0.0.1:110;
</code></pre><p>listen <em>:110;<br>listen 110;     # same as </em>:110<br>listen localhost:110;<br></p><p>   IPv6地址（0.7.58）在方括号中指定： </p><blockquote class="example"><pre class="notranslate">listen [::1]:110;<br>listen [::]:110;<br></pre></blockquote><p>   UNIX域套接字（1.3.5）使用“ <code class="notranslate">unix:</code> ”前缀指定： </p><blockquote class="example"><pre class="notranslate">listen unix:/var/run/nginx.sock;<br></pre></blockquote><p></p><p>  不同的服务器必须侦听不同的<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对。 </p><p>   <code class="notranslate">ssl</code>参数允许指定此端口上接受的所有连接都应在SSL模式下工作。 </p><p>   <code class="notranslate">listen</code>指令可以有几个特定于与套接字相关的系统调用的附加参数。 </p><dl class="compact"><dt>   <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  在<code class="notranslate">listen()</code>调用中设置<code class="notranslate">backlog</code>参数，该参数限制挂起连接队列的最大长度（1.9.2）。  默认情况下， <code class="notranslate">backlog</code>在FreeBSD，DragonFly BSD和macOS上设置为-1，在其他平台上设置为511。 </dd><dt>   <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> </dt><dd>  设置侦听套接字的接收缓冲区大小（ <code class="notranslate">SO_RCVBUF</code>选项）（1.11.13）。 </dd><dt>   <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> </dt><dd>  设置侦听套接字的发送缓冲区大小（ <code class="notranslate">SO_SNDBUF</code>选项）（1.11.13）。 </dd><dt> <code class="notranslate">bind</code> </dt> <dd>  此参数指示对给定地址：端口对进行单独的<code class="notranslate">bind()</code>调用。  事实是，如果有几个具有相同端口但不同地址的<code class="notranslate">listen</code>指令，并且其中一个<code class="notranslate">listen</code>指令侦听给定端口（ <code class="notranslate"><em>:</em></code> <code class="notranslate"><i>port</i></code> ）的所有地址，则nginx将<code class="notranslate">bind()</code>仅限于<code class="notranslate">:</code> <code class="notranslate"><i>port</i></code> 。  应该注意的是，在这种情况下将进行<code class="notranslate">getsockname()</code>系统调用以确定接受连接的地址。  如果使用<code class="notranslate">ipv6only</code>或<code class="notranslate">so_keepalive</code>参数，那么对于给定的<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对将始终进行单独的<code class="notranslate">bind()</code>调用。 </dd><dt>   <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> </dt><dd>  此参数确定（通过<code class="notranslate">IPV6_V6ONLY</code>套接字选项）侦听通配符地址<code class="notranslate">[::]</code>的IPv6套接字是仅接受IPv6连接还是仅接受IPv6和IPv4连接。  默认情况下，此参数处于启用状态。  它只能在开始时设置一次。 </dd><dt>   <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> |   <code class="notranslate">off</code> | [ <code class="notranslate"><i>keepidle</i></code> ]：[ <code class="notranslate"><i>keepintvl</i></code> ]：[ <code class="notranslate"><i>keepcnt</i></code> ] </dt><dd>  此参数配置侦听套接字的“TCP keepalive”行为。  如果省略此参数，则操作系统的设置将对套接字有效。  如果将其设置为值“ <code class="notranslate">on</code> ”，则为套接字打开<code class="notranslate">SO_KEEPALIVE</code>选项。  如果将其设置为值“ <code class="notranslate">off</code> ”，则为套接字关闭<code class="notranslate">SO_KEEPALIVE</code>选项。  某些操作系统支持使用<code class="notranslate">TCP_KEEPIDLE</code> ， <code class="notranslate">TCP_KEEPINTVL</code>和<code class="notranslate">TCP_KEEPCNT</code>套接字选项在每个套接字的基础上设置TCP keepalive参数。  在这样的系统上（目前，Linux 2.4 +，NetBSD 5+和FreeBSD 9.0-STABLE），可以使用<code class="notranslate"><i>keepidle</i></code> ， <code class="notranslate"><i>keepintvl</i></code>和<code class="notranslate"><i>keepcnt</i></code>参数配置它们。  可以省略一个或两个参数，在这种情况下，相应套接字选项的系统默认设置将生效。  例如， <blockquote class="example"><pre class="notranslate">so_keepalive=30m::10</pre></blockquote>  将空闲超时（ <code class="notranslate">TCP_KEEPIDLE</code> ）设置为30分钟，将探测间隔（ <code class="notranslate">TCP_KEEPINTVL</code> ）保留为系统默认值，并将探测计数（ <code class="notranslate">TCP_KEEPCNT</code> ）设置为10个探测。 </dd></dl><p></p><a name="mail"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>mail</strong> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  提供指定邮件服务器指令的配置文件上下文。 &lt;/p&gt;&lt;a name=&quot;protocol&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;protocol&lt;/strong&gt; 
</code></pre><p>  <code class="notranslate">imap</code> |<br>  <code class="notranslate">pop3</code> |<br>  <code class="notranslate">smtp</code> ; <br><br>                </p></td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置代理服务器的协议。  支持的协议是&lt;a hhref=&quot;ngx_mail_imap_module.html&quot;&gt;IMAP&lt;/a&gt; ， &lt;a hhref=&quot;ngx_mail_pop3_module.html&quot;&gt;POP3&lt;/a&gt;和&lt;a hhref=&quot;ngx_mail_smtp_module.html&quot;&gt;SMTP&lt;/a&gt; 。 &lt;/p&gt;&lt;p&gt;  如果未设置该指令，则可以根据&lt;a hhref=&quot;#listen&quot;&gt;listen&lt;/a&gt;指令中指定的已知端口自动检测协议： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   &lt;code class=&quot;notranslate&quot;&gt;imap&lt;/code&gt; ：143,993 &lt;/li&gt;&lt;li&gt;   &lt;code class=&quot;notranslate&quot;&gt;pop3&lt;/code&gt; ：110,995 &lt;/li&gt;&lt;li&gt;   &lt;code class=&quot;notranslate&quot;&gt;smtp&lt;/code&gt; ：25,587,465 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可以使用&lt;a hhref=&quot;configure.html&quot;&gt;配置&lt;/a&gt;参数&lt;code class=&quot;notranslate&quot;&gt;--without-mail_imap_module&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;--without-mail_pop3_module&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;--without-mail_smtp_module&lt;/code&gt;禁用不必要的协议。 &lt;/p&gt;&lt;a name=&quot;resolver&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;resolver&lt;/strong&gt; 
</code></pre><p><code class="notranslate"><i>address</i></code> …<br>[ <code class="notranslate">valid</code> = <code class="notranslate"><i>time</i></code> ]; <br> <code class="notranslate"><strong>resolver</strong> <code class="notranslate">off</code> ;</code> <br><br>                </p></td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">resolver off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  配置用于查找客户端主机名的名称服务器以将其传递给<a hhref="ngx_mail_auth_http_module.html">身份验证服务器</a> ，并在代理SMTP时配置<a hhref="ngx_mail_proxy_module.html#xclient">XCLIENT</a>命令。  例如： </p><blockquote class="example"><pre class="notranslate">resolver 127.0.0.1 [::1]:5353;<br></pre></blockquote><p>  可以将地址指定为域名或IP地址，以及可选端口（1.3.1,1.2.2）。  如果未指定端口，则使用端口53。  以循环方式查询名称服务器。 </p><blockquote class="note">  在1.1.7版之前，只能配置一个名称服务器。  从版本1.3.1和1.2.2开始支持使用IPv6地址指定名称服务器。 </blockquote><p>  默认情况下，nginx使用响应的TTL值缓存答案。  可选的<code class="notranslate">valid</code>参数允许覆盖它： </p><blockquote class="example"><pre class="notranslate">resolver 127.0.0.1 [::1]:5353 valid=30s;<br></pre></blockquote><p></p><blockquote class="note">  在版本1.1.9之前，无法调整缓存时间，并且nginx始终缓存5分钟的持续时间。 </blockquote><p></p><p>  特殊值<code class="notranslate">off</code>禁用解析。 </p><a name="resolver_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>resolver_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">resolver_timeout 30s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置DNS操作的超时，例如： </p><blockquote class="example"><pre class="notranslate">resolver_timeout 5s;<br></pre></blockquote><p></p><a name="server"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server</strong> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置服务器的配置。 &lt;/p&gt;&lt;a name=&quot;server_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;server_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;server_name hostname;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置使用的服务器名称： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;  在初始POP3 / SMTP服务器问候语中; &lt;/li&gt;&lt;li&gt;  在SASL CRAM-MD5认证期间的盐; &lt;/li&gt;&lt;li&gt;  如果启用了&lt;a hhref=&quot;ngx_mail_proxy_module.html#xclient&quot;&gt;XCLIENT&lt;/a&gt;命令的传递，则在连接到SMTP后端时在&lt;code class=&quot;notranslate&quot;&gt;EHLO&lt;/code&gt;命令中。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  如果未指定该指令，则使用计算机的主机名。 &lt;/p&gt;&lt;a name=&quot;timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;timeout 60s;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置代理到后端开始之前使用的超时。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/mail/ngx_mail_auth_http_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_mail_auth_http_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#directives">Directives</a> <br>     <a hhref="#auth_http">auth_http</a> <br>     <a hhref="#auth_http_header">auth_http_header</a> <br>     <a hhref="#auth_http_pass_client_cert">auth_http_pass_client_cert</a> <br>     <a hhref="#auth_http_timeout">auth_http_timeout</a> <br> <a hhref="#protocol">Protocol</a> <br></td></tr></tbody></table><a name="directives"></a><center><h4>  指令 </h4></center><a name="auth_http"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_http</strong> <code class="notranslate"><i>URL</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置HTTP身份验证服务器的URL。  该协议&lt;a hhref=&quot;#protocol&quot;&gt;如下所述&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;auth_http_header&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;auth_http_header&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;header&lt;/i&gt;&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;mail&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  将指定的标头附加到发送到身份验证服务器的请求。  此标头可用作共享密钥，以验证请求是否来自nginx。  例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;auth_http_header X-Auth-Key &quot;secret_string&quot;;
</code></pre><p></p><p></p><a name="auth_http_pass_client_cert"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_http_pass_client_cert</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">auth_http_pass_client_cert off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.11版本中。 </p></div><p>  将具有PEM格式（urlencoded）的<a hhref="ngx_mail_ssl_module.html#ssl_verify_client">客户端</a>证书的“Auth-SSL-Cert”标头附加到发送到身份验证服务器的请求。 </p><a name="auth_http_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_http_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">auth_http_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">mail</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置与身份验证服务器通信的超时。 </p><a name="protocol"></a><center><h4>  协议 </h4></center><p>   HTTP协议用于与身份验证服务器通信。  响应正文中的数据将被忽略，信息仅在标题中传递。 </p><p>  请求和响应的示例： </p><p>  请求： </p><blockquote class="example"><pre class="notranslate">GET /auth HTTP/1.0<br>Host: localhost<br>Auth-Method: plain # plain/apop/cram-md5/external<br>Auth-User: user<br>Auth-Pass: password<br>Auth-Protocol: imap # imap/pop3/smtp<br>Auth-Login-Attempt: 1<br>Client-IP: 192.0.2.42<br>Client-Host: client.example.org<br></pre></blockquote><p>  反应良好： </p><blockquote class="example"><pre class="notranslate">HTTP/1.0 200 OK<br>Auth-Status: OK<br>Auth-Server: 198.51.100.1<br>Auth-Port: 143<br></pre></blockquote><p>  不好的回应： </p><blockquote class="example"><pre class="notranslate">HTTP/1.0 200 OK<br>Auth-Status: Invalid login or password<br>Auth-Wait: 3<br></pre></blockquote><p></p><p>  如果没有“Auth-Wait”标头，将返回错误并关闭连接。  当前实现为每次身份验证尝试分配内存。  仅在会话结束时释放内存。  因此，必须限制单个会话中无效身份验证尝试的次数 - 服务器必须在10-20次尝试后响应而不使用“Auth-Wait”标头（尝试号码在“Auth-Login-Attempt”标头中传递） 。 </p><p>  使用APOP或CRAM-MD5时，请求 - 响应将如下所示： </p><blockquote class="example"><pre class="notranslate">GET /auth HTTP/1.0<br>Host: localhost<br>Auth-Method: apop<br>Auth-User: user<br>Auth-Salt: &lt;238188073.1163692009@mail.example.com&gt;<br>Auth-Pass: auth_response<br>Auth-Protocol: imap<br>Auth-Login-Attempt: 1<br>Client-IP: 192.0.2.42<br>Client-Host: client.example.org<br></pre></blockquote><p>  反应良好： </p><blockquote class="example"><pre class="notranslate">HTTP/1.0 200 OK<br>Auth-Status: OK<br>Auth-Server: 198.51.100.1<br>Auth-Port: 143<br>Auth-Pass: plain-text-pass<br></pre></blockquote><p></p><p>  如果响应中存在“Auth-User”标头，它将覆盖用于通过后端进行身份验证的用户名。 </p><p>  对于SMTP，响应还考虑了“Auth-Error-Code”标头 - 如果存在，则在发生错误时用作响应代码。  否则，535 5.7.0代码将添加到“Auth-Status”标头中。 </p><p>  例如，如果从身份验证服务器收到以下响应： </p><blockquote class="example"><pre class="notranslate">HTTP/1.0 200 OK<br>Auth-Status: Temporary server problem, try again later<br>Auth-Error-Code: 451 4.3.0<br>Auth-Wait: 3<br></pre></blockquote><p>  然后SMTP客户端将收到错误 </p><blockquote class="example"><pre class="notranslate">451 4.3.0 Temporary server problem, try again later<br></pre></blockquote><p></p><p>  如果代理SMTP不需要身份验证，请求将如下所示： </p><blockquote class="example"><pre class="notranslate">GET /auth HTTP/1.0<br>Host: localhost<br>Auth-Method: none<br>Auth-User:<br>Auth-Pass:<br>Auth-Protocol: smtp<br>Auth-Login-Attempt: 1<br>Client-IP: 192.0.2.42<br>Client-Host: client.example.org<br>Auth-SMTP-Helo: client.example.org<br>Auth-SMTP-From: MAIL FROM: &lt;&gt;<br>Auth-SMTP-To: RCPT TO: &lt;postmaster@mail.example.com&gt;<br></pre></blockquote><p></p><p>  对于SSL / TLS客户端连接（1.7.11），添加了“Auth-SSL”标头，“Auth-SSL-Verify”将包含客户端证书验证的结果（如果已<a hhref="ngx_mail_ssl_module.html#ssl_verify_client">启用）</a> ：“ <code class="notranslate">SUCCESS</code> ”，“ <code class="notranslate">FAILED:</code>如果证书不存在，则“和” <code class="notranslate">NONE</code> “。 </p><blockquote class="note">  在1.11.7版之前，“ <code class="notranslate">FAILED</code> ”结果不包含<code class="notranslate"><i>reason</i></code>字符串。 </blockquote><p>  当客户端证书存在时，其详细信息将在以下请求标头中传递：“Auth-SSL-Subject”，“Auth-SSL-Issuer”，“Auth-SSL-Serial”和“Auth-SSL-Fingerprint”。  如果启用了<a hhref="#auth_http_pass_client_cert">auth_http_pass_client_cert</a> ，则证书本身将在“Auth-SSL-Cert”标头中传递。  请求如下： </p><blockquote class="example"><pre class="notranslate">GET /auth HTTP/1.0<br>Host: localhost<br>Auth-Method: plain<br>Auth-User: user<br>Auth-Pass: password<br>Auth-Protocol: imap<br>Auth-Login-Attempt: 1<br>Client-IP: 192.0.2.42<br>Auth-SSL: on<br>Auth-SSL-Verify: SUCCESS<br>Auth-SSL-Subject: /CN=example.com<br>Auth-SSL-Issuer: /CN=example.com<br>Auth-SSL-Serial: C07AD56B846B5BFF<br>Auth-SSL-Fingerprint: 29d6a80a123d13355ed16b4b04605e29cb55a5ad<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/websocket.html</url>
      <content type="html"><![CDATA[<p></p><h2>   WebSocket代理 </h2><p>  要将客户端和服务器之间的连接从HTTP / 1.1转换为WebSocket，请使用HTTP / 1.1中提供的<a hhref="https://tools.ietf.org/html/rfc2616#section-14.42">协议交换</a>机制。 </p><p>  然而，有一个微妙之处：由于“升级”是<a hhref="https://tools.ietf.org/html/rfc2616#section-13.5.1">逐跳</a>标头，因此它不会从客户端传递到代理服务器。  使用正向代理，客户端可以使用<code class="notranslate">CONNECT</code>方法来规避此问题。  但是，这不适用于反向代理，因为客户端不知道任何代理服务器，并且需要在代理服务器上进行特殊处理。 </p><p>  从版本1.3.13开始，nginx实现了特殊的操作模式，如果代理服务器返回带有代码101（交换协议）的响应，则允许在客户端和代理服务器之间建立隧道，并且客户端要求通过请求中的“升级”标头。 </p><p>  如上所述，包括“升级”和“连接”的逐跳头不会从客户端传递到代理服务器，因此为了让代理服务器知道客户端将协议切换到WebSocket的意图，这些头必须明确传递： </p><blockquote class="example"><pre class="notranslate">location /chat/ {<br>    proxy_pass <a href="http://backend" target="_blank" rel="noopener">http://backend</a>;<br>    proxy_http_version 1.1;<br>    proxy_set_header Upgrade $http_upgrade;<br>    proxy_set_header Connection “upgrade”;<br>}<br></pre></blockquote><p>  一个更复杂的示例，其中对代理服务器的请求中的“连接”头字段的值取决于客户端请求头中是否存在“升级”字段： </p><blockquote class="example"><pre class="notranslate">http {<br>    map $http_upgrade $connection_upgrade {<br>        default upgrade;<br>        ‘’      close;<br>    }<p></p>
<pre><code>server {
    ...

    location /chat/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }
}
</code></pre><p></p></pre></blockquote><p></p><p>  默认情况下，如果代理服务器在60秒内未传输任何数据，则将关闭连接。  使用<a hhref="ngx_http_proxy_module.html#proxy_read_timeout">proxy_read_timeout</a>指令可以增加此超时。  或者，代理服务器可以配置为定期发送WebSocket ping帧以重置超时并检查连接是否仍然存在。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/server_names.html</url>
      <content type="html"><![CDATA[<p></p><h2>  服务器名称 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#wildcard_names">Wildcard names</a> <br> <a hhref="#regex_names">Regular expressions names</a> <br> <a hhref="#miscellaneous_names">Miscellaneous names</a> <br> <a hhref="#idn">Internationalized names</a> <br> <a hhref="#optimization">Optimization</a> <br> <a hhref="#compatibility">Compatibility</a> <br></td></tr></tbody></table><p>  服务器名称使用<a hhref="ngx_http_core_module.html#server_name">server_name</a>指令定义，并确定用于给定请求的<a hhref="ngx_http_core_module.html#server">服务器</a>块。  另请参阅“ <a hhref="request_processing.html">nginx如何处理请求</a> ”。  可以使用确切名称，通配符名称或正则表达式来定义它们： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server_name  example.org  www.example.org;<br>    …<br>}<p></p>
<p>server {<br>    listen       80;<br>    server_name  *.example.org;<br>    …<br>}</p>
<p>server {<br>    listen       80;<br>    server_name  mail.*;<br>    …<br>}</p>
<p>server {<br>    listen       80;<br>    server_name  ~^(?&lt;user&gt;.+).example.net$;<br>    …<br>}<br></p></pre></blockquote><p></p><p>  按名称搜索虚拟服务器时，如果name匹配多个指定的变体，例如通配符名称和正则表达式匹配，则将按以下优先顺序选择第一个匹配的变体： </p><ol class="compact"><li>  确切的名字 </li><li>  最长的通配符名称以星号开头，例如“ <code class="notranslate"><em>.example.org</em></code> ” </li><li>  最长的通配符名称以星号结尾，例如“ <code class="notranslate">mail.</code> ” </li><li>  第一个匹配正则表达式（按配置文件中的出现顺序） </li></ol><p></p><a name="wildcard_names"></a><center><h4>  通配符名称 </h4></center><p>  通配符名称可能仅在名称的开头或结尾包含星号，并且仅在点边框上包含星号。  名称“ <code class="notranslate">www.<em>.example.org</em></code> ”和“ <code class="notranslate">w.example.org</code> ”无效。  但是，可以使用正则表达式指定这些名称，例如“ <code class="notranslate">~^www..+.example.org$</code> ”和“ <code class="notranslate">~^w.<em>.example.org$</em></code> ”。  星号可以匹配多个名称部分。  名称“ <code class="notranslate">.example.org</code> ”不仅匹配<code class="notranslate">www.example.org</code>还匹配<code class="notranslate">www.sub.example.org</code> 。 </p><p>   “ <code class="notranslate">.example.org</code> ”形式的特殊通配符名称可用于匹配确切名称“ <code class="notranslate">example.org</code> ”和通配符名称“ <code class="notranslate">*.example.org</code> ”。 </p><a name="regex_names"></a><center><h4>  正则表达式名称 </h4></center><p>   nginx使用的正则表达式与Perl编程语言（PCRE）使用的正则表达式兼容。  要使用正则表达式，服务器名称必须以波浪号开头： </p><blockquote class="example"><pre class="notranslate">server_name  ~^www\d+.example.net$;<br></pre></blockquote><p>  否则它将被视为一个确切的名称，或者如果表达式包含星号，则视为通配符名称（并且很可能是无效的名称）。  不要忘记设置“ <code class="notranslate">^</code> ”和“ <code class="notranslate">$</code> ”锚点。  它们在语法上不是必需的，但在逻辑上是必需的。  另请注意，域名点应使用反斜杠进行转义。  应引用包含字符“ <code class="notranslate">{</code> ”和“ <code class="notranslate">}</code> ”的正则表达式： </p><blockquote class="example"><pre class="notranslate">server_name  “~^(?&lt;name&gt;\w\d <b>{</b> 1,3 <b>}</b> +).example.net$”;<br></pre></blockquote><p>  否则nginx将无法启动并显示错误消息： </p><blockquote class="example"><pre class="notranslate">directive “server_name” is not terminated by “;” in …<br></pre></blockquote><p>  命名的正则表达式捕获稍后可以用作变量： </p><blockquote class="example"><pre class="notranslate">server {<br>    server_name   ~^(www.)?( <b>?&lt;domain&gt;</b> .+)$;<p></p>
<pre><code>location / {
    root   /sites/ &lt;b&gt;$domain&lt;/b&gt; ;
}
</code></pre><p>}<br></p></pre></blockquote><p>   PCRE库使用以下语法支持命名捕获： </p><blockquote><table width="100%"><tbody><tr><td class="notranslate"> <code class="notranslate">?&lt; <code class="notranslate"><i>name</i></code> &gt;</code> </td><td class="notranslate">Perl 5.10 compatible syntax, supported since PCRE-7.0</td></tr><tr><td class="notranslate"> <code class="notranslate">?’ <code class="notranslate"><i>name</i></code> ‘</code> </td><td class="notranslate">Perl 5.10 compatible syntax, supported since PCRE-7.0</td></tr><tr><td class="notranslate"> <code class="notranslate">?P&lt; <code class="notranslate"><i>name</i></code> &gt;</code> </td><td class="notranslate">Python compatible syntax, supported since PCRE-4.0</td></tr></tbody></table></blockquote>  如果nginx无法启动并显示错误消息： <p></p><blockquote class="example"><pre class="notranslate">pcre_compile() failed: unrecognized character after (?&lt; in …<br></pre></blockquote><p>  这意味着PCRE库已经过时了，应该尝试使用语法“ <code class="notranslate">?P&lt; <code class="notranslate"><i>name</i></code> &gt;</code> ”。  捕获也可以以数字形式使用： </p><blockquote class="example"><pre class="notranslate">server {<br>    server_name   ~^(www.)?(.+)$;<p></p>
<pre><code>location / {
    root   /sites/ &lt;b&gt;$2&lt;/b&gt; ;
}
</code></pre><p>}<br></p></pre></blockquote><p>  但是，这种用法应限于简单的情况（如上所述），因为数字参考可以很容易地被覆盖。 </p><a name="miscellaneous_names"></a><center><h4>  杂项名称 </h4></center><p>  有一些服务器名称是专门处理的。 </p><p>  如果需要处理没有默认<a hhref="ngx_http_core_module.html#server">服务器</a>块中“Host”头字段的<a hhref="ngx_http_core_module.html#server">请求</a> ，则应指定一个空名称： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server_name  example.org  www.example.org  “”;<br>    …<br>}<br></pre></blockquote><p></p><p>  如果<a hhref="ngx_http_core_module.html#server">服务器</a>块中未定义<a hhref="ngx_http_core_module.html#server_name">server_name</a> ，则nginx使用空名称作为服务器名称。 </p><blockquote class="note">  在这种情况下，最高为0.8.48的nginx版本使用机器的主机名作为服务器名称。 </blockquote><p></p><p>  如果服务器名称定义为“ <code class="notranslate">$hostname</code> ”（0.9.4），则使用计算机的主机名。 </p><p>  如果有人使用IP地址而不是服务器名称发出请求，则“主机”请求标头字段将包含IP地址，并且可以使用IP地址作为服务器名称来处理请求： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server<em>name  example.org<br>                 www.example.org<br>                 “”<br>                 <b>192.168.1.1</b><br>                 ;<br>    …<br>}<br></em></pre></blockquote><p></p><p>  在catch-all服务器示例中，可以看到奇怪的名称“ <code class="notranslate"></code> ”： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80  default_server;<br>    server<em>name  </em>;<br>    return       444;<br>}<br></pre></blockquote><p>  这个名称没有什么特别之处，它只是无数域名之一，永远不会与任何真实姓名相交。  也可以使用诸如“ <code class="notranslate">–</code> ”和“ <code class="notranslate">!@#</code> ”之类的其他无效名称。 </p><p>   nginx版本高达0.6.25支持特殊名称“ <code class="notranslate"><em></em></code> ”，它被错误地解释为一个包罗万象的名称。  它从不作为全能或通配符服务器名称运行。  相反，它提供了<a hhref="ngx_http_core_module.html#server_name_in_redirect">server_name_in_redirect</a>指令现在提供的功能。  现在不推荐使用特殊名称“ <code class="notranslate"></code> ”，并且应使用<a hhref="ngx_http_core_module.html#server_name_in_redirect">server_name_in_redirect</a>指令。  请注意，无法使用<a hhref="ngx_http_core_module.html#server_name">server_name</a>指令指定catch-all名称或缺省服务器。  这是<a hhref="ngx_http_core_module.html#listen">listen</a>指令的属性，而不是<a hhref="ngx_http_core_module.html#server_name">server_name</a>指令的属性。  另请参阅“ <a hhref="request_processing.html">nginx如何处理请求</a> ”。  可以定义侦听端口<em>：80和</em>：8080的服务器，并指示一个端口将是端口<em>的默认服务器：8080，而另一个将是端口</em>的默认值：80： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    listen       8080  default_server;<br>    server_name  example.net;<br>    …<br>}<p></p>
<p>server {<br>    listen       80  default_server;<br>    listen       8080;<br>    server_name  example.org;<br>    …<br>}<br></p></pre></blockquote><p></p><a name="idn"></a><center><h4>  国际化名称 </h4></center><p>  应使用<a hhref="ngx_http_core_module.html#server_name">server_name</a>指令中的ASCII（Punycode）表示来指定国际化域名（ <a hhref="https://en.wikipedia.org/wiki/Internationalized_domain_name">IDN</a> ）： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server_name  xn–e1afmkfd.xn–80akhbyknj4f;  # пример.испытание<br>    …<br>}<br></pre></blockquote><p></p><a name="optimization"></a><center><h4>  优化 </h4></center><p>  确切名称，以星号开头的通配符名称以及以星号结尾的通配符名称存储在绑定到侦听端口的三个哈希表中。  散列表的大小在配置阶段进行了优化，因此可以找到最少CPU缓存未命中的名称。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><p>  首先搜索确切的名称哈希表。  如果未找到名称，则搜索带有以星号开头的通配符名称的哈希表。  如果在那里找不到名称，则搜索带有以星号结尾的通配符名称的哈希表。 </p><p>  搜索通配符名称哈希表比搜索确切名称哈希表要慢，因为域名部分会搜索名称。  请注意，特殊通配符形式“ <code class="notranslate">.example.org</code> ”存储在通配符名称哈希表中，而不是存储在精确名称哈希表中。 </p><p>  正则表达式是按顺序测试的，因此是最慢的方法，并且是不可伸缩的。 </p><p>  出于这些原因，最好在可能的情况下使用确切的名称。  例如，如果服务器的最常请求名称是<code class="notranslate">example.org</code>和<code class="notranslate">www.example.org</code> ，则明确定义它们会更有效： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server_name  example.org  www.example.org  <em>.example.org;<br>    …<br>}<br></em></pre></blockquote><p>  而不是使用简化形式： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server_name  .example.org;<br>    …<br>}<br></pre></blockquote><p></p><p>  如果定义了大量服务器名称，或者定义了异常长的服务器名称，则可能需要在<i>http</i>级别调整<a hhref="ngx_http_core_module.html#server_names_hash_max_size">server_names_hash_max_size</a>和<a hhref="ngx_http_core_module.html#server_names_hash_bucket_size">server_names_hash_bucket_size</a>指令。   <a hhref="ngx_http_core_module.html#server_names_hash_bucket_size">server_names_hash_bucket_size</a>指令的默认值可能等于32或64，或其他值，具体取决于CPU缓存行大小。  如果默认值为32且服务器名称定义为“ <code class="notranslate">too.long.server.name.example.org</code> ”，则nginx将无法启动并显示错误消息： </p><blockquote class="example"><pre class="notranslate">could not build the server_names_hash,<br>you should increase server_names_hash_bucket_size: 32<br></pre></blockquote><p>  在这种情况下，指令值应该增加到下一个2的幂： </p><blockquote class="example"><pre class="notranslate">http {<br>    server_names_hash_bucket_size  64;<br>    …<br></pre></blockquote><p>  如果定义了大量服务器名称，则会显示另一条错误消息： </p><blockquote class="example"><pre class="notranslate">could not build the server_names_hash,<br>you should increase either server_names_hash_max_size: 512<br>or server_names_hash_bucket_size: 32<br></pre></blockquote><p>  在这种情况下，首先尝试将<a hhref="ngx_http_core_module.html#server_names_hash_max_size">server_names_hash_max_size</a>设置为接近服务器名称数的数字。  只有当这没有帮助时，或者如果nginx的开始时间长得令人无法接受，请尝试增加<a hhref="ngx_http_core_module.html#server_names_hash_bucket_size">server_names_hash_bucket_size</a> 。 </p><p>  如果服务器是监听端口的唯一服务器，则nginx根本不会测试服务器名称（并且不会为监听端口构建哈希表）。  但是，有一个例外。  如果服务器名称是带捕获的正则表达式，则nginx必须执行表达式才能获取捕获。 </p><a name="compatibility"></a><center><h4>  兼容性 </h4></center><p></p><ul class="compact"><li>  自0.9.4以来一直支持特殊服务器名称“ <code class="notranslate">$hostname</code> ”。 </li><li>  默认服务器名称值是自0.8.48以来的空名称“”。 </li><li>  自0.8.25起，支持命名正则表达式服务器名称捕获。 </li><li>  自0.7.40起支持正则表达式服务器名称捕获。 </li><li>  自0.7.12起，支持空服务器名称“”。 </li><li>  支持使用通配符服务器名称或正则表达式作为自0.6.25以来的第一个服务器名称。 </li><li>  自0.6.7起支持正则表达式服务器名称。 </li><li>  自0.6.0以来一直支持通配符表单<code class="notranslate">example.</code> 。 </li><li>  从0.3.18开始支持特殊格式<code class="notranslate">.example.org</code> 。 </li><li>  自0.1.13起支持通配符<code class="notranslate">*.example.org</code> 。 </li></ul><p></p><table width="100%"><tbody><tr><td align="right" class="notranslate">written by Igor Sysoev<br>edited by Brian Mercer<br></td></tr></tbody></table><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/request_processing.html</url>
      <content type="html"><![CDATA[<p></p><h2>   nginx如何处理请求 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#how_to_prevent_undefined_server_names">How to prevent processing requests with undefined server names</a> <br> <a hhref="#mixed_name_ip_based_servers">Mixed name-based and IP-based virtual servers</a> <br> <a hhref="#simple_php_site_configuration">A simple PHP site configuration</a> <br></td></tr></tbody></table><center><h4>  基于名称的虚拟服务器 </h4></center><p>   nginx首先决定哪个<i>服务器</i>应该处理请求。  让我们从一个简单的配置开始，其中所有三个虚拟服务器都在端口*：80上侦听： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen      80;<br>    server_name example.org www.example.org;<br>    …<br>}<p></p>
<p>server {<br>    listen      80;<br>    server_name example.net www.example.net;<br>    …<br>}</p>
<p>server {<br>    listen      80;<br>    server_name example.com www.example.com;<br>    …<br>}<br></p></pre></blockquote><p></p><p>  在此配置中，nginx仅测试请求的标头字段“Host”，以确定请求应路由到哪个服务器。  如果其值与任何服务器名称都不匹配，或者请求根本不包含此标头字段，则nginx会将请求路由到此端口的默认服务器。  在上面的配置中，默认服务器是第一个 - 这是nginx的标准默认行为。  也可以使用<a hhref="ngx_http_core_module.html#listen">listen</a>指令中的<code class="notranslate">default_server</code>参数明确设置哪个服务器应该是默认的： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen      80 <b>default_server</b> ;<br>    server_name example.net www.example.net;<br>    …<br>}<br></pre></blockquote><p></p><blockquote class="note">   <code class="notranslate">default_server</code>参数自版本0.8.21起可用。  在早期版本中，应使用<code class="notranslate">default</code>参数。 </blockquote><p>  请注意，默认服务器是侦听端口的属性，而不是服务器名称的属性。  稍后会详细介绍。 </p><a name="how_to_prevent_undefined_server_names"></a><center><h4>  如何使用未定义的服务器名称防止处理请求 </h4></center><p>  如果不允许没有“Host”头字段的请求，则可以定义只删除请求的服务器： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen      80;<br>    server_name “”;<br>    return      444;<br>}<br></pre></blockquote><p>  这里，服务器名称设置为一个空字符串，它将匹配没有“Host”头字段的请求，并返回一个特殊的nginx非标准代码444来关闭连接。 </p><blockquote class="note">  从版本0.8.48开始，这是服务器名称的默认设置，因此可以省略<code class="notranslate">server_name “”</code> 。  在早期版本中，计算机的<i>主机名</i>用作默认服务器名称。 </blockquote><p></p><a name="mixed_name_ip_based_servers"></a><center><h4>  基于名称的混合和基于IP的虚拟服务器 </h4></center><p>  让我们看一个更复杂的配置，其中一些虚拟服务器监听不同的地址： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen      192.168.1.1:80;<br>    server_name example.org www.example.org;<br>    …<br>}<p></p>
<p>server {<br>    listen      192.168.1.1:80;<br>    server_name example.net www.example.net;<br>    …<br>}</p>
<p>server {<br>    listen      192.168.1.2:80;<br>    server_name example.com www.example.com;<br>    …<br>}<br></p></pre></blockquote><p>  在此配置中，nginx首先根据<a hhref="ngx_http_core_module.html#server">服务器</a>块的<a hhref="ngx_http_core_module.html#listen">listen</a>指令测试请求的IP地址和端口。  然后，它针对与IP地址和端口匹配的<a hhref="ngx_http_core_module.html#server">服务器</a>块的<a hhref="ngx_http_core_module.html#server_name">server_name</a>条目测试请求的“Host”头字段。  如果未找到服务器名称，则默认服务器将处理该请求。  例如，在192.168.1.1:80端口上收到的<code class="notranslate">www.example.com</code>请求将由192.168.1.1:80端口的默认服务器处理，即由第一台服务器处理，因为没有<code class="notranslate">www.example.com</code>为此端口定义。 </p><p>  如前所述，默认服务器是监听端口的属性，可以为不同的端口定义不同的默认服务器： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen      192.168.1.1:80;<br>    server_name example.org www.example.org;<br>    …<br>}<p></p>
<p>server {<br>    listen      192.168.1.1:80 <b>default_server</b> ;<br>    server_name example.net www.example.net;<br>    …<br>}</p>
<p>server {<br>    listen      192.168.1.2:80 <b>default_server</b> ;<br>    server_name example.com www.example.com;<br>    …<br>}<br></p></pre></blockquote><p></p><a name="simple_php_site_configuration"></a><center><h4>  一个简单的PHP站点配置 </h4></center><p>  现在让我们看看nginx如何选择一个<i>位置</i>来处理一个典型的简单PHP站点的请求： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen      80;<br>    server_name example.org www.example.org;<br>    root        /data/www;<p></p>
<pre><code>location / {
    index   index.html index.php;
}

location ~* \.(gif|jpg|png)$ {
    expires 30d;
}

location ~ \.php$ {
    fastcgi_pass  localhost:9000;
    fastcgi_param SCRIPT_FILENAME
                  $document_root$fastcgi_script_name;
    include       fastcgi_params;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p>   nginx首先搜索由文字字符串给出的最具体的前缀位置，而不管列出的顺序如何。  在上面的配置中，唯一的前缀位置是“ <code class="notranslate">/</code> ”，因为它匹配任何请求，它将被用作最后的手段。  然后nginx按照配置文件中列出的顺序检查正则表达式给出的位置。  第一个匹配表达式将停止搜索，nginx将使用此位置。  如果没有正则表达式与请求匹配，则nginx使用先前找到的最具体的前缀位置。 </p><p>  请注意，所有类型的位置仅测试不带参数的请求行的URI部分。  这样做是因为查询字符串中的参数可以通过多种方式给出，例如： </p><blockquote class="example"><pre class="notranslate">/index.php?user=john&amp;page=1<br>/index.php?page=1&amp;user=john<br></pre></blockquote><p>  此外，任何人都可以在查询字符串中请求任何内容 </p><blockquote class="example"><pre class="notranslate">/index.php?page=1&amp;something+else&amp;user=john<br></pre></blockquote><p></p><p>  现在让我们看看如何在上面的配置中处理请求： </p><ul><li>  请求“ <code class="notranslate">/logo.gif</code> ”首先与前缀位置“ <code class="notranslate">/</code> ”匹配，然后由正则表达式“ <code class="notranslate">.(gif|jpg|png)$</code> ”匹配，因此，它由后一个位置处理。  使用指令“ <code class="notranslate">root /data/www</code> ”将请求映射到文件<code class="notranslate">/data/www/logo.gif</code> ，并将文件发送到客户端。 </li><li>  请求“ <code class="notranslate">/index.php</code> ”也首先与前缀位置“ <code class="notranslate">/</code> ”匹配，然后由正则表达式“ <code class="notranslate">.(php)$</code> ”匹配。  因此，它由后一个位置处理，请求被传递给侦听localhost：9000的FastCGI服务器。   <a hhref="ngx_http_fastcgi_module.html#fastcgi_param">fastcgi_param</a>指令将FastCGI参数<code class="notranslate">SCRIPT_FILENAME</code>为“ <code class="notranslate">/data/www/index.php</code>服务器执行该文件。  变量<code class="notranslate">$document_root</code>等于<a hhref="ngx_http_core_module.html#root">root</a>指令的值，变量<code class="notranslate">$fastcgi_script_name</code>等于请求URI，即“ <code class="notranslate">/index.php</code> ”。 </li><li>  请求“ <code class="notranslate">/about.html</code> ”仅与前缀位置“ <code class="notranslate">/</code> ”匹配，因此，它在此位置处理。  使用指令“ <code class="notranslate">root /data/www</code> ”将请求映射到文件<code class="notranslate">/data/www/about.html</code> ，并将文件发送到客户端。 </li><li>  处理请求“ <code class="notranslate">/</code> ”更复杂。  它仅与前缀位置“ <code class="notranslate">/</code> ”匹配，因此，它由此位置处理。  然后<a hhref="ngx_http_index_module.html#index">索引</a>指令根据其参数和“ <code class="notranslate">root /data/www</code> ”指令测试索引文件是否存在。  如果文件<code class="notranslate">/data/www/index.html</code>不存在，并且文件<code class="notranslate">/data/www/index.php</code>存在，则该指令执行内部重定向到“ <code class="notranslate">/index.php</code> ”，并且nginx再次搜索位置如果请求是由客户发送的。  正如我们之前看到的，重定向的请求最终将由FastCGI服务器处理。 </li></ul><p></p><table width="100%"><tbody><tr><td align="right" class="notranslate">written by Igor Sysoev<br>edited by Brian Mercer<br></td></tr></tbody></table><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_xslt_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_xslt_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#xml_entities">xml_entities</a> <br>     <a hhref="#xslt_last_modified">xslt_last_modified</a> <br>     <a hhref="#xslt_param">xslt_param</a> <br>     <a hhref="#xslt_string_param">xslt_string_param</a> <br>     <a hhref="#xslt_stylesheet">xslt_stylesheet</a> <br>     <a hhref="#xslt_types">xslt_types</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_xslt_module</code> （0.7.8+）是一个使用一个或多个XSLT样式表转换XML响应的过滤器。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_xslt_module</code>配置参数启用它。 </p><blockquote class="note">  该模块需要<a hhref="http://xmlsoft.org">libxml2</a>和<a hhref="http://xmlsoft.org/XSLT/">libxslt</a>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    xml_entities    /site/dtd/entities.dtd;<br>    xslt_stylesheet /site/xslt/one.xslt param=value;<br>    xslt_stylesheet /site/xslt/two.xslt;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="xml_entities"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>xml_entities</strong> <code class="notranslate"><i>path</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定声明字符实体的DTD文件。  此文件在配置阶段编译。  由于技术原因，模块无法使用已处理XML中声明的外部子集，因此将忽略该模块并使用特殊定义的文件。  此文件不应描述XML结构。  仅声明所需的字符实体就足够了，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;&amp;lt;!ENTITY nbsp &quot;&amp;amp;#xa0;&quot;&amp;gt;
</code></pre><p></p><p></p><a name="xslt_last_modified"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>xslt_last_modified</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">xslt_last_modified off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.1版本中。 </p></div><p>  允许在XSLT转换期间保留原始响应中的“Last-Modified”头字段，以便于响应缓存。 </p><p>  默认情况下，在转换期间修改响应内容时会删除标题字段，并且可能包含动态生成的元素或与原始响应无关的部分。 </p><a name="xslt_param"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>xslt_param</strong> <code class="notranslate"><i>parameter</i></code> <code class="notranslate"><i>value</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.1.18版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义XSLT样式表的参数。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;被视为XPath表达式。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含变量。  要将字符串值传递给样式表，可以使用&lt;a hhref=&quot;#xslt_string_param&quot;&gt;xslt_string_param&lt;/a&gt;指令。 &lt;/p&gt;&lt;p&gt;  可能有几个&lt;code class=&quot;notranslate&quot;&gt;xslt_param&lt;/code&gt;指令。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;xslt_param&lt;/code&gt;和&lt;a hhref=&quot;#xslt_string_param&quot;&gt;xslt_string_param&lt;/a&gt;指令时，这些指令才从前一级继承。 &lt;/p&gt;&lt;a name=&quot;xslt_string_param&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;xslt_string_param&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameter&lt;/i&gt;&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.1.18版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义XSLT样式表的字符串参数。  不解释&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;中的XPath表达式。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含变量。 &lt;/p&gt;&lt;p&gt;  可能有几个&lt;code class=&quot;notranslate&quot;&gt;xslt_string_param&lt;/code&gt;指令。  当且仅当在当前级别上没有定义&lt;a hhref=&quot;#xslt_param&quot;&gt;xslt_param&lt;/a&gt;和&lt;code class=&quot;notranslate&quot;&gt;xslt_string_param&lt;/code&gt;指令时，这些指令才从前一级继承。 &lt;/p&gt;&lt;a name=&quot;xslt_stylesheet&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;xslt_stylesheet&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;stylesheet&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameter&lt;/i&gt;&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; ...];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义XSLT样式表及其可选参数。  样式表在配置阶段编译。 &lt;/p&gt;&lt;p&gt;  参数既可以单独指定，也可以使用“ &lt;code class=&quot;notranslate&quot;&gt;:&lt;/code&gt; ”分隔符分组在一行中。  如果参数包含“ &lt;code class=&quot;notranslate&quot;&gt;:&lt;/code&gt; ”字符，则应将其转义为“ &lt;code class=&quot;notranslate&quot;&gt;%3A&lt;/code&gt; ”。  此外， &lt;code class=&quot;notranslate&quot;&gt;libxslt&lt;/code&gt;要求将包含非字母数字字符的参数括在单引号或双引号中，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;param1=&apos;http%3A//www.example.com&apos;:param2=value2
</code></pre><p></p><p></p><p>  参数描述可以包含变量，例如，整行参数可以从单个变量中获取： </p><blockquote class="example"><pre class="notranslate">location / {<br>    xslt_stylesheet /site/xslt/one.xslt<br>                    $arg_xslt_params<br>                    param1=’$value1’:param2=value2<br>                    param3=value3;<br>}<br></pre></blockquote><p></p><p>  可以指定多个样式表。  它们将按指定的顺序依次应用。 </p><a name="xslt_types"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>xslt_types</strong> <code class="notranslate"><i>mime-type</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">xslt_types text/xml;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  除了“ <code class="notranslate">text/xml</code> ”之外，还启用具有指定MIME类型的响应中的转换。  特殊值“ <code class="notranslate">*</code> ”匹配任何MIME类型（0.8.29）。  如果转换结果是HTML响应，则其MIME类型将更改为“ <code class="notranslate">text/html</code> ”。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_v2_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_v2_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#issues">Known Issues</a> <br> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#http2_body_preread_size">http2_body_preread_size</a> <br>     <a hhref="#http2_chunk_size">http2_chunk_size</a> <br>     <a hhref="#http2_idle_timeout">http2_idle_timeout</a> <br>     <a hhref="#http2_max_concurrent_pushes">http2_max_concurrent_pushes</a> <br>     <a hhref="#http2_max_concurrent_streams">http2_max_concurrent_streams</a> <br>     <a hhref="#http2_max_field_size">http2_max_field_size</a> <br>     <a hhref="#http2_max_header_size">http2_max_header_size</a> <br>     <a hhref="#http2_max_requests">http2_max_requests</a> <br>     <a hhref="#http2_push">http2_push</a> <br>     <a hhref="#http2_push_preload">http2_push_preload</a> <br>     <a hhref="#http2_recv_buffer_size">http2_recv_buffer_size</a> <br>     <a hhref="#http2_recv_timeout">http2_recv_timeout</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_v2_module</code>模块（1.9.5）提供对<a hhref="https://tools.ietf.org/html/rfc7540">HTTP / 2的</a>支持并取代<a hhref="ngx_http_spdy_module.html">ngx_http_spdy_module</a>模块。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_v2_module</code>配置参数启用它。 </p><a name="issues"></a><center><h4>  已知的问题 </h4></center><p>  在版本1.9.14之前，无论<a hhref="ngx_http_proxy_module.html#proxy_request_buffering">proxy_request_buffering</a> ， <a hhref="ngx_http_fastcgi_module.html#fastcgi_request_buffering">fastcgi_request_buffering</a> ， <a hhref="ngx_http_uwsgi_module.html#uwsgi_request_buffering">uwsgi_request_buffering</a>和<a hhref="ngx_http_scgi_module.html#scgi_request_buffering">scgi_request_buffering</a>指令值如何，都无法禁用客户端请求正文的缓冲。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">server {<br>    listen 443 ssl http2;<p></p>
<pre><code>ssl_certificate server.crt;
ssl_certificate_key server.key;
</code></pre><p>}<br></p></pre></blockquote><p>  请注意，通过TLS接受HTTP / 2连接需要“应用程序层协议协商”（ALPN）TLS扩展支持，该支持仅在<a hhref="http://www.openssl.org">OpenSSL</a>版本1.0.2之后可用。  为此目的使用“下一协议协商”（NPN）TLS扩展（自OpenSSL版本1.0.1起可用）不能保证有效。 </p><p>  另请注意，如果<a hhref="ngx_http_ssl_module.html#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a>指令设置为值“ <code class="notranslate">on</code> ”，则应将<a hhref="ngx_http_ssl_module.html#ssl_ciphers">密码</a>配置为符合<a hhref="https://tools.ietf.org/html/rfc7540#appendix-A">RFC 7540，附录A</a>黑名单并由客户端支持。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="http2_body_preread_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_body_preread_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_body_preread_size 64k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.0版本中。 </p></div><p>  设置在开始处理请求主体之前可以保存请求主体的每个请求的缓冲区<code class="notranslate"><i>size</i></code> 。 </p><a name="http2_chunk_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_chunk_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_chunk_size 8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置响应主体被切片到的块的最大大小。  值太低会导致更高的开销。  由于<a hhref="http://en.wikipedia.org/wiki/Head-of-line_blocking">HOL阻塞，</a>太高的值会损害优先级。 </p><a name="http2_idle_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_idle_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_idle_timeout 3m;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置关闭连接之前的不活动超时。 </p><a name="http2_max_concurrent_pushes"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_max_concurrent_pushes</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_max_concurrent_pushes 10;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.13.9版中。 </p></div><p>  限制连接中的最大并发<a hhref="#http2_push">推送</a>请求数。 </p><a name="http2_max_concurrent_streams"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_max_concurrent_streams</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_max_concurrent_streams 128;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置连接中的最大并发HTTP / 2流数。 </p><a name="http2_max_field_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_max_field_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_max_field_size 4k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  限制<a hhref="https://tools.ietf.org/html/rfc7541">HPACK</a>压缩请求标头字段的最大大小。  该限制同样适用于名称和价值。  请注意，如果应用了霍夫曼编码，则解压缩的名称和值字符串的实际大小可能会更大。  对于大多数请求，默认限制应该足够。 </p><a name="http2_max_header_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_max_header_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_max_header_size 16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  在<a hhref="https://tools.ietf.org/html/rfc7541">HPACK</a>解压缩后限制整个请求标头列表的最大大小。  对于大多数请求，默认限制应该足够。 </p><a name="http2_max_requests"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_max_requests</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_max_requests 1000;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.6版中。 </p></div><p>  设置可通过一个HTTP / 2连接提供的最大请求数（包括<a hhref="#http2_push">推送</a>请求），之后下一个客户端请求将导致连接关闭以及建立新连接的需要。 </p><a name="http2_push"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_push</strong> <code class="notranslate"><i>uri</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_push off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.13.9版中。 </p></div><p>  先发制人地将请求发送（ <a hhref="https://tools.ietf.org/html/rfc7540#section-8.2">推送</a> ）到指定的<code class="notranslate"><i>uri</i></code>以及对原始请求的响应。  仅处理具有绝对路径的相对URI，例如： </p><blockquote class="example"><pre class="notranslate">http2_push /static/css/main.css;<br></pre></blockquote><p>   <code class="notranslate"><i>uri</i></code>值可以包含变量。 </p><p>  可以在同一配置级别指定多个<code class="notranslate">http2_push</code>指令。   <code class="notranslate">off</code>参数取消了从先前配置级别继承的<code class="notranslate">http2_push</code>指令的效果。 </p><a name="http2_push_preload"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_push_preload</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_push_preload off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.13.9版中。 </p></div><p>  允许将“链接”响应头字段中指定的<a hhref="https://www.w3.org/TR/preload/#server-push-http-2">预加载链接</a>自动转换为<a hhref="https://tools.ietf.org/html/rfc7540#section-8.2">推送</a>请求。 </p><a name="http2_recv_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_recv_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_recv_buffer_size 256k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  设置每个<a hhref="ngx_core_module.html#worker_processes">工作者</a>输入缓冲区的大小。 </p><a name="http2_recv_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http2_recv_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">http2_recv_timeout 30s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置从客户端获取更多数据的超时，然后关闭连接。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_v2_module</code>模块支持以下嵌入变量： </p><dl><dt id="var_http2"> <code class="notranslate">$http2</code> </dt> <dd>  协商协议标识符：“ <code class="notranslate">h2</code> ”表示HTTP / 2通过TLS，“ <code class="notranslate">h2c</code> ”表示HTTP / 2通过明文TCP，否则为空字符串。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_uwsgi_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_uwsgi_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#uwsgi_bind">uwsgi_bind</a> <br>     <a hhref="#uwsgi_buffer_size">uwsgi_buffer_size</a> <br>     <a hhref="#uwsgi_buffering">uwsgi_buffering</a> <br>     <a hhref="#uwsgi_buffers">uwsgi_buffers</a> <br>     <a hhref="#uwsgi_busy_buffers_size">uwsgi_busy_buffers_size</a> <br>     <a hhref="#uwsgi_cache">uwsgi_cache</a> <br>     <a hhref="#uwsgi_cache_background_update">uwsgi_cache_background_update</a> <br>     <a hhref="#uwsgi_cache_bypass">uwsgi_cache_bypass</a> <br>     <a hhref="#uwsgi_cache_key">uwsgi_cache_key</a> <br>     <a hhref="#uwsgi_cache_lock">uwsgi_cache_lock</a> <br>     <a hhref="#uwsgi_cache_lock_age">uwsgi_cache_lock_age</a> <br>     <a hhref="#uwsgi_cache_lock_timeout">uwsgi_cache_lock_timeout</a> <br>     <a hhref="#uwsgi_cache_max_range_offset">uwsgi_cache_max_range_offset</a> <br>     <a hhref="#uwsgi_cache_methods">uwsgi_cache_methods</a> <br>     <a hhref="#uwsgi_cache_min_uses">uwsgi_cache_min_uses</a> <br>     <a hhref="#uwsgi_cache_path">uwsgi_cache_path</a> <br>     <a hhref="#uwsgi_cache_purge">uwsgi_cache_purge</a> <br>     <a hhref="#uwsgi_cache_revalidate">uwsgi_cache_revalidate</a> <br>     <a hhref="#uwsgi_cache_use_stale">uwsgi_cache_use_stale</a> <br>     <a hhref="#uwsgi_cache_valid">uwsgi_cache_valid</a> <br>     <a hhref="#uwsgi_connect_timeout">uwsgi_connect_timeout</a> <br>     <a hhref="#uwsgi_force_ranges">uwsgi_force_ranges</a> <br>     <a hhref="#uwsgi_hide_header">uwsgi_hide_header</a> <br>     <a hhref="#uwsgi_ignore_client_abort">uwsgi_ignore_client_abort</a> <br>     <a hhref="#uwsgi_ignore_headers">uwsgi_ignore_headers</a> <br>     <a hhref="#uwsgi_intercept_errors">uwsgi_intercept_errors</a> <br>     <a hhref="#uwsgi_limit_rate">uwsgi_limit_rate</a> <br>     <a hhref="#uwsgi_max_temp_file_size">uwsgi_max_temp_file_size</a> <br>     <a hhref="#uwsgi_modifier1">uwsgi_modifier1</a> <br>     <a hhref="#uwsgi_modifier2">uwsgi_modifier2</a> <br>     <a hhref="#uwsgi_next_upstream">uwsgi_next_upstream</a> <br>     <a hhref="#uwsgi_next_upstream_timeout">uwsgi_next_upstream_timeout</a> <br>     <a hhref="#uwsgi_next_upstream_tries">uwsgi_next_upstream_tries</a> <br>     <a hhref="#uwsgi_no_cache">uwsgi_no_cache</a> <br>     <a hhref="#uwsgi_param">uwsgi_param</a> <br>     <a hhref="#uwsgi_pass">uwsgi_pass</a> <br>     <a hhref="#uwsgi_pass_header">uwsgi_pass_header</a> <br>     <a hhref="#uwsgi_pass_request_body">uwsgi_pass_request_body</a> <br>     <a hhref="#uwsgi_pass_request_headers">uwsgi_pass_request_headers</a> <br>     <a hhref="#uwsgi_read_timeout">uwsgi_read_timeout</a> <br>     <a hhref="#uwsgi_request_buffering">uwsgi_request_buffering</a> <br>     <a hhref="#uwsgi_send_timeout">uwsgi_send_timeout</a> <br>     <a hhref="#uwsgi_socket_keepalive">uwsgi_socket_keepalive</a> <br>     <a hhref="#uwsgi_ssl_certificate">uwsgi_ssl_certificate</a> <br>     <a hhref="#uwsgi_ssl_certificate_key">uwsgi_ssl_certificate_key</a> <br>     <a hhref="#uwsgi_ssl_ciphers">uwsgi_ssl_ciphers</a> <br>     <a hhref="#uwsgi_ssl_crl">uwsgi_ssl_crl</a> <br>     <a hhref="#uwsgi_ssl_name">uwsgi_ssl_name</a> <br>     <a hhref="#uwsgi_ssl_password_file">uwsgi_ssl_password_file</a> <br>     <a hhref="#uwsgi_ssl_protocols">uwsgi_ssl_protocols</a> <br>     <a hhref="#uwsgi_ssl_server_name">uwsgi_ssl_server_name</a> <br>     <a hhref="#uwsgi_ssl_session_reuse">uwsgi_ssl_session_reuse</a> <br>     <a hhref="#uwsgi_ssl_trusted_certificate">uwsgi_ssl_trusted_certificate</a> <br>     <a hhref="#uwsgi_ssl_verify">uwsgi_ssl_verify</a> <br>     <a hhref="#uwsgi_ssl_verify_depth">uwsgi_ssl_verify_depth</a> <br>     <a hhref="#uwsgi_store">uwsgi_store</a> <br>     <a hhref="#uwsgi_store_access">uwsgi_store_access</a> <br>     <a hhref="#uwsgi_temp_file_write_size">uwsgi_temp_file_write_size</a> <br>     <a hhref="#uwsgi_temp_path">uwsgi_temp_path</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_uwsgi_module</code>模块允许将请求传递给uwsgi服务器。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    include    uwsgi_params;<br>    uwsgi_pass localhost:9000;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="uwsgi_bind"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_bind</strong><br>    <code class="notranslate"><i>address</i></code><br>    [ <code class="notranslate">transparent</code> ] |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  使用可选端口（1.11.2）从指定的本地IP地址发出到uwsgi服务器的传出连接。  参数值可以包含变量（1.3.12）。  特殊值&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; （1.3.12）取消了从先前配置级别继承的&lt;code class=&quot;notranslate&quot;&gt;uwsgi_bind&lt;/code&gt;指令的效果，该指令允许系统自动分配本地IP地址和端口。 &lt;/p&gt;&lt;a name=&quot;uwsgi_bind_transparent&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;transparent&lt;/code&gt;参数（1.11.0）允许到uwsgi服务器的传出连接源自非本地IP地址，例如，来自客户端的真实IP地址： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_bind $remote_addr transparent;
</code></pre><p></p><p>  为了使此参数有效，通常需要使用<a hhref="ngx_core_module.html#user">超级用户</a>权限运行nginx工作进程。  在Linux上，不需要（1.13.8），就像指定了<code class="notranslate">transparent</code>参数一样，工作进程从主进程继承<code class="notranslate">CAP_NET_RAW</code>功能。  还需要配置内核路由表以拦截来自uwsgi服务器的网络流量。 </p><a name="uwsgi_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_buffer_size 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取从uwsgi服务器接收的响应的第一部分的缓冲区的<code class="notranslate"><i>size</i></code> 。  这部分通常包含一个小的响应头。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。  然而，它可以做得更小。 </p><a name="uwsgi_buffering"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_buffering</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_buffering on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用缓冲来自uwsgi服务器的响应。 </p><p>  启用缓冲后，nginx会尽快从uwsgi服务器接收响应，并将其保存到<a hhref="#uwsgi_buffer_size">uwsgi_buffer_size</a>和<a hhref="#uwsgi_buffers">uwsgi_buffers</a>指令设置的缓冲区中。  如果整个响应不适合内存，则可以将其中的一部分保存到磁盘上的<a hhref="#uwsgi_temp_path">临时文件中</a> 。  写入临时文件由<a hhref="#uwsgi_max_temp_file_size">uwsgi_max_temp_file_size</a>和<a hhref="#uwsgi_temp_file_write_size">uwsgi_temp_file_write_size</a>指令控制。 </p><p>  禁用缓冲时，响应会在收到响应时立即同步传递给客户端。   nginx不会尝试从uwsgi服务器读取整个响应。   nginx一次可以从服务器接收的数据的最大大小由<a hhref="#uwsgi_buffer_size">uwsgi_buffer_size</a>指令设置。 </p><p>  也可以通过在“X-Accel-Buffering”响应头字段中传递“ <code class="notranslate">yes</code> ”或“ <code class="notranslate">no</code> ”来启用或禁用缓冲。  可以使用<a hhref="#uwsgi_ignore_headers">uwsgi_ignore_headers</a>指令禁用此功能。 </p><a name="uwsgi_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_buffers 8 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于从uwsgi服务器读取响应的缓冲区的<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> ，用于单个连接。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 </p><a name="uwsgi_busy_buffers_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_busy_buffers_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_busy_buffers_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用<a hhref="#uwsgi_buffering">缓冲</a>来自uwsgi服务器的响应时，限制可能忙于向客户端发送响应的缓冲区的总<code class="notranslate"><i>size</i></code> ，而响应尚未完全读取。  同时，其余的缓冲区可用于读取响应，并在需要时缓冲部分响应临时文件。  默认情况下， <code class="notranslate"><i>size</i></code>受<a hhref="#uwsgi_buffer_size">uwsgi_buffer_size</a>和<a hhref="#uwsgi_buffers">uwsgi_buffers</a>指令设置的两个缓冲区<code class="notranslate"><i>size</i></code>的限制。 </p><a name="uwsgi_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache</strong> <code class="notranslate"><i>zone</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_cache off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于缓存的共享内存区域。  可以在多个地方使用相同的区域。  参数值可以包含变量（1.7.9）。   <code class="notranslate">off</code>参数禁用从先前配置级别继承的高速缓存。 </p><a name="uwsgi_cache_background_update"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_background_update</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_cache_background_update off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.10版中。 </p></div><p>  允许启动后台子请求以更新过期的缓存项，同时将过时的缓存响应返回给客户端。  请注意，在更新时必须<a hhref="#uwsgi_cache_use_stale_updating">允许</a>使用陈旧的缓存响应。 </p><a name="uwsgi_cache_bypass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_bypass</strong> <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义不从缓存中获取响应的条件。  如果字符串参数的至少一个值不为空且不等于“0”，则不会从缓存中获取响应： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_cache_bypass $cookie_nocache $arg_nocache$arg_comment;
</code></pre><p>uwsgi_cache_bypass $http_pragma    $http_authorization;<br></p><p>  可以与<a hhref="#uwsgi_no_cache">uwsgi_no_cache</a>指令一起使用。 </p><a name="uwsgi_cache_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_key</strong> <code class="notranslate"><i>string</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  例如，定义缓存的键 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_cache_key localhost:9000$request_uri;
</code></pre><p></p><p></p><a name="uwsgi_cache_lock"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_lock</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_cache_lock off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  启用后，通过将请求传递给<a hhref="#uwsgi_cache_key">uwsgi</a>服务器，一次只允许一个请求填充根据<a hhref="#uwsgi_cache_key">uwsgi_cache_key</a>指令标识的新缓存元素。  同一缓存元素的其他请求将等待响应出现在缓存中或缓存此元素的缓存锁定，直到<a hhref="#uwsgi_cache_lock_timeout">uwsgi_cache_lock_timeout</a>指令设置的时间。 </p><a name="uwsgi_cache_lock_age"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_lock_age</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_cache_lock_age 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.8版本中。 </p></div><p>  如果传递给uwsgi服务器以填充新缓存元素的最后一个请求在指定<code class="notranslate"><i>time</i></code>内没有完成，则可以将另一个请求传递给uwsgi服务器。 </p><a name="uwsgi_cache_lock_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_lock_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_cache_lock_timeout 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  设置<a hhref="#uwsgi_cache_lock">uwsgi_cache_lock</a>的超时。  当<code class="notranslate"><i>time</i></code>到期时，请求将被传递给uwsgi服务器，但是，响应将不会被缓存。 </p><blockquote class="note">  在1.7.8之前，可以缓存响应。 </blockquote><p></p><a name="uwsgi_cache_max_range_offset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_max_range_offset</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置字节范围请求的偏移量（以字节为单位）。  如果范围超出偏移量，则范围请求将传递给uwsgi服务器，并且不会缓存响应。 &lt;/p&gt;&lt;a name=&quot;uwsgi_cache_methods&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_cache_methods&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_cache_methods GET HEAD;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  如果此指令中列出了客户端请求方法，则将缓存响应。   “ &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; ”方法总是添加到列表中，但建议明确指定它们。  另请参见&lt;a hhref=&quot;#uwsgi_no_cache&quot;&gt;uwsgi_no_cache&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;uwsgi_cache_min_uses&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_cache_min_uses&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_cache_min_uses 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将缓存响应的请求&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;a name=&quot;uwsgi_cache_path&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_cache_path&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;path&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;levels&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;levels&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;use_temp_path&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ]
&lt;code class=&quot;notranslate&quot;&gt;keys_zone&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; : &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;inactive&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;max_size&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置缓存的路径和其他参数。  缓存数据存储在文件中。  缓存中的文件名是将MD5功能应用于&lt;a hhref=&quot;#uwsgi_cache_key&quot;&gt;缓存键的结果&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;levels&lt;/code&gt;参数定义高速缓存的层次结构级别：从1到3，每个级别接受值1或2.例如，在以下配置中 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;
</code></pre><p></p><p>  缓存中的文件名如下所示： </p><blockquote class="example"><pre class="notranslate">/data/nginx/cache/ <strong>c</strong> / <strong>29</strong> /b7f54b2df7773722d382f4809d650 <strong>29c</strong><br></pre></blockquote><p></p><p>  首先将缓存的响应写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和缓存可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，缓存和保存临时文件的目录都放在同一文件系统上。  根据<code class="notranslate">use_temp_path</code>参数（1.7.10）设置临时文件的目录。  如果省略此参数或将其设置为<code class="notranslate">on</code> ，则将使用<a hhref="#uwsgi_temp_path">uwsgi_temp_path</a>指令为给定位置设置的目录。  如果该值设置为<code class="notranslate">off</code> ，则临时文件将直接放入缓存目录中。 </p><p>  此外，所有活动密钥和有关数据的信息都存储在共享内存区域中，其<code class="notranslate"><i>name</i></code>和<code class="notranslate"><i>size</i></code>由<code class="notranslate">keys_zone</code>参数配置。  一兆字节区域可以存储大约8000个密钥。 </p><blockquote class="note">  作为<a hhref="http://nginx.com/products/">商业订阅的</a>一部分，共享存储器区域还存储扩展的高速缓存<a hhref="ngx_http_api_module.html#http_caches_">信息</a> ，因此，需要为相同数量的密钥指定更大的区域大小。  例如，一兆字节区域可以存储大约4000个密钥。 </blockquote><p></p><p>  在<code class="notranslate">inactive</code>参数指定的时间内未访问的缓存数据将从缓存中删除，无论其新鲜度如何。  默认情况下， <code class="notranslate">inactive</code>设置为10分钟。 </p><p>  特殊的“缓存管理器”进程监视<code class="notranslate">max_size</code>参数设置的最大缓存大小。  超过此大小时，它会删除最近最少使用的数据。  在<code class="notranslate">manager_files</code> ， <code class="notranslate">manager_threshold</code>和<code class="notranslate">manager_sleep</code>参数（1.11.5）配置的迭代中删除数据。  在一次迭代期间，不会删除<code class="notranslate">manager_files</code>项（默认情况下为100）。  一次迭代的持续时间受<code class="notranslate">manager_threshold</code>参数限制（默认情况下为200毫秒）。  在迭代之间，由<code class="notranslate">manager_sleep</code>参数（默认为50毫秒）配置的暂停。 </p><p>  启动一分钟后，激活特殊的“缓存加载程序”进程。  它将有关存储在文件系统中的先前缓存数据的信息加载到缓存区。  加载也是在迭代中完成的。  在一次迭代期间，加载的<code class="notranslate">loader_files</code>项目不超过（默认情况下为100）。  此外，一次迭代的持续时间受<code class="notranslate">loader_threshold</code>参数限制（默认为200毫秒）。  在迭代之间，由<code class="notranslate">loader_sleep</code>参数（默认为50毫秒）配置暂停。 </p><p>  此外，以下参数作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供： </p><p></p><dl class="compact"><dt id="purger">   <code class="notranslate">purger</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> </dt><dd>  指示缓存清除程序是否将从磁盘中删除与<a hhref="#uwsgi_cache_purge">通配符密钥</a>匹配的缓存条目（1.7.12）。  将参数设置为<code class="notranslate">on</code> （默认为<code class="notranslate">off</code> ）将激活“cache purger”进程，该进程将永久迭代所有缓存条目并删除与通配符键匹配的条目。 </dd><dt id="purger_files">   <code class="notranslate">purger_files</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置在一次迭代（1.7.12）期间将扫描的项目数。  默认情况下， <code class="notranslate">purger_files</code>设置为10。 </dd><dt id="purger_threshold">   <code class="notranslate">purger_threshold</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置一次迭代的持续时间（1.7.12）。  默认情况下， <code class="notranslate">purger_threshold</code>设置为50毫秒。 </dd><dt id="purger_sleep">   <code class="notranslate">purger_sleep</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置迭代之间的暂停（1.7.12）。  默认情况下， <code class="notranslate">purger_sleep</code>设置为50毫秒。 </dd></dl><p></p><p></p><blockquote class="note">  在版本1.7.3,1.7.7和1.11.10中，缓存头格式已更改。  升级到较新的nginx版本之前，缓存的响应将被视为无效。 </blockquote><p></p><a name="uwsgi_cache_purge"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_purge</strong> string …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义将请求视为缓存清除请求的条件。  如果字符串参数的至少一个值不为空并且不等于“0”，则移除具有相应&lt;a hhref=&quot;#uwsgi_cache_key&quot;&gt;高速缓存键&lt;/a&gt;的高速缓存条目。  通过返回204（无内容）响应来指示成功操作的结果。 &lt;/p&gt;&lt;p&gt;  如果清除请求的&lt;a hhref=&quot;#uwsgi_cache_key&quot;&gt;缓存键&lt;/a&gt;以星号（“ &lt;code class=&quot;notranslate&quot;&gt;*&lt;/code&gt; ”）结尾，则将从缓存中删除与通配符键匹配的所有缓存条目。  但是，这些条目将保留在磁盘上，直到它们被删除&lt;a hhref=&quot;#uwsgi_cache_path&quot;&gt;为非活动状态&lt;/a&gt; ，或由&lt;a hhref=&quot;#purger&quot;&gt;缓存&lt;/a&gt;清除程序（1.7.12）处理，或者客户端尝试访问它们。 &lt;/p&gt;&lt;p&gt;  配置示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_cache_path /data/nginx/cache keys_zone=cache_zone:10m;
</code></pre><p>map $request_method $purge_method {<br>    PURGE   1;<br>    default 0;<br>}</p>
<p>server {<br>    …<br>    location / {<br>        uwsgi_pass        backend;<br>        uwsgi_cache       cache_zone;<br>        uwsgi_cache_key   $uri;<br>        uwsgi_cache_purge $purge_method;<br>    }<br>}<br></p><p></p><blockquote class="note">  此功能作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="uwsgi_cache_revalidate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_revalidate</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_cache_revalidate off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.7版本中。 </p></div><p>  使用具有“If-Modified-Since”和“If-None-Match”标头字段的条件请求启用过期缓存项的重新验证。 </p><a name="uwsgi_cache_use_stale"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_use_stale</strong><br>    <code class="notranslate">error</code> |<br>    <code class="notranslate">timeout</code> |<br>    <code class="notranslate">invalid_header</code> |<br>    <code class="notranslate">updating</code> |<br>    <code class="notranslate">http_500</code> |<br>    <code class="notranslate">http_503</code> |<br>    <code class="notranslate">http_403</code> |<br>    <code class="notranslate">http_404</code> |<br>    <code class="notranslate">http_429</code> |<br>    <code class="notranslate">off</code><br>    …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_cache_use_stale off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  确定在与uwsgi服务器通信期间发生错误时，在哪些情况下可以使用过时的缓存响应。  该指令的参数与<a hhref="#uwsgi_next_upstream">uwsgi_next_upstream</a>指令的参数匹配。 </p><p>  如果无法选择要处理请求的uwsgi服务器，则<code class="notranslate">error</code>参数还允许使用过时的缓存响应。 </p><a name="uwsgi_cache_use_stale_updating"></a><p>  此外，如果当前正在更新，则<code class="notranslate">updating</code>参数允许使用过时的缓存响应。  这允许在更新缓存数据时最小化对uwsgi服务器的访问次数。 </p><p>  在响应变为失效后，也可以在响应头中直接启用过时的缓存响应指定的秒数（1.11.10）。  这比使用指令参数的优先级低。 </p><ul><li>   “Cache-Control”头字段的“ <a hhref="https://tools.ietf.org/html/rfc5861#section-3">stale-while-revalidate</a> ”扩展允许使用陈旧的缓存响应（如果当前正在更新）。 </li><li>   “Cache-Control”头字段的“ <a hhref="https://tools.ietf.org/html/rfc5861#section-4">stale-if-error</a> ”扩展允许在出现错误时使用陈旧的缓存响应。 </li></ul><p></p><p>  要在填充新缓存元素时最小化对uwsgi服务器的访问次数，可以使用<a hhref="#uwsgi_cache_lock">uwsgi_cache_lock</a>指令。 </p><a name="uwsgi_cache_valid"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_cache_valid</strong> [ <code class="notranslate"><i>code</i></code> …] <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置不同响应代码的缓存时间。  例如，以下指令 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_cache_valid 200 302 10m;
</code></pre><p>uwsgi_cache_valid 404      1m;<br></p><p>  为代码为200和302的响应设置10分钟的缓存，为代码404的响应设置1分钟。 </p><p>  如果仅指定了缓存<code class="notranslate"><i>time</i></code> </p><blockquote class="example"><pre class="notranslate">uwsgi_cache_valid 5m;<br></pre></blockquote><p>  然后只缓存200,301和302个响应。 </p><p>  此外，可以指定<code class="notranslate">any</code>参数来缓存任何响应： </p><blockquote class="example"><pre class="notranslate">uwsgi_cache_valid 200 302 10m;<br>uwsgi_cache_valid 301      1h;<br>uwsgi_cache_valid any      1m;<br></pre></blockquote><p></p><p>  缓存的参数也可以直接在响应头中设置。  这比使用该指令设置缓存时间具有更高的优先级。 </p><ul><li>   “X-Accel-Expires”标题字段以秒为单位设置响应的缓存时间。  零值禁用响应的缓存。  如果值以<code class="notranslate">@</code>前缀开头，则设置自Epoch以来的绝对时间（以秒为单位），响应可以高速缓存。 </li><li>  如果标题不包括“X-Accel-Expires”字段，则可以在标题字段“Expires”或“Cache-Control”中设置高速缓存的参数。 </li><li>  如果标头包含“Set-Cookie”字段，则不会缓存此类响应。 </li><li>  如果标题包含具有特殊值“ <code class="notranslate">*</code> ”的“Vary”字段，则不会缓存此类响应（1.7.7）。  如果标题包含具有另一个值的“Vary”字段，则将考虑相应的请求标题字段来缓存这样的响应（1.7.7）。 </li></ul><p>  可以使用<a hhref="#uwsgi_ignore_headers">uwsgi_ignore_headers</a>指令禁用这些响应头字段中的一个或多个的处理。 </p><a name="uwsgi_connect_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_connect_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_connect_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义与uwsgi服务器建立连接的超时。  应该注意，此超时通常不会超过75秒。 </p><a name="uwsgi_force_ranges"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_force_ranges</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_force_ranges off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.7版本中。 </p></div><p>  无论这些响应中的“Accept-Ranges”字段如何，都可以对来自uwsgi服务器的缓存和未缓存响应启用字节范围支持。 </p><a name="uwsgi_hide_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_hide_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  默认情况下，nginx不会从uwsgi服务器对客户端的响应中传递标题字段“Status”和“X-Accel -...”。   &lt;code class=&quot;notranslate&quot;&gt;uwsgi_hide_header&lt;/code&gt;指令设置了不会传递的其他字段。  相反，如果需要允许传递字段，则可以使用&lt;a hhref=&quot;#uwsgi_pass_header&quot;&gt;uwsgi_pass_header&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ignore_client_abort&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ignore_client_abort&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_ignore_client_abort off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定客户端在不等待响应的情况下关闭连接时是否应关闭与uwsgi服务器的连接。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ignore_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ignore_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;field&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  禁用从uwsgi服务器处理某些响应头字段。  可以忽略以下字段：“X-Accel-Redirect”，“X-Accel-Expires”，“X-Accel-Limit-Rate”（1.1.6），“X-Accel-Buffering”（1.1.6） ，“X-Accel-Charset”（1.1.6），“Expires”，“Cache-Control”，“Set-Cookie”（0.8.44）和“Vary”（1.7.7）。 &lt;/p&gt;&lt;p&gt;  如果未禁用，则处理这些标头字段会产生以下影响： &lt;/p&gt;&lt;ul&gt;&lt;li&gt;   “X-Accel-Expires”，“Expires”，“Cache-Control”，“Set-Cookie”和“Vary”设置响应&lt;a hhref=&quot;#uwsgi_cache_valid&quot;&gt;缓存&lt;/a&gt;的参数; &lt;/li&gt;&lt;li&gt;   “X-Accel-Redirect”执行&lt;a hhref=&quot;ngx_http_core_module.html#internal&quot;&gt;内部重定向&lt;/a&gt;到指定的URI; &lt;/li&gt;&lt;li&gt;   “X-Accel-Limit-Rate”设置向客户端传输响应的&lt;a hhref=&quot;ngx_http_core_module.html#limit_rate&quot;&gt;速率限制&lt;/a&gt; ; &lt;/li&gt;&lt;li&gt;   “X-Accel-Buffering”启用或禁用&lt;a hhref=&quot;#uwsgi_buffering&quot;&gt;缓冲&lt;/a&gt;响应; &lt;/li&gt;&lt;li&gt;   “X-Accel-Charset”设置了所需的响应&lt;a hhref=&quot;ngx_http_charset_module.html#charset&quot;&gt;字符集&lt;/a&gt; 。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;uwsgi_intercept_errors&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_intercept_errors&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_intercept_errors off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定代码大于或等于300的uwsgi服务器响应是应该传递给客户端还是被拦截并重定向到nginx以便使用&lt;a hhref=&quot;ngx_http_core_module.html#error_page&quot;&gt;error_page&lt;/a&gt;指令进行处理。 &lt;/p&gt;&lt;a name=&quot;uwsgi_limit_rate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_limit_rate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;rate&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_limit_rate 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制从uwsgi服务器读取响应的速度。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;rate&lt;/i&gt;&lt;/code&gt;以每秒字节数指定。  零值禁用速率限制。  根据请求设置限制，因此如果nginx同时打开两个到uwsgi服务器的连接，则总速率将是指定限制的两倍。  仅当启用了来自uwsgi服务器的响应&lt;a hhref=&quot;#uwsgi_buffering&quot;&gt;缓冲时&lt;/a&gt; ，该限制才有效。 &lt;/p&gt;&lt;a name=&quot;uwsgi_max_temp_file_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_max_temp_file_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_max_temp_file_size 1024m;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  当启用&lt;a hhref=&quot;#uwsgi_buffering&quot;&gt;缓冲&lt;/a&gt;来自uwsgi服务器的响应，并且整个响应不适合&lt;a hhref=&quot;#uwsgi_buffer_size&quot;&gt;uwsgi_buffer_size&lt;/a&gt;和&lt;a hhref=&quot;#uwsgi_buffers&quot;&gt;uwsgi_buffers&lt;/a&gt;指令设置的缓冲区时，响应的一部分可以保存到临时文件中。  该指令设置临时文件的最大&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  一次写入临时文件的数据大小由&lt;a hhref=&quot;#uwsgi_temp_file_write_size&quot;&gt;uwsgi_temp_file_write_size&lt;/a&gt;指令设置。 &lt;/p&gt;&lt;p&gt;  零值禁用缓冲对临时文件的响应。 &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  此限制不适用于将&lt;a hhref=&quot;#uwsgi_cache&quot;&gt;缓存&lt;/a&gt;或&lt;a hhref=&quot;#uwsgi_store&quot;&gt;存储&lt;/a&gt;在磁盘上的响应。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;uwsgi_modifier1&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_modifier1&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_modifier1 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置&lt;a hhref=&quot;http://uwsgi-docs.readthedocs.org/en/latest/Protocol.html#uwsgi-packet-header&quot;&gt;uwsgi数据包标头中&lt;/a&gt; &lt;code class=&quot;notranslate&quot;&gt;modifier1&lt;/code&gt;字段的&lt;a hhref=&quot;http://uwsgi-docs.readthedocs.org/en/latest/Protocol.html#uwsgi-packet-header&quot;&gt;值&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;uwsgi_modifier2&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_modifier2&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_modifier2 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置&lt;a hhref=&quot;http://uwsgi-docs.readthedocs.org/en/latest/Protocol.html#uwsgi-packet-header&quot;&gt;uwsgi数据包标头中&lt;/a&gt; &lt;code class=&quot;notranslate&quot;&gt;modifier2&lt;/code&gt;字段的&lt;a hhref=&quot;http://uwsgi-docs.readthedocs.org/en/latest/Protocol.html#uwsgi-packet-header&quot;&gt;值&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;uwsgi_next_upstream&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_next_upstream&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;non_idempotent&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_next_upstream error timeout;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定应将请求传递到下一个服务器的情况： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与服务器建立连接，向其传递请求或读取响应头时发生错误; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  在与服务器建立连接，向其传递请求或读取响应头时发生超时; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回空或无效响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为500的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为503的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为403的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为404的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为429的响应（1.11.13）; &lt;/dd&gt;&lt;dt id=&quot;non_idempotent&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;non_idempotent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  通常，如果请求已发送到上游服务器，则使用&lt;a hhref=&quot;https://tools.ietf.org/html/rfc7231#section-4.2.2&quot;&gt;非幂等&lt;/a&gt;方法（ &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;LOCK&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; ）的请求不会传递给下一个服务器（1.9.13）;  启用此选项显式允许重试此类请求; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  禁用将请求传递给下一个服务器。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  应该记住，只有在尚未向客户端发送任何内容的情况下，才能将请求传递给下一个服务器。  也就是说，如果在传输响应的过程中发生错误或超时，则无法修复此问题。 &lt;/p&gt;&lt;p&gt;  该指令还定义了与服务器通信的&lt;a hhref=&quot;ngx_http_upstream_module.html#max_fails&quot;&gt;不成功尝试&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt;情况始终被视为不成功的尝试，即使它们未在指令中指定。   &lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt;情况仅在指令中指定&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt;被视为不成功尝试。   &lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt;情况从未被视为不成功的尝试。 &lt;/p&gt;&lt;p&gt;  将请求传递到下一个服务器可能会受到&lt;a hhref=&quot;#uwsgi_next_upstream_tries&quot;&gt;尝试次数&lt;/a&gt;和&lt;a hhref=&quot;#uwsgi_next_upstream_timeout&quot;&gt;时间的限制&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;uwsgi_next_upstream_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_next_upstream_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_next_upstream_timeout 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.5版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制请求可以传递到&lt;a hhref=&quot;#uwsgi_next_upstream&quot;&gt;下一个服务器的时间&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;uwsgi_next_upstream_tries&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_next_upstream_tries&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_next_upstream_tries 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.5版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制将请求传递到&lt;a hhref=&quot;#uwsgi_next_upstream&quot;&gt;下一个服务器&lt;/a&gt;的可能尝试次数。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;uwsgi_no_cache&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_no_cache&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义不将响应保存到缓存的条件。  如果字符串参数的至少一个值不为空且不等于“0”，则不会保存响应： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_no_cache $cookie_nocache $arg_nocache$arg_comment;
</code></pre><p>uwsgi_no_cache $http_pragma    $http_authorization;<br></p><p>  可以与<a hhref="#uwsgi_cache_bypass">uwsgi_cache_bypass</a>指令一起使用。 </p><a name="uwsgi_param"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_param</strong><br>    <code class="notranslate"><i>parameter</i></code> <code class="notranslate"><i>value</i></code><br>    [ <code class="notranslate">if_not_empty</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置应传递给uwsgi服务器的参数。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;uwsgi_param&lt;/code&gt;指令时，这些指令才从先前级别继承。 &lt;/p&gt;&lt;p&gt;  标准&lt;a hhref=&quot;https://tools.ietf.org/html/rfc3875#section-4.1&quot;&gt;CGI环境变量&lt;/a&gt;应作为uwsgi标头提供，请参阅分发中提供的&lt;code class=&quot;notranslate&quot;&gt;uwsgi_params&lt;/code&gt;文件： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location / {
include uwsgi_params;
...
</code></pre><p>}<br></p><p></p><p>  如果使用<code class="notranslate">if_not_empty</code> （1.1.11）指定了该指令，则只有在其值不为空时，才会将此参数传递给服务器： </p><blockquote class="example"><pre class="notranslate">uwsgi_param HTTPS $https if_not_empty;<br></pre></blockquote><p></p><a name="uwsgi_pass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_pass</strong> [ <code class="notranslate"><i>protocol</i></code> ://] <code class="notranslate"><i>address</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置uwsgi服务器的协议和地址。  作为&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;protocol&lt;/i&gt;&lt;/code&gt; ，可以指定“ &lt;code class=&quot;notranslate&quot;&gt;suwsgi&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;suwsgi&lt;/code&gt; ”（安全的&lt;code class=&quot;notranslate&quot;&gt;suwsgi&lt;/code&gt; over SSL）。  地址可以指定为域名或IP地址，以及端口： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_pass localhost:9000;
</code></pre><p>uwsgi_pass uwsgi://localhost:9000;<br>uwsgi_pass suwsgi://[2001:db8::1]:9090;<br></p><p>  或者作为UNIX域套接字路径： </p><blockquote class="example"><pre class="notranslate">uwsgi_pass unix:/tmp/uwsgi.socket;<br></pre></blockquote><p></p><p>  如果域名解析为多个地址，则所有这些地址都将以循环方式使用。  此外，可以将地址指定为<a hhref="ngx_http_upstream_module.html">服务器组</a> 。 </p><p>  参数值可以包含变量。  在这种情况下，如果将地址指定为域名，则在所描述的<a hhref="ngx_http_upstream_module.html">服务器组中</a>搜索名称，如果未找到，则使用<a hhref="ngx_http_core_module.html#resolver">解析器</a>确定。 </p><p></p><blockquote class="note">  从版本1.5.8开始支持安全的uwsgi协议。 </blockquote><p></p><a name="uwsgi_pass_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_pass_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将来自uwsgi服务器的&lt;a hhref=&quot;#uwsgi_hide_header&quot;&gt;其他禁用的&lt;/a&gt;头字段传递给客户端。 &lt;/p&gt;&lt;a name=&quot;uwsgi_pass_request_body&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_pass_request_body&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_pass_request_body on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指示是否将原始请求正文传递给uwsgi服务器。  另请参见&lt;a hhref=&quot;#uwsgi_pass_request_headers&quot;&gt;uwsgi_pass_request_headers&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;uwsgi_pass_request_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_pass_request_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_pass_request_headers on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指示原始请求的标头字段是否传递给uwsgi服务器。  另请参见&lt;a hhref=&quot;#uwsgi_pass_request_body&quot;&gt;uwsgi_pass_request_body&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;uwsgi_read_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_read_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_read_timeout 60s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义从uwsgi服务器读取响应的超时。  仅在两个连续的读操作之间设置超时，而不是为整个响应的传输。  如果uwsgi服务器在此时间内未传输任何内容，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;uwsgi_request_buffering&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_request_buffering&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_request_buffering on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用客户端请求正文的缓冲。 &lt;/p&gt;&lt;p&gt;  启用缓冲后，在将请求发送到uwsgi服务器之前，将从客户端&lt;a hhref=&quot;ngx_http_core_module.html#client_body_buffer_size&quot;&gt;读取&lt;/a&gt;整个请求正文。 &lt;/p&gt;&lt;p&gt;  禁用缓冲时，请求主体在收到时立即发送到uwsgi服务器。  在这种情况下，如果nginx已经开始发送请求主体，则无法将请求传递给&lt;a hhref=&quot;#uwsgi_next_upstream&quot;&gt;下一个服务器&lt;/a&gt; 。 &lt;/p&gt;&lt;p&gt;  当使用HTTP / 1.1分块传输编码来发送原始请求主体时，无论指令值如何，都将缓冲请求主体。 &lt;/p&gt;&lt;a name=&quot;uwsgi_send_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_send_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_send_timeout 60s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将请求传输到uwsgi服务器的超时。  仅在两个连续的写操作之间设置超时，而不是为整个请求的传输。  如果uwsgi服务器在此时间内未收到任何内容，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;uwsgi_socket_keepalive&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_socket_keepalive&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_socket_keepalive off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  为uwsgi服务器的传出连接配置“TCP keepalive”行为。  默认情况下，操作系统的设置对套接字有效。  如果指令设置为值“ &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; ”，则为套接字打开&lt;code class=&quot;notranslate&quot;&gt;SO_KEEPALIVE&lt;/code&gt;套接字选项。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_certificate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_certificate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该证书用于对安全的uwsgi服务器进行身份验证。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_certificate_key&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_certificate_key&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于对安全的uwsgi服务器进行身份验证。 &lt;/p&gt;&lt;p&gt;  可以指定value &lt;code class=&quot;notranslate&quot;&gt;engine&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;而不是&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; （1.7.9），该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;从OpenSSL引擎&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;加载具有指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;密钥。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_ciphers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_ciphers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ciphers&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_ssl_ciphers DEFAULT;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定对安全的uwsgi服务器的请求的启用密码。  密码以OpenSSL库理解的格式指定。 &lt;/p&gt;&lt;p&gt;  可以使用“ &lt;code class=&quot;notranslate&quot;&gt;openssl ciphers&lt;/code&gt; ”命令查看完整列表。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_crl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_crl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的已吊销证书（CRL）的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#uwsgi_ssl_verify&quot;&gt;验证&lt;/a&gt;受保护的uwsgi服务器的证书。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_ssl_name host from uwsgi_pass;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  允许覆盖用于&lt;a hhref=&quot;#uwsgi_ssl_verify&quot;&gt;验证&lt;/a&gt;安全uwsgi服务器证书的服务器名称，并在与安全uwsgi服务器建立连接时&lt;a hhref=&quot;#uwsgi_ssl_server_name&quot;&gt;通过SNI&lt;/a&gt;传递。 &lt;/p&gt;&lt;p&gt;  默认情况下，使用&lt;a hhref=&quot;#uwsgi_pass&quot;&gt;uwsgi_pass&lt;/a&gt;的主机部分。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_password_file&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_password_file&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有密钥密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_protocols&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_protocols&lt;/strong&gt; 
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv3&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.3&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  为安全的uwsgi服务器启用指定的协议。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_server_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_server_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_ssl_server_name off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  在与安全的uwsgi服务器建立连接时，启用或禁用通过&lt;a hhref=&quot;http://en.wikipedia.org/wiki/Server_Name_Indication&quot;&gt;TLS服务器名称指示扩展&lt;/a&gt; （SNI，RFC 6066）传递服务器名称。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_session_reuse&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_session_reuse&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_ssl_session_reuse on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  确定在使用安全的uwsgi服务器时是否可以重用SSL会话。  如果日志中出现“ &lt;code class=&quot;notranslate&quot;&gt;SSL3_GET_FINISHED:digest check failed&lt;/code&gt; ”错误，请尝试禁用会话重用。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_trusted_certificate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_trusted_certificate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#uwsgi_ssl_verify&quot;&gt;验证&lt;/a&gt;安全uwsgi服务器的证书。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_verify&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_verify&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_ssl_verify off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用安全uwsgi服务器证书的验证。 &lt;/p&gt;&lt;a name=&quot;uwsgi_ssl_verify_depth&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_ssl_verify_depth&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_ssl_verify_depth 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  在安全的uwsgi服务器证书链中设置验证深度。 &lt;/p&gt;&lt;a name=&quot;uwsgi_store&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uwsgi_store&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uwsgi_store off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将文件保存到磁盘。   &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt;参数使用与指令&lt;a hhref=&quot;ngx_http_core_module.html#alias&quot;&gt;别名&lt;/a&gt;或&lt;a hhref=&quot;ngx_http_core_module.html#root&quot;&gt;root&lt;/a&gt;对应的路径保存文件。   &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;参数禁用文件保存。  此外，可以使用带变量的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt;显式设置文件名： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;uwsgi_store /data/www$original_uri;
</code></pre><p></p><p></p><p>  根据接收到的“Last-Modified”响应头字段设置文件的修改时间。  首先将响应写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和持久性存储可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，保存的文件和保存临时文件的目录（由<a hhref="#uwsgi_temp_path">uwsgi_temp_path</a>指令设置）都放在同一文件系统上。 </p><p>  该指令可用于创建静态不可更改文件的本地副本，例如： </p><blockquote class="example"><pre class="notranslate">location /images/ {<br>    root               /data/www;<br>    error_page         404 = /fetch$uri;<br>}<p></p>
<p>location /fetch/ {<br>    internal;</p>
<pre><code>uwsgi_pass         backend:9000;
...

uwsgi_store        on;
uwsgi_store_access user:rw group:rw all:r;
uwsgi_temp_path    /data/temp;

alias              /data/www/;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="uwsgi_store_access"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_store_access</strong> <code class="notranslate"><i>users</i></code> : <code class="notranslate"><i>permissions</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_store_access user:rw;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  为新创建的文件和目录设置访问权限，例如： </p><blockquote class="example"><pre class="notranslate">uwsgi_store_access user:rw group:rw all:r;<br></pre></blockquote><p></p><p>  如果指定了任何<code class="notranslate">group</code>或<code class="notranslate">all</code>访问权限，则可以省略<code class="notranslate">user</code>权限： </p><blockquote class="example"><pre class="notranslate">uwsgi_store_access group:rw all:r;<br></pre></blockquote><p></p><a name="uwsgi_temp_file_write_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_temp_file_write_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_temp_file_write_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用从uwsgi服务器到临时文件的响应缓冲时，限制一次写入临时文件的数据<code class="notranslate"><i>size</i></code> 。  默认情况下， <code class="notranslate"><i>size</i></code>受<a hhref="#uwsgi_buffer_size">uwsgi_buffer_size</a>和<a hhref="#uwsgi_buffers">uwsgi_buffers</a>指令设置的两个缓冲区限制。  临时文件的最大大小由<a hhref="#uwsgi_max_temp_file_size">uwsgi_max_temp_file_size</a>指令设置。 </p><a name="uwsgi_temp_path"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>uwsgi_temp_path</strong><br>    <code class="notranslate"><i>path</i></code><br>    [ <code class="notranslate"><i>level1</i></code><br>    [ <code class="notranslate"><i>level2</i></code><br>    [ <code class="notranslate"><i>level3</i></code> ]]];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">uwsgi_temp_path uwsgi_temp;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于存储临时文件的目录，其中包含从uwsgi服务器接收的数据。  在指定目录下最多可以使用三级子目录层次结构。  例如，在以下配置中 </p><blockquote class="example"><pre class="notranslate">uwsgi_temp_path /spool/nginx/uwsgi_temp 1 2;<br></pre></blockquote><p>  临时文件可能如下所示： </p><blockquote class="example"><pre class="notranslate">/spool/nginx/uwsgi_temp/ <strong>7</strong> / <strong>45</strong> /00000123 <strong>457</strong><br></pre></blockquote><p></p><p>  另请参见<a hhref="#uwsgi_cache_path">uwsgi_cache_path</a>指令的<code class="notranslate">use_temp_path</code>参数。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_userid_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_userid_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#userid">userid</a> <br>     <a hhref="#userid_domain">userid_domain</a> <br>     <a hhref="#userid_expires">userid_expires</a> <br>     <a hhref="#userid_mark">userid_mark</a> <br>     <a hhref="#userid_name">userid_name</a> <br>     <a hhref="#userid_p3p">userid_p3p</a> <br>     <a hhref="#userid_path">userid_path</a> <br>     <a hhref="#userid_service">userid_service</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_userid_module</code>模块设置适合客户端识别的cookie。  可以使用嵌入变量<a hhref="#var_uid_got">$ uid_got</a>和<a hhref="#var_uid_set">$ uid_set</a>记录已接收和设置的cookie。  该模块与Apache的<a hhref="http://www.lexa.ru/programs/mod-uid-eng.html">mod_uid</a>模块兼容。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">userid         on;<br>userid_name    uid;<br>userid_domain  example.com;<br>userid_path    /;<br>userid_expires 365d;<br>userid_p3p     ‘policyref=”/w3c/p3p.xml”, CP=”CUR ADM OUR NOR STA NID”‘;<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="userid"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>userid</strong><br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">v1</code> |<br>    <code class="notranslate">log</code> |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">userid off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用设置cookie并记录收到的cookie： </p><dl class="compact"><dt> <code class="notranslate">on</code> </dt> <dd>  可以设置版本2 cookie并记录收到的cookie; </dd><dt> <code class="notranslate">v1</code> </dt> <dd>  可以设置版本1 cookie并记录收到的cookie; </dd><dt> <code class="notranslate">log</code> </dt> <dd>  禁用cookie的设置，但允许记录收到的cookie; </dd><dt> <code class="notranslate">off</code> </dt> <dd>  禁用cookie的设置和记录收到的cookie。 </dd></dl><p></p><a name="userid_domain"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>userid_domain</strong> <code class="notranslate"><i>name</i></code> | <code class="notranslate">none</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">userid_domain none;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义为其设置cookie的域。   <code class="notranslate">none</code>参数禁用cookie的域设置。 </p><a name="userid_expires"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>userid_expires</strong> <code class="notranslate"><i>time</i></code> | <code class="notranslate">max</code> |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">userid_expires off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置浏览器保留cookie的时间。  参数<code class="notranslate">max</code>将导致cookie在“ <code class="notranslate">31 Dec 2037 23:55:55 GMT</code> ”到期。  参数<code class="notranslate">off</code>将导致cookie在浏览器会话结束时到期。 </p><a name="userid_mark"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>userid_mark</strong><br>    <code class="notranslate"><i>letter</i></code> | <code class="notranslate"><i>digit</i></code> |<br>    <code class="notranslate">=</code> |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">userid_mark off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  如果参数未<code class="notranslate">off</code> ，则启用cookie标记机制并设置用作标记的字符。  此机制用于在保留客户端标识符的同时添加或更改<a hhref="#userid_p3p">userid_p3p</a>和/或cookie过期时间。  标记可以是英文字母（区分大小写），数字或“ <code class="notranslate">=</code> ”字符的任何字母。 </p><p>  如果设置了标记，则将其与cookie中传递的客户端标识符的base64表示中的第一个填充符号进行比较。  如果它们不匹配，则会使用指定的标记，到期时间和“P3P”标头重新发送cookie。 </p><a name="userid_name"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>userid_name</strong> <code class="notranslate"><i>name</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">userid_name uid;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置cookie名称。 </p><a name="userid_p3p"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>userid_p3p</strong> <code class="notranslate"><i>string</i></code> | <code class="notranslate">none</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">userid_p3p none;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置将与cookie一起发送的“P3P”标题字段的值。  如果指令设置为特殊值<code class="notranslate">none</code> ，则不会在响应中发送“P3P”标头。 </p><a name="userid_path"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>userid_path</strong> <code class="notranslate"><i>path</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">userid_path /;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义cookie的设置路径。 </p><a name="userid_service"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>userid_service</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">userid_service IP address of the server;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  如果标识符由多个服务器（服务）发出，则应为每个服务分配其自己的<code class="notranslate"><i>number</i></code>以确保客户端标识符是唯一的。  对于版本1 cookie，默认值为零。  对于版本2 cookie，默认值是由服务器IP地址的最后四个八位字节组成的数字。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_userid_module</code>模块支持以下嵌入变量： </p><dl class="compact"><dt id="var_uid_got"> <code class="notranslate">$uid_got</code> </dt> <dd>   Cookie名称和已接收的客户端标识符。 </dd><dt id="var_uid_reset"> <code class="notranslate">$uid_reset</code> </dt> <dd>  如果变量设置为非空字符串不是“ <code class="notranslate">0</code> ”，则重置客户端标识符。  特殊值“ <code class="notranslate">log</code> ”还导致将关于重置标识符的消息输出到<a hhref="ngx_core_module.html#error_log">error_log</a> 。 </dd><dt id="var_uid_set"> <code class="notranslate">$uid_set</code> </dt> <dd>   Cookie名称和已发送的客户端标识符。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_upstream_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_upstream_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#upstream">upstream</a> <br>     <a hhref="#server">server</a> <br>     <a hhref="#zone">zone</a> <br>     <a hhref="#state">state</a> <br>     <a hhref="#hash">hash</a> <br>     <a hhref="#ip_hash">ip_hash</a> <br>     <a hhref="#keepalive">keepalive</a> <br>     <a hhref="#keepalive_requests">keepalive_requests</a> <br>     <a hhref="#keepalive_timeout">keepalive_timeout</a> <br>     <a hhref="#ntlm">ntlm</a> <br>     <a hhref="#least_conn">least_conn</a> <br>     <a hhref="#least_time">least_time</a> <br>     <a hhref="#queue">queue</a> <br>     <a hhref="#random">random</a> <br>     <a hhref="#sticky">sticky</a> <br>     <a hhref="#sticky_cookie_insert">sticky_cookie_insert</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_upstream_module</code>模块用于定义可由<a hhref="ngx_http_proxy_module.html#proxy_pass">proxy_pass</a> ， <a hhref="ngx_http_fastcgi_module.html#fastcgi_pass">fastcgi_pass</a> ， <a hhref="ngx_http_uwsgi_module.html#uwsgi_pass">uwsgi_pass</a> ， <a hhref="ngx_http_scgi_module.html#scgi_pass">scgi_pass</a> ， <a hhref="ngx_http_memcached_module.html#memcached_pass">memcached_pa​​ss</a>和<a hhref="ngx_http_grpc_module.html#grpc_pass">grpc_pass</a>指令引用的服务器组。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">upstream <strong>backend</strong> {<br>    server backend1.example.com       weight=5;<br>    server backend2.example.com:8080;<br>    server unix:/tmp/backend3;<p></p>
<pre><code>server backup1.example.com:8080   backup;
server backup2.example.com:8080   backup;
</code></pre><p>}</p>
<p>server {<br>    location / {<br>        proxy_pass http:// <strong>backend</strong> ;<br>    }<br>}<br></p></pre></blockquote><p></p><p>  具有定期<a hhref="ngx_http_upstream_hc_module.html">运行状况检查的</a>动态可配置组可作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分： </p><blockquote class="example"><pre class="notranslate">resolver 10.0.0.1;<p></p>
<p>upstream <strong>dynamic</strong> {<br>    zone upstream_dynamic 64k;</p>
<pre><code>server backend1.example.com      weight=5;
server backend2.example.com:8080 fail_timeout=5s slow_start=30s;
server 192.0.2.1                 max_fails=3;
server backend3.example.com      resolve;
server backend4.example.com      service=http resolve;

server backup1.example.com:8080  backup;
server backup2.example.com:8080  backup;
</code></pre><p>}</p>
<p>server {<br>    location / {<br>        proxy_pass http:// <strong>dynamic</strong> ;<br>        health_check;<br>    }<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="upstream"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>upstream</strong> <code class="notranslate"><i>name</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义一组服务器。  服务器可以侦听不同的端口。  此外，可以混合侦听TCP和UNIX域套接字的服务器。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;upstream backend {
server backend1.example.com weight=5;
server 127.0.0.1:8080       max_fails=3 fail_timeout=30s;
server unix:/tmp/backend3;

server backup1.example.com  backup;
</code></pre><p>}<br></p><p></p><p>  默认情况下，使用加权循环平衡方法在服务器之间分配请求。  在上面的示例中，每个7个请求将按如下方式分发：5个请求转到<code class="notranslate">backend1.example.com</code> ，1个请求转发给第二个和第三个服务器。  如果在与服务器通信期间发生错误，请求将被传递到下一个服务器，依此类推，直到将尝试所有正常运行的服务器。  如果无法从任何服务器获得成功的响应，则客户端将接收与最后一个服务器的通信结果。 </p><a name="server"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server</strong> <code class="notranslate"><i>address</i></code> [ <code class="notranslate"><i>parameters</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义服务器的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt;和其他&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameters&lt;/i&gt;&lt;/code&gt; 。  可以将地址指定为域名或IP地址，带有可选端口，或者指定为“ &lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt; ”前缀后指定的UNIX域套接字路径。  如果未指定端口，则使用端口80。  解析为多个IP地址的域名一次定义多个服务器。 &lt;/p&gt;&lt;p&gt;  可以定义以下参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;weight&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;weight&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置服务器的权重，默认为1。 &lt;/dd&gt;&lt;dt id=&quot;max_conns&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  限制与代理服务器的最大并发活动连接&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; （1.11.5）。  默认值为零，表示没有限制。  如果服务器组不驻留在&lt;a hhref=&quot;#zone&quot;&gt;共享内存中&lt;/a&gt; ，则每个工作进程的限制都有效。 &lt;blockquote class=&quot;note&quot;&gt;  如果启用了&lt;a hhref=&quot;#keepalive&quot;&gt;空闲keepalive&lt;/a&gt;连接，多个&lt;a hhref=&quot;ngx_core_module.html#worker_processes&quot;&gt;工作程序&lt;/a&gt;和&lt;a hhref=&quot;#zone&quot;&gt;共享内存&lt;/a&gt; ，则代理服务器的活动和空闲连接总数可能会超过&lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt;值。 &lt;/blockquote&gt;&lt;blockquote class=&quot;note&quot;&gt;  自版本1.5.9和版本1.11.5之前，此参数作为我们的&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分提供。 &lt;/blockquote&gt;&lt;/dd&gt;&lt;dt id=&quot;max_fails&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;max_fails&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置在&lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt;参数设置的持续时间内发生的与服务器通信的不成功尝试次数，以考虑服务器在&lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt;参数设置的持续时间内不可用。  默认情况下，不成功尝试次数设置为1.零值禁用尝试的计费。  被认为是不成功的尝试由&lt;a hhref=&quot;ngx_http_proxy_module.html#proxy_next_upstream&quot;&gt;proxy_next_upstream&lt;/a&gt; ， &lt;a hhref=&quot;ngx_http_fastcgi_module.html#fastcgi_next_upstream&quot;&gt;fastcgi_next_upstream&lt;/a&gt; ， &lt;a hhref=&quot;ngx_http_uwsgi_module.html#uwsgi_next_upstream&quot;&gt;uwsgi_next_upstream&lt;/a&gt; ， &lt;a hhref=&quot;ngx_http_scgi_module.html#scgi_next_upstream&quot;&gt;scgi_next_upstream&lt;/a&gt; ， &lt;a hhref=&quot;ngx_http_memcached_module.html#memcached_next_upstream&quot;&gt;memcached_next_upstream&lt;/a&gt;和&lt;a hhref=&quot;ngx_http_grpc_module.html#grpc_next_upstream&quot;&gt;grpc_next_upstream&lt;/a&gt;指令定义。 &lt;/dd&gt;&lt;dt id=&quot;fail_timeout&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  套 &lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;  指定数量的不成功尝试与服务器通信的时间应该考虑服务器不可用; &lt;/li&gt;&lt;li&gt;  以及服务器被视为不可用的时间段。 &lt;/li&gt;&lt;/ul&gt;  默认情况下，参数设置为10秒。 &lt;/dd&gt;&lt;dt id=&quot;backup&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;backup&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  将服务器标记为备份服务器。  当主服务器不可用时，它将被传递请求。 &lt;/dd&gt;&lt;dt id=&quot;down&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;down&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  将服务器标记为永久不可用。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  此外，以下参数作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分提供： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;resolve&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;resolve&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  监视与服务器域名对应的IP地址的更改，并自动修改上游配置，而无需重新启动nginx（1.5.12）。  服务器组必须驻留在&lt;a hhref=&quot;#zone&quot;&gt;共享内存中&lt;/a&gt; 。 &lt;p&gt;  要使此参数起作用，必须在&lt;a hhref=&quot;ngx_http_core_module.html#http&quot;&gt;http&lt;/a&gt;块中指定&lt;a hhref=&quot;ngx_http_core_module.html#resolver&quot;&gt;解析程序&lt;/a&gt;指令。  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;http {
resolver 10.0.0.1;

upstream u {
    zone ...;
    ...
    server example.com resolve;
}
</code></pre><p>}<br></p><p></p><dt id="route">   <code class="notranslate">route</code> = <code class="notranslate"><i>string</i></code> </dt><dd>  设置服务器路由名称。 </dd><dt id="service">   <code class="notranslate">service</code> = <code class="notranslate"><i>name</i></code> </dt><dd>  能够解析DNS <a hhref="https://tools.ietf.org/html/rfc2782">SRV</a>记录并设置服务<code class="notranslate"><i>name</i></code> （1.9.13）。  要使此参数起作用，必须为服务器指定<a hhref="#resolve">resolve</a>参数并指定不带端口号的主机名。 <p>  如果服务名称不包含点（“ <code class="notranslate">.</code> ”），则构造符合<a hhref="https://tools.ietf.org/html/rfc2782">RFC</a>的名称，并将TCP协议添加到服务前缀。  例如，要查找<code class="notranslate">_http._tcp.backend.example.com</code> SRV记录，必须指定该指令： </p><blockquote class="example"><pre class="notranslate">server backend.example.com service=http resolve;<br></pre></blockquote><p>  如果服务名称包含一个或多个点，则通过加入服务前缀和服务器名称来构造名称。  例如，要查找<code class="notranslate">_http._tcp.backend.example.com</code>和<code class="notranslate">server1.backend.example.com</code> SRV记录，必须指定指令： </p><blockquote class="example"><pre class="notranslate">server backend.example.com service=_http._tcp resolve;<br>server example.com service=server1.backend resolve;<br></pre></blockquote><p></p><p>  最高优先级SRV记录（具有相同最低优先级值的记录）将被解析为主服务器，其余SRV记录将被解析为备份服务器。  如果为服务器指定了<a hhref="#backup">backup</a>参数，则高优先级SRV记录将解析为备份服务器，其余SRV记录将被忽略。 </p></dd><dt id="slow_start">   <code class="notranslate">slow_start</code> = <code class="notranslate"><i>time</i></code> </dt><dd>  设置服务器将其权重从零恢复到标称值的时间，当不健康的服务器变得<a hhref="ngx_http_upstream_hc_module.html#health_check">健康时</a> ，或者服务器在一段时间被认为<a hhref="#fail_timeout">不可用</a>后变得可用时。  默认值为零，即禁用慢启动。 <blockquote class="note">  该参数不能与<a hhref="#hash">hash</a>和<a hhref="#ip_hash">ip_hash</a>负载平衡方法一起使用。 </blockquote></dd><dt id="drain"> <code class="notranslate">drain</code> </dt> <dd>  使服务器进入“排水”模式（1.13.6）。  在此模式下，只有<a hhref="#sticky">绑定</a>到服务器的请求才会被代理。 <blockquote class="note">  在1.13.6版之前，只能使用<a hhref="ngx_http_api_module.html">API</a>模块更改参数。 </blockquote></dd><p></p><p></p><blockquote class="note">  如果组中只有一个服务器，则忽略<code class="notranslate">max_fails</code> ， <code class="notranslate">fail_timeout</code>和<code class="notranslate">slow_start</code>参数，并且永远不会将此类服务器视为不可用。 </blockquote><p></p><a name="zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>zone</strong> <code class="notranslate"><i>name</i></code> [ <code class="notranslate"><i>size</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义共享内存区域的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ，该区域保持组工作进程之间共享的组配置和运行时状态。  几个组可能共享同一个区域。  在这种情况下，仅指定一次&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;就足够了。 &lt;/p&gt;&lt;p&gt;  此外，作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分，此类组允许更改组成员身份或修改特定服务器的设置，而无需重新启动nginx。  可通过&lt;a hhref=&quot;ngx_http_api_module.html&quot;&gt;API&lt;/a&gt;模块（1.13.3）访问该配置。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.13.3版之前，只能通过&lt;a hhref=&quot;ngx_http_upstream_conf_module.html#upstream_conf&quot;&gt;upstream_conf&lt;/a&gt;处理的特殊位置访问配置。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;state&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;state&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.7版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定保持动态可配置组状态的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  例子： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;state /var/lib/nginx/state/servers.conf; # path for Linux
</code></pre><p>state /var/db/nginx/state/servers.conf;  # path for FreeBSD<br></p><p></p><p>  该状态目前仅限于具有其参数的服务器列表。  解析配置时会读取文件，每次<a hhref="ngx_http_api_module.html#http_upstreams_http_upstream_name_servers_">更改</a>上游配置时都会更新该文件。  应避免直接更改文件内容。  该指令不能与<a hhref="#server">server</a>指令一起使用。 </p><p></p><blockquote class="note">   <a hhref="control.html#reconfiguration">配置重新加载</a>或<a hhref="control.html#upgrade">二进制升级</a>期间所做的更改可能会丢失。 </blockquote><p></p><p></p><blockquote class="note">  该指令作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="hash"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>hash</strong> <code class="notranslate"><i>key</i></code> [ <code class="notranslate">consistent</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.2版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定服务器组的负载平衡方法，其中客户端 - 服务器映射基于散列&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。  请注意，从组中添加或删除服务器可能会导致将大多数密钥重新映射到不同的服务器。  该方法与&lt;a hhref=&quot;https://metacpan.org/pod/Cache::Memcached&quot;&gt;Cache :: Memcached&lt;/a&gt; Perl库兼容。 &lt;/p&gt;&lt;p&gt;  如果指定了&lt;code class=&quot;notranslate&quot;&gt;consistent&lt;/code&gt;参数，则将使用&lt;a hhref=&quot;https://www.metabrew.com/article/libketama-consistent-hashing-algo-memcached-clients&quot;&gt;ketama&lt;/a&gt;一致性哈希方法。  该方法确保在向组添加服务器或从组中删除服务器时，只有少数密钥将重新映射到不同的服务器。  这有助于为缓存服务器实现更高的缓存命中率。  该方法与&lt;a hhref=&quot;https://metacpan.org/pod/Cache::Memcached::Fast&quot;&gt;Cache :: Memcached :: Fast&lt;/a&gt; Perl库兼容，并将&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ketama_points&lt;/i&gt;&lt;/code&gt;参数设置为160。 &lt;/p&gt;&lt;a name=&quot;ip_hash&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ip_hash&lt;/strong&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定组应使用负载平衡方法，其中请求根据客户端IP地址在服务器之间分配。  客户端IPv4地址的前三个八位字节或整个IPv6地址用作散列密钥。  该方法确保来自同一客户端的请求将始终传递到同一服务器，除非此服务器不可用。  在后一种情况下，客户端请求将被传递到另一个服务器。  最有可能的是，它也将始终是同一台服务器。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  从版本1.3.2和1.2.2开始支持IPv6地址。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  如果需要临时删除其中一个服务器，则应使用&lt;code class=&quot;notranslate&quot;&gt;down&lt;/code&gt;参数对其进行标记，以保留客户端IP地址的当前哈希值。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;upstream backend {
ip_hash;

server backend1.example.com;
server backend2.example.com;
server backend3.example.com &lt;strong&gt;down&lt;/strong&gt; ;
server backend4.example.com;
</code></pre><p>}<br></p><p></p><p></p><blockquote class="note">  在版本1.3.1和1.2.2之前，无法使用<code class="notranslate">ip_hash</code>负载平衡方法为服务器指定权重。 </blockquote><p></p><a name="keepalive"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>keepalive</strong> <code class="notranslate"><i>connections</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.1.4版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  激活缓存以连接到上游服务器。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;connections&lt;/i&gt;&lt;/code&gt;参数设置在每个工作进程的缓存中保留的上游服务器的最大空闲keepalive连接数。  超过此数量时，将关闭最近最少使用的连接。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  应特别注意的是， &lt;code class=&quot;notranslate&quot;&gt;keepalive&lt;/code&gt;指令不限制nginx工作进程可以打开的上游服务器的连接总数。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;connections&lt;/i&gt;&lt;/code&gt;参数应设置为足够小的数字，以便上游服务器也可以处理新的传入连接。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  使用keepalive连接的memcached上游示例配置： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;upstream memcached_backend {
server 127.0.0.1:11211;
server 10.0.0.2:11211;

keepalive 32;
</code></pre><p>}</p>
<p>server {<br>    …</p>
<pre><code>location /memcached/ {
    set $memcached_key $uri;
    memcached_pass memcached_backend;
}
</code></pre><p>}<br></p><p></p><p>  对于HTTP， <a hhref="ngx_http_proxy_module.html#proxy_http_version">proxy_http_version</a>指令应设置为“ <code class="notranslate">1.1</code> ”，并且应清除“Connection”头字段： </p><blockquote class="example"><pre class="notranslate">upstream http_backend {<br>    server 127.0.0.1:8080;<p></p>
<pre><code>keepalive 16;
</code></pre><p>}</p>
<p>server {<br>    …</p>
<pre><code>location /http/ {
    proxy_pass http://http_backend;
    proxy_http_version 1.1;
    proxy_set_header Connection &quot;&quot;;
    ...
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p></p><blockquote class="note">  或者，可以通过将“Connection：Keep-Alive”头字段传递给上游服务器来使用HTTP / 1.0持久连接，但不建议使用此方法。 </blockquote><p></p><p>  对于FastCGI服务器，需要设置<a hhref="ngx_http_fastcgi_module.html#fastcgi_keep_conn">fastcgi_keep_conn</a>才能使keepalive连接正常工作： </p><blockquote class="example"><pre class="notranslate">upstream fastcgi_backend {<br>    server 127.0.0.1:9000;<p></p>
<pre><code>keepalive 8;
</code></pre><p>}</p>
<p>server {<br>    …</p>
<pre><code>location /fastcgi/ {
    fastcgi_pass fastcgi_backend;
    fastcgi_keep_conn on;
    ...
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p></p><blockquote class="note">  使用除默认循环方法之外的负载平衡器方法时，必须在<code class="notranslate">keepalive</code>指令之前激活它们。 </blockquote><p></p><blockquote class="note">   SCGI和uwsgi协议没有keepalive连接的概念。 </blockquote><p></p><a name="keepalive_requests"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>keepalive_requests</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">keepalive_requests 100;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">upstream</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.15.3版中。 </p></div><p>  设置可通过一个keepalive连接提供的最大请求数。  在发出最大请求数后，将关闭连接。 </p><a name="keepalive_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>keepalive_timeout</strong> <code class="notranslate"><i>timeout</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">keepalive_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">upstream</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.15.3版中。 </p></div><p>  设置超时，在此期间与上游服务器的空闲keepalive连接将保持打开状态。 </p><a name="ntlm"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ntlm</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.2版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  允许使用&lt;a hhref=&quot;https://en.wikipedia.org/wiki/Integrated_Windows_Authentication&quot;&gt;NTLM身份验证&lt;/a&gt;代理请求。  一旦客户端发送具有以“ &lt;code class=&quot;notranslate&quot;&gt;Negotiate&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;NTLM&lt;/code&gt; ”开头的“Authorization”头字段值的请求，上游连接就绑定到客户端连接。  进一步的客户端请求将通过相同的上游连接进行代理，从而保持身份验证上下文。 &lt;/p&gt;&lt;p&gt;  为了使NTLM身份验证起作用，必须启用与上游服务器的keepalive连接。   &lt;a hhref=&quot;ngx_http_proxy_module.html#proxy_http_version&quot;&gt;proxy_http_version&lt;/a&gt;指令应设置为“ &lt;code class=&quot;notranslate&quot;&gt;1.1&lt;/code&gt; ”，并且应清除“Connection”头字段： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;upstream http_backend {
server 127.0.0.1:8080;

ntlm;
</code></pre><p>}</p>
<p>server {<br>    …</p>
<pre><code>location /http/ {
    proxy_pass http://http_backend;
    proxy_http_version 1.1;
    proxy_set_header Connection &quot;&quot;;
    ...
}
</code></pre><p>}<br></p><p></p><p></p><blockquote class="note">  使用除默认循环方法之外的负载平衡器方法时，必须在<code class="notranslate">ntlm</code>指令之前激活它们。 </blockquote><p></p><p></p><blockquote class="note">  该指令作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="least_conn"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>least_conn</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.3.1和1.2.2版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定组应使用负载平衡方法，其中将请求传递到具有最少活动连接的服务器，同时考虑服务器的权重。  如果有多个这样的服务器，则使用加权循环平衡方法依次尝试它们。 &lt;/p&gt;&lt;a name=&quot;least_time&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;least_time&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;header&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;last_byte&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;inflight&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.10版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定组应使用负载平衡方法，其中请求以最少的平均响应时间和最少的活动连接传递给服务器，同时考虑服务器的权重。  如果有多个这样的服务器，则使用加权循环平衡方法依次尝试它们。 &lt;/p&gt;&lt;p&gt;  如果指定了&lt;code class=&quot;notranslate&quot;&gt;header&lt;/code&gt;参数，则使用接收&lt;a hhref=&quot;#var_upstream_header_time&quot;&gt;响应头的&lt;/a&gt;时间。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;last_byte&lt;/code&gt;参数，则使用接收&lt;a hhref=&quot;#var_upstream_response_time&quot;&gt;完整响应的&lt;/a&gt;时间。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;inflight&lt;/code&gt;参数（1.11.6），则还会考虑不完整的请求。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.11.6版之前，默认情况下会考虑不完整的请求。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  该指令作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分提供。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;queue&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;queue&lt;/strong&gt; 
</code></pre><p><code class="notranslate"><i>number</i></code><br>[ <code class="notranslate">timeout</code> = <code class="notranslate"><i>time</i></code> ]; <br><br>                </p></td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.12版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果在处理请求时无法立即选择上游服务器，则请求将被放入队列中。  该指令指定了可以同时在队列中的最大请求&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; 。  如果队列已满，或者在&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;参数中指定的时间段内无法选择要传递请求的服务器，则会将502（错误网关）错误返回给客户端。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;参数的默认值为60秒。 &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  使用除默认循环方法之外的负载平衡器方法时，必须在&lt;code class=&quot;notranslate&quot;&gt;queue&lt;/code&gt;指令之前激活它们。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  该指令作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅的&lt;/a&gt;一部分提供。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;random&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;random&lt;/strong&gt; [ &lt;code class=&quot;notranslate&quot;&gt;two&lt;/code&gt; [ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;method&lt;/i&gt;&lt;/code&gt; ]];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.1版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定组应使用负载平衡方法，其中将请求传递给随机选择的服务器，同时考虑服务器的权重。 &lt;/p&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;two&lt;/code&gt;参数指示nginx随机选择&lt;a hhref=&quot;https://homes.cs.washington.edu/~karlin/papers/balls.pdf&quot;&gt;两个&lt;/a&gt;服务器，然后使用指定的&lt;code class=&quot;notranslate&quot;&gt;method&lt;/code&gt;选择服务器。  默认方法是&lt;code class=&quot;notranslate&quot;&gt;least_conn&lt;/code&gt; ，它将请求传递给活动连接数最少的服务器。 &lt;/p&gt;&lt;a name=&quot;random_least_time&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;least_time&lt;/code&gt;方法将请求传递给具有最少平均响应时间和最少活动连接数的服务器。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;least_time=header&lt;/code&gt; ，则使用接收&lt;a hhref=&quot;#var_upstream_header_time&quot;&gt;响应头&lt;/a&gt;的时间。  如果指定了&lt;code class=&quot;notranslate&quot;&gt;least_time=last_byte&lt;/code&gt; ，则使用接收&lt;a hhref=&quot;#var_upstream_response_time&quot;&gt;完整响应&lt;/a&gt;的时间。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;least_time&lt;/code&gt;方法可作为我们&lt;a hhref=&quot;http://nginx.com/products/&quot;&gt;商业订阅&lt;/a&gt;的一部分。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;sticky&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;sticky&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;cookie&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;expires=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;domain=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;domain&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;httponly&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;secure&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;path=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;path&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;sticky&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;route&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;$variable&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;sticky&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;learn&lt;/code&gt;
&lt;code class=&quot;notranslate&quot;&gt;create=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;$variable&lt;/i&gt;&lt;/code&gt;
&lt;code class=&quot;notranslate&quot;&gt;lookup=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;$variable&lt;/i&gt;&lt;/code&gt;
&lt;code class=&quot;notranslate&quot;&gt;zone=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; : &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;timeout=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;header&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;sync&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用会话关联，这会将来自同一客户端的请求传递到一组服务器中的同一服务器。  有三种方法可供选择： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;sticky_cookie&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;cookie&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  使用&lt;code class=&quot;notranslate&quot;&gt;cookie&lt;/code&gt;方法时，有关指定服务器的信息将在nginx生成的HTTP cookie中传递： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;upstream backend {
server backend1.example.com;
server backend2.example.com;

sticky cookie srv_id expires=1h domain=.example.com path=/;
</code></pre><p>}<br></p><p></p><p>  来自尚未绑定到特定服务器的客户端的请求将传递到由配置的balance方法选择的服务器。  使用此cookie的进一步请求将传递到指定的服务器。  如果指定的服务器无法处理请求，则选择新服务器，就好像客户端尚未绑定一样。 </p><p>  第一个参数设置要设置或检查的cookie的名称。   cookie值是IP地址和端口的MD5哈希值或UNIX域套接字路径的十六进制表示形式。  但是，如果指定了<a hhref="#server">server</a>指令的“ <code class="notranslate">route</code> ”参数，则cookie值将是“ <code class="notranslate">route</code> ”参数的值： </p><blockquote class="example"><pre class="notranslate">upstream backend {<br>    server backend1.example.com route= <strong>a</strong> ;<br>    server backend2.example.com route= <strong>b</strong> ;<p></p>
<pre><code>sticky cookie srv_id expires=1h domain=.example.com path=/;
</code></pre><p>}<br></p></pre></blockquote><p>  在这种情况下，“ <code class="notranslate">srv_id</code> ”cookie的值将是<code class="notranslate"><i>a</i></code>或<code class="notranslate"><i>b</i></code> 。 </p><p>  其他参数可能如下： </p><dl class="compact"><dt>   <code class="notranslate">expires=</code> <code class="notranslate"><i>time</i></code> </dt><dd>  设置浏览器保留cookie的时间。  特殊值<code class="notranslate">max</code>将导致cookie在“ <code class="notranslate">31 Dec 2037 23:55:55 GMT</code> ”到期。  如果未指定参数，则会导致cookie在浏览器会话结束时到期。 </dd><dt>   <code class="notranslate">domain=</code> <code class="notranslate"><i>domain</i></code> </dt><dd>  定义为其设置cookie的<code class="notranslate"><i>domain</i></code> 。  参数值可以包含变量（1.11.5）。 </dd><dt> <code class="notranslate">httponly</code> </dt> <dd>  将<code class="notranslate">HttpOnly</code>属性添加到cookie（1.7.11）。 </dd><dt> <code class="notranslate">secure</code> </dt> <dd>  将<code class="notranslate">Secure</code>属性添加到cookie（1.7.11）。 </dd><dt>   <code class="notranslate">path=</code> <code class="notranslate"><i>path</i></code> </dt><dd>  定义cookie的设置<code class="notranslate"><i>path</i></code> 。 </dd></dl><p>  如果省略任何参数，则不会设置相应的cookie字段。 </p><dt id="sticky_route"> <code class="notranslate">route</code> </dt> <dd><p>  使用<code class="notranslate">route</code>方法时，代理服务器在收到第一个请求时为客户端分配路由。  来自此客户端的所有后续请求将在cookie或URI中携带路由信息。  将此信息与<a hhref="#server">服务器</a>指令的“ <code class="notranslate">route</code> ”参数进行比较，以标识应将请求代理到的服务器。  如果未指定“ <code class="notranslate">route</code> ”参数，则路由名称将是IP地址和端口的MD5哈希值或UNIX域套接字路径的十六进制表示形式。  如果指定的服务器无法处理请求，则配置的平衡方法将选择新服务器，就好像请求中没有路由信息一样。 </p><p>   <code class="notranslate">route</code>方法的参数指定可能包含路由信息的变量。  第一个非空变量用于查找匹配服务器。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">map $cookie_jsessionid $route_cookie {<br>    ~.+.(?P&lt;route&gt;\w+)$ $route;<br>}<p></p>
<p>map $request_uri $route_uri {<br>    ~jsessionid=.+.(?P&lt;route&gt;\w+)$ $route;<br>}</p>
<p>upstream backend {<br>    server backend1.example.com route=a;<br>    server backend2.example.com route=b;</p>
<pre><code>sticky route $route_cookie $route_uri;
</code></pre><p>}<br></p></pre></blockquote><p>  这里，路由取自“ <code class="notranslate">JSESSIONID</code> ”cookie（如果请求中存在）。  否则，使用来自URI的路由。 </p></dd><dt id="sticky_learn"> <code class="notranslate">learn</code> </dt> <dd><p>  当使用<code class="notranslate">learn</code>方法（1.7.1）时，nginx会分析上游服务器响应并学习通常在HTTP cookie中传递的服务器启动的会话。 </p><blockquote class="example"><pre class="notranslate">upstream backend {<br>   server backend1.example.com:8080;<br>   server backend2.example.com:8081;<p></p>
<p>   sticky learn<br>          create=$upstream_cookie_examplecookie<br>          lookup=$cookie_examplecookie<br>          zone=client_sessions:1m;<br>}<br></p></pre></blockquote><p>  在该示例中，上游服务器通过在响应中设置cookie“ <code class="notranslate">EXAMPLECOOKIE</code> ”来创建会话。  使用此cookie的进一步请求将传递到同一服务器。  如果服务器无法处理请求，则选择新服务器，就好像客户端尚未绑定一样。 </p><p>  参数<code class="notranslate">create</code>和<code class="notranslate">lookup</code>指定分别指示如何创建新会话和搜索现有会话的变量。  两个参数可以多次指定，在这种情况下使用第一个非空变量。 </p><p>  会话存储在共享内存区域中，其<code class="notranslate"><i>name</i></code>和<code class="notranslate"><i>size</i></code>由<code class="notranslate">zone</code>参数配置。  一兆字节区域可以在64位平台上存储大约4000个会话。  在<code class="notranslate">timeout</code>参数指定的时间内未访问的会话将从区域中删除。  默认情况下， <code class="notranslate">timeout</code>设置为10分钟。 </p><a name="sticky_learn_header"></a><p>   <code class="notranslate">header</code>参数（1.13.1）允许在从上游服务器接收响应头之后立即创建会话。 </p><a name="sticky_learn_sync"></a><p>   <code class="notranslate">sync</code>参数（1.13.8）启用共享内存区域的<a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync">同步</a> 。 </p></dd><p></p><p></p><blockquote class="note">  该指令作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="sticky_cookie_insert"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>sticky_cookie_insert</strong> <code class="notranslate"><i>name</i></code><br>[ <code class="notranslate">expires=</code> <code class="notranslate"><i>time</i></code> ]<br>[ <code class="notranslate">domain=</code> <code class="notranslate"><i>domain</i></code> ]<br>[ <code class="notranslate">path=</code> <code class="notranslate"><i>path</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;upstream&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  从1.5.7版开始，该指令已过时。  应该使用具有新语法的等效&lt;a hhref=&quot;#sticky&quot;&gt;粘性&lt;/a&gt;指令： &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;sticky cookie&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; [ &lt;code class=&quot;notranslate&quot;&gt;expires=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ] [ &lt;code class=&quot;notranslate&quot;&gt;domain=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;domain&lt;/i&gt;&lt;/code&gt; ] [ &lt;code class=&quot;notranslate&quot;&gt;path=&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;path&lt;/i&gt;&lt;/code&gt; ]; &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_http_upstream_module&lt;/code&gt;模块支持以下嵌入变量： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_upstream_addr&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_addr&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留IP地址和端口，或上游服务器的UNIX域套接字的路径。  如果在请求处理期间联系了多个服务器，则它们的地址用逗号分隔，例如“ &lt;code class=&quot;notranslate&quot;&gt;192.168.1.1:80, 192.168.1.2:80, unix:/tmp/sock&lt;/code&gt; ”。  如果从一个服务器组到另一个服务器组的内部重定向发生，由“X-Accel-Redirect”或&lt;a hhref=&quot;ngx_http_core_module.html#error_page&quot;&gt;error_page启动&lt;/a&gt; ，则来自不同组的服务器地址用冒号分隔，例如“ &lt;code class=&quot;notranslate&quot;&gt;192.168.1.1:80, 192.168.1.2:80, unix:/tmp/sock : 192.168.10.1:80, 192.168.10.2:80&lt;/code&gt; “。  如果无法选择服务器，则变量将保留服务器组的名称。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_bytes_received&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_bytes_received&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从上游服务器（1.11.4）接收的字节数。  来自多个连接的值由逗号和冒号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_bytes_sent&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_bytes_sent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  发送到上游服务器的字节数（1.15.8）。  来自多个连接的值由逗号和冒号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_cache_status&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_cache_status&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保持访问响应缓存的状态（0.8.3）。  状态可以是“ &lt;code class=&quot;notranslate&quot;&gt;MISS&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;BYPASS&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;EXPIRED&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;STALE&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;UPDATING&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;REVALIDATED&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;HIT&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_connect_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_connect_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留与上游服务器建立连接所花费的时间（1.9.1）;  时间以秒为单位，分辨率为毫秒。  在SSL的情况下，包括握手时间。  几个连接的时间用逗号和冒号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_cookie_&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;$upstream_cookie_&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  上游服务器在“Set-Cookie”响应头字段（1.7.1）中发送的具有指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;的cookie。  仅保存最后一台服务器响应中的cookie。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_header_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_header_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留从上游服务器接收响应头所花费的时间（1.7.10）;  时间以秒为单位，分辨率为毫秒。  几个响应的时间用逗号和冒号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_http_&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;$upstream_http_&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  保留服务器响应头字段。  例如，“Server”响应头字段可通过&lt;code class=&quot;notranslate&quot;&gt;$upstream_http_server&lt;/code&gt;变量获得。  将头字段名称转换为变量名称的规则与以“ &lt;a hhref=&quot;ngx_http_core_module.html#var_http_&quot;&gt;$ http_&lt;/a&gt; ”前缀开头的变量相同。  仅保存最后一个服务器响应中的标头字段。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_queue_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_queue_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留请求在上游&lt;a hhref=&quot;#queue&quot;&gt;队列中&lt;/a&gt;花费的时间（1.13.9）;  时间以秒为单位，分辨率为毫秒。  几个响应的时间用逗号和冒号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_response_length&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_response_length&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保持从上游服务器获得的响应长度（0.7.27）;  长度以字节为单位。  几个响应的长度用逗号和冒号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_response_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_response_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留从上游服务器接收响应所花费的时间;  时间以秒为单位，分辨率为毫秒。  几个响应的时间用逗号和冒号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_status&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$upstream_status&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留从上游服务器获得的响应的状态代码。  几个响应的状态代码用逗号和冒号分隔，如&lt;a hhref=&quot;#var_upstream_addr&quot;&gt;$ upstream_addr&lt;/a&gt;变量中的地址。  如果无法选择服务器，则变量将保留502（错误网关）状态代码。 &lt;/dd&gt;&lt;dt id=&quot;var_upstream_trailer_&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;$upstream_trailer_&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  保留从上游服务器（1.13.10）获得的响应结束的字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_upstream_hc_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_upstream_hc_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#health_check">health_check</a> <br>     <a hhref="#match">match</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_upstream_hc_module</code>模块允许对周围位置中引用的<a hhref="ngx_http_upstream_module.html#upstream">组</a>中的服务器进行定期运行状况检查。  服务器组必须驻留在<a hhref="ngx_http_upstream_module.html#zone">共享内存中</a> 。 </p><p>  如果运行状况检查失败，则服务器将被视为运行状况不佳。  如果为同一组服务器定义了多个运行状况检查，则任何检查的单个故障都将使相应的服务器被视为不健康。  客户端请求不会传递到处于“检查”状态的不健康服务器和服务器。 </p><p></p><blockquote class="note">  请注意，与健康检查一起使用时，大多数变量都将具有空值。 </blockquote><p></p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">upstream dynamic {<br>    zone upstream_dynamic 64k;<p></p>
<pre><code>server backend1.example.com      weight=5;
server backend2.example.com:8080 fail_timeout=5s slow_start=30s;
server 192.0.2.1                 max_fails=3;

server backup1.example.com:8080  backup;
server backup2.example.com:8080  backup;
</code></pre><p>}</p>
<p>server {<br>    location / {<br>        proxy_pass <a href="http://dynamic" target="_blank" rel="noopener">http://dynamic</a>;<br>        health_check;<br>    }<br>}<br></p></pre></blockquote><p>  使用此配置，nginx将每隔五秒向<code class="notranslate">backend</code>组中的每个服务器发送“ <code class="notranslate">/</code> ”请求。  如果发生任何通信错误或超时，或者代理服务器使用2xx或3xx以外的状态代码进行响应，运行状况检查将失败，并且服务器将被视为运行状况不佳。 </p><p>  可以配置运行状况检查以测试响应的状态代码，某些标题字段及其值的存在以及正文内容。  测试使用<a hhref="#match">match</a>伪指令单独配置，并在<a hhref="#health_check">health_check</a>指令的<code class="notranslate">match</code>参数中引用： </p><blockquote class="example"><pre class="notranslate">http {<br>    server {<br>    …<br>        location / {<br>            proxy_pass <a href="http://backend" target="_blank" rel="noopener">http://backend</a>;<br>            health_check match=welcome;<br>        }<br>    }<p></p>
<pre><code>match welcome {
    status 200;
    header Content-Type = text/html;
    body ~ &quot;Welcome to nginx!&quot;;
}
</code></pre><p>}<br></p></pre></blockquote><p>  此配置显示，为了通过运行状况检查，对运行状况检查请求的响应应该成功，状态为200，并包含“ <code class="notranslate">Welcome to nginx!</code>   “ 在身体里。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="health_check"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>health_check</strong> [ <code class="notranslate"><i>parameters</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用对周围位置中引用的&lt;a hhref=&quot;ngx_http_upstream_module.html#upstream&quot;&gt;组&lt;/a&gt;中的服务器的定期运行状况检查。 &lt;/p&gt;&lt;p&gt;  支持以下可选参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;health_check_interval&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;interval&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置两次连续运行状况检查之间的间隔，默认为5秒。 &lt;/dd&gt;&lt;dt id=&quot;health_check_jitter&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;jitter&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置每个健康检查随机延迟的时间，默认情况下，没有延迟。 &lt;/dd&gt;&lt;dt id=&quot;health_check_fails&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;fails&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置特定服务器的连续失败运行状况检查的数量，在此之后，此服务器将被视为运行状况不佳，默认情况下为1。 &lt;/dd&gt;&lt;dt id=&quot;health_check_passes&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;passes&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  设置特定服务器的连续传递运行状况检查的数量，在此之后服务器将被视为运行状况，默认情况下为1。 &lt;/dd&gt;&lt;dt id=&quot;health_check_uri&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;uri&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;uri&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  定义健康检查请求中使用的URI，默认情况下为“ &lt;code class=&quot;notranslate&quot;&gt;/&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;health_check_mandatory&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;mandatory&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  设置服务器的初始“检查”状态，直到第一次健康检查完成（1.11.7）。  客户端请求不会传递到处于“检查”状态的服务器。  如果未指定参数，则服务器最初将被视为健康。 &lt;/dd&gt;&lt;dt id=&quot;health_check_match&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;match&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  指定配置响应应传递的测试的&lt;code class=&quot;notranslate&quot;&gt;match&lt;/code&gt;块，以便进行运行状况检查。  默认情况下，响应的状态代码应为2xx或3xx。 &lt;/dd&gt;&lt;dt id=&quot;health_check_port&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;port&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  定义连接到服务器以执行运行状况检查时使用的端口（1.9.7）。  默认情况下，等于&lt;a hhref=&quot;ngx_http_upstream_module.html#server&quot;&gt;服务器&lt;/a&gt;端口。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;match&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;match&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; { ... }&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义用于验证对运行状况检查请求的响应的命名测试集。 &lt;/p&gt;&lt;p&gt;  可以在响应中测试以下项目： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;status 200;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  状态是200 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;status ! 500;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  状态不是500 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;status 200 204;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  状态为200或204 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;status ! 301 302;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  状态既不是301也不是302 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;status 200-399;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  状态在200到399之间 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;status ! 400-599;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  状态不在400到599之间 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;status 301-303 307;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  状态为301,302,303或307 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;header Content-Type = text/html;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   header包含值为&lt;code class=&quot;notranslate&quot;&gt;text/html&lt;/code&gt; “Content-Type” &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;header Content-Type != text/html;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   header包含“Content-Type”，其值不是&lt;code class=&quot;notranslate&quot;&gt;text/html&lt;/code&gt; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;header Connection ~ close;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   header包含“Connection”，其值与正则表达式&lt;code class=&quot;notranslate&quot;&gt;close&lt;/code&gt;匹配 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;header Connection !~ close;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   header包含“Connection”，其值与正则表达式&lt;code class=&quot;notranslate&quot;&gt;close&lt;/code&gt;不匹配 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;header Host;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  标头包含“主机” &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;header ! X-Accel-Redirect;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  标头缺少“X-Accel-Redirect” &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;body ~ &quot;Welcome to nginx!&quot;;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  正文表达“ &lt;code class=&quot;notranslate&quot;&gt;Welcome to nginx!&lt;/code&gt;   ” &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;body !~ &quot;Welcome to nginx!&quot;;&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  正文表达式不符合“ &lt;code class=&quot;notranslate&quot;&gt;Welcome to nginx!&lt;/code&gt;   ” &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  如果指定了多个测试，则响应仅在匹配所有测试时才匹配。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  仅检查响应体的前256k。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  例子： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;# status is 200, content type is &quot;text/html&quot;,
</code></pre><h1 id="and-body-contains-“Welcome-to-nginx-”"><a href="#and-body-contains-“Welcome-to-nginx-”" class="headerlink" title="and body contains “Welcome to nginx!”"></a>and body contains “Welcome to nginx!”</h1><p>match welcome {<br>    status 200;<br>    header Content-Type = text/html;<br>    body ~ “Welcome to nginx!”;<br>}<br></p><p></p><blockquote class="example"><pre class="notranslate"># status is not one of 301, 302, 303, or 307, and header does not have “Refresh:”<br>match not_redirect {<br>    status ! 301-303 307;<br>    header ! Refresh;<br>}<br></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate"># status ok and not in maintenance mode<br>match server_ok {<br>    status 200-399;<br>    body !~ “maintenance mode”;<br>}<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_upstream_conf_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_upstream_conf_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#upstream_conf">upstream_conf</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_upstream_conf_module</code>模块允许通过简单的HTTP接口即时配置上游服务器组，而无需重新启动nginx。   <a hhref="ngx_http_upstream_module.html#zone">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#zone">流</a>服务器组必须驻留在共享内存中。 </p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供，直到1.13.10。  它被1.13.3中的<a hhref="ngx_http_api_module.html">ngx_http_api_module</a>模块取代。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">upstream backend {<br>    zone upstream_backend 64k;<p></p>
<pre><code>...
</code></pre><p>}</p>
<p>server {<br>    location /upstream_conf {<br>        <strong>upstream_conf</strong> ;<br>        allow 127.0.0.1;<br>        deny all;<br>    }<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="upstream_conf"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>upstream_conf</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  打开周围位置的上游配置的HTTP接口。  应&lt;a hhref=&quot;ngx_http_core_module.html#satisfy&quot;&gt;限制&lt;/a&gt;访问此位置。 &lt;/p&gt;&lt;p&gt;  配置命令可用于： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;  查看组配置; &lt;/li&gt;&lt;li&gt;  查看，修改或删除服务器; &lt;/li&gt;&lt;li&gt;  添加新服务器。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  由于组中的地址不需要是唯一的，因此组中的特定服务器由其ID引用。  添加新服务器或查看组配置时，会自动分配ID并显示ID。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  配置命令由作为请求参数传递的参数组成，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;http://127.0.0.1/upstream_conf?upstream=backend
</code></pre><p></p><p></p><p>  支持以下参数： </p><dl><dt> <code class="notranslate">stream=</code> </dt> <dd>  选择<a hhref="stream/ngx_stream_upstream_module.html">流</a>上游服务器组。  如果没有此参数，请选择<a hhref="ngx_http_upstream_module.html">http</a>上游服务器组。 </dd><dt>   <code class="notranslate">upstream=</code> <code class="notranslate"><i>name</i></code> </dt><dd>  选择要使用的组。  此参数是必需的。 </dd><dt>   <code class="notranslate">id=</code> <code class="notranslate"><i>number</i></code> </dt><dd>  选择用于查看，修改或删除的服务器。 </dd><dt> <code class="notranslate">remove=</code> </dt> <dd>  从组中删除服务器。 </dd><dt> <code class="notranslate">add=</code> </dt> <dd>  向组中添加新服务器。 </dd><dt> <code class="notranslate">backup=</code> </dt> <dd>  需要添加备份服务器。 <blockquote class="note">  在1.7.2版之前，还需要<code class="notranslate">backup=</code>来查看，修改或删除现有备份服务器。 </blockquote></dd><dt>   <code class="notranslate">server=</code> <code class="notranslate"><i>address</i></code> </dt><dd>  与<a hhref="ngx_http_upstream_module.html#server">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#server">流</a>上游服务器的“ <code class="notranslate">address</code> ”参数相同。 <p>  添加服务器时，可以将其指定为域名。  在这种情况下，将监视与域名对应的IP地址的更改并自动应用于上游配置，而无需重新启动nginx（1.7.2）。  这需要<a hhref="ngx_http_core_module.html#resolver">http</a>或<a hhref="stream/ngx_stream_core_module.html#resolver">流</a>块中的“ <code class="notranslate">resolver</code> ”指令。  另请参阅<a hhref="ngx_http_upstream_module.html#resolve">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#resolve">流</a>上游服务器的“ <code class="notranslate">resolve</code> ”参数。 </p></dd><dt>   <code class="notranslate">service=</code> <code class="notranslate"><i>name</i></code> </dt><dd>  与<a hhref="ngx_http_upstream_module.html#service">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#service">流</a>上游服务器的“ <code class="notranslate">service</code> ”参数相同（1.9.13）。 </dd><dt>   <code class="notranslate">weight=</code> <code class="notranslate"><i>number</i></code> </dt><dd>  与<a hhref="ngx_http_upstream_module.html#weight">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#weight">流</a>上游服务器的“ <code class="notranslate">weight</code> ”参数相同。 </dd><dt>   <code class="notranslate">max_conns=</code> <code class="notranslate"><i>number</i></code> </dt><dd>  与<a hhref="ngx_http_upstream_module.html#max_conns">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#max_conns">流</a>上游服务器的“ <code class="notranslate">max_conns</code> ”参数相同。 </dd><dt>   <code class="notranslate">max_fails=</code> <code class="notranslate"><i>number</i></code> </dt><dd>  与<a hhref="ngx_http_upstream_module.html#max_fails">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#max_fails">流</a>上游服务器的“ <code class="notranslate">max_fails</code> ”参数相同。 </dd><dt>   <code class="notranslate">fail_timeout=</code> <code class="notranslate"><i>time</i></code> </dt><dd>  与<a hhref="ngx_http_upstream_module.html#fail_timeout">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#fail_timeout">流</a>上游服务器的“ <code class="notranslate">fail_timeout</code> ”参数相同。 </dd><dt>   <code class="notranslate">slow_start=</code> <code class="notranslate"><i>time</i></code> </dt><dd>  与<a hhref="ngx_http_upstream_module.html#slow_start">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#slow_start">流</a>上游服务器的“ <code class="notranslate">slow_start</code> ”参数相同。 </dd><dt> <code class="notranslate">down=</code> </dt> <dd>  与<a hhref="ngx_http_upstream_module.html#down">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#down">流</a>上游服务器的“ <code class="notranslate">down</code> ”参数相同。 </dd><dt id="drain"> <code class="notranslate">drain=</code> </dt> <dd>  将<a hhref="ngx_http_upstream_module.html">http</a>上游服务器置于“排空”模式（1.7.5）。  在此模式下，只有<a hhref="ngx_http_upstream_module.html#sticky">绑定</a>到服务器的请求才会被代理。 </dd><dt> <code class="notranslate">up=</code> </dt> <dd>  与<a hhref="ngx_http_upstream_module.html#down">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#down">流</a>上游服务器的“ <code class="notranslate">down</code> ”参数相反。 </dd><dt>   <code class="notranslate">route=</code> <code class="notranslate"><i>string</i></code> </dt><dd>  与<a hhref="ngx_http_upstream_module.html#route">http</a>上游服务器的“ <code class="notranslate">route</code> ”参数相同。 </dd></dl><p>  前三个参数选择一个对象。  这可以是整个http或流上游服务器组，也可以是特定服务器。  如果没有其他参数，则会显示所选组或服务器的配置。 </p><p>  例如，要查看整个组的配置，请发送： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?upstream=backend" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?upstream=backend</a><br></pre></blockquote><p>  要查看特定服务器的配置，还要指定其ID： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42</a><br></pre></blockquote><p></p><p>  要添加新服务器，请在“ <code class="notranslate">server=</code> ”参数中指定其地址。  如果未指定其他参数，将添加服务器，并将其他参数设置为其默认值（请参阅<a hhref="ngx_http_upstream_module.html#server">http</a>或<a hhref="stream/ngx_stream_upstream_module.html#server">流</a> “ <code class="notranslate">server</code> ”指令）。 </p><p>  例如，要添加新的主服务器，请发送： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;server=127.0.0.1:8080" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;server=127.0.0.1:8080</a><br></pre></blockquote><p>  要添加新的备份服务器，请发送： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;backup=&amp;server=127.0.0.1:8080" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;backup=&amp;server=127.0.0.1:8080</a><br></pre></blockquote><p>  要添加新的主服务器，请将其参数设置为非默认值并将其标记为“ <code class="notranslate">down</code> ”，发送： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;server=127.0.0.1:8080&amp;weight=2&amp;down=" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;server=127.0.0.1:8080&amp;weight=2&amp;down=</a><br></pre></blockquote><p>  要删除服务器，请指定其ID： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?remove=&amp;upstream=backend&amp;id=42" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?remove=&amp;upstream=backend&amp;id=42</a><br></pre></blockquote><p>  要将现有服务器标记为“ <code class="notranslate">down</code> ”，请发送： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;down=" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;down=</a><br></pre></blockquote><p>  要修改现有服务器的地址，请发送： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;server=192.0.2.3:8123" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;server=192.0.2.3:8123</a><br></pre></blockquote><p>  要修改现有服务器的其他参数，请发送： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;max_fails=3&amp;weight=4" target="_blank" rel="noopener">http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;max_fails=3&amp;weight=4</a><br></pre></blockquote><p>  以上示例适用于<a hhref="ngx_http_upstream_module.html">http</a>上游服务器组。   <a hhref="stream/ngx_stream_upstream_module.html">流</a>上游服务器组的类似示例需要“ <code class="notranslate">stream=</code> ”参数。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_sub_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_sub_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#sub_filter">sub_filter</a> <br>     <a hhref="#sub_filter_last_modified">sub_filter_last_modified</a> <br>     <a hhref="#sub_filter_once">sub_filter_once</a> <br>     <a hhref="#sub_filter_types">sub_filter_types</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_sub_module</code>模块是一个过滤器，它通过将一个指定的字符串替换为另一个来修改响应。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_sub_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    sub_filter ‘&lt;a href=”<a href="http://127.0.0.1:8080/" target="_blank" rel="noopener">http://127.0.0.1:8080/</a>‘  ‘&lt;a href=”<a href="https://$host/" target="_blank" rel="noopener">https://$host/</a>‘;<br>    sub_filter ‘&lt;img src=”<a href="http://127.0.0.1:8080/" target="_blank" rel="noopener">http://127.0.0.1:8080/</a>‘ ‘&lt;img src=”<a href="https://$host/" target="_blank" rel="noopener">https://$host/</a>‘;<br>    sub_filter_once on;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="sub_filter"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>sub_filter</strong> <code class="notranslate"><i>string</i></code> <code class="notranslate"><i>replacement</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置要替换的字符串和替换字符串。  忽略大小写匹配的字符串匹配。  要替换的字符串（1.9.4）和替换字符串可以包含变量。  可以在一个配置级别（1.9.4）上指定几个&lt;code class=&quot;notranslate&quot;&gt;sub_filter&lt;/code&gt;指令。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;sub_filter&lt;/code&gt;指令时，这些指令才从前一级继承。 &lt;/p&gt;&lt;a name=&quot;sub_filter_last_modified&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;sub_filter_last_modified&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;sub_filter_last_modified off;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.1版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  允许在替换期间保留原始响应中的“Last-Modified”头字段，以便于响应缓存。 &lt;/p&gt;&lt;p&gt;  默认情况下，在处理期间修改响应的内容时，将删除标头字段。 &lt;/p&gt;&lt;a name=&quot;sub_filter_once&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;sub_filter_once&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;sub_filter_once on;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指示是查找要重复替换的每个字符串。 &lt;/p&gt;&lt;a name=&quot;sub_filter_types&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;sub_filter_types&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;mime-type&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;sub_filter_types text/html;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  除了“ &lt;code class=&quot;notranslate&quot;&gt;text/html&lt;/code&gt; ”之外，还在具有指定MIME类型的响应中启用字符串替换。  特殊值“ &lt;code class=&quot;notranslate&quot;&gt;*&lt;/code&gt; ”匹配任何MIME类型（0.8.29）。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_stub_status_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_stub_status_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#stub_status">stub_status</a> <br> <a hhref="#data">Data</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_stub_status_module</code>模块提供对基本状态信息的访问。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_stub_status_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location = /basic_status {<br>    stub_status;<br>}<br></pre></blockquote><p>  此配置创建一个简单的网页，其基本状态数据可能如下所示： </p><blockquote class="example"><pre class="notranslate">Active connections: 291<br>server accepts handled requests<br> 16630948 16630948 31070465<br>Reading: 6 Writing: 179 Waiting: 106<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="stub_status"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>stub_status</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  可从周围位置访问基本状态信息。 &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.7.5之前的版本中，指令语法需要任意参数，例如“ &lt;code class=&quot;notranslate&quot;&gt;stub_status on&lt;/code&gt; ”。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;data&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  数据 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;  提供以下状态信息： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;stubstat_active&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;Active connections&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前活动客户端连接数，包括&lt;code class=&quot;notranslate&quot;&gt;Waiting&lt;/code&gt;连接。 &lt;/dd&gt;&lt;dt id=&quot;stubstat_accepts&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;accepts&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  已接受的客户端连接总数。 &lt;/dd&gt;&lt;dt id=&quot;stubstat_handled&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;handled&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  处理的连接总数。  通常，参数值与&lt;a hhref=&quot;ngx_core_module.html#worker_connections&quot;&gt;accept&lt;/a&gt;相同，除非已达到某些资源限制（例如， &lt;a hhref=&quot;ngx_core_module.html#worker_connections&quot;&gt;worker_connections&lt;/a&gt;限制）。 &lt;/dd&gt;&lt;dt id=&quot;stubstat_requests&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;requests&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  客户端请求的总数。 &lt;/dd&gt;&lt;dt id=&quot;stubstat_reading&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;Reading&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   nginx正在读取请求标头的当前连接数。 &lt;/dd&gt;&lt;dt id=&quot;stubstat_writing&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;Writing&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   nginx将响应写回客户端的当前连接数。 &lt;/dd&gt;&lt;dt id=&quot;stubstat_waiting&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;Waiting&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前等待请求的空闲客户端连接数。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_http_stub_status_module&lt;/code&gt;模块支持以下嵌入变量（1.3.14）： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_connections_active&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$connections_active&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与&lt;code class=&quot;notranslate&quot;&gt;Active connections&lt;/code&gt;值相同; &lt;/dd&gt;&lt;dt id=&quot;var_connections_reading&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$connections_reading&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与&lt;code class=&quot;notranslate&quot;&gt;Reading&lt;/code&gt;值相同; &lt;/dd&gt;&lt;dt id=&quot;var_connections_writing&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$connections_writing&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与&lt;code class=&quot;notranslate&quot;&gt;Writing&lt;/code&gt;值相同; &lt;/dd&gt;&lt;dt id=&quot;var_connections_waiting&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$connections_waiting&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与&lt;code class=&quot;notranslate&quot;&gt;Waiting&lt;/code&gt;值相同。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_status_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_status_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#status">status</a> <br>     <a hhref="#status_format">status_format</a> <br>     <a hhref="#status_zone">status_zone</a> <br> <a hhref="#data">Data</a> <br> <a hhref="#compatibility">Compatibility</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_status_module</code>模块提供对各种状态信息的访问。 </p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供，直到1.13.10。  它被1.13.3中的<a hhref="ngx_http_api_module.html">ngx_http_api_module</a>模块取代。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<br>    upstream <strong>backend</strong> {<br>        <strong>zone</strong> http_backend 64k;<p></p>
<pre><code>    server backend1.example.com weight=5;
    server backend2.example.com;
}

proxy_cache_path /data/nginx/cache_backend keys_zone= &lt;strong&gt;cache_backend&lt;/strong&gt; :10m;

server {
    server_name backend.example.com;

    location / {
        proxy_pass  http://backend;
        proxy_cache cache_backend;

        health_check;
    }

    &lt;strong&gt;status_zone server_backend;&lt;/strong&gt;
}

server {
    listen 127.0.0.1;

    location /upstream_conf {
        upstream_conf;
    }

    location /status {
        status;
    }

    location = /status.html {
    }
}
</code></pre><p>}</p>
<p>stream {<br>    upstream <strong>backend</strong> {<br>        <strong>zone</strong> stream_backend 64k;</p>
<pre><code>    server backend1.example.com:12345 weight=5;
    server backend2.example.com:12345;
}

server {
    listen      127.0.0.1:12345;
    proxy_pass  backend;
    &lt;strong&gt;status_zone server_backend;&lt;/strong&gt;
    health_check;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p>  使用此配置的状态请求示例： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/status" target="_blank" rel="noopener">http://127.0.0.1/status</a><br><a href="http://127.0.0.1/status/nginx_version" target="_blank" rel="noopener">http://127.0.0.1/status/nginx_version</a><br><a href="http://127.0.0.1/status/caches/cache_backend" target="_blank" rel="noopener">http://127.0.0.1/status/caches/cache_backend</a><br><a href="http://127.0.0.1/status/upstreams" target="_blank" rel="noopener">http://127.0.0.1/status/upstreams</a><br><a href="http://127.0.0.1/status/upstreams/backend" target="_blank" rel="noopener">http://127.0.0.1/status/upstreams/backend</a><br><a href="http://127.0.0.1/status/upstreams/backend/peers/1" target="_blank" rel="noopener">http://127.0.0.1/status/upstreams/backend/peers/1</a><br><a href="http://127.0.0.1/status/upstreams/backend/peers/1/weight" target="_blank" rel="noopener">http://127.0.0.1/status/upstreams/backend/peers/1/weight</a><br><a href="http://127.0.0.1/status/stream" target="_blank" rel="noopener">http://127.0.0.1/status/stream</a><br><a href="http://127.0.0.1/status/stream/upstreams" target="_blank" rel="noopener">http://127.0.0.1/status/stream/upstreams</a><br><a href="http://127.0.0.1/status/stream/upstreams/backend" target="_blank" rel="noopener">http://127.0.0.1/status/stream/upstreams/backend</a><br><a href="http://127.0.0.1/status/stream/upstreams/backend/peers/1" target="_blank" rel="noopener">http://127.0.0.1/status/stream/upstreams/backend/peers/1</a><br><a href="http://127.0.0.1/status/stream/upstreams/backend/peers/1/weight" target="_blank" rel="noopener">http://127.0.0.1/status/stream/upstreams/backend/peers/1/weight</a><br></pre></blockquote><p></p><p>  简单监视页面随附此发行版一起提供，可在默认配置中以“ <code class="notranslate">/status.html</code> ”身份访问。  它需要配置位置“ <code class="notranslate">/status</code> ”和“ <code class="notranslate">/status.html</code> ”，如上所示。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="status"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>status</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  可以从周围的位置访问状态信息。  应&lt;a hhref=&quot;ngx_http_core_module.html#satisfy&quot;&gt;限制&lt;/a&gt;访问此位置。 &lt;/p&gt;&lt;a name=&quot;status_format&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;status_format&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;json&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;status_format&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;jsonp&lt;/code&gt; [ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;callback&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;status_format json;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  默认情况下，状态信息以JSON格式输出。 &lt;/p&gt;&lt;p&gt;  或者，数据可以输出为JSONP。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;callback&lt;/i&gt;&lt;/code&gt;参数指定回调函数的名称。  该值可以包含变量。  如果省略参数，或者计算的值是空字符串，则使用“ &lt;code class=&quot;notranslate&quot;&gt;ngx_status_jsonp_callback&lt;/code&gt; ”。 &lt;/p&gt;&lt;a name=&quot;status_zone&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;status_zone&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;zone&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许在指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;zone&lt;/i&gt;&lt;/code&gt;收集虚拟&lt;a hhref=&quot;ngx_http_core_module.html#server&quot;&gt;http&lt;/a&gt;或&lt;a hhref=&quot;stream/ngx_stream_core_module.html#server&quot;&gt;流&lt;/a&gt; （1.7.11）服务器状态信息。  多个服务器可能共享同一个区域。 &lt;/p&gt;&lt;a name=&quot;data&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  数据 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;  提供以下状态信息： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;version&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;version&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  提供的数据集的版本。  目前的版本是8。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;nginx_version&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   nginx的版本。 &lt;/dd&gt;&lt;dt id=&quot;nginx_build&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;nginx_build&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   nginx构建的名称。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;address&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  接受状态请求的服务器的地址。 &lt;/dd&gt;&lt;dt id=&quot;generation&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;generation&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  配置&lt;a hhref=&quot;control.html#reconfiguration&quot;&gt;重新加载&lt;/a&gt;的总数。 &lt;/dd&gt;&lt;dt id=&quot;load_timestamp&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;load_timestamp&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  上次重新加载配置的时间，自Epoch以来的毫秒数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;timestamp&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   Epoch以来的当前时间（以毫秒为单位）。 &lt;/dd&gt;&lt;dt id=&quot;pid&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;pid&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  处理状态请求的工作进程的ID。 &lt;/dd&gt;&lt;dt id=&quot;ppid&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;ppid&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  启动&lt;a hhref=&quot;#pid&quot;&gt;工作进程&lt;/a&gt;的主进程的ID。 &lt;/dd&gt;&lt;dt id=&quot;processes&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;processes&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;respawned&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;respawned&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  异常终止和重生的子进程的总数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;connections&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;accepted&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  已接受的客户端连接总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;dropped&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  已删除的客户端连接总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;active&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前活动客户端连接数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;idle&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前空闲客户端连接数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;ssl&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;ssl&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;handshakes&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  成功的SSL握手总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;handshakes_failed&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  失败的SSL握手总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;session_reuses&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   SSL握手期间会话​​重用的总次数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;requests&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;total&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  客户端请求的总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;current&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前的客户端请求数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;server_zones&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;server_zones&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于每个&lt;a hhref=&quot;#status_zone&quot;&gt;status_zone&lt;/a&gt; ： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;processing&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前正在处理的客户端请求数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;requests&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从客户端收到的客户端请求总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;responses&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;total&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  发送给客户端的响应总数。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;1xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;2xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;3xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;4xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;5xx&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  状态代码为1xx，2xx，3xx，4xx和5xx的响应数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;discarded&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;discarded&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  未发送响应而完成的请求总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;received&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从客户端收到的总字节数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;sent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  发送给客户端的总字节数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;slabs&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;slabs&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于使用slab分配器的每个共享内存区域： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;pages&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;used&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前使用的内存页数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;free&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前可用内存页数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;slots&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于每个内存插槽大小（8,16,32,64,128等），提供以下数据： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;used&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前使用的内存插槽数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;free&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前可用内存插槽的数量。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;reqs&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  分配指定大小内存的总尝试次数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;fails&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  分配指定大小内存的尝试失败次数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;upstreams&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;upstreams&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于每个&lt;a hhref=&quot;ngx_http_upstream_module.html#zone&quot;&gt;动态可配置&lt;/a&gt; &lt;a hhref=&quot;ngx_http_upstream_module.html#upstream&quot;&gt;组&lt;/a&gt; ，提供以下数据： &lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;peers&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;peers&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于每个&lt;a hhref=&quot;ngx_http_upstream_module.html#server&quot;&gt;服务器&lt;/a&gt; ，提供以下数据： &lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;id&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;id&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器的ID。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器的&lt;a hhref=&quot;ngx_http_upstream_module.html#server&quot;&gt;地址&lt;/a&gt; 。 &lt;/dd&gt;&lt;dt id=&quot;name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;name&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   &lt;a hhref=&quot;ngx_http_upstream_module.html#server&quot;&gt;server&lt;/a&gt;指令中指定的&lt;a hhref=&quot;ngx_http_upstream_module.html#server&quot;&gt;服务器&lt;/a&gt;名称。 &lt;/dd&gt;&lt;dt id=&quot;service&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   &lt;a hhref=&quot;ngx_http_upstream_module.html#server&quot;&gt;server&lt;/a&gt;指令的&lt;a hhref=&quot;ngx_http_upstream_module.html#service&quot;&gt;服务&lt;/a&gt;参数值。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;backup&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  一个布尔值，指示服务器是否为&lt;a hhref=&quot;ngx_http_upstream_module.html#backup&quot;&gt;备份&lt;/a&gt;服务器。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;weight&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器的&lt;a hhref=&quot;ngx_http_upstream_module.html#weight&quot;&gt;重量&lt;/a&gt; 。 &lt;/dd&gt;&lt;dt id=&quot;state&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;state&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前状态，可以是“ &lt;code class=&quot;notranslate&quot;&gt;up&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;draining&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;down&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;checking&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; ”之一。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;active&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前活动连接数。 &lt;/dd&gt;&lt;dt id=&quot;max_conns&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器的&lt;a hhref=&quot;ngx_http_upstream_module.html#max_conns&quot;&gt;max_conns&lt;/a&gt;限制。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;requests&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  转发到此服务器的客户端请求总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;responses&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;total&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从此服务器获取的响应总数。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;1xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;2xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;3xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;4xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;5xx&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  状态代码为1xx，2xx，3xx，4xx和5xx的响应数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;sent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  发送到此服务器的总字节数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;received&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从此服务器接收的总字节数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;fails&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与服务器通信失败的总次数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  由于尝试达到&lt;a hhref=&quot;ngx_http_upstream_module.html#max_fails&quot;&gt;max_fails&lt;/a&gt;阈值的次数不成功，服务器因客户端请求（状态为“ &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; ”）而变为不可用的次数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;health_checks&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;checks&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  进行的&lt;a hhref=&quot;ngx_http_upstream_hc_module.html#health_check&quot;&gt;健康检查&lt;/a&gt;请求总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;fails&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  健康检查失败的次数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器变得不健康的次数（状态“ &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; ”）。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;last_passed&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  布尔值，指示上次运行状况检查请求是否成功并通过了&lt;a hhref=&quot;ngx_http_upstream_hc_module.html#match&quot;&gt;测试&lt;/a&gt; 。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;downtime&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器处于“ &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;checking&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; ”状态的总时间。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;downstart&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器变为“ &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;checking&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; ”时的时间（自Epoch以来的毫秒数）。 &lt;/dd&gt;&lt;dt id=&quot;selected&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;selected&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  上次选择服务器处理请求时的时间（自Epoch以来的毫秒数）（1.7.5）。 &lt;/dd&gt;&lt;dt id=&quot;header_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;header_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从服务器获取&lt;a hhref=&quot;ngx_http_upstream_module.html#var_upstream_header_time&quot;&gt;响应头&lt;/a&gt;的平均时间（1.7.10）。  在1.11.6版之前，该字段仅在使用&lt;a hhref=&quot;ngx_http_upstream_module.html#least_time&quot;&gt;least_time&lt;/a&gt;负载平衡方法时可用。 &lt;/dd&gt;&lt;dt id=&quot;response_time&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;response_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从服务器获得&lt;a hhref=&quot;ngx_http_upstream_module.html#var_upstream_response_time&quot;&gt;完整响应&lt;/a&gt;的平均时间（1.7.10）。  在1.11.6版之前，该字段仅在使用&lt;a hhref=&quot;ngx_http_upstream_module.html#least_time&quot;&gt;least_time&lt;/a&gt;负载平衡方法时可用。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;keepalive&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前空闲&lt;a hhref=&quot;ngx_http_upstream_module.html#keepalive&quot;&gt;keepalive&lt;/a&gt;连接数。 &lt;/dd&gt;&lt;dt id=&quot;zombies&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;zombies&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从组中删除但仍处理活动客户端请求的当前服务器数。 &lt;/dd&gt;&lt;dt id=&quot;zone&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;zone&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保持组配置和运行时状态的共享内存&lt;a hhref=&quot;ngx_http_upstream_module.html#zone&quot;&gt;区域&lt;/a&gt;的名称。 &lt;/dd&gt;&lt;dt id=&quot;queue&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;queue&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于请求&lt;a hhref=&quot;ngx_http_upstream_module.html#queue&quot;&gt;队列&lt;/a&gt; ，提供以下数据： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;size&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  队列中当前的请求数。 &lt;/dd&gt;&lt;dt id=&quot;max_size&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;max_size&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  可以同时在队列中的最大请求数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;overflows&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  由于队列溢出而拒绝的请求总数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;caches&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;caches&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于每个缓存（由&lt;a hhref=&quot;ngx_http_proxy_module.html#proxy_cache_path&quot;&gt;proxy_cache_path&lt;/a&gt;等配置）： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;size&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  缓存的当前大小。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;max_size&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  配置中指定的高速缓存的最大大小限制。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;cold&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  一个布尔值，指示“缓存加载器”进程是否仍在将数据从磁盘加载到缓存中。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;hit&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;stale&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;updating&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;revalidated&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;responses&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从缓存中读取的响应总数（由于&lt;a hhref=&quot;ngx_http_proxy_module.html#proxy_cache_use_stale&quot;&gt;proxy_cache_use_stale&lt;/a&gt;等而导致的命中或过时响应）。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;bytes&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从缓存中读取的总字节数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;miss&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;expired&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;bypass&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;responses&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  未从缓存中获取的响应总数（由于&lt;a hhref=&quot;ngx_http_proxy_module.html#proxy_cache_bypass&quot;&gt;proxy_cache_bypass&lt;/a&gt;等而导致的未命中，到期或绕过）。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;bytes&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从代理服务器读取的总字节数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;responses_written&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  写入缓存的响应总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;bytes_written&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  写入缓存的总字节数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;stream&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;stream&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;stream_server_zones&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;server_zones&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于每个&lt;a hhref=&quot;#status_zone&quot;&gt;status_zone&lt;/a&gt; ： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;processing&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前正在处理的客户端连接数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;connections&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从客户端接受的连接总数。 &lt;/dd&gt;&lt;dt id=&quot;sessions&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;sessions&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;total&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  已完成的客户会话总数。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;2xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;4xx&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;5xx&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  已完成的会话数， &lt;a hhref=&quot;stream/ngx_stream_core_module.html#var_status&quot;&gt;状态代码为&lt;/a&gt; 2xx，4xx或5xx。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_discarded&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;discarded&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  在不创建会话的情况下完成的连接总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;received&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从客户端收到的总字节数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;sent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  发送给客户端的总字节数。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_upstreams&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;upstreams&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于每个&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#zone&quot;&gt;动态可配置&lt;/a&gt; &lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#upstream&quot;&gt;组&lt;/a&gt; ，提供以下数据： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;peers&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  对于每个&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#server&quot;&gt;服务器&lt;/a&gt; ，提供以下数据： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;id&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器的ID。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器的&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#server&quot;&gt;地址&lt;/a&gt; 。 &lt;/dd&gt;&lt;dt id=&quot;stream_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;name&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   &lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#server&quot;&gt;server&lt;/a&gt;指令中指定的&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#server&quot;&gt;服务器&lt;/a&gt;名称。 &lt;/dd&gt;&lt;dt id=&quot;stream_service&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   &lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#server&quot;&gt;server&lt;/a&gt;指令的&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#service&quot;&gt;服务&lt;/a&gt;参数值。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;backup&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  一个布尔值，指示服务器是否为&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#backup&quot;&gt;备份&lt;/a&gt;服务器。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;weight&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器的&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#weight&quot;&gt;重量&lt;/a&gt; 。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;state&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前状态，可以是“ &lt;code class=&quot;notranslate&quot;&gt;up&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;down&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;checking&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; ”之一。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;active&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前的连接数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器的&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#max_conns&quot;&gt;max_conns&lt;/a&gt;限制。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;connections&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  转发到此服务器的客户端连接总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;connect_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  连接上游服务器的平均时间。  在1.11.6版之前，该字段仅在使用&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#least_time&quot;&gt;least_time&lt;/a&gt;负载平衡方法时可用。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;first_byte_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  接收第一个数据字节的平均时间。  在1.11.6版之前，该字段仅在使用&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#least_time&quot;&gt;least_time&lt;/a&gt;负载平衡方法时可用。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;response_time&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  接收最后一个数据字节的平均时间。  在1.11.6版之前，该字段仅在使用&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#least_time&quot;&gt;least_time&lt;/a&gt;负载平衡方法时可用。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;sent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  发送到此服务器的总字节数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;received&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  从此服务器接收的总字节数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;fails&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与服务器通信失败的总次数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  由于尝试达到&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#max_fails&quot;&gt;max_fails&lt;/a&gt;阈值的次数不成功，服务器无法进行客户端连接（状态为“ &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; ”）的次数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;health_checks&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;checks&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  进行的&lt;a hhref=&quot;stream/ngx_stream_upstream_hc_module.html#health_check&quot;&gt;健康检查&lt;/a&gt;请求总数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;fails&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  健康检查失败的次数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器变得不健康的次数（状态“ &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; ”）。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;last_passed&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  布尔值，指示上次运行状况检查请求是否成功并通过了&lt;a hhref=&quot;stream/ngx_stream_upstream_hc_module.html#match&quot;&gt;测试&lt;/a&gt; 。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;downtime&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器处于“ &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;checking&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; ”状态的总时间。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;downstart&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器变为“ &lt;code class=&quot;notranslate&quot;&gt;unavail&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;checking&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;unhealthy&lt;/code&gt; ”时的时间（自Epoch以来的毫秒数）。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;selected&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  上次选择服务器以处理连接时的时间（自Epoch以来的毫秒数）。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;zombies&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前从组中删除但仍处理活动客户端连接的服务器数。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;zone&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保持组配置和运行时状态的共享内存&lt;a hhref=&quot;stream/ngx_stream_upstream_module.html#zone&quot;&gt;区域&lt;/a&gt;的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;/dl&gt;&lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;compatibility&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  兼容性 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;&lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 8中添加了&lt;a hhref=&quot;#upstreams&quot;&gt;http&lt;/a&gt;和&lt;a hhref=&quot;#stream_upstreams&quot;&gt;流&lt;/a&gt;上游中的&lt;a hhref=&quot;#zone&quot;&gt;区域&lt;/a&gt;字段。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 8中添加了&lt;a hhref=&quot;#slabs&quot;&gt;slab&lt;/a&gt;状态数据。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 8中添加了&lt;a hhref=&quot;#state&quot;&gt;检查&lt;/a&gt;状态。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 8中添加了&lt;a hhref=&quot;#upstreams&quot;&gt;http&lt;/a&gt;和&lt;a hhref=&quot;#stream_upstreams&quot;&gt;流&lt;/a&gt;上游中的&lt;a hhref=&quot;#name&quot;&gt;名称&lt;/a&gt;和&lt;a hhref=&quot;#service&quot;&gt;服务&lt;/a&gt;字段。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 8中添加了&lt;a hhref=&quot;#nginx_build&quot;&gt;nginx_build&lt;/a&gt;和&lt;a hhref=&quot;#ppid&quot;&gt;ppid&lt;/a&gt;字段。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 7中添加了&lt;a hhref=&quot;#sessions&quot;&gt;会话&lt;/a&gt;状态数据和流&lt;a hhref=&quot;#stream_server_zones&quot;&gt;server_zones&lt;/a&gt;中的&lt;a hhref=&quot;#stream_discarded&quot;&gt;丢弃&lt;/a&gt;字段。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#zombies&quot;&gt;僵尸&lt;/a&gt;字段是从&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 6中的nginx &lt;a hhref=&quot;debugging_log.html&quot;&gt;调试&lt;/a&gt;版本移动的。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 6中添加了&lt;a hhref=&quot;#ssl&quot;&gt;ssl&lt;/a&gt;状态数据。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#server_zones&quot;&gt;server_zones中&lt;/a&gt;的&lt;a hhref=&quot;#discarded&quot;&gt;丢弃&lt;/a&gt;字段已在&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 6中添加。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#queue&quot;&gt;队列&lt;/a&gt;状态数据已在&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 6中添加。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#pid&quot;&gt;pid&lt;/a&gt;字段已在&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 6中添加。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#upstreams&quot;&gt;上游&lt;/a&gt;中的服务器列表已移至&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 6中的&lt;a hhref=&quot;#peers&quot;&gt;对等项&lt;/a&gt; 。 &lt;/li&gt;&lt;li&gt;  在&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 5中删除了上游服务器的&lt;code class=&quot;notranslate&quot;&gt;keepalive&lt;/code&gt;字段。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#stream&quot;&gt;流&lt;/a&gt;状态数据已在&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 5中添加。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#generation&quot;&gt;生成&lt;/a&gt;字段已在&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 5中添加。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#processes&quot;&gt;进程中&lt;/a&gt;重新&lt;a hhref=&quot;#respawned&quot;&gt;生成的&lt;/a&gt;字段已在&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 5中添加。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 5中添加了&lt;a hhref=&quot;#upstreams&quot;&gt;上游&lt;/a&gt;中的&lt;a hhref=&quot;#header_time&quot;&gt;header_time&lt;/a&gt;和&lt;a hhref=&quot;#response_time&quot;&gt;response_time&lt;/a&gt;字段。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 4中添加了&lt;a hhref=&quot;#upstreams&quot;&gt;上游中&lt;/a&gt;的&lt;a hhref=&quot;#selected&quot;&gt;选定&lt;/a&gt;字段。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 4中添加了&lt;a hhref=&quot;#upstreams&quot;&gt;上游&lt;/a&gt;的&lt;a hhref=&quot;#state&quot;&gt;排水&lt;/a&gt;状态。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#upstreams&quot;&gt;上游&lt;/a&gt;中的&lt;a hhref=&quot;#id&quot;&gt;id&lt;/a&gt;和&lt;a hhref=&quot;#max_conns&quot;&gt;max_conns&lt;/a&gt;字段已在&lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 3中添加。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 3中添加了&lt;a hhref=&quot;#caches&quot;&gt;缓存&lt;/a&gt;中&lt;code class=&quot;notranslate&quot;&gt;revalidated&lt;/code&gt;字段。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#version&quot;&gt;版本&lt;/a&gt; 2中添加了&lt;a hhref=&quot;#server_zones&quot;&gt;server_zones&lt;/a&gt; ， &lt;a hhref=&quot;#caches&quot;&gt;caches&lt;/a&gt;和&lt;a hhref=&quot;#load_timestamp&quot;&gt;load_timestamp&lt;/a&gt;状态数据。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_ssl_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_ssl_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#ssl">ssl</a> <br>     <a hhref="#ssl_buffer_size">ssl_buffer_size</a> <br>     <a hhref="#ssl_certificate">ssl_certificate</a> <br>     <a hhref="#ssl_certificate_key">ssl_certificate_key</a> <br>     <a hhref="#ssl_ciphers">ssl_ciphers</a> <br>     <a hhref="#ssl_client_certificate">ssl_client_certificate</a> <br>     <a hhref="#ssl_crl">ssl_crl</a> <br>     <a hhref="#ssl_dhparam">ssl_dhparam</a> <br>     <a hhref="#ssl_early_data">ssl_early_data</a> <br>     <a hhref="#ssl_ecdh_curve">ssl_ecdh_curve</a> <br>     <a hhref="#ssl_password_file">ssl_password_file</a> <br>     <a hhref="#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a> <br>     <a hhref="#ssl_protocols">ssl_protocols</a> <br>     <a hhref="#ssl_session_cache">ssl_session_cache</a> <br>     <a hhref="#ssl_session_ticket_key">ssl_session_ticket_key</a> <br>     <a hhref="#ssl_session_tickets">ssl_session_tickets</a> <br>     <a hhref="#ssl_session_timeout">ssl_session_timeout</a> <br>     <a hhref="#ssl_stapling">ssl_stapling</a> <br>     <a hhref="#ssl_stapling_file">ssl_stapling_file</a> <br>     <a hhref="#ssl_stapling_responder">ssl_stapling_responder</a> <br>     <a hhref="#ssl_stapling_verify">ssl_stapling_verify</a> <br>     <a hhref="#ssl_trusted_certificate">ssl_trusted_certificate</a> <br>     <a hhref="#ssl_verify_client">ssl_verify_client</a> <br>     <a hhref="#ssl_verify_depth">ssl_verify_depth</a> <br> <a hhref="#errors">Error Processing</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_ssl_module</code>模块为HTTPS提供必要的支持。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_ssl_module</code>配置参数启用它。 </p><blockquote class="note">  该模块需要<a hhref="http://www.openssl.org">OpenSSL</a>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  为减少处理器负载，建议使用 </p><ul class="compact"><li>  设置<a hhref="ngx_core_module.html#worker_processes">工作进程数</a>等于处理器数， </li><li>  启用<a hhref="ngx_http_core_module.html#keepalive_timeout">保持活动</a>连接， </li><li>  启用<a hhref="#ssl_session_cache_shared">共享</a>会话缓存， </li><li>  禁用<a hhref="#ssl_session_cache_builtin">内置</a>会话缓存， </li><li>  并可能增加会话<a hhref="#ssl_session_timeout">生命周期</a> （默认为5分钟）： </li></ul><p></p><blockquote class="example"><pre class="notranslate"> <strong>worker_processes auto;</strong><p></p>
<p>http {</p>
<pre><code>...

server {
    listen              443 ssl;
    &lt;strong&gt;keepalive_timeout   70;&lt;/strong&gt;

    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;
    ssl_certificate     /usr/local/nginx/conf/cert.pem;
    ssl_certificate_key /usr/local/nginx/conf/cert.key;
    &lt;strong&gt;ssl_session_cache   shared:SSL:10m;&lt;/strong&gt;
    &lt;strong&gt;ssl_session_timeout 10m;&lt;/strong&gt;

    ...
}
</code></pre><p></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="ssl"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  该指令在1.15.0版本中已过时。  应该使用<a hhref="ngx_http_core_module.html#listen">listen</a>指令的<code class="notranslate">ssl</code>参数。 </p><a name="ssl_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_buffer_size 16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.9版本中。 </p></div><p>  设置用于发送数据的缓冲区的大小。 </p><p>  默认情况下，缓冲区大小为16k，这对应于发送大响应时的最小开销。  要最小化第一个字节的时间，使用较小的值可能是有益的，例如： </p><blockquote class="example"><pre class="notranslate">ssl_buffer_size 4k;<br></pre></blockquote><p></p><a name="ssl_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有给定虚拟服务器的PEM格式的证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。  如果除了主证书之外还应指定中间证书，则应按以下顺序在同一文件中指定它们：首先是主证书，然后是中间证书。   PEM格式的密钥可以放在同一文件中。 &lt;/p&gt;&lt;p&gt;  从版本1.11.0开始，可以多次指定此指令以加载不同类型的证书，例如，RSA和ECDSA： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;server {
listen              443 ssl;
server_name         example.com;

ssl_certificate     example.com.rsa.crt;
ssl_certificate_key example.com.rsa.key;

ssl_certificate     example.com.ecdsa.crt;
ssl_certificate_key example.com.ecdsa.key;

...
</code></pre><p>}<br></p><p></p><blockquote class="note">  只有OpenSSL 1.0.2或更高版本支持不同<a hhref="configuring_https_servers.html#chains">证书的</a>单独<a hhref="configuring_https_servers.html#chains">证书链</a> 。  对于旧版本，只能使用一个证书链。 </blockquote><p></p><p>  应该记住，由于HTTPS协议对最大互操作性的限制，虚拟服务器应该监听<a hhref="configuring_https_servers.html#name_based_https_servers">不同的IP地址</a> 。 </p><a name="ssl_certificate_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_certificate_key</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有给定虚拟服务器的PEM格式的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  可以指定value &lt;code class=&quot;notranslate&quot;&gt;engine&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;而不是&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; （1.7.9），该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;从OpenSSL引擎&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;加载具有指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;密钥。 &lt;/p&gt;&lt;a name=&quot;ssl_ciphers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_ciphers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ciphers&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;ssl_ciphers HIGH:!aNULL:!MD5;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定启用的密码。  密码以OpenSSL库理解的格式指定，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_ciphers ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
</code></pre><p></p><p></p><p>  可以使用“ <code class="notranslate">openssl ciphers</code> ”命令查看完整列表。 </p><p></p><blockquote class="note">  以前版本的nginx默认使用<a hhref="configuring_https_servers.html#compatibility">不同的</a>密码。 </blockquote><p></p><a name="ssl_client_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_client_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  如果启用了&lt;a hhref=&quot;#ssl_stapling&quot;&gt;ssl_stapling，&lt;/a&gt;则指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该证书用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书和OCSP响应。 &lt;/p&gt;&lt;p&gt;  证书列表将发送给客户。  如果不需要，可以使用&lt;a hhref=&quot;#ssl_trusted_certificate&quot;&gt;ssl_trusted_certificate&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;ssl_crl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_crl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.8.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的已吊销证书（CRL）的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书。 &lt;/p&gt;&lt;a name=&quot;ssl_dhparam&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_dhparam&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.7.2版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  为DHE密码指定具有DH参数的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  默认情况下，不设置任何参数，因此不会使用DHE密码。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.11.0版之前，默认使用内置参数。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;ssl_early_data&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_early_data&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;ssl_early_data off;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.3版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用TLS 1.3 &lt;a hhref=&quot;https://tools.ietf.org/html/rfc8446#section-2.3&quot;&gt;早期数据&lt;/a&gt; 。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在早期数据中发送的请求会受到&lt;a hhref=&quot;https://tools.ietf.org/html/rfc8470&quot;&gt;重播攻击&lt;/a&gt; 。  为了防止应用程序层发生此类攻击，应使用&lt;a hhref=&quot;#var_ssl_early_data&quot;&gt;$ ssl_early_data&lt;/a&gt;变量。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_set_header Early-Data $ssl_early_data;
</code></pre><p></p><p></p><blockquote class="note">  使用OpenSSL 1.1.1或更高版本（1.15.4）和<a hhref="https://boringssl.googlesource.com/boringssl/">BoringSSL</a>时，支持该指令。 </blockquote><p></p><a name="ssl_ecdh_curve"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_ecdh_curve</strong> <code class="notranslate"><i>curve</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_ecdh_curve auto;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.0和1.0.6版本中。 </p></div><p>  指定ECDHE密码的<code class="notranslate"><i>curve</i></code> 。 </p><p>  使用OpenSSL 1.0.2或更高版本时，可以指定多条曲线（1.11.0），例如： </p><blockquote class="example"><pre class="notranslate">ssl_ecdh_curve prime256v1:secp384r1;<br></pre></blockquote><p></p><p>  特殊值<code class="notranslate">auto</code> （1.11.0）指示nginx在使用OpenSSL 1.0.2或更高版本时使用内置在OpenSSL库中的列表，或者使用旧版本的<code class="notranslate">prime256v1</code> 。 </p><p></p><blockquote class="note">  在版本1.11.0之前，默认使用<code class="notranslate">prime256v1</code>曲线。 </blockquote><p></p><a name="ssl_password_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_password_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.3版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有密钥密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;http {
ssl_password_file /etc/keys/global.pass;
...

server {
    server_name www1.example.com;
    ssl_certificate_key /etc/keys/first.key;
}

server {
    server_name www2.example.com;

    # named pipe can also be used instead of a file
    ssl_password_file /etc/keys/fifo;
    ssl_certificate_key /etc/keys/second.key;
}
</code></pre><p>}<br></p><p></p><a name="ssl_prefer_server_ciphers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_prefer_server_ciphers</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_prefer_server_ciphers off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  指定在使用SSLv3和TLS协议时，服务器密码应优先于客户端密码。 </p><a name="ssl_protocols"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_protocols</strong><br>    [ <code class="notranslate">SSLv2</code> ]<br>    [ <code class="notranslate">SSLv3</code> ]<br>    [ <code class="notranslate">TLSv1</code> ]<br>    [ <code class="notranslate">TLSv1.1</code> ]<br>    [ <code class="notranslate">TLSv1.2</code> ]<br>    [ <code class="notranslate">TLSv1.3</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  启用指定的协议。 </p><blockquote class="note">   <code class="notranslate">TLSv1.1</code>和<code class="notranslate">TLSv1.2</code>参数（ <code class="notranslate">TLSv1.2</code> ）仅在使用OpenSSL 1.0.1或更高版本时有效。 </blockquote><p></p><blockquote class="note">  仅当使用使用TLSv1.3支持构建的OpenSSL 1.1.1时， <code class="notranslate">TLSv1.3</code>参数（1.13.0）才有效。 </blockquote><p></p><a name="ssl_session_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_cache</strong><br>    <code class="notranslate">off</code> |<br>    <code class="notranslate">none</code> |<br>    [ <code class="notranslate">builtin</code> [: <code class="notranslate"><i>size</i></code> ]]<br>    [ <code class="notranslate">shared</code> : <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_cache none;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置存储会话参数的缓存的类型和大小。  缓存可以是以下任何类型： </p><dl class="compact"><dt> <code class="notranslate">off</code> </dt> <dd>  严格禁止使用会话缓存：nginx明确告诉客户端会话可能不会被重用。 </dd><dt> <code class="notranslate">none</code> </dt> <dd>  轻轻地禁止使用会话缓存：nginx告诉客户端会话可以重用，但实际上并不会将会话参数存储在缓存中。 </dd><dt id="ssl_session_cache_builtin"> <code class="notranslate">builtin</code> </dt> <dd>  一个用OpenSSL构建的缓存;  仅由一个工作进程使用。  缓存大小在会话中指定。  如果未给出大小，则等于20480个会话。  使用内置缓存可能会导致内存碎片。 </dd><dt id="ssl_session_cache_shared"> <code class="notranslate">shared</code> </dt> <dd>  所有工作进程之间共享的缓存。  高速缓存大小以字节为单位指定;  一兆字节可以存储大约4000个会话。  每个共享缓存都应具有任意名称。  可以在多个虚拟服务器中使用具有相同名称的缓存。 </dd></dl><p></p><p>  两种缓存类型可以同时使用，例如： </p><blockquote class="example"><pre class="notranslate">ssl_session_cache builtin:1000 shared:SSL:10m;<br></pre></blockquote><p>  但只使用没有内置缓存的共享缓存应该更有效。 </p><a name="ssl_session_ticket_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_ticket_key</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置具有用于加密和解密TLS会话票证的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; 。  如果必须在多个服务器之间共享相同的密钥，则该指令是必需的。  默认情况下，使用随机生成的密钥。 &lt;/p&gt;&lt;p&gt;  如果指定了多个密钥，则仅使用第一个密钥来加密TLS会话票证。  这允许配置键旋转，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_session_ticket_key current.key;
</code></pre><p>ssl_session_ticket_key previous.key;<br></p><p></p><p>  该<code class="notranslate"><i>file</i></code>必须包含80或48个字节的随机数据，并且可以使用以下命令创建： </p><blockquote class="example"><pre class="notranslate">openssl rand 80 &gt; ticket.key<br></pre></blockquote><p>  根据文件大小，AES256（对于80字节密钥，1.11.8）或AES128（对于48字节密钥）用于加密。 </p><a name="ssl_session_tickets"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_tickets</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_tickets on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.9版本中。 </p></div><p>  通过<a hhref="https://tools.ietf.org/html/rfc5077">TLS会话票证</a>启用或禁用会话恢复。 </p><a name="ssl_session_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_session_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_session_timeout 5m;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  指定客户端可以重用会话参数的时间。 </p><a name="ssl_stapling"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_stapling</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_stapling off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.3.7版本中。 </p></div><p>  启用或禁用服务器<a hhref="https://tools.ietf.org/html/rfc6066#section-8">对OCSP响应</a>的<a hhref="https://tools.ietf.org/html/rfc6066#section-8">装订</a> 。  例： </p><blockquote class="example"><pre class="notranslate">ssl_stapling on;<br>resolver 192.0.2.1;<br></pre></blockquote><p></p><p>  要使OCSP装订起作用，应该知道服务器证书颁发者的证书。  如果<a hhref="#ssl_certificate">ssl_certificate</a>文件不包含中间证书，则服务器证书颁发者的证书应存在于<a hhref="#ssl_trusted_certificate">ssl_trusted_certificate</a>文件中。 </p><p>  要解析OCSP响应程序主机名，还应指定<a hhref="ngx_http_core_module.html#resolver">解析程序</a>指令。 </p><a name="ssl_stapling_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_stapling_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.3.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置后，将从指定的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;获取装订的OCSP响应，而不是查询服务器证书中指定的OCSP响应程序。 &lt;/p&gt;&lt;p&gt;  该文件应为DER格式，由“ &lt;code class=&quot;notranslate&quot;&gt;openssl ocsp&lt;/code&gt; ”命令生成。 &lt;/p&gt;&lt;a name=&quot;ssl_stapling_responder&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_stapling_responder&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;url&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.3.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  覆盖“ &lt;a hhref=&quot;https://tools.ietf.org/html/rfc5280#section-4.2.2.1&quot;&gt;Authority Information Access&lt;/a&gt; ”证书扩展中指定的OCSP响应程序的URL。 &lt;/p&gt;&lt;p&gt;  仅支持“ &lt;code class=&quot;notranslate&quot;&gt;http://&lt;/code&gt; ”OCSP响应者： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;ssl_stapling_responder http://ocsp.example.com/;
</code></pre><p></p><p></p><a name="ssl_stapling_verify"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_stapling_verify</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssl_stapling_verify off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.3.7版本中。 </p></div><p>  启用或禁用服务器对OCSP响应的验证。 </p><p>  要使验证<a hhref="#ssl_trusted_certificate">生效，</a>应使用<a hhref="#ssl_trusted_certificate">ssl_trusted_certificate</a>指令将服务器证书颁发者的证书，根证书和所有中间证书配置为受信任。 </p><a name="ssl_trusted_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_trusted_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.3.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果启用了&lt;a hhref=&quot;#ssl_stapling&quot;&gt;ssl_stapling，&lt;/a&gt;则指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该证书用于&lt;a hhref=&quot;#ssl_verify_client&quot;&gt;验证&lt;/a&gt;客户端证书和OCSP响应。 &lt;/p&gt;&lt;p&gt;  与&lt;a hhref=&quot;#ssl_client_certificate&quot;&gt;ssl_client_certificate&lt;/a&gt;设置的证书&lt;a hhref=&quot;#ssl_client_certificate&quot;&gt;不同&lt;/a&gt; ，这些证书的列表不会发送给客户端。 &lt;/p&gt;&lt;a name=&quot;ssl_verify_client&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_verify_client&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;optional&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;optional_no_ca&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;ssl_verify_client off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用客户端证书验证。  验证结果存储在&lt;a hhref=&quot;#var_ssl_client_verify&quot;&gt;$ ssl_client_verify&lt;/a&gt;变量中。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;optional&lt;/code&gt;参数（0.8.7+）请求客户端证书，并在证书存在时验证它。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;optional_no_ca&lt;/code&gt;参数（1.3.8,1.2.5）请求客户端证书，但不要求它由受信任的CA证书签名。  这适用于nginx外部的服务执行实际证书验证的情况。  可以通过&lt;a hhref=&quot;#var_ssl_client_cert&quot;&gt;$ ssl_client_cert&lt;/a&gt;变量访问证书的内容。 &lt;/p&gt;&lt;a name=&quot;ssl_verify_depth&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ssl_verify_depth&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;ssl_verify_depth 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置客户端证书链中的验证深度。 &lt;/p&gt;&lt;a name=&quot;errors&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  错误处理 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_http_ssl_module&lt;/code&gt;模块支持几个非标准错误代码，可以使用&lt;a hhref=&quot;ngx_http_core_module.html#error_page&quot;&gt;error_page&lt;/a&gt;指令用于重定向： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   495 &lt;/dt&gt;&lt;dd&gt;  客户端证书验证期间发生错误; &lt;/dd&gt;&lt;dt&gt;   496 &lt;/dt&gt;&lt;dd&gt;  客户未提交所需证书; &lt;/dd&gt;&lt;dt&gt;   497 &lt;/dt&gt;&lt;dd&gt;  已将常规请求发送到HTTPS端口。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  重定向发生在完全解析请求并且变量（例如&lt;code class=&quot;notranslate&quot;&gt;$request_uri&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;$uri&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;$args&lt;/code&gt;和其他变量）可用之后。 &lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_http_ssl_module&lt;/code&gt;模块支持几个嵌入变量： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_ssl_cipher&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$ssl_cipher&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  返回用于建立的SSL连接的密码字符串; &lt;/dd&gt;&lt;dt id=&quot;var_ssl_ciphers&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$ssl_ciphers&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  返回客户端支持的密码列表（1.11.7）。  已知密码按名称列出，未知以十六进制显示，例如： &lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;AES128-SHA:AES256-SHA:0x00ff
</code></pre><p><blockquote class="note">  仅在使用OpenSSL 1.0.2或更高版本时才完全支持该变量。  对于旧版本，该变量仅适用于新会话，仅列出已知密码。 </blockquote><dt id="var_ssl_client_escaped_cert"> <code class="notranslate">$ssl_client_escaped_cert</code> </dt> <dd>  以PEM格式（urlencoded）返回已建立SSL连接的客户端证书（1.13.5）; </dd><dt id="var_ssl_client_cert"> <code class="notranslate">$ssl_client_cert</code> </dt> <dd>  为已建立的SSL连接返回PEM格式的客户端证书，除了第一行前面的每一行都带有制表符;  这适用于<a hhref="ngx_http_proxy_module.html#proxy_set_header">proxy_set_header</a>指令; <blockquote class="note">  不推荐使用该变量，应该使用<code class="notranslate">$ssl_client_escaped_cert</code>变量。 </blockquote></dd><dt id="var_ssl_client_fingerprint"> <code class="notranslate">$ssl_client_fingerprint</code> </dt> <dd>  返回已建立SSL连接的客户端证书的SHA1指纹（1.7.1）; </dd><dt id="var_ssl_client_i_dn"> <code class="notranslate">$ssl_client_i_dn</code> </dt> <dd>  根据<a hhref="https://tools.ietf.org/html/rfc2253">RFC 2253</a> （1.11.6），为已建立的SSL连接返回客户端证书的“issuer DN”字符串; </dd><dt id="var_ssl_client_i_dn_legacy"> <code class="notranslate">$ssl_client_i_dn_legacy</code> </dt> <dd>  返回已建立SSL连接的客户端证书的“issuer DN”字符串; <blockquote class="note">  在1.11.6版之前，变量名称为<code class="notranslate">$ssl_client_i_dn</code> 。 </blockquote></dd><dt id="var_ssl_client_raw_cert"> <code class="notranslate">$ssl_client_raw_cert</code> </dt> <dd>  返回已建立SSL连接的PEM格式的客户端证书; </dd><dt id="var_ssl_client_s_dn"> <code class="notranslate">$ssl_client_s_dn</code> </dt> <dd>  根据<a hhref="https://tools.ietf.org/html/rfc2253">RFC 2253</a> （1.11.6），为已建立的SSL连接返回客户端证书的“subject DN”字符串; </dd><dt id="var_ssl_client_s_dn_legacy"> <code class="notranslate">$ssl_client_s_dn_legacy</code> </dt> <dd>  返回已建立SSL连接的客户端证书的“subject DN”字符串; <blockquote class="note">  在1.11.6版之前，变量名称为<code class="notranslate">$ssl_client_s_dn</code> 。 </blockquote></dd><dt id="var_ssl_client_serial"> <code class="notranslate">$ssl_client_serial</code> </dt> <dd>  返回已建立的SSL连接的客户端证书的序列号; </dd><dt id="var_ssl_client_v_end"> <code class="notranslate">$ssl_client_v_end</code> </dt> <dd>  返回客户端证书的结束日期（1.11.7）; </dd><dt id="var_ssl_client_v_remain"> <code class="notranslate">$ssl_client_v_remain</code> </dt> <dd>  返回客户端证书到期前的天数（1.11.7）; </dd><dt id="var_ssl_client_v_start"> <code class="notranslate">$ssl_client_v_start</code> </dt> <dd>  返回客户端证书的开始日期（1.11.7）; </dd><dt id="var_ssl_client_verify"> <code class="notranslate">$ssl_client_verify</code> </dt> <dd>  返回客户端证书验证的结果：“ <code class="notranslate">SUCCESS</code> ”，“ <code class="notranslate">FAILED:</code> <code class="notranslate"><i>reason</i></code> ”，如果证书不存在则返回“ <code class="notranslate">NONE</code> ”; <blockquote class="note">  在1.11.7版之前，“ <code class="notranslate">FAILED</code> ”结果不包含<code class="notranslate"><i>reason</i></code>字符串。 </blockquote></dd><dt id="var_ssl_curves"> <code class="notranslate">$ssl_curves</code> </dt> <dd>  返回客户端支持的曲线列表（1.11.7）。  已知曲线按名称列出，未知以十六进制显示，例如： <blockquote class="example"><pre class="notranslate">0x001d:prime256v1:secp521r1:secp384r1<br></pre></blockquote><blockquote class="note">  仅在使用OpenSSL 1.0.2或更高版本时才支持该变量。  对于旧版本，变量值将为空字符串。 </blockquote><blockquote class="note">  该变量仅适用于新会话。 </blockquote></dd><dt id="var_ssl_early_data"> <code class="notranslate">$ssl_early_data</code> </dt> <dd>  如果使用TLS 1.3 <a hhref="#ssl_early_data">早期数据</a>并且握手未完成则返回“ <code class="notranslate">1</code> ”，否则返回“”（1.15.3）。 </dd><dt id="var_ssl_protocol"> <code class="notranslate">$ssl_protocol</code> </dt> <dd>  返回已建立的SSL连接的协议; </dd><dt id="var_ssl_server_name"> <code class="notranslate">$ssl_server_name</code> </dt> <dd>  返回通过<a hhref="http://en.wikipedia.org/wiki/Server_Name_Indication">SNI</a> （1.7.0）请求的服务器名称; </dd><dt id="var_ssl_session_id"> <code class="notranslate">$ssl_session_id</code> </dt> <dd>  返回已建立的SSL连接的会话标识; </dd><dt id="var_ssl_session_reused"> <code class="notranslate">$ssl_session_reused</code> </dt> <dd>  如果重用SSL会话，则返回“ <code class="notranslate">r</code> ”，或“ <code class="notranslate">.</code>   “否则（1.5.11）。 </dd></p><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_ssi_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_ssi_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#ssi">ssi</a> <br>     <a hhref="#ssi_last_modified">ssi_last_modified</a> <br>     <a hhref="#ssi_min_file_chunk">ssi_min_file_chunk</a> <br>     <a hhref="#ssi_silent_errors">ssi_silent_errors</a> <br>     <a hhref="#ssi_types">ssi_types</a> <br>     <a hhref="#ssi_value_length">ssi_value_length</a> <br> <a hhref="#commands">SSI Commands</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_ssi_module</code>模块是一个过滤器，用于处理通过它的响应中的SSI（服务器端包含）命令。  目前，支持的SSI命令列表不完整。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    ssi on;<br>    …<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="ssi"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssi</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssi off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用响应中SSI命令的处理。 </p><a name="ssi_last_modified"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssi_last_modified</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssi_last_modified off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.1版本中。 </p></div><p>  允许在SSI处理期间保留原始响应中的“Last-Modified”头字段，以便于响应缓存。 </p><p>  默认情况下，在处理过程中修改响应内容时会删除标题字段，并且可能包含动态生成的元素或与原始响应无关的部分。 </p><a name="ssi_min_file_chunk"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssi_min_file_chunk</strong> <code class="notranslate">size</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssi_min_file_chunk 1k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置存储在磁盘上的响应部分的最小<code class="notranslate"><i>size</i></code> ，从使用<a hhref="ngx_http_core_module.html#sendfile">sendfile</a>发送它们开始是有意义的。 </p><a name="ssi_silent_errors"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssi_silent_errors</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssi_silent_errors off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  如果启用，则在SSI处理期间发生<code class="notranslate">[an error occurred while processing the directive]</code> ，禁止输出“ <code class="notranslate">[an error occurred while processing the directive]</code> ”字符串。 </p><a name="ssi_types"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssi_types</strong> <code class="notranslate"><i>mime-type</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssi_types text/html;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  除了“ <code class="notranslate">text/html</code> ”之外，还可以在具有指定MIME类型的响应中处理SSI命令。  特殊值“ <code class="notranslate">*</code> ”匹配任何MIME类型（0.8.29）。 </p><a name="ssi_value_length"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssi_value_length</strong> <code class="notranslate"><i>length</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">ssi_value_length 256;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置SSI命令中参数值的最大长度。 </p><a name="commands"></a><center><h4>   SSI命令 </h4></center><p>   SSI命令具有以下通用格式： </p><blockquote class="example"><pre class="notranslate">&lt;!–# command parameter1=value1 parameter2=value2 … –&gt;<br></pre></blockquote><p></p><p>  支持以下命令： </p><dl class="compact"><dt> <code class="notranslate">block</code> </dt> <dd>  定义可在<code class="notranslate">include</code>命令中用作存根的块。  该块可以包含其他SSI命令。  该命令具有以下参数： <dl class="compact"><dt> <code class="notranslate">name</code> </dt> <dd>  块名称。 </dd></dl>  例： <blockquote class="example"><pre class="notranslate">&lt;!–# block name=”one” –&gt;<br>stub<br>&lt;!–# endblock –&gt;<br></pre></blockquote></dd><dt> <code class="notranslate">config</code> </dt> <dd>  设置SSI处理期间使用的一些参数，即： <dl class="compact"><dt> <code class="notranslate">errmsg</code> </dt> <dd>  在SSI处理期间发生错误时输出的字符串。  默认情况下，输出以下字符串： <blockquote class="example"><pre class="notranslate">[an error occurred while processing the directive]<br></pre></blockquote></dd><dt> <code class="notranslate">timefmt</code> </dt> <dd>  传递给<code class="notranslate">strftime()</code>函数的格式字符串，用于输出日期和时间。  默认情况下，使用以下格式： <blockquote class="example"><pre class="notranslate">“%A, %d-%b-%Y %H:%M:%S %Z”<br></pre></blockquote>   “ <code class="notranslate">%s</code> ”格式适合以秒为单位输出时间。 </dd></dl></dd><dt> <code class="notranslate">echo</code> </dt> <dd>  输出变量的值。  该命令具有以下参数： <dl class="compact"><dt> <code class="notranslate">var</code> </dt> <dd>  变量名称。 </dd><dt> <code class="notranslate">encoding</code> </dt> <dd>  编码方法。  可能的值包括<code class="notranslate">none</code> ， <code class="notranslate">url</code>和<code class="notranslate">entity</code> 。  默认情况下，使用<code class="notranslate">entity</code> 。 </dd><dt> <code class="notranslate">default</code> </dt> <dd>  一个非标准参数，如果未定义变量，则设置要输出的字符串。  默认情况下，输出“ <code class="notranslate">(none)</code> ”。  命令 <blockquote class="example"><pre class="notranslate">&lt;!–# echo var=”name” default=” <strong>no</strong> “ –&gt;<br></pre></blockquote>  替换以下命令序列： <blockquote class="example"><pre class="notranslate">&lt;!–# if expr=”$name” –&gt;&lt;!–# echo var=”name” –&gt;&lt;!–#<br>       else –&gt; <strong>no</strong> &lt;!–# endif –&gt;<br></pre></blockquote></dd></dl></dd><dt> <code class="notranslate">if</code> </dt> <dd>  执行条件包含。  支持以下命令： <blockquote class="example"><pre class="notranslate">&lt;!–# if expr=”…” –&gt;<br>…<br>&lt;!–# elif expr=”…” –&gt;<br>…<br>&lt;!–# else –&gt;<br>…<br>&lt;!–# endif –&gt;<br></pre></blockquote>  目前仅支持一级嵌套。  该命令具有以下参数： <dl class="compact"><dt> <code class="notranslate">expr</code> </dt> <dd>  表达。  表达式可以是： <ul class="compact"><li>  变量存在检查： <blockquote class="example"><pre class="notranslate">&lt;!–# if expr=”$name” –&gt;<br></pre></blockquote></li><li>  变量与文本的比较： <blockquote class="example"><pre class="notranslate">&lt;!–# if expr=”$name = <code class="notranslate"><i>text</i></code> “ –&gt;<br>&lt;!–# if expr=”$name != <code class="notranslate"><i>text</i></code> “ –&gt;<br></pre></blockquote></li><li>  变量与正则表达式的比较： <blockquote class="example"><pre class="notranslate">&lt;!–# if expr=”$name = / <code class="notranslate"><i>text</i></code> /“ –&gt;<br>&lt;!–# if expr=”$name != / <code class="notranslate"><i>text</i></code> /“ –&gt;<br></pre></blockquote></li></ul>  如果<code class="notranslate"><i>text</i></code>包含变量，则替换它们的值。  正则表达式可以包含以后可以通过变量使用的位置和命名捕获，例如： <blockquote class="example"><pre class="notranslate">&lt;!–# if expr=”$name = /(.+)@(?P&lt;domain&gt;.+)/“ –&gt;<br>    &lt;!–# echo var=”1” –&gt;<br>    &lt;!–# echo var=”domain” –&gt;<br>&lt;!–# endif –&gt;<br></pre></blockquote></dd></dl></dd><dt> <code class="notranslate">include</code> </dt> <dd>  将另一个请求的结果包含在响应中。  该命令具有以下参数： <dl class="compact"><dt> <code class="notranslate">file</code> </dt> <dd>  指定包含的文件，例如： <blockquote class="example"><pre class="notranslate">&lt;!–# include file=”footer.html” –&gt;<br></pre></blockquote></dd><dt> <code class="notranslate">virtual</code> </dt> <dd>  指定包含的请求，例如： <blockquote class="example"><pre class="notranslate">&lt;!–# include virtual=”/remote/body.php?argument=value” –&gt;<br></pre></blockquote>  在一个页面上指定并由代理或FastCGI / uwsgi / SCGI / gRPC服务器处理的多个请求并行运行。  如果需要顺序处理，则应使用<code class="notranslate">wait</code>参数。 </dd><dt> <code class="notranslate">stub</code> </dt> <dd>  一个非标准参数，用于命名块，如果包含的请求导致空体或在请求处理期间发生错误，则将输出其内容，例如： <blockquote class="example"><pre class="notranslate">&lt;!–# block name=”one” –&gt;&amp;nbsp;&lt;!–# endblock –&gt;<br>&lt;!–# include virtual=”/remote/body.php?argument=value” stub=”one” –&gt;<br></pre></blockquote>  替换块内容在包含的请求上下文中处理。 </dd><dt> <code class="notranslate">wait</code> </dt> <dd>  一个非标准参数，指示在继续进行SSI处理之前等待请求完全完成，例如： <blockquote class="example"><pre class="notranslate">&lt;!–# include virtual=”/remote/body.php?argument=value” wait=”yes” –&gt;<br></pre></blockquote></dd><dt id="ssi_include_set"> <code class="notranslate">set</code> </dt> <dd>  一个非标准参数，指示将请求处理的成功结果写入指定变量，例如： <blockquote class="example"><pre class="notranslate">&lt;!–# include virtual=”/remote/body.php?argument=value” set=”one” –&gt;<br></pre></blockquote>  响应的最大大小由subrequest_output_buffer_size指令（1.13.10）设置： <blockquote class="example"><pre class="notranslate">location /remote/ {<br>    subrequest_output_buffer_size 64k;<br>    …<br>}<br></pre></blockquote>  在版本1.13.10之前，只有使用<a hhref="ngx_http_proxy_module.html">ngx_http_proxy_module</a> ， <a hhref="ngx_http_memcached_module.html">ngx_http_memcached_module</a> ， <a hhref="ngx_http_fastcgi_module.html">ngx_http_fastcgi_module</a> （1.5.6）， <a hhref="ngx_http_uwsgi_module.html">ngx_http_uwsgi_module</a> （1.5.6）和<a hhref="ngx_http_scgi_module.html">ngx_http_scgi_module</a> （1.5.6）模块获得的响应结果才能写入变量。  响应的最大大小是使用<a hhref="ngx_http_proxy_module.html#proxy_buffer_size">proxy_buffer_size</a> ， <a hhref="ngx_http_memcached_module.html#memcached_buffer_size">memcached_buffer_size</a> ， <a hhref="ngx_http_fastcgi_module.html#fastcgi_buffer_size">fastcgi_buffer_size</a> ， <a hhref="ngx_http_uwsgi_module.html#uwsgi_buffer_size">uwsgi_buffer_size</a>和<a hhref="ngx_http_scgi_module.html#scgi_buffer_size">scgi_buffer_size</a>指令设置的。 </dd></dl></dd><dt> <code class="notranslate">set</code> </dt> <dd>  设置变量的值。  该命令具有以下参数： <dl class="compact"><dt> <code class="notranslate">var</code> </dt> <dd>  变量名称。 </dd><dt> <code class="notranslate">value</code> </dt> <dd>  变量值。  如果指定的值包含变量，则替换它们的值。 </dd></dl></dd></dl><p></p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_ssi_module</code>模块支持两个嵌入变量： </p><dl class="compact"><dt id="var_date_local"> <code class="notranslate">$date_local</code> </dt> <dd>  当地时区的当前时间。  该格式由<code class="notranslate">config</code>命令和<code class="notranslate">timefmt</code>参数设置。 </dd><dt id="var_date_gmt"> <code class="notranslate">$date_gmt</code> </dt> <dd>  格林威治标准时间当前时间  该格式由<code class="notranslate">config</code>命令和<code class="notranslate">timefmt</code>参数设置。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_split_clients_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_split_clients_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#split_clients">split_clients</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_split_clients_module</code>模块创建适用于A / B测试的变量，也称为拆分测试。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<br>    split_clients “${remote_addr}AAA” $variant {<br>                   0.5%               .one;<br>                   2.0%               .two;<p></p>
<pre><code>               *                  &quot;&quot;;
}

server {
    location / {
        index index${variant}.html;
</code></pre><p></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="split_clients"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>split_clients</strong><br>    <code class="notranslate"><i>string</i></code><br>    <code class="notranslate"><i>$variable</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为A / B测试创建变量，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;split_clients &quot;${remote_addr}AAA&quot; $variant {
   0.5%               .one;
   2.0%               .two;
   *                  &quot;&quot;;
</code></pre><p>}<br></p><p>  使用MurmurHash2对原始字符串的值进行哈希处理。  在给出的示例中，从0到21474835（0.5％）的哈希值对应于<code class="notranslate">$variant</code>变量的值<code class="notranslate">“.one”</code> ，从21474836到107374180（2％）的哈希值对应于值<code class="notranslate">“.two”</code>和哈希值从107374181到4294967295的值对应于值<code class="notranslate">“”</code> （空字符串）。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_spdy_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_spdy_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#issues">Known Issues</a> <br> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#spdy_chunk_size">spdy_chunk_size</a> <br>     <a hhref="#spdy_headers_comp">spdy_headers_comp</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_spdy_module</code>模块为<a hhref="http://www.chromium.org/spdy/spdy-protocol">SPDY</a>提供实验支持。  目前，已实施SPDY协议<a hhref="http://www.chromium.org/spdy/spdy-protocol/spdy-protocol-draft3-1">草案3.1</a> 。 </p><blockquote class="note">  在1.5.10版之前，实施了SPDY协议<a hhref="http://www.chromium.org/spdy/spdy-protocol/spdy-protocol-draft2">草案2</a> 。 </blockquote><p></p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_spdy_module</code>配置参数启用它。 </p><p></p><blockquote class="note">  该模块已被1.9.5中的<a hhref="ngx_http_v2_module.html">ngx_http_v2_module</a>模块取代。 </blockquote><p></p><a name="issues"></a><center><h4>  已知的问题 </h4></center><p>  该模块是实验性的，需要注意的是经纪人。 </p><p>   SPDY协议的当前实现不支持“服务器推送”。 </p><p>  在1.5.9之前的版本中，SPDY连接中的响应不能受<a hhref="ngx_http_core_module.html#limit_rate">速率限制</a> 。 </p><p>  无论<a hhref="ngx_http_proxy_module.html#proxy_request_buffering">proxy_request_buffering</a> ， <a hhref="ngx_http_fastcgi_module.html#fastcgi_request_buffering">fastcgi_request_buffering</a> ， <a hhref="ngx_http_uwsgi_module.html#uwsgi_request_buffering">uwsgi_request_buffering</a>和<a hhref="ngx_http_scgi_module.html#scgi_request_buffering">scgi_request_buffering</a>指令值如何，都无法禁用客户端请求正文的缓冲。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">server {<br>    listen 443 ssl spdy;<p></p>
<pre><code>ssl_certificate server.crt;
ssl_certificate_key server.key;
...
</code></pre><p>}<br></p></pre></blockquote><p></p><blockquote class="note">  请注意，为了在同一端口上同时接受<a hhref="ngx_http_ssl_module.html">HTTPS</a>和SPDY连接，所使用的<a hhref="http://www.openssl.org">OpenSSL</a>库应支持“Next Protocol Negotiation”TLS扩展，自Ope​​nSSL 1.0.1版开始可用。 </blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="spdy_chunk_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>spdy_chunk_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">spdy_chunk_size 8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.9版本中。 </p></div><p>  设置响应主体被<a hhref="http://www.chromium.org/spdy/spdy-protocol/spdy-protocol-draft2#TOC-Data-frames">切片</a>到的块的最大大小。  值太低会导致更高的开销。  由于<a hhref="http://en.wikipedia.org/wiki/Head-of-line_blocking">HOL阻塞，</a>太高的值会损害优先级。 </p><a name="spdy_headers_comp"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>spdy_headers_comp</strong> <code class="notranslate"><i>level</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">spdy_headers_comp 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置响应的标头压缩<code class="notranslate"><i>level</i></code> ，范围从1（最快，压缩程度较低）到9（最慢，最佳压缩）。  特殊值0关闭标头压缩。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_spdy_module</code>模块支持以下嵌入变量： </p><dl><dt id="var_spdy"> <code class="notranslate">$spdy</code> </dt> <dd>   SPDY连接的SPDY协议版本，否则为空字符串; </dd><dt id="var_spdy_request_priority"> <code class="notranslate">$spdy_request_priority</code> </dt> <dd>  请求SPDY连接的优先级，否则请求空字符串。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_slice_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_slice_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#slice">slice</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_slice_module</code>模块（1.9.8）是一个过滤器，它将请求拆分为子请求，每个子请求都返回一定范围的响应。  过滤器提供更有效的大响应缓存。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_slice_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    <strong>slice</strong>             1m;<br>    proxy_cache       cache;<br>    proxy_cache_key   $uri$is_args$args <strong>$slice_range</strong> ;<br>    proxy_set_header  Range <strong>$slice_range</strong> ;<br>    proxy_cache_valid 200 206 1h;<br>    proxy_pass        <a href="http://localhost:8000" target="_blank" rel="noopener">http://localhost:8000</a>;<br>}<br></pre></blockquote><p>  在此示例中，响应被拆分为1兆字节的可缓存切片。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="slice"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>slice</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">slice 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置切片的<code class="notranslate"><i>size</i></code> 。  零值禁用将响应拆分为切片。  请注意，值太低可能会导致内存使用过多并打开大量文件。 </p><p>  为了使子请求返回所需的范围， <code class="notranslate">$slice_range</code>变量应作为<code class="notranslate">Range</code>请求头字段<a hhref="ngx_http_proxy_module.html#proxy_set_header">传递</a>给代理服务器。  如果启用了<a hhref="ngx_http_proxy_module.html#proxy_cache">缓存</a> ，则应将<code class="notranslate">$slice_range</code>添加到<a hhref="ngx_http_proxy_module.html#proxy_cache_key">缓存键，</a>并<a hhref="ngx_http_proxy_module.html#proxy_cache_valid">启用</a>具有206状态代码的响应缓存。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_slice_module</code>模块支持以下嵌入变量： </p><dl class="compact"><dt id="var_slice_range"> <code class="notranslate">$slice_range</code> </dt> <dd>   <a hhref="https://tools.ietf.org/html/rfc7233#section-2.1">HTTP字节范围</a>格式的当前切片范围，例如， <code class="notranslate">bytes=0-1048575</code> 。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_session_log_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_session_log_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#session_log">session_log</a> <br>     <a hhref="#session_log_format">session_log_format</a> <br>     <a hhref="#session_log_zone">session_log_zone</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_session_log_module</code>模块启用日志记录会话（即多个HTTP请求的聚合），而不是单个HTTP请求。 </p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  以下配置根据请求客户端地址和“User-Agent”请求标头字段设置会话日志并将请求映射到会话： </p><blockquote class="example"><pre class="notranslate">    session_log_zone /path/to/log format=combined<br>                     zone=one:1m timeout=30s<br>                     md5=$binary_remote_addr$http_user_agent;<p></p>
<pre><code>location /media/ {
    session_log one;
}
</code></pre><p></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="session_log"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>session_log</strong> <code class="notranslate"><i>name</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">session_log off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  允许使用指定的会话日志。  特殊值<code class="notranslate">off</code>取消从先前配置级别继承的所有<code class="notranslate">session_log</code>指令。 </p><a name="session_log_format"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>session_log_format</strong><br>    <code class="notranslate"><i>name</i></code><br>    <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">session_log_format combined “…”;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  指定日志的输出格​​式。   <code class="notranslate">$body_bytes_sent</code>变量的值在会话中的所有请求中聚合。  可用于记录的所有其他变量的值对应于会话中的第一个请求。 </p><a name="session_log_zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>session_log_zone</strong><br>    <code class="notranslate"><i>path</i></code><br>    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code><br>    [ <code class="notranslate">format</code> = <code class="notranslate"><i>format</i></code> ]<br>    [ <code class="notranslate">timeout</code> = <code class="notranslate"><i>time</i></code> ]<br>    [ <code class="notranslate">id</code> = <code class="notranslate"><i>id</i></code> ]<br>    [ <code class="notranslate">md5</code> = <code class="notranslate"><i>md5</i></code> ]<br>;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置日志文件的路径，并配置用于存储当前活动会话的共享内存区域。 &lt;/p&gt;&lt;p&gt;  只要会话中的最后一个请求自指定&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; （默认为30秒）以来经过的时间，会话就被视为活动状态。  会话不再处于活动状态时，会将其写入日志。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;id&lt;/code&gt;参数标识请求映射到的会话。   &lt;code class=&quot;notranslate&quot;&gt;id&lt;/code&gt;参数设置为MD5哈希的十六进制表示（例如，使用变量从cookie获取）。  如果未指定此参数或不表示有效的MD5哈希，则nginx将根据&lt;code class=&quot;notranslate&quot;&gt;md5&lt;/code&gt;参数的值计算MD5哈希，并使用此哈希创建新会话。   &lt;code class=&quot;notranslate&quot;&gt;id&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;md5&lt;/code&gt;参数都可以包含变量。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;format&lt;/code&gt;参数设置&lt;a hhref=&quot;#session_log_format&quot;&gt;session_log_format&lt;/a&gt;指令配置的自定义会话日志格式。  如果未指定format，则使用预定义的“ &lt;code class=&quot;notranslate&quot;&gt;combined&lt;/code&gt; ”格式。 &lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_http_session_log_module&lt;/code&gt;模块支持两个嵌入变量： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_session_log_id&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$session_log_id&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  当前会话ID; &lt;/dd&gt;&lt;dt id=&quot;var_session_log_binary_id&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$session_log_binary_id&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  二进制形式的当前会话ID（16字节）。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_secure_link_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_secure_link_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#directives">Directives</a> <br>     <a hhref="#secure_link">secure_link</a> <br>     <a hhref="#secure_link_md5">secure_link_md5</a> <br>     <a hhref="#secure_link_secret">secure_link_secret</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_secure_link_module</code>模块（0.7.18）用于检查请求链路的真实性，保护资源免受未经授权的访问，并限制链路生存期。 </p><p>  通过将请求中传递的校验和值与为请求计算的值进行比较来验证所请求链接的真实性。  如果链接的生命周期有限且时间已过，则该链接将被视为过时。  这些检查的状态在<code class="notranslate">$secure_link</code>变量中可用。 </p><p>  该模块提供两种备选操作模式。  第一种模式由<a hhref="#secure_link_secret">secure_link_secret</a>指令启用，用于检查请求链接的真实性以及保护资源免受未经授权的访问。  第二种模式（0.8.50）由<a hhref="#secure_link">secure_link</a>和<a hhref="#secure_link_md5">secure_link_md5</a>指令启用，也用于限制链接的生命周期。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_secure_link_module</code>配置参数启用它。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="secure_link"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>secure_link</strong> <code class="notranslate"><i>expression</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义一个包含变量的字符串，从中提取链接的校验和值和生命周期。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;expression&lt;/i&gt;&lt;/code&gt;中使用的变量通常与请求相关联;  见下面的&lt;a hhref=&quot;#secure_link_md5&quot;&gt;例子&lt;/a&gt; 。 &lt;/p&gt;&lt;p&gt;  将从字符串中提取的校验和值与&lt;a hhref=&quot;#secure_link_md5&quot;&gt;secure_link_md5&lt;/a&gt;指令定义的表达式的MD5哈希值进行比较。  如果校验和不同，则&lt;code class=&quot;notranslate&quot;&gt;$secure_link&lt;/code&gt;变量设置为空字符串。  如果校验和相同，则检查链路生存期。  如果链接的生命周期有限且时间已过，则&lt;code class=&quot;notranslate&quot;&gt;$secure_link&lt;/code&gt;变量设置为“ &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt; ”。  否则，它被设置为“ &lt;code class=&quot;notranslate&quot;&gt;1&lt;/code&gt; ”。  请求中传递的MD5哈希值在&lt;a hhref=&quot;https://tools.ietf.org/html/rfc4648#section-5&quot;&gt;base64url中&lt;/a&gt;编码。 &lt;/p&gt;&lt;p&gt;  如果链接的生命周期有限，则到期时间设置为自Epoch（Thu，1970年1月1日1970:00 00:00:00 GMT）以来的秒数。  该值在MD5哈希之后的表达式中指定，并以逗号分隔。  请求中传递的到期时间可通过&lt;code class=&quot;notranslate&quot;&gt;$secure_link_expires&lt;/code&gt;变量获得，以便在&lt;a hhref=&quot;#secure_link_md5&quot;&gt;secure_link_md5&lt;/a&gt;指令中使用。  如果未指定到期时间，则链接具有无限生存期。 &lt;/p&gt;&lt;a name=&quot;secure_link_md5&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;secure_link_md5&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;expression&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义将为其计算MD5哈希值并与请求中传递的值进行比较的表达式。 &lt;/p&gt;&lt;p&gt;  表达式应包含链接（资源）和秘密成分的安全部分。  如果链接的生命周期有限，则表达式还应包含&lt;code class=&quot;notranslate&quot;&gt;$secure_link_expires&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  为防止未经授权的访问，表达式可能包含有关客户端的一些信息，例如其地址和浏览器版本。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location /s/ {
secure_link $arg_md5,$arg_expires;
secure_link_md5 &quot;$secure_link_expires$uri$remote_addr secret&quot;;

if ($secure_link = &quot;&quot;) {
    return 403;
}

if ($secure_link = &quot;0&quot;) {
    return 410;
}

...
</code></pre><p>}<br></p><p>   “ <code class="notranslate">/s/link?md5=<em>e4Nc3iduzkWRm01TBBNYw&amp;expires=2147483647</em></code> ”链接限制对IP地址为127.0.0.1的客户端的“ <code class="notranslate">/s/link</code> ”访问。  该链接的使用寿命有限，直到2038年1月19日（GMT）。 </p><p>  在UNIX上， <code class="notranslate"><i>md5</i></code>请求参数值可以获取为： </p><blockquote class="example"><pre class="notranslate">echo -n ‘2147483647/s/link127.0.0.1 secret’ | \<br>    openssl md5 -binary | openssl base64 | tr +/ - | tr -d =<br></pre></blockquote><p></p><a name="secure_link_secret"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>secure_link_secret</strong> <code class="notranslate"><i>word</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义用于检查所请求链接的真实性的密码。 &lt;/p&gt;&lt;p&gt;  请求链接的完整URI如下所示： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;/ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;prefix&lt;/i&gt;&lt;/code&gt; / &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;hash&lt;/i&gt;&lt;/code&gt; / &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;link&lt;/i&gt;&lt;/code&gt;
</code></pre><p></p><p>   <code class="notranslate"><i>hash</i></code>是为链接和秘密字的串联计算的MD5哈希的十六进制表示，而<code class="notranslate"><i>prefix</i></code>是没有斜杠的任意字符串。 </p><p>  如果请求的链接通过了真实性检查，则<code class="notranslate">$secure_link</code>变量将设置为从请求URI中提取的链接。  否则， <code class="notranslate">$secure_link</code>变量设置为空字符串。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">location /p/ {<br>    secure_link_secret secret;<p></p>
<pre><code>if ($secure_link = &quot;&quot;) {
    return 403;
}

rewrite ^ /secure/$secure_link;
</code></pre><p>}</p>
<p>location /secure/ {<br>    internal;<br>}<br></p></pre></blockquote><p>   “ <code class="notranslate">/p/5e814704a28d9bc1914ff19fa0c4a00a/link</code> ”的请求将在内部重定向到“ <code class="notranslate">/secure/link</code> ”。 </p><p>  在UNIX上，此示例的哈希值可以获得为： </p><blockquote class="example"><pre class="notranslate">echo -n ‘linksecret’ | openssl md5 -hex<br></pre></blockquote><p></p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p></p><dl><dt id="var_secure_link"> <code class="notranslate">$secure_link</code> </dt> <dd>  链接检查的状态。  具体值取决于所选的操作模式。 </dd><dt id="var_secure_link_expires"> <code class="notranslate">$secure_link_expires</code> </dt> <dd>  请求中传递的链接的生命周期;  仅用于<a hhref="#secure_link_md5">secure_link_md5</a>指令。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_scgi_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_scgi_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#scgi_bind">scgi_bind</a> <br>     <a hhref="#scgi_buffer_size">scgi_buffer_size</a> <br>     <a hhref="#scgi_buffering">scgi_buffering</a> <br>     <a hhref="#scgi_buffers">scgi_buffers</a> <br>     <a hhref="#scgi_busy_buffers_size">scgi_busy_buffers_size</a> <br>     <a hhref="#scgi_cache">scgi_cache</a> <br>     <a hhref="#scgi_cache_background_update">scgi_cache_background_update</a> <br>     <a hhref="#scgi_cache_bypass">scgi_cache_bypass</a> <br>     <a hhref="#scgi_cache_key">scgi_cache_key</a> <br>     <a hhref="#scgi_cache_lock">scgi_cache_lock</a> <br>     <a hhref="#scgi_cache_lock_age">scgi_cache_lock_age</a> <br>     <a hhref="#scgi_cache_lock_timeout">scgi_cache_lock_timeout</a> <br>     <a hhref="#scgi_cache_max_range_offset">scgi_cache_max_range_offset</a> <br>     <a hhref="#scgi_cache_methods">scgi_cache_methods</a> <br>     <a hhref="#scgi_cache_min_uses">scgi_cache_min_uses</a> <br>     <a hhref="#scgi_cache_path">scgi_cache_path</a> <br>     <a hhref="#scgi_cache_purge">scgi_cache_purge</a> <br>     <a hhref="#scgi_cache_revalidate">scgi_cache_revalidate</a> <br>     <a hhref="#scgi_cache_use_stale">scgi_cache_use_stale</a> <br>     <a hhref="#scgi_cache_valid">scgi_cache_valid</a> <br>     <a hhref="#scgi_connect_timeout">scgi_connect_timeout</a> <br>     <a hhref="#scgi_force_ranges">scgi_force_ranges</a> <br>     <a hhref="#scgi_hide_header">scgi_hide_header</a> <br>     <a hhref="#scgi_ignore_client_abort">scgi_ignore_client_abort</a> <br>     <a hhref="#scgi_ignore_headers">scgi_ignore_headers</a> <br>     <a hhref="#scgi_intercept_errors">scgi_intercept_errors</a> <br>     <a hhref="#scgi_limit_rate">scgi_limit_rate</a> <br>     <a hhref="#scgi_max_temp_file_size">scgi_max_temp_file_size</a> <br>     <a hhref="#scgi_next_upstream">scgi_next_upstream</a> <br>     <a hhref="#scgi_next_upstream_timeout">scgi_next_upstream_timeout</a> <br>     <a hhref="#scgi_next_upstream_tries">scgi_next_upstream_tries</a> <br>     <a hhref="#scgi_no_cache">scgi_no_cache</a> <br>     <a hhref="#scgi_param">scgi_param</a> <br>     <a hhref="#scgi_pass">scgi_pass</a> <br>     <a hhref="#scgi_pass_header">scgi_pass_header</a> <br>     <a hhref="#scgi_pass_request_body">scgi_pass_request_body</a> <br>     <a hhref="#scgi_pass_request_headers">scgi_pass_request_headers</a> <br>     <a hhref="#scgi_read_timeout">scgi_read_timeout</a> <br>     <a hhref="#scgi_request_buffering">scgi_request_buffering</a> <br>     <a hhref="#scgi_send_timeout">scgi_send_timeout</a> <br>     <a hhref="#scgi_socket_keepalive">scgi_socket_keepalive</a> <br>     <a hhref="#scgi_store">scgi_store</a> <br>     <a hhref="#scgi_store_access">scgi_store_access</a> <br>     <a hhref="#scgi_temp_file_write_size">scgi_temp_file_write_size</a> <br>     <a hhref="#scgi_temp_path">scgi_temp_path</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_scgi_module</code>模块允许将请求传递给SCGI服务器。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    include   scgi_params;<br>    scgi_pass localhost:9000;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="scgi_bind"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_bind</strong><br>    <code class="notranslate"><i>address</i></code><br>    [ <code class="notranslate">transparent</code> ] |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  使用可选端口（1.11.2）从指定的本地IP地址发出到SCGI服务器的传出连接。  参数值可以包含变量（1.3.12）。  特殊值&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; （1.3.12）取消了从先前配置级别继承的&lt;code class=&quot;notranslate&quot;&gt;scgi_bind&lt;/code&gt;指令的效果，该指令允许系统自动分配本地IP地址和端口。 &lt;/p&gt;&lt;a name=&quot;scgi_bind_transparent&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;transparent&lt;/code&gt;参数（1.11.0）允许到SCGI服务器的传出连接源自非本地IP地址，例如，来自客户端的真实IP地址： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_bind $remote_addr transparent;
</code></pre><p></p><p>  为了使此参数有效，通常需要使用<a hhref="ngx_core_module.html#user">超级用户</a>权限运行nginx工作进程。  在Linux上，不需要（1.13.8），就像指定了<code class="notranslate">transparent</code>参数一样，工作进程从主进程继承<code class="notranslate">CAP_NET_RAW</code>功能。  还需要配置内核路由表以拦截来自SCGI服务器的网络流量。 </p><a name="scgi_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_buffer_size 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取从SCGI服务器接收的响应的第一部分的缓冲区的<code class="notranslate"><i>size</i></code> 。  这部分通常包含一个小的响应头。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。  然而，它可以做得更小。 </p><a name="scgi_buffering"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_buffering</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_buffering on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用缓冲来自SCGI服务器的响应。 </p><p>  启用缓冲后，nginx会尽快从SCGI服务器接收响应，并将其保存到<a hhref="#scgi_buffer_size">scgi_buffer_size</a>和<a hhref="#scgi_buffers">scgi_buffers</a>指令设置的缓冲区中。  如果整个响应不适合内存，则可以将其中的一部分保存到磁盘上的<a hhref="#scgi_temp_path">临时文件中</a> 。  写入临时文件由<a hhref="#scgi_max_temp_file_size">scgi_max_temp_file_size</a>和<a hhref="#scgi_temp_file_write_size">scgi_temp_file_write_size</a>指令控制。 </p><p>  禁用缓冲时，响应会在收到响应时立即同步传递给客户端。   nginx不会尝试从SCGI服务器读取整个响应。   nginx一次可以从服务器接收的数据的最大大小由<a hhref="#scgi_buffer_size">scgi_buffer_size</a>指令设置。 </p><p>  也可以通过在“X-Accel-Buffering”响应头字段中传递“ <code class="notranslate">yes</code> ”或“ <code class="notranslate">no</code> ”来启用或禁用缓冲。  可以使用<a hhref="#scgi_ignore_headers">scgi_ignore_headers</a>指令禁用此功能。 </p><a name="scgi_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_buffers 8 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于从SCGI服务器读取响应的缓冲区的<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> ，用于单个连接。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 </p><a name="scgi_busy_buffers_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_busy_buffers_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_busy_buffers_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用来自SCGI服务器的响应<a hhref="#scgi_buffering">缓冲</a>时，限制在响应尚未完全读取时可能忙于向客户端发送响应的缓冲区的总<code class="notranslate"><i>size</i></code> 。  同时，其余的缓冲区可用于读取响应，并在需要时缓冲部分响应临时文件。  默认情况下， <code class="notranslate"><i>size</i></code>受<a hhref="#scgi_buffer_size">scgi_buffer_size</a>和<a hhref="#scgi_buffers">scgi_buffers</a>指令设置的两个缓冲区的大小限制。 </p><a name="scgi_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache</strong> <code class="notranslate"><i>zone</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_cache off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于缓存的共享内存区域。  可以在多个地方使用相同的区域。  参数值可以包含变量（1.7.9）。   <code class="notranslate">off</code>参数禁用从先前配置级别继承的高速缓存。 </p><a name="scgi_cache_background_update"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_background_update</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_cache_background_update off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.10版中。 </p></div><p>  允许启动后台子请求以更新过期的缓存项，同时将过时的缓存响应返回给客户端。  请注意，在更新时必须<a hhref="#scgi_cache_use_stale_updating">允许</a>使用陈旧的缓存响应。 </p><a name="scgi_cache_bypass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_bypass</strong> <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义不从缓存中获取响应的条件。  如果字符串参数的至少一个值不为空且不等于“0”，则不会从缓存中获取响应： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_cache_bypass $cookie_nocache $arg_nocache$arg_comment;
</code></pre><p>scgi_cache_bypass $http_pragma    $http_authorization;<br></p><p>  可以与<a hhref="#scgi_no_cache">scgi_no_cache</a>指令一起使用。 </p><a name="scgi_cache_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_key</strong> <code class="notranslate"><i>string</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  例如，定义缓存的键 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_cache_key localhost:9000$request_uri;
</code></pre><p></p><p></p><a name="scgi_cache_lock"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_lock</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_cache_lock off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  启用后，通过将请求传递给SCGI服务器，一次只允许一个请求填充根据<a hhref="#scgi_cache_key">scgi_cache_key</a>指令标识的新缓存元素。  同一缓存元素的其他请求将等待响应出现在缓存中或缓存锁定以释放此元素，直到<a hhref="#scgi_cache_lock_timeout">scgi_cache_lock_timeout</a>指令设置的时间。 </p><a name="scgi_cache_lock_age"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_lock_age</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_cache_lock_age 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.8版本中。 </p></div><p>  如果传递给SCGI服务器以填充新缓存元素的最后一个请求在指定<code class="notranslate"><i>time</i></code>内没有完成，则可以将另一个请求传递给SCGI服务器。 </p><a name="scgi_cache_lock_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_lock_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_cache_lock_timeout 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  设置<a hhref="#scgi_cache_lock">scgi_cache_lock</a>的超时。  当<code class="notranslate"><i>time</i></code>到期时，请求将被传递给SCGI服务器，但是，响应将不会被缓存。 </p><blockquote class="note">  在1.7.8之前，可以缓存响应。 </blockquote><p></p><a name="scgi_cache_max_range_offset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_max_range_offset</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置字节范围请求的偏移量（以字节为单位）。  如果范围超出偏移量，则范围请求将传递给SCGI服务器，并且不会缓存响应。 &lt;/p&gt;&lt;a name=&quot;scgi_cache_methods&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_cache_methods&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_cache_methods GET HEAD;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  如果此指令中列出了客户端请求方法，则将缓存响应。   “ &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; ”方法总是添加到列表中，但建议明确指定它们。  另请参见&lt;a hhref=&quot;#scgi_no_cache&quot;&gt;scgi_no_cache&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;scgi_cache_min_uses&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_cache_min_uses&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_cache_min_uses 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将缓存响应的请求&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;a name=&quot;scgi_cache_path&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_cache_path&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;path&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;levels&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;levels&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;use_temp_path&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ]
&lt;code class=&quot;notranslate&quot;&gt;keys_zone&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; : &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;inactive&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;max_size&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置缓存的路径和其他参数。  缓存数据存储在文件中。  缓存中的文件名是将MD5功能应用于&lt;a hhref=&quot;#scgi_cache_key&quot;&gt;缓存键的结果&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;levels&lt;/code&gt;参数定义高速缓存的层次结构级别：从1到3，每个级别接受值1或2.例如，在以下配置中 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;
</code></pre><p></p><p>  缓存中的文件名如下所示： </p><blockquote class="example"><pre class="notranslate">/data/nginx/cache/ <strong>c</strong> / <strong>29</strong> /b7f54b2df7773722d382f4809d650 <strong>29c</strong><br></pre></blockquote><p></p><p>  首先将缓存的响应写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和缓存可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，缓存和保存临时文件的目录都放在同一文件系统上。  根据<code class="notranslate">use_temp_path</code>参数（1.7.10）设置临时文件的目录。  如果省略此参数或将其设置为<code class="notranslate">on</code> ，则将使用<a hhref="#scgi_temp_path">scgi_temp_path</a>指令为给定位置设置的目录。  如果该值设置为<code class="notranslate">off</code> ，则临时文件将直接放入缓存目录中。 </p><p>  此外，所有活动密钥和有关数据的信息都存储在共享内存区域中，其<code class="notranslate"><i>name</i></code>和<code class="notranslate"><i>size</i></code>由<code class="notranslate">keys_zone</code>参数配置。  一兆字节区域可以存储大约8000个密钥。 </p><blockquote class="note">  作为<a hhref="http://nginx.com/products/">商业订阅的</a>一部分，共享存储器区域还存储扩展的高速缓存<a hhref="ngx_http_api_module.html#http_caches_">信息</a> ，因此，需要为相同数量的密钥指定更大的区域大小。  例如，一兆字节区域可以存储大约4000个密钥。 </blockquote><p></p><p>  在<code class="notranslate">inactive</code>参数指定的时间内未访问的缓存数据将从缓存中删除，无论其新鲜度如何。  默认情况下， <code class="notranslate">inactive</code>设置为10分钟。 </p><p>  特殊的“缓存管理器”进程监视<code class="notranslate">max_size</code>参数设置的最大缓存大小。  超过此大小时，它会删除最近最少使用的数据。  在<code class="notranslate">manager_files</code> ， <code class="notranslate">manager_threshold</code>和<code class="notranslate">manager_sleep</code>参数（1.11.5）配置的迭代中删除数据。  在一次迭代期间，不会删除<code class="notranslate">manager_files</code>项（默认情况下为100）。  一次迭代的持续时间受<code class="notranslate">manager_threshold</code>参数限制（默认情况下为200毫秒）。  在迭代之间，由<code class="notranslate">manager_sleep</code>参数（默认为50毫秒）配置的暂停。 </p><p>  启动一分钟后，激活特殊的“缓存加载程序”进程。  它将有关存储在文件系统中的先前缓存数据的信息加载到缓存区。  加载也是在迭代中完成的。  在一次迭代期间，加载的<code class="notranslate">loader_files</code>项目不超过（默认情况下为100）。  此外，一次迭代的持续时间受<code class="notranslate">loader_threshold</code>参数限制（默认为200毫秒）。  在迭代之间，由<code class="notranslate">loader_sleep</code>参数（默认为50毫秒）配置暂停。 </p><p>  此外，以下参数作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供： </p><p></p><dl class="compact"><dt id="purger">   <code class="notranslate">purger</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> </dt><dd>  指示缓存清除程序是否将从磁盘中删除与<a hhref="#scgi_cache_purge">通配符密钥</a>匹配的缓存条目（1.7.12）。  将参数设置为<code class="notranslate">on</code> （默认为<code class="notranslate">off</code> ）将激活“cache purger”进程，该进程将永久迭代所有缓存条目并删除与通配符键匹配的条目。 </dd><dt id="purger_files">   <code class="notranslate">purger_files</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置在一次迭代（1.7.12）期间将扫描的项目数。  默认情况下， <code class="notranslate">purger_files</code>设置为10。 </dd><dt id="purger_threshold">   <code class="notranslate">purger_threshold</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置一次迭代的持续时间（1.7.12）。  默认情况下， <code class="notranslate">purger_threshold</code>设置为50毫秒。 </dd><dt id="purger_sleep">   <code class="notranslate">purger_sleep</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置迭代之间的暂停（1.7.12）。  默认情况下， <code class="notranslate">purger_sleep</code>设置为50毫秒。 </dd></dl><p></p><p></p><blockquote class="note">  在版本1.7.3,1.7.7和1.11.10中，缓存头格式已更改。  升级到较新的nginx版本之前，缓存的响应将被视为无效。 </blockquote><p></p><a name="scgi_cache_purge"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_purge</strong> string …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义将请求视为缓存清除请求的条件。  如果字符串参数的至少一个值不为空并且不等于“0”，则移除具有相应&lt;a hhref=&quot;#scgi_cache_key&quot;&gt;高速缓存键&lt;/a&gt;的高速缓存条目。  通过返回204（无内容）响应来指示成功操作的结果。 &lt;/p&gt;&lt;p&gt;  如果清除请求的&lt;a hhref=&quot;#scgi_cache_key&quot;&gt;缓存键&lt;/a&gt;以星号（“ &lt;code class=&quot;notranslate&quot;&gt;*&lt;/code&gt; ”）结尾，则将从缓存中删除与通配符键匹配的所有缓存条目。  但是，这些条目将保留在磁盘上，直到它们被删除&lt;a hhref=&quot;#scgi_cache_path&quot;&gt;为非活动状态&lt;/a&gt; ，或由&lt;a hhref=&quot;#purger&quot;&gt;缓存&lt;/a&gt;清除程序（1.7.12）处理，或者客户端尝试访问它们。 &lt;/p&gt;&lt;p&gt;  配置示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_cache_path /data/nginx/cache keys_zone=cache_zone:10m;
</code></pre><p>map $request_method $purge_method {<br>    PURGE   1;<br>    default 0;<br>}</p>
<p>server {<br>    …<br>    location / {<br>        scgi_pass        backend;<br>        scgi_cache       cache_zone;<br>        scgi_cache_key   $uri;<br>        scgi_cache_purge $purge_method;<br>    }<br>}<br></p><p></p><blockquote class="note">  此功能作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="scgi_cache_revalidate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_revalidate</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_cache_revalidate off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.7版本中。 </p></div><p>  使用具有“If-Modified-Since”和“If-None-Match”标头字段的条件请求启用过期缓存项的重新验证。 </p><a name="scgi_cache_use_stale"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_use_stale</strong><br>    <code class="notranslate">error</code> |<br>    <code class="notranslate">timeout</code> |<br>    <code class="notranslate">invalid_header</code> |<br>    <code class="notranslate">updating</code> |<br>    <code class="notranslate">http_500</code> |<br>    <code class="notranslate">http_503</code> |<br>    <code class="notranslate">http_403</code> |<br>    <code class="notranslate">http_404</code> |<br>    <code class="notranslate">http_429</code> |<br>    <code class="notranslate">off</code><br>    …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_cache_use_stale off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  确定在与SCGI服务器通信期间发生错误时可以使用过时的缓存响应的情况。  该指令的参数与<a hhref="#scgi_next_upstream">scgi_next_upstream</a>指令的参数匹配。 </p><p>  如果无法选择处理请求的SCGI服务器，则<code class="notranslate">error</code>参数还允许使用过时的缓存响应。 </p><a name="scgi_cache_use_stale_updating"></a><p>  此外，如果当前正在更新，则<code class="notranslate">updating</code>参数允许使用过时的缓存响应。  这允许在更新缓存数据时最小化对SCGI服务器的访问次数。 </p><p>  在响应变为失效后，也可以在响应头中直接启用过时的缓存响应指定的秒数（1.11.10）。  这比使用指令参数的优先级低。 </p><ul><li>   “Cache-Control”头字段的“ <a hhref="https://tools.ietf.org/html/rfc5861#section-3">stale-while-revalidate</a> ”扩展允许使用陈旧的缓存响应（如果当前正在更新）。 </li><li>   “Cache-Control”头字段的“ <a hhref="https://tools.ietf.org/html/rfc5861#section-4">stale-if-error</a> ”扩展允许在出现错误时使用陈旧的缓存响应。 </li></ul><p></p><p>  要在填充新缓存元素时最小化对SCGI服务器的访问次数，可以使用<a hhref="#scgi_cache_lock">scgi_cache_lock</a>指令。 </p><a name="scgi_cache_valid"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_cache_valid</strong> [ <code class="notranslate"><i>code</i></code> …] <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置不同响应代码的缓存时间。  例如，以下指令 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_cache_valid 200 302 10m;
</code></pre><p>scgi_cache_valid 404      1m;<br></p><p>  为代码为200和302的响应设置10分钟的缓存，为代码404的响应设置1分钟。 </p><p>  如果仅指定了缓存<code class="notranslate"><i>time</i></code> </p><blockquote class="example"><pre class="notranslate">scgi_cache_valid 5m;<br></pre></blockquote><p>  然后只缓存200,301和302个响应。 </p><p>  此外，可以指定<code class="notranslate">any</code>参数来缓存任何响应： </p><blockquote class="example"><pre class="notranslate">scgi_cache_valid 200 302 10m;<br>scgi_cache_valid 301      1h;<br>scgi_cache_valid any      1m;<br></pre></blockquote><p></p><p>  缓存的参数也可以直接在响应头中设置。  这比使用该指令设置缓存时间具有更高的优先级。 </p><ul><li>   “X-Accel-Expires”标题字段以秒为单位设置响应的缓存时间。  零值禁用响应的缓存。  如果值以<code class="notranslate">@</code>前缀开头，则设置自Epoch以来的绝对时间（以秒为单位），响应可以高速缓存。 </li><li>  如果标题不包括“X-Accel-Expires”字段，则可以在标题字段“Expires”或“Cache-Control”中设置高速缓存的参数。 </li><li>  如果标头包含“Set-Cookie”字段，则不会缓存此类响应。 </li><li>  如果标题包含具有特殊值“ <code class="notranslate">*</code> ”的“Vary”字段，则不会缓存此类响应（1.7.7）。  如果标题包含具有另一个值的“Vary”字段，则将考虑相应的请求标题字段来缓存这样的响应（1.7.7）。 </li></ul><p>  可以使用<a hhref="#scgi_ignore_headers">scgi_ignore_headers</a>指令禁用这些响应头字段中的一个或多个的处理。 </p><a name="scgi_connect_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_connect_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_connect_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义与SCGI服务器建立连接的超时。  应该注意，此超时通常不会超过75秒。 </p><a name="scgi_force_ranges"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_force_ranges</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_force_ranges off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.7版本中。 </p></div><p>  无论来自这些响应中的“Accept-Ranges”字段，都可以对来自SCGI服务器的缓存和未缓存响应启用字节范围支持。 </p><a name="scgi_hide_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_hide_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  默认情况下，nginx不会将SCGI服务器的响应中的标题字段“Status”和“X-Accel -...”传递给客户端。   &lt;code class=&quot;notranslate&quot;&gt;scgi_hide_header&lt;/code&gt;指令设置不会传递的其他字段。  相反，如果需要允许传递字段，则可以使用&lt;a hhref=&quot;#scgi_pass_header&quot;&gt;scgi_pass_header&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;scgi_ignore_client_abort&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_ignore_client_abort&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_ignore_client_abort off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定客户端在不等待响应的情况下关闭连接时是否应关闭与SCGI服务器的连接。 &lt;/p&gt;&lt;a name=&quot;scgi_ignore_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_ignore_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;field&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  禁用从SCGI服务器处理某些响应头字段。  可以忽略以下字段：“X-Accel-Redirect”，“X-Accel-Expires”，“X-Accel-Limit-Rate”（1.1.6），“X-Accel-Buffering”（1.1.6） ，“X-Accel-Charset”（1.1.6），“Expires”，“Cache-Control”，“Set-Cookie”（0.8.44）和“Vary”（1.7.7）。 &lt;/p&gt;&lt;p&gt;  如果未禁用，则处理这些标头字段会产生以下影响： &lt;/p&gt;&lt;ul&gt;&lt;li&gt;   “X-Accel-Expires”，“Expires”，“Cache-Control”，“Set-Cookie”和“Vary”设置响应&lt;a hhref=&quot;#scgi_cache_valid&quot;&gt;缓存&lt;/a&gt;的参数; &lt;/li&gt;&lt;li&gt;   “X-Accel-Redirect”执行&lt;a hhref=&quot;ngx_http_core_module.html#internal&quot;&gt;内部重定向&lt;/a&gt;到指定的URI; &lt;/li&gt;&lt;li&gt;   “X-Accel-Limit-Rate”设置向客户端传输响应的&lt;a hhref=&quot;ngx_http_core_module.html#limit_rate&quot;&gt;速率限制&lt;/a&gt; ; &lt;/li&gt;&lt;li&gt;   “X-Accel-Buffering”启用或禁用&lt;a hhref=&quot;#scgi_buffering&quot;&gt;缓冲&lt;/a&gt;响应; &lt;/li&gt;&lt;li&gt;   “X-Accel-Charset”设置了所需的响应&lt;a hhref=&quot;ngx_http_charset_module.html#charset&quot;&gt;字符集&lt;/a&gt; 。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;scgi_intercept_errors&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_intercept_errors&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_intercept_errors off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定代码大于或等于300的SCGI服务器响应是应该传递给客户端还是被拦截并重定向到nginx以便使用&lt;a hhref=&quot;ngx_http_core_module.html#error_page&quot;&gt;error_page&lt;/a&gt;指令进行处理。 &lt;/p&gt;&lt;a name=&quot;scgi_limit_rate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_limit_rate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;rate&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_limit_rate 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制从SCGI服务器读取响应的速度。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;rate&lt;/i&gt;&lt;/code&gt;以每秒字节数指定。  零值禁用速率限制。  根据请求设置限制，因此如果nginx同时打开两个到SCGI服务器的连接，则总速率将是指定限制的两倍。  仅当启用了来自SCGI服务器的响应&lt;a hhref=&quot;#scgi_buffering&quot;&gt;缓冲时&lt;/a&gt; ，该限制才有效。 &lt;/p&gt;&lt;a name=&quot;scgi_max_temp_file_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_max_temp_file_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_max_temp_file_size 1024m;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  当启用来自SCGI服务器的响应&lt;a hhref=&quot;#scgi_buffering&quot;&gt;缓冲&lt;/a&gt; ，并且整个响应不适合&lt;a hhref=&quot;#scgi_buffer_size&quot;&gt;scgi_buffer_size&lt;/a&gt;和&lt;a hhref=&quot;#scgi_buffers&quot;&gt;scgi_buffers&lt;/a&gt;指令设置的缓冲区时，响应的一部分可以保存到临时文件中。  该指令设置临时文件的最大&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  一次写入临时文件的数据大小由&lt;a hhref=&quot;#scgi_temp_file_write_size&quot;&gt;scgi_temp_file_write_size&lt;/a&gt;指令设置。 &lt;/p&gt;&lt;p&gt;  零值禁用缓冲对临时文件的响应。 &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  此限制不适用于将&lt;a hhref=&quot;#scgi_cache&quot;&gt;缓存&lt;/a&gt;或&lt;a hhref=&quot;#scgi_store&quot;&gt;存储&lt;/a&gt;在磁盘上的响应。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;scgi_next_upstream&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_next_upstream&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;non_idempotent&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_next_upstream error timeout;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定应将请求传递到下一个服务器的情况： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与服务器建立连接，向其传递请求或读取响应头时发生错误; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  在与服务器建立连接，向其传递请求或读取响应头时发生超时; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回空或无效响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为500的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为503的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为403的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为404的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为429的响应（1.11.13）; &lt;/dd&gt;&lt;dt id=&quot;non_idempotent&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;non_idempotent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  通常，如果请求已发送到上游服务器，则使用&lt;a hhref=&quot;https://tools.ietf.org/html/rfc7231#section-4.2.2&quot;&gt;非幂等&lt;/a&gt;方法（ &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;LOCK&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; ）的请求不会传递给下一个服务器（1.9.13）;  启用此选项显式允许重试此类请求; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  禁用将请求传递给下一个服务器。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  应该记住，只有在尚未向客户端发送任何内容的情况下，才能将请求传递给下一个服务器。  也就是说，如果在传输响应的过程中发生错误或超时，则无法修复此问题。 &lt;/p&gt;&lt;p&gt;  该指令还定义了与服务器通信的&lt;a hhref=&quot;ngx_http_upstream_module.html#max_fails&quot;&gt;不成功尝试&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt;情况始终被视为不成功的尝试，即使它们未在指令中指定。   &lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt;情况仅在指令中指定&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt;被视为不成功尝试。   &lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt;情况从未被视为不成功的尝试。 &lt;/p&gt;&lt;p&gt;  将请求传递到下一个服务器可能会受到&lt;a hhref=&quot;#scgi_next_upstream_tries&quot;&gt;尝试次数&lt;/a&gt;和&lt;a hhref=&quot;#scgi_next_upstream_timeout&quot;&gt;时间的限制&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;scgi_next_upstream_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_next_upstream_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_next_upstream_timeout 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.5版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制请求可以传递到&lt;a hhref=&quot;#scgi_next_upstream&quot;&gt;下一个服务器的时间&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;scgi_next_upstream_tries&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_next_upstream_tries&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_next_upstream_tries 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.5版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制将请求传递到&lt;a hhref=&quot;#scgi_next_upstream&quot;&gt;下一个服务器&lt;/a&gt;的可能尝试次数。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;scgi_no_cache&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_no_cache&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义不将响应保存到缓存的条件。  如果字符串参数的至少一个值不为空且不等于“0”，则不会保存响应： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_no_cache $cookie_nocache $arg_nocache$arg_comment;
</code></pre><p>scgi_no_cache $http_pragma    $http_authorization;<br></p><p>  可以与<a hhref="#scgi_cache_bypass">scgi_cache_bypass</a>指令一起使用。 </p><a name="scgi_param"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_param</strong><br>    <code class="notranslate"><i>parameter</i></code> <code class="notranslate"><i>value</i></code><br>    [ <code class="notranslate">if_not_empty</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置应传递给SCGI服务器的参数。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;scgi_param&lt;/code&gt;指令时，这些指令才从先前级别继承。 &lt;/p&gt;&lt;p&gt;  标准&lt;a hhref=&quot;https://tools.ietf.org/html/rfc3875#section-4.1&quot;&gt;CGI环境变量&lt;/a&gt;应作为SCGI头提供，请参阅分发中提供的&lt;code class=&quot;notranslate&quot;&gt;scgi_params&lt;/code&gt;文件： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location / {
include scgi_params;
...
</code></pre><p>}<br></p><p></p><p>  如果使用<code class="notranslate">if_not_empty</code> （1.1.11）指定了该指令，则只有在其值不为空时，才会将此参数传递给服务器： </p><blockquote class="example"><pre class="notranslate">scgi_param HTTPS $https if_not_empty;<br></pre></blockquote><p></p><a name="scgi_pass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_pass</strong> <code class="notranslate"><i>address</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置SCGI服务器的地址。  地址可以指定为域名或IP地址，以及端口： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_pass localhost:9000;
</code></pre><p></p><p>  或者作为UNIX域套接字路径： </p><blockquote class="example"><pre class="notranslate">scgi_pass unix:/tmp/scgi.socket;<br></pre></blockquote><p></p><p>  如果域名解析为多个地址，则所有这些地址都将以循环方式使用。  此外，可以将地址指定为<a hhref="ngx_http_upstream_module.html">服务器组</a> 。 </p><p>  参数值可以包含变量。  在这种情况下，如果将地址指定为域名，则在所描述的<a hhref="ngx_http_upstream_module.html">服务器组中</a>搜索名称，如果未找到，则使用<a hhref="ngx_http_core_module.html#resolver">解析器</a>确定。 </p><a name="scgi_pass_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_pass_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将已&lt;a hhref=&quot;#scgi_hide_header&quot;&gt;禁用的&lt;/a&gt;头字段从SCGI服务器传递到客户端。 &lt;/p&gt;&lt;a name=&quot;scgi_pass_request_body&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_pass_request_body&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_pass_request_body on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指示是否将原始请求正文传递给SCGI服务器。  另请参见&lt;a hhref=&quot;#scgi_pass_request_headers&quot;&gt;scgi_pass_request_headers&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;scgi_pass_request_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_pass_request_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_pass_request_headers on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指示原始请求的标头字段是否传递给SCGI服务器。  另请参见&lt;a hhref=&quot;#scgi_pass_request_body&quot;&gt;scgi_pass_request_body&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;scgi_read_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_read_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_read_timeout 60s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义从SCGI服务器读取响应的超时。  仅在两个连续的读操作之间设置超时，而不是为整个响应的传输。  如果SCGI服务器在此时间内未传输任何内容，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;scgi_request_buffering&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_request_buffering&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_request_buffering on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用客户端请求正文的缓冲。 &lt;/p&gt;&lt;p&gt;  启用缓冲后，在将请求发送到SCGI服务器之前，将从客户端&lt;a hhref=&quot;ngx_http_core_module.html#client_body_buffer_size&quot;&gt;读取&lt;/a&gt;整个请求正文。 &lt;/p&gt;&lt;p&gt;  禁用缓冲时，请求主体在收到时立即发送到SCGI服务器。  在这种情况下，如果nginx已经开始发送请求主体，则无法将请求传递给&lt;a hhref=&quot;#scgi_next_upstream&quot;&gt;下一个服务器&lt;/a&gt; 。 &lt;/p&gt;&lt;p&gt;  当使用HTTP / 1.1分块传输编码来发送原始请求主体时，无论指令值如何，都将缓冲请求主体。 &lt;/p&gt;&lt;a name=&quot;scgi_send_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_send_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_send_timeout 60s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将请求发送到SCGI服务器的超时。  仅在两个连续的写操作之间设置超时，而不是为整个请求的传输。  如果SCGI服务器在此时间内未收到任何内容，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;scgi_socket_keepalive&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_socket_keepalive&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_socket_keepalive off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  配置与SCGI服务器的传出连接的“TCP keepalive”行为。  默认情况下，操作系统的设置对套接字有效。  如果指令设置为值“ &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; ”，则为套接字打开&lt;code class=&quot;notranslate&quot;&gt;SO_KEEPALIVE&lt;/code&gt;套接字选项。 &lt;/p&gt;&lt;a name=&quot;scgi_store&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;scgi_store&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;scgi_store off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将文件保存到磁盘。   &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt;参数使用与指令&lt;a hhref=&quot;ngx_http_core_module.html#alias&quot;&gt;别名&lt;/a&gt;或&lt;a hhref=&quot;ngx_http_core_module.html#root&quot;&gt;root&lt;/a&gt;对应的路径保存文件。   &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;参数禁用文件保存。  此外，可以使用带变量的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt;显式设置文件名： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;scgi_store /data/www$original_uri;
</code></pre><p></p><p></p><p>  根据接收到的“Last-Modified”响应头字段设置文件的修改时间。  首先将响应写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和持久性存储可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，由<a hhref="#scgi_temp_path">scgi_temp_path</a>指令设置的保存文件和保存临时文件的目录都放在同一文件系统上。 </p><p>  该指令可用于创建静态不可更改文件的本地副本，例如： </p><blockquote class="example"><pre class="notranslate">location /images/ {<br>    root              /data/www;<br>    error_page        404 = /fetch$uri;<br>}<p></p>
<p>location /fetch/ {<br>    internal;</p>
<pre><code>scgi_pass         backend:9000;
...

scgi_store        on;
scgi_store_access user:rw group:rw all:r;
scgi_temp_path    /data/temp;

alias             /data/www/;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="scgi_store_access"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_store_access</strong> <code class="notranslate"><i>users</i></code> : <code class="notranslate"><i>permissions</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_store_access user:rw;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  为新创建的文件和目录设置访问权限，例如： </p><blockquote class="example"><pre class="notranslate">scgi_store_access user:rw group:rw all:r;<br></pre></blockquote><p></p><p>  如果指定了任何<code class="notranslate">group</code>或<code class="notranslate">all</code>访问权限，则可以省略<code class="notranslate">user</code>权限： </p><blockquote class="example"><pre class="notranslate">scgi_store_access group:rw all:r;<br></pre></blockquote><p></p><a name="scgi_temp_file_write_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_temp_file_write_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_temp_file_write_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用从SCGI服务器到临时文件的响应缓冲时，限制一次写入临时文件的数据<code class="notranslate"><i>size</i></code> 。  默认情况下， <code class="notranslate"><i>size</i></code>由<a hhref="#scgi_buffer_size">scgi_buffer_size</a>和<a hhref="#scgi_buffers">scgi_buffers</a>指令设置的两个缓冲区限制。  临时文件的最大大小由<a hhref="#scgi_max_temp_file_size">scgi_max_temp_file_size</a>指令设置。 </p><a name="scgi_temp_path"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>scgi_temp_path</strong><br>    <code class="notranslate"><i>path</i></code><br>    [ <code class="notranslate"><i>level1</i></code><br>    [ <code class="notranslate"><i>level2</i></code><br>    [ <code class="notranslate"><i>level3</i></code> ]]];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">scgi_temp_path scgi_temp;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于存储包含从SCGI服务器接收的数据的临时文件的目录。  在指定目录下最多可以使用三级子目录层次结构。  例如，在以下配置中 </p><blockquote class="example"><pre class="notranslate">scgi_temp_path /spool/nginx/scgi_temp 1 2;<br></pre></blockquote><p>  临时文件可能如下所示： </p><blockquote class="example"><pre class="notranslate">/spool/nginx/scgi_temp/ <strong>7</strong> / <strong>45</strong> /00000123 <strong>457</strong><br></pre></blockquote><p></p><p>  另请参见<a hhref="#scgi_cache_path">scgi_cache_path</a>指令的<code class="notranslate">use_temp_path</code>参数。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_rewrite_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_rewrite_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#directives">Directives</a> <br>     <a hhref="#break">break</a> <br>     <a hhref="#if">if</a> <br>     <a hhref="#return">return</a> <br>     <a hhref="#rewrite">rewrite</a> <br>     <a hhref="#rewrite_log">rewrite_log</a> <br>     <a hhref="#set">set</a> <br>     <a hhref="#uninitialized_variable_warn">uninitialized_variable_warn</a> <br> <a hhref="#internals">Internal Implementation</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_rewrite_module</code>模块用于使用PCRE正则表达式更改请求URI，返回重定向和有条件地选择配置。 </p><p>   <a hhref="#break">break</a> ， <a hhref="#if">if</a> ， <a hhref="#return">return</a> ， <a hhref="#rewrite">rewrite</a>和<a hhref="#set">set</a>指令按以下顺序处理： </p><ul class="compact"><li>  在<a hhref="ngx_http_core_module.html#server">服务器</a>级别指定的此模块的指令是按顺序执行的; </li><li>  反复： <ul class="compact"><li>  基于请求URI搜索<a hhref="ngx_http_core_module.html#location">位置</a> ; </li><li>  在找到的位置内指定的该模块的指令是顺序执行的; </li><li>  如果<a hhref="#rewrite">重写</a>请求URI，则重复循环，但不超过<a hhref="ngx_http_core_module.html#internal">10次</a> 。 </li></ul></li></ul><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="break"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>break</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  停止处理当前的&lt;code class=&quot;notranslate&quot;&gt;ngx_http_rewrite_module&lt;/code&gt;指令集。 &lt;/p&gt;&lt;p&gt;  如果在该&lt;a hhref=&quot;ngx_http_core_module.html#location&quot;&gt;位置&lt;/a&gt;内指定了指令，则在该&lt;a hhref=&quot;ngx_http_core_module.html#location&quot;&gt;位置&lt;/a&gt;继续进一步处理该请求。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;if ($slow) {
limit_rate 10k;
break;
</code></pre><p>}<br></p><p></p><a name="if"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>if</strong> ( <code class="notranslate"><i>condition</i></code> ) { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  评估指定的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;condition&lt;/i&gt;&lt;/code&gt; 。  如果为true，则执行在大括号内指定的此模块指令，并在&lt;code class=&quot;notranslate&quot;&gt;if&lt;/code&gt;指令内为该请求分配配置。   &lt;code class=&quot;notranslate&quot;&gt;if&lt;/code&gt;指令内的配置继承自先前的配置级别。 &lt;/p&gt;&lt;p&gt;  条件可以是以下任何一种： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;  变量名;  如果变量的值为空字符串或“ &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt; ”，则为false; &lt;blockquote class=&quot;note&quot;&gt;  在版本1.0.1之前，任何以“ &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt; ”开头的字符串都被视为错误值。 &lt;/blockquote&gt;&lt;/li&gt;&lt;li&gt;  使用“ &lt;code class=&quot;notranslate&quot;&gt;=&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;!=&lt;/code&gt; ”运算符比较变量和字符串; &lt;/li&gt;&lt;li&gt;  使用“ &lt;code class=&quot;notranslate&quot;&gt;~&lt;/code&gt; ”（对于区分大小写的匹配）和“ &lt;code class=&quot;notranslate&quot;&gt;~*&lt;/code&gt; ”（对于不区分大小写的匹配）运算符，将变量与正则表达式进行匹配。  正则表达式可以包含可供以后在&lt;code class=&quot;notranslate&quot;&gt;$1&lt;/code&gt; .. &lt;code class=&quot;notranslate&quot;&gt;$9&lt;/code&gt;变量中重用的捕获。  负操作符“ &lt;code class=&quot;notranslate&quot;&gt;!~&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;!~*&lt;/code&gt; ”也可用。  如果正则表达式包含“ &lt;code class=&quot;notranslate&quot;&gt;}&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;;&lt;/code&gt;   “字符，整个表达式应该用单引号或双引号括起来。 &lt;/li&gt;&lt;li&gt;  使用“ &lt;code class=&quot;notranslate&quot;&gt;-f&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;!-f&lt;/code&gt; ”运算符检查文件是否存在; &lt;/li&gt;&lt;li&gt;  使用“ &lt;code class=&quot;notranslate&quot;&gt;-d&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;!-d&lt;/code&gt; ”运算符检查目录是否存在; &lt;/li&gt;&lt;li&gt;  使用“ &lt;code class=&quot;notranslate&quot;&gt;-e&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;!-e&lt;/code&gt; ”运算符检查文件，目录或符号链接是否存在; &lt;/li&gt;&lt;li&gt;  使用“ &lt;code class=&quot;notranslate&quot;&gt;-x&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;!-x&lt;/code&gt; ”运算符检查可执行文件。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  例子： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;if ($http_user_agent ~ MSIE) {
rewrite ^(.*)$ /msie/$1 break;
</code></pre><p>}</p>
<p>if ($http_cookie ~* “id=([^;]+)(?:;|$)”) {<br>    set $id $1;<br>}</p>
<p>if ($request_method = POST) {<br>    return 405;<br>}</p>
<p>if ($slow) {<br>    limit_rate 10k;<br>}</p>
<p>if ($invalid_referer) {<br>    return 403;<br>}<br></p><p></p><blockquote class="note">   <code class="notranslate">$invalid_referer</code>嵌入变量的值由<a hhref="ngx_http_referer_module.html#valid_referers">valid_referers</a>指令设置。 </blockquote><p></p><a name="return"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>return</strong> <code class="notranslate"><i>code</i></code> [ <code class="notranslate"><i>text</i></code> ];</code> <br> <code class="notranslate"><strong>return</strong> <code class="notranslate"><i>code</i></code> <code class="notranslate"><i>URL</i></code> ;</code> <br> <code class="notranslate"><strong>return</strong> <code class="notranslate"><i>URL</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  停止处理并将指定的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;code&lt;/i&gt;&lt;/code&gt;返回给客户端。  非标准代码444在不发送响应头的情况下关闭连接。 &lt;/p&gt;&lt;p&gt;  从版本0.8.42开始，可以指定重定向URL（对于代码301,302,303,307和308）或响应正文&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;text&lt;/i&gt;&lt;/code&gt; （对于其他代码）。  响应正文文本和重定向URL可以包含变量。  作为特殊情况，可以将重定向URL指定为此服务器的本地URI，在这种情况下，根据请求方案（ &lt;code class=&quot;notranslate&quot;&gt;$scheme&lt;/code&gt; ）以及&lt;a hhref=&quot;ngx_http_core_module.html#server_name_in_redirect&quot;&gt;server_name_in_redirect&lt;/a&gt;和&lt;a hhref=&quot;ngx_http_core_module.html#port_in_redirect&quot;&gt;port_in_redirect&lt;/a&gt;指令形成完整重定向URL。 &lt;/p&gt;&lt;p&gt;  另外，可以将用于具有代码302的临时重定向的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;URL&lt;/i&gt;&lt;/code&gt;指定为唯一参数。  这样的参数应该以“ &lt;code class=&quot;notranslate&quot;&gt;http://&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;https://&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;$scheme&lt;/code&gt; ”字符串开头。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;URL&lt;/i&gt;&lt;/code&gt;可以包含变量。 &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在版本0.7.51之前只能返回以下代码：204,400,402-406,408,410,411,413,416和500-504。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在版本1.1.16和1.0.13之前，代码307不被视为重定向。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在版本1.13.0之前，代码308不被视为重定向。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  另请参见&lt;a hhref=&quot;ngx_http_core_module.html#error_page&quot;&gt;error_page&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;rewrite&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;rewrite&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;regex&lt;/i&gt;&lt;/code&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;replacement&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;flag&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  如果指定的正则表达式与请求URI匹配，则URI将根据&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;replacement&lt;/i&gt;&lt;/code&gt;字符串中的指定进行更改。   &lt;code class=&quot;notranslate&quot;&gt;rewrite&lt;/code&gt;指令按照它们在配置文件中的出现顺序依次执行。  可以使用标志终止对指令的进一步处理。  如果替换字符串以“ &lt;code class=&quot;notranslate&quot;&gt;http://&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;https://&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;$scheme&lt;/code&gt; ”开头，则处理停止并将重定向返回给客户端。 &lt;/p&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;flag&lt;/i&gt;&lt;/code&gt;参数可以是以下之一： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;last&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  停止处理当前的&lt;code class=&quot;notranslate&quot;&gt;ngx_http_rewrite_module&lt;/code&gt;指令集并开始搜索与更改的URI匹配的新位置; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;break&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与&lt;a hhref=&quot;#break&quot;&gt;break&lt;/a&gt;指令一样，停止处理当前的&lt;code class=&quot;notranslate&quot;&gt;ngx_http_rewrite_module&lt;/code&gt;指令集; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;redirect&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  返回带有302代码的临时重定向;  如果替换字符串不以“ &lt;code class=&quot;notranslate&quot;&gt;http://&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;https://&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;$scheme&lt;/code&gt; ”开头，则使用; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;permanent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  返回301代码的永久重定向。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  完整重定向URL根据请求方案（ &lt;code class=&quot;notranslate&quot;&gt;$scheme&lt;/code&gt; ）以及&lt;a hhref=&quot;ngx_http_core_module.html#server_name_in_redirect&quot;&gt;server_name_in_redirect&lt;/a&gt;和&lt;a hhref=&quot;ngx_http_core_module.html#port_in_redirect&quot;&gt;port_in_redirect&lt;/a&gt;指令形成。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;server {
...
rewrite ^(/download/.*)/media/(.*)\..*$ $1/mp3/$2.mp3 last;
rewrite ^(/download/.*)/audio/(.*)\..*$ $1/mp3/$2.ra  last;
return  403;
...
</code></pre><p>}<br></p><p></p><p>  但是如果这些指令放在“ <code class="notranslate">/download/</code> ”位置， <code class="notranslate">last</code>标志应该用<code class="notranslate">break</code>替换，否则nginx会生成10个周期并返回500错误： </p><blockquote class="example"><pre class="notranslate">location /download/ {<br>    rewrite ^(/download/.<em>)/media/(.</em>)..<em>$ $1/mp3/$2.mp3 break;<br>    rewrite ^(/download/.</em>)/audio/(.<em>)..</em>$ $1/mp3/$2.ra  break;<br>    return  403;<br>}<br></pre></blockquote><p></p><p>  如果<code class="notranslate"><i>replacement</i></code>字符串包含新请求参数，则先前的请求参数将附加在它们之后。  如果这是不希望的，在替换字符串的末尾加上一个问号可以避免附加它们，例如： </p><blockquote class="example"><pre class="notranslate">rewrite ^/users/(.*)$ /show?user=$1? last;<br></pre></blockquote><p></p><p>  如果正则表达式包含“ <code class="notranslate">}</code> ”或“ <code class="notranslate">;</code>   “字符，整个表达式应该用单引号或双引号括起来。 </p><a name="rewrite_log"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>rewrite_log</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">rewrite_log off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用将<code class="notranslate">ngx_http_rewrite_module</code>模块指令处理结果记录到<code class="notranslate">notice</code>级别的<a hhref="ngx_core_module.html#error_log">error_log</a>中。 </p><a name="set"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>set</strong> <code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>value</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;variable&lt;/i&gt;&lt;/code&gt;的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; 。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。 &lt;/p&gt;&lt;a name=&quot;uninitialized_variable_warn&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;uninitialized_variable_warn&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;uninitialized_variable_warn on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  控制是否记录有关未初始化变量的警告。 &lt;/p&gt;&lt;a name=&quot;internals&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  内部实施 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;ngx_http_rewrite_module&lt;/code&gt;模块指令在配置阶段编译为在请求处理期间解释的内部指令。  解释器是一个简单的虚拟堆栈机器。 &lt;/p&gt;&lt;p&gt;  例如，指令 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location /download/ {
if ($forbidden) {
    return 403;
}

if ($slow) {
    limit_rate 10k;
}

rewrite ^/(download/.*)/media/(.*)\..*$ /$1/mp3/$2.mp3 break;
</code></pre><p>}<br></p><p>  将被翻译成这些说明： </p><blockquote class="example"><pre class="notranslate">variable $forbidden<br>check against zero<br>    return 403<br>    end of code<br>variable $slow<br>check against zero<br>match of regular expression<br>copy “/“<br>copy $1<br>copy “/mp3/“<br>copy $2<br>copy “.mp3”<br>end of regular expression<br>end of code<br></pre></blockquote><p></p><p>  请注意，上面的<a hhref="ngx_http_core_module.html#limit_rate">limit_rate</a>指令没有说明，因为它与<code class="notranslate">ngx_http_rewrite_module</code>模块无关。  为<a hhref="#if">if</a>块创建单独的配置。  如果条件成立，则为此配置分配一个请求，其中<code class="notranslate">limit_rate</code>等于10k。 </p><p>  指令 </p><blockquote class="example"><pre class="notranslate">rewrite ^/(download/.<em>)/media/(.</em>)..<em>$ /$1/mp3/$2.mp3 break;<br></em></pre></blockquote><p>  如果正则表达式中的第一个斜杠放在括号内，则可以通过一条指令变小： </p><blockquote class="example"><pre class="notranslate">rewrite ^( <strong>/</strong> download/.)/media/(.<em>)..</em>$ $1/mp3/$2.mp3 break;<br></pre></blockquote><p>  相应的说明将如下所示： </p><blockquote class="example"><pre class="notranslate">match of regular expression<br>copy $1<br>copy “/mp3/“<br>copy $2<br>copy “.mp3”<br>end of regular expression<br>end of code<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_referer_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_referer_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#referer_hash_bucket_size">referer_hash_bucket_size</a> <br>     <a hhref="#referer_hash_max_size">referer_hash_max_size</a> <br>     <a hhref="#valid_referers">valid_referers</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_referer_module</code>模块用于阻止对“Referer”头字段中具有无效值的请求访问站点。  应该记住，使用适当的“Referer”字段值来构造请求非常容易，因此本模块的预期目的不是要彻底阻止此类请求，而是阻止常规浏览器发送的请求的大量流量。  还应该考虑到，即使对于有效请求，常规浏览器也可能不发送“Referer”字段。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">valid_referers none blocked server_names<br>               <em>.example.com example.</em> www.example.org/galleries/<br>               ~.google.;<p></p>
<p>if ($invalid_referer) {<br>    return 403;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="referer_hash_bucket_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>referer_hash_bucket_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">referer_hash_bucket_size 64;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.0.5版本中。 </p></div><p>  设置有效引用散列表的存储区大小。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="referer_hash_max_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>referer_hash_max_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">referer_hash_max_size 2048;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.0.5版本中。 </p></div><p>  设置有效引用者哈希表的最大<code class="notranslate"><i>size</i></code> 。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="valid_referers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>valid_referers</strong><br>    <code class="notranslate">none</code> |<br>    <code class="notranslate">blocked</code> |<br>    <code class="notranslate">server_names</code> |<br>    <code class="notranslate"><i>string</i></code><br>    …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定将导致嵌入的&lt;code class=&quot;notranslate&quot;&gt;$invalid_referer&lt;/code&gt;变量设置为空字符串的“Referer”请求标头字段值。  否则，变量将设置为“ &lt;code class=&quot;notranslate&quot;&gt;1&lt;/code&gt; ”。  搜索匹配不区分大小写。 &lt;/p&gt;&lt;p&gt;  参数可以如下： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;none&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  请求标头中缺少“Referer”字段; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;blocked&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   “Referer”字段出现在请求标头中，但其值已被防火墙或代理服务器删除;  这些值是不以“ &lt;code class=&quot;notranslate&quot;&gt;http://&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;https://&lt;/code&gt; ”开头的字符串; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;server_names&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;   “Referer”请求头字段包含一个服务器名称; &lt;/dd&gt;&lt;dt&gt;  任意字串 &lt;/dt&gt;&lt;dd&gt;  定义服务器名称和可选的URI前缀。  服务器名称的开头或结尾可以包含“ &lt;code class=&quot;notranslate&quot;&gt;*&lt;/code&gt; ”。  在检查期间，“Referer”字段中的服务器端口被忽略; &lt;/dd&gt;&lt;dt&gt;  正则表达式 &lt;/dt&gt;&lt;dd&gt;  第一个符号应为“ &lt;code class=&quot;notranslate&quot;&gt;~&lt;/code&gt; ”。  应该注意的是，表达式将与“ &lt;code class=&quot;notranslate&quot;&gt;http://&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;https://&lt;/code&gt; ”之后的文本匹配。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;valid_referers none blocked server_names
   *.example.com example.* www.example.org/galleries/
   ~\.google\.;
</code></pre><p></p><p></p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p></p><dl class="compact"><dt id="var_invalid_referer"> <code class="notranslate">$invalid_referer</code> </dt> <dd>  空字符串，如果“Referer”请求标头字段值被认为<a hhref="#valid_referers">有效</a> ，否则为“ <code class="notranslate">1</code> ”。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_realip_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_realip_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#set_real_ip_from">set_real_ip_from</a> <br>     <a hhref="#real_ip_header">real_ip_header</a> <br>     <a hhref="#real_ip_recursive">real_ip_recursive</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_realip_module</code>模块用于将客户端地址和可选端口更改为在指定的头字段中发送的端口。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_realip_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">set_real_ip_from  192.168.1.0/24;<br>set_real_ip_from  192.168.2.1;<br>set_real_ip_from  2001:0db8::/32;<br>real_ip_header    X-Forwarded-For;<br>real_ip_recursive on;<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="set_real_ip_from"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>set_real_ip_from</strong><br>    <code class="notranslate"><i>address</i></code> |<br>    <code class="notranslate"><i>CIDR</i></code> |<br>    <code class="notranslate">unix:</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义已知可发送正确替换地址的可信地址。  如果指定了特殊值&lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt;则所有UNIX域套接字都将受信任。  也可以使用主机名（1.13.1）指定可信地址。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  从版本1.3.0和1.2.1开始支持IPv6地址。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;real_ip_header&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;real_ip_header&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;field&lt;/i&gt;&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;X-Real-IP&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;X-Forwarded-For&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;proxy_protocol&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;real_ip_header X-Real-IP;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义请求标头字段，其值将用于替换客户端地址。 &lt;/p&gt;&lt;p&gt;  包含可选端口的请求标头字段值也用于替换客户端端口（1.11.0）。  应根据&lt;a hhref=&quot;https://tools.ietf.org/html/rfc3986&quot;&gt;RFC 3986&lt;/a&gt;指定地址和端口。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;proxy_protocol&lt;/code&gt;参数（1.5.12）将客户端地址更改为PROXY协议头中的地址。  必须先通过在&lt;a hhref=&quot;ngx_http_core_module.html#listen&quot;&gt;listen&lt;/a&gt;指令中设置&lt;code class=&quot;notranslate&quot;&gt;proxy_protocol&lt;/code&gt;参数来启用PROXY协议。 &lt;/p&gt;&lt;a name=&quot;real_ip_recursive&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;real_ip_recursive&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;real_ip_recursive off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.3.0和1.2.1版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果禁用递归搜索，则匹配其中一个可信地址的原始客户端地址将替换为&lt;a hhref=&quot;#real_ip_header&quot;&gt;real_ip_header&lt;/a&gt;指令定义的请求头字段中发送的最后一个地址。  如果启用了递归搜索，则匹配其中一个可信地址的原始客户端地址将替换为请求头字段中发送的最后一个非受信任地址。 &lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;&lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_realip_remote_addr&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$realip_remote_addr&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留原始客户地址（1.9.7） &lt;/dd&gt;&lt;dt id=&quot;var_realip_remote_port&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$realip_remote_port&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  保留原始客户端端口（1.11.0） &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_random_index_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_random_index_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#random_index">random_index</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_random_index_module</code>模块处理以斜杠字符（’ <code class="notranslate">/</code> ‘）结尾的请求，并在目录中选择一个随机文件作为索引文件。  在<a hhref="ngx_http_index_module.html">ngx_http_index_module</a>模块之前处理该模块。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_random_index_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    random_index on;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="random_index"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>random_index</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">random_index off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用周围位置的模块处理。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_proxy_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_proxy_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#proxy_bind">proxy_bind</a> <br>     <a hhref="#proxy_buffer_size">proxy_buffer_size</a> <br>     <a hhref="#proxy_buffering">proxy_buffering</a> <br>     <a hhref="#proxy_buffers">proxy_buffers</a> <br>     <a hhref="#proxy_busy_buffers_size">proxy_busy_buffers_size</a> <br>     <a hhref="#proxy_cache">proxy_cache</a> <br>     <a hhref="#proxy_cache_background_update">proxy_cache_background_update</a> <br>     <a hhref="#proxy_cache_bypass">proxy_cache_bypass</a> <br>     <a hhref="#proxy_cache_convert_head">proxy_cache_convert_head</a> <br>     <a hhref="#proxy_cache_key">proxy_cache_key</a> <br>     <a hhref="#proxy_cache_lock">proxy_cache_lock</a> <br>     <a hhref="#proxy_cache_lock_age">proxy_cache_lock_age</a> <br>     <a hhref="#proxy_cache_lock_timeout">proxy_cache_lock_timeout</a> <br>     <a hhref="#proxy_cache_max_range_offset">proxy_cache_max_range_offset</a> <br>     <a hhref="#proxy_cache_methods">proxy_cache_methods</a> <br>     <a hhref="#proxy_cache_min_uses">proxy_cache_min_uses</a> <br>     <a hhref="#proxy_cache_path">proxy_cache_path</a> <br>     <a hhref="#proxy_cache_purge">proxy_cache_purge</a> <br>     <a hhref="#proxy_cache_revalidate">proxy_cache_revalidate</a> <br>     <a hhref="#proxy_cache_use_stale">proxy_cache_use_stale</a> <br>     <a hhref="#proxy_cache_valid">proxy_cache_valid</a> <br>     <a hhref="#proxy_connect_timeout">proxy_connect_timeout</a> <br>     <a hhref="#proxy_cookie_domain">proxy_cookie_domain</a> <br>     <a hhref="#proxy_cookie_path">proxy_cookie_path</a> <br>     <a hhref="#proxy_force_ranges">proxy_force_ranges</a> <br>     <a hhref="#proxy_headers_hash_bucket_size">proxy_headers_hash_bucket_size</a> <br>     <a hhref="#proxy_headers_hash_max_size">proxy_headers_hash_max_size</a> <br>     <a hhref="#proxy_hide_header">proxy_hide_header</a> <br>     <a hhref="#proxy_http_version">proxy_http_version</a> <br>     <a hhref="#proxy_ignore_client_abort">proxy_ignore_client_abort</a> <br>     <a hhref="#proxy_ignore_headers">proxy_ignore_headers</a> <br>     <a hhref="#proxy_intercept_errors">proxy_intercept_errors</a> <br>     <a hhref="#proxy_limit_rate">proxy_limit_rate</a> <br>     <a hhref="#proxy_max_temp_file_size">proxy_max_temp_file_size</a> <br>     <a hhref="#proxy_method">proxy_method</a> <br>     <a hhref="#proxy_next_upstream">proxy_next_upstream</a> <br>     <a hhref="#proxy_next_upstream_timeout">proxy_next_upstream_timeout</a> <br>     <a hhref="#proxy_next_upstream_tries">proxy_next_upstream_tries</a> <br>     <a hhref="#proxy_no_cache">proxy_no_cache</a> <br>     <a hhref="#proxy_pass">proxy_pass</a> <br>     <a hhref="#proxy_pass_header">proxy_pass_header</a> <br>     <a hhref="#proxy_pass_request_body">proxy_pass_request_body</a> <br>     <a hhref="#proxy_pass_request_headers">proxy_pass_request_headers</a> <br>     <a hhref="#proxy_read_timeout">proxy_read_timeout</a> <br>     <a hhref="#proxy_redirect">proxy_redirect</a> <br>     <a hhref="#proxy_request_buffering">proxy_request_buffering</a> <br>     <a hhref="#proxy_send_lowat">proxy_send_lowat</a> <br>     <a hhref="#proxy_send_timeout">proxy_send_timeout</a> <br>     <a hhref="#proxy_set_body">proxy_set_body</a> <br>     <a hhref="#proxy_set_header">proxy_set_header</a> <br>     <a hhref="#proxy_socket_keepalive">proxy_socket_keepalive</a> <br>     <a hhref="#proxy_ssl_certificate">proxy_ssl_certificate</a> <br>     <a hhref="#proxy_ssl_certificate_key">proxy_ssl_certificate_key</a> <br>     <a hhref="#proxy_ssl_ciphers">proxy_ssl_ciphers</a> <br>     <a hhref="#proxy_ssl_crl">proxy_ssl_crl</a> <br>     <a hhref="#proxy_ssl_name">proxy_ssl_name</a> <br>     <a hhref="#proxy_ssl_password_file">proxy_ssl_password_file</a> <br>     <a hhref="#proxy_ssl_protocols">proxy_ssl_protocols</a> <br>     <a hhref="#proxy_ssl_server_name">proxy_ssl_server_name</a> <br>     <a hhref="#proxy_ssl_session_reuse">proxy_ssl_session_reuse</a> <br>     <a hhref="#proxy_ssl_trusted_certificate">proxy_ssl_trusted_certificate</a> <br>     <a hhref="#proxy_ssl_verify">proxy_ssl_verify</a> <br>     <a hhref="#proxy_ssl_verify_depth">proxy_ssl_verify_depth</a> <br>     <a hhref="#proxy_store">proxy_store</a> <br>     <a hhref="#proxy_store_access">proxy_store_access</a> <br>     <a hhref="#proxy_temp_file_write_size">proxy_temp_file_write_size</a> <br>     <a hhref="#proxy_temp_path">proxy_temp_path</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_proxy_module</code>模块允许将请求传递到另一台服务器。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    proxy_pass       <a href="http://localhost:8000" target="_blank" rel="noopener">http://localhost:8000</a>;<br>    proxy_set_header Host      $host;<br>    proxy_set_header X-Real-IP $remote_addr;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="proxy_bind"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_bind</strong><br>    <code class="notranslate"><i>address</i></code><br>    [ <code class="notranslate">transparent</code> ] |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.8.22版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  使与可选端口（1.11.2）的指定本地IP地址建立到代理服务器的传出连接。  参数值可以包含变量（1.3.12）。  特殊值&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; （1.3.12）取消了从先前配置级别继承的&lt;code class=&quot;notranslate&quot;&gt;proxy_bind&lt;/code&gt;指令的效果，允许系统自动分配本地IP地址和端口。 &lt;/p&gt;&lt;a name=&quot;proxy_bind_transparent&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;transparent&lt;/code&gt;参数（1.11.0）允许到代理服务器的传出连接源自非本地IP地址，例如，来自客户端的真实IP地址： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_bind $remote_addr transparent;
</code></pre><p></p><p>  为了使此参数有效，通常需要使用<a hhref="ngx_core_module.html#user">超级用户</a>权限运行nginx工作进程。  在Linux上，不需要（1.13.8），就像指定了<code class="notranslate">transparent</code>参数一样，工作进程从主进程继承<code class="notranslate">CAP_NET_RAW</code>功能。  还需要配置内核路由表以拦截来自代理服务器的网络流量。 </p><a name="proxy_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_buffer_size 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取从代理服务器接收的响应的第一部分的缓冲区的<code class="notranslate"><i>size</i></code> 。  这部分通常包含一个小的响应头。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。  然而，它可以做得更小。 </p><a name="proxy_buffering"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_buffering</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_buffering on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用来自代理服务器的响应缓冲。 </p><p>  启用缓冲后，nginx会尽快从代理服务器接收响应，并将其保存到<a hhref="#proxy_buffer_size">proxy_buffer_size</a>和<a hhref="#proxy_buffers">proxy_buffers</a>指令设置的缓冲区中。  如果整个响应不适合内存，则可以将其中的一部分保存到磁盘上的<a hhref="#proxy_temp_path">临时文件中</a> 。  写入临时文件由<a hhref="#proxy_max_temp_file_size">proxy_max_temp_file_size</a>和<a hhref="#proxy_temp_file_write_size">proxy_temp_file_write_size</a>指令控制。 </p><p>  禁用缓冲时，响应会在收到响应时立即同步传递给客户端。   nginx不会尝试从代理服务器读取整个响应。   nginx一次可以从服务器接收的数据的最大大小由<a hhref="#proxy_buffer_size">proxy_buffer_size</a>指令设置。 </p><p>  也可以通过在“X-Accel-Buffering”响应头字段中传递“ <code class="notranslate">yes</code> ”或“ <code class="notranslate">no</code> ”来启用或禁用缓冲。  可以使用<a hhref="#proxy_ignore_headers">proxy_ignore_headers</a>指令禁用此功能。 </p><a name="proxy_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_buffers 8 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于从代理服务器读取响应的缓冲区的<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> ，用于单个连接。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 </p><a name="proxy_busy_buffers_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_busy_buffers_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_busy_buffers_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用来自代理服务器的响应<a hhref="#proxy_buffering">缓冲</a>时，限制可能忙于向响应客户端发送响应的缓冲区的总<code class="notranslate"><i>size</i></code> ，而响应尚未完全读取。  同时，其余的缓冲区可用于读取响应，并在需要时缓冲部分响应临时文件。  默认情况下， <code class="notranslate"><i>size</i></code>由<a hhref="#proxy_buffer_size">proxy_buffer_size</a>和<a hhref="#proxy_buffers">proxy_buffers</a>指令设置的两个缓冲区的大小限制。 </p><a name="proxy_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache</strong> <code class="notranslate"><i>zone</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于缓存的共享内存区域。  可以在多个地方使用相同的区域。  参数值可以包含变量（1.7.9）。   <code class="notranslate">off</code>参数禁用从先前配置级别继承的高速缓存。 </p><a name="proxy_cache_background_update"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_background_update</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache_background_update off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.10版中。 </p></div><p>  允许启动后台子请求以更新过期的缓存项，同时将过时的缓存响应返回给客户端。  请注意，在更新时必须<a hhref="#proxy_cache_use_stale_updating">允许</a>使用陈旧的缓存响应。 </p><a name="proxy_cache_bypass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_bypass</strong> <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义不从缓存中获取响应的条件。  如果字符串参数的至少一个值不为空且不等于“0”，则不会从缓存中获取响应： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;
</code></pre><p>proxy_cache_bypass $http_pragma    $http_authorization;<br></p><p>  可以与<a hhref="#proxy_no_cache">proxy_no_cache</a>指令一起使用。 </p><a name="proxy_cache_convert_head"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_convert_head</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache_convert_head on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.9.7版中。 </p></div><p>  启用或禁用将“ <code class="notranslate">HEAD</code> ”方法转换为“ <code class="notranslate">GET</code> ”以进行缓存。  禁用转换时，应将<a hhref="#proxy_cache_key">缓存键</a>配置为包含<code class="notranslate">$request_method</code> 。 </p><a name="proxy_cache_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_key</strong> <code class="notranslate"><i>string</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache_key $scheme$proxy_host$request_uri;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  例如，定义缓存的键 </p><blockquote class="example"><pre class="notranslate">proxy_cache_key “$host$request_uri $cookie_user”;<br></pre></blockquote><p>  默认情况下，指令的值接近字符串 </p><blockquote class="example"><pre class="notranslate">proxy_cache_key $scheme$proxy_host$uri$is_args$args;<br></pre></blockquote><p></p><a name="proxy_cache_lock"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_lock</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache_lock off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  启用后，通过将请求传递给代理服务器，一次只允许一个请求填充根据<a hhref="#proxy_cache_key">proxy_cache_key</a>指令标识的新缓存元素。  同一缓存元素的其他请求将等待响应出现在缓存中或缓存锁定以释放此元素，直到<a hhref="#proxy_cache_lock_timeout">proxy_cache_lock_timeout</a>指令设置的时间。 </p><a name="proxy_cache_lock_age"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_lock_age</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache_lock_age 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.8版本中。 </p></div><p>  如果传递给代理服务器以填充新缓存元素的最后一个请求在指定<code class="notranslate"><i>time</i></code>内没有完成，则可以将另一个请求传递给代理服务器。 </p><a name="proxy_cache_lock_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_lock_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache_lock_timeout 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  设置<a hhref="#proxy_cache_lock">proxy_cache_lock</a>的超时。  当<code class="notranslate"><i>time</i></code>到期时，请求将被传递给代理服务器，但是，响应将不会被缓存。 </p><blockquote class="note">  在1.7.8之前，可以缓存响应。 </blockquote><p></p><a name="proxy_cache_max_range_offset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_max_range_offset</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置字节范围请求的偏移量（以字节为单位）。  如果范围超出偏移量，则范围请求将传递到代理服务器，并且不会缓存响应。 &lt;/p&gt;&lt;a name=&quot;proxy_cache_methods&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_cache_methods&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_cache_methods GET HEAD;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.7.59版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果此指令中列出了客户端请求方法，则将缓存响应。   “ &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; ”方法总是添加到列表中，但建议明确指定它们。  另请参见&lt;a hhref=&quot;#proxy_no_cache&quot;&gt;proxy_no_cache&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;proxy_cache_min_uses&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_cache_min_uses&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_cache_min_uses 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将缓存响应的请求&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;a name=&quot;proxy_cache_path&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_cache_path&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;path&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;levels&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;levels&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;use_temp_path&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ]
&lt;code class=&quot;notranslate&quot;&gt;keys_zone&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; : &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;inactive&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;max_size&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置缓存的路径和其他参数。  缓存数据存储在文件中。  缓存中的文件名是将MD5功能应用于&lt;a hhref=&quot;#proxy_cache_key&quot;&gt;缓存键的结果&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;levels&lt;/code&gt;参数定义高速缓存的层次结构级别：从1到3，每个级别接受值1或2.例如，在以下配置中 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;
</code></pre><p></p><p>  缓存中的文件名如下所示： </p><blockquote class="example"><pre class="notranslate">/data/nginx/cache/ <strong>c</strong> / <strong>29</strong> /b7f54b2df7773722d382f4809d650 <strong>29c</strong><br></pre></blockquote><p></p><p>  首先将缓存的响应写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和缓存可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，缓存和保存临时文件的目录都放在同一文件系统上。  临时文件的目录是根据<code class="notranslate">use_temp_path</code>参数（1.7.10）设置的。  如果省略此参数或将其设置为<code class="notranslate">on</code> ，则将使用<a hhref="#proxy_temp_path">proxy_temp_path</a>指令为给定位置设置的目录。  如果该值设置为<code class="notranslate">off</code> ，则临时文件将直接放入缓存目录中。 </p><p>  此外，所有活动密钥和有关数据的信息都存储在共享内存区域中，其<code class="notranslate"><i>name</i></code>和<code class="notranslate"><i>size</i></code>由<code class="notranslate">keys_zone</code>参数配置。  一兆字节区域可以存储大约8000个密钥。 </p><blockquote class="note">  作为<a hhref="http://nginx.com/products/">商业订阅的</a>一部分，共享存储器区域还存储扩展的高速缓存<a hhref="ngx_http_api_module.html#http_caches_">信息</a> ，因此，需要为相同数量的密钥指定更大的区域大小。  例如，一兆字节区域可以存储大约4000个密钥。 </blockquote><p></p><p>  在<code class="notranslate">inactive</code>参数指定的时间内未访问的缓存数据将从缓存中删除，无论其新鲜度如何。  默认情况下， <code class="notranslate">inactive</code>设置为10分钟。 </p><p>  特殊的“缓存管理器”进程监视<code class="notranslate">max_size</code>参数设置的最大缓存大小。  超过此大小时，它会删除最近最少使用的数据。  在<code class="notranslate">manager_files</code> ， <code class="notranslate">manager_threshold</code>和<code class="notranslate">manager_sleep</code>参数（1.11.5）配置的迭代中删除数据。  在一次迭代期间，不会删除<code class="notranslate">manager_files</code>项（默认情况下为100）。  一次迭代的持续时间受<code class="notranslate">manager_threshold</code>参数限制（默认情况下为200毫秒）。  在迭代之间，由<code class="notranslate">manager_sleep</code>参数（默认为50毫秒）配置的暂停。 </p><p>  启动一分钟后，激活特殊的“缓存加载程序”进程。  它将有关存储在文件系统中的先前缓存数据的信息加载到缓存区。  加载也是在迭代中完成的。  在一次迭代期间，加载的<code class="notranslate">loader_files</code>项目不超过（默认情况下为100）。  此外，一次迭代的持续时间受<code class="notranslate">loader_threshold</code>参数限制（默认为200毫秒）。  在迭代之间，由<code class="notranslate">loader_sleep</code>参数（默认为50毫秒）配置暂停。 </p><p>  此外，以下参数作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供： </p><p></p><dl class="compact"><dt id="purger">   <code class="notranslate">purger</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> </dt><dd>  指示缓存清除程序是否将从磁盘中删除与<a hhref="#proxy_cache_purge">通配符密钥</a>匹配的缓存条目（1.7.12）。  将参数设置为<code class="notranslate">on</code> （默认为<code class="notranslate">off</code> ）将激活“cache purger”进程，该进程将永久迭代所有缓存条目并删除与通配符键匹配的条目。 </dd><dt id="purger_files">   <code class="notranslate">purger_files</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置在一次迭代（1.7.12）期间将扫描的项目数。  默认情况下， <code class="notranslate">purger_files</code>设置为10。 </dd><dt id="purger_threshold">   <code class="notranslate">purger_threshold</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置一次迭代的持续时间（1.7.12）。  默认情况下， <code class="notranslate">purger_threshold</code>设置为50毫秒。 </dd><dt id="purger_sleep">   <code class="notranslate">purger_sleep</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置迭代之间的暂停（1.7.12）。  默认情况下， <code class="notranslate">purger_sleep</code>设置为50毫秒。 </dd></dl><p></p><p></p><blockquote class="note">  在版本1.7.3,1.7.7和1.11.10中，缓存头格式已更改。  升级到较新的nginx版本之前，缓存的响应将被视为无效。 </blockquote><p></p><a name="proxy_cache_purge"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_purge</strong> string …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义将请求视为缓存清除请求的条件。  如果字符串参数的至少一个值不为空并且不等于“0”，则移除具有相应&lt;a hhref=&quot;#proxy_cache_key&quot;&gt;高速缓存键&lt;/a&gt;的高速缓存条目。  通过返回204（无内容）响应来指示成功操作的结果。 &lt;/p&gt;&lt;p&gt;  如果清除请求的&lt;a hhref=&quot;#proxy_cache_key&quot;&gt;缓存键&lt;/a&gt;以星号（“ &lt;code class=&quot;notranslate&quot;&gt;*&lt;/code&gt; ”）结尾，则将从缓存中删除与通配符键匹配的所有缓存条目。  但是，这些条目将保留在磁盘上，直到它们被删除&lt;a hhref=&quot;#proxy_cache_path&quot;&gt;为非活动状态&lt;/a&gt; ，或由&lt;a hhref=&quot;#purger&quot;&gt;缓存&lt;/a&gt;清除程序（1.7.12）处理，或者客户端尝试访问它们。 &lt;/p&gt;&lt;p&gt;  配置示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_cache_path /data/nginx/cache keys_zone=cache_zone:10m;
</code></pre><p>map $request_method $purge_method {<br>    PURGE   1;<br>    default 0;<br>}</p>
<p>server {<br>    …<br>    location / {<br>        proxy_pass <a href="http://backend" target="_blank" rel="noopener">http://backend</a>;<br>        proxy_cache cache_zone;<br>        proxy_cache_key $uri;<br>        proxy_cache_purge $purge_method;<br>    }<br>}<br></p><p></p><blockquote class="note">  此功能作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="proxy_cache_revalidate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_revalidate</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache_revalidate off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.7版本中。 </p></div><p>  使用具有“If-Modified-Since”和“If-None-Match”标头字段的条件请求启用过期缓存项的重新验证。 </p><a name="proxy_cache_use_stale"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_use_stale</strong><br>    <code class="notranslate">error</code> |<br>    <code class="notranslate">timeout</code> |<br>    <code class="notranslate">invalid_header</code> |<br>    <code class="notranslate">updating</code> |<br>    <code class="notranslate">http_500</code> |<br>    <code class="notranslate">http_502</code> |<br>    <code class="notranslate">http_503</code> |<br>    <code class="notranslate">http_504</code> |<br>    <code class="notranslate">http_403</code> |<br>    <code class="notranslate">http_404</code> |<br>    <code class="notranslate">http_429</code> |<br>    <code class="notranslate">off</code><br>    …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cache_use_stale off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  确定在与代理服务器通信期间可以在哪些情况下使用过时的缓存响应。  该指令的参数与<a hhref="#proxy_next_upstream">proxy_next_upstream</a>指令的参数匹配。 </p><p>  如果无法选择代理服务器来处理请求，则<code class="notranslate">error</code>参数还允许使用过时的缓存响应。 </p><a name="proxy_cache_use_stale_updating"></a><p>  此外，如果当前正在更新，则<code class="notranslate">updating</code>参数允许使用过时的缓存响应。  这允许在更新缓存数据时最小化对代理服务器的访问次数。 </p><p>  在响应变为失效后，也可以在响应头中直接启用过时的缓存响应指定的秒数（1.11.10）。  这比使用指令参数的优先级低。 </p><ul><li>   “Cache-Control”头字段的“ <a hhref="https://tools.ietf.org/html/rfc5861#section-3">stale-while-revalidate</a> ”扩展允许使用陈旧的缓存响应（如果当前正在更新）。 </li><li>   “Cache-Control”头字段的“ <a hhref="https://tools.ietf.org/html/rfc5861#section-4">stale-if-error</a> ”扩展允许在出现错误时使用陈旧的缓存响应。 </li></ul><p></p><p>  要在填充新缓存元素时最小化对代理服务器的访问次数，可以使用<a hhref="#proxy_cache_lock">proxy_cache_lock</a>指令。 </p><a name="proxy_cache_valid"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cache_valid</strong> [ <code class="notranslate"><i>code</i></code> …] <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置不同响应代码的缓存时间。  例如，以下指令 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_cache_valid 200 302 10m;
</code></pre><p>proxy_cache_valid 404      1m;<br></p><p>  为代码为200和302的响应设置10分钟的缓存，为代码404的响应设置1分钟。 </p><p>  如果仅指定了缓存<code class="notranslate"><i>time</i></code> </p><blockquote class="example"><pre class="notranslate">proxy_cache_valid 5m;<br></pre></blockquote><p>  然后只缓存200,301和302个响应。 </p><p>  此外，可以指定<code class="notranslate">any</code>参数来缓存任何响应： </p><blockquote class="example"><pre class="notranslate">proxy_cache_valid 200 302 10m;<br>proxy_cache_valid 301      1h;<br>proxy_cache_valid any      1m;<br></pre></blockquote><p></p><p>  缓存的参数也可以直接在响应头中设置。  这比使用该指令设置缓存时间具有更高的优先级。 </p><ul><li>   “X-Accel-Expires”标题字段以秒为单位设置响应的缓存时间。  零值禁用响应的缓存。  如果值以<code class="notranslate">@</code>前缀开头，则设置自Epoch以来的绝对时间（以秒为单位），响应可以高速缓存。 </li><li>  如果标题不包括“X-Accel-Expires”字段，则可以在标题字段“Expires”或“Cache-Control”中设置高速缓存的参数。 </li><li>  如果标头包含“Set-Cookie”字段，则不会缓存此类响应。 </li><li>  如果标题包含具有特殊值“ <code class="notranslate"><em></em></code> ”的“Vary”字段，则不会缓存此类响应（1.7.7）。  如果标题包含具有另一个值的“Vary”字段，则将考虑相应的请求标题字段来缓存这样的响应（1.7.7）。 </li></ul><p>  可以使用<a hhref="#proxy_ignore_headers">proxy_ignore_headers</a>指令禁用这些响应头字段中的一个或多个的处理。 </p><a name="proxy_connect_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_connect_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_connect_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义与代理服务器建立连接的超时。  应该注意，此超时通常不会超过75秒。 </p><a name="proxy_cookie_domain"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cookie_domain</strong> <code class="notranslate">off</code> ;</code> <br> <code class="notranslate"><strong>proxy_cookie_domain</strong> <code class="notranslate"><i>domain</i></code> <code class="notranslate"><i>replacement</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cookie_domain off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.15版中。 </p></div><p>  设置应在代理服务器响应的“Set-Cookie”标头字段的<code class="notranslate">domain</code>属性中更改的文本。  假设代理服务器返回带有“ <code class="notranslate">domain=localhost</code> ”属性的“Set-Cookie”头字段。  指令 </p><blockquote class="example"><pre class="notranslate">proxy_cookie_domain localhost example.org;<br></pre></blockquote><p>  将此属性重写为“ <code class="notranslate">domain=example.org</code> ”。 </p><p>   <code class="notranslate"><i>domain</i></code>开头处的点和<code class="notranslate"><i>replacement</i></code>字符串以及<code class="notranslate">domain</code>属性将被忽略。  匹配不区分大小写。 </p><p>   <code class="notranslate"><i>domain</i></code>和<code class="notranslate"><i>replacement</i></code>字符串可以包含变量： </p><blockquote class="example"><pre class="notranslate">proxy_cookie_domain www.$host $host;<br></pre></blockquote><p></p><p>  也可以使用正则表达式指定该指令。  在这种情况下， <code class="notranslate"><i>domain</i></code>应该从“ <code class="notranslate">~</code> ”符号开始。  正则表达式可以包含命名和位置捕获， <code class="notranslate"><i>replacement</i></code>可以引用它们： </p><blockquote class="example"><pre class="notranslate">proxy_cookie_domain ~.(?P&lt;sl_domain&gt;[-0-9a-z]+.[a-z]+)$ $sl_domain;<br></pre></blockquote><p></p><p>  可能有几个<code class="notranslate">proxy_cookie_domain</code>指令： </p><blockquote class="example"><pre class="notranslate">proxy_cookie_domain localhost example.org;<br>proxy_cookie_domain ~.([a-z]+.[a-z]+)$ $1;<br></pre></blockquote><p></p><p>   <code class="notranslate">off</code>参数取消所有<code class="notranslate">proxy_cookie_domain</code>指令对当前级别的影响： </p><blockquote class="example"><pre class="notranslate">proxy_cookie_domain off;<br>proxy_cookie_domain localhost example.org;<br>proxy_cookie_domain www.example.org example.org;<br></pre></blockquote><p></p><a name="proxy_cookie_path"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_cookie_path</strong> <code class="notranslate">off</code> ;</code> <br> <code class="notranslate"><strong>proxy_cookie_path</strong> <code class="notranslate"><i>path</i></code> <code class="notranslate"><i>replacement</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_cookie_path off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.15版中。 </p></div><p>  设置应在代理服务器响应的“Set-Cookie”标头字段的<code class="notranslate">path</code>属性中更改的文本。  假设代理服务器返回带有属性“ <code class="notranslate">path=/two/some/uri/</code> ”的“Set-Cookie”头字段。  指令 </p><blockquote class="example"><pre class="notranslate">proxy_cookie_path /two/ /;<br></pre></blockquote><p>  将此属性重写为“ <code class="notranslate">path=/some/uri/</code> ”。 </p><p>   <code class="notranslate"><i>path</i></code>和<code class="notranslate"><i>replacement</i></code>字符串可以包含变量： </p><blockquote class="example"><pre class="notranslate">proxy_cookie_path $uri /some$uri;<br></pre></blockquote><p></p><p>  也可以使用正则表达式指定该指令。  在这种情况下， <code class="notranslate"><i>path</i></code>应该从用于区分大小写匹配的“ <code class="notranslate">~</code> ”符号开始，或者从用于区分大小写匹配的“ <code class="notranslate">~</code> ”符号开始。  正则表达式可以包含命名和位置捕获， <code class="notranslate"><i>replacement</i></code>可以引用它们： </p><blockquote class="example"><pre class="notranslate">proxy_cookie_path ~<em>^/user/([^/]+) /u/$1;<br></em></pre></blockquote><p></p><p>  可能有几个<code class="notranslate">proxy_cookie_path</code>指令： </p><blockquote class="example"><pre class="notranslate">proxy_cookie_path /one/ /;<br>proxy_cookie_path / /two/;<br></pre></blockquote><p></p><p>   <code class="notranslate">off</code>参数取消所有<code class="notranslate">proxy_cookie_path</code>指令对当前级别的影响： </p><blockquote class="example"><pre class="notranslate">proxy_cookie_path off;<br>proxy_cookie_path /two/ /;<br>proxy_cookie_path ~^/user/([^/]+) /u/$1;<br></pre></blockquote><p></p><a name="proxy_force_ranges"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_force_ranges</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_force_ranges off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.7版本中。 </p></div><p>  无论代理服务器中的“Accept-Ranges”字段如何，都可以对代理服务器的缓存和未缓存响应启用字节范围支持。 </p><a name="proxy_headers_hash_bucket_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_headers_hash_bucket_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_headers_hash_bucket_size 64;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置<a hhref="#proxy_hide_header">proxy_hide_header</a>和<a hhref="#proxy_set_header">proxy_set_header</a>指令使用的哈希表的桶<code class="notranslate"><i>size</i></code> 。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="proxy_headers_hash_max_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_headers_hash_max_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_headers_hash_max_size 512;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置<a hhref="#proxy_hide_header">proxy_hide_header</a>和<a hhref="#proxy_set_header">proxy_set_header</a>指令使用的哈希表的最大<code class="notranslate"><i>size</i></code> 。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="proxy_hide_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_hide_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  默认情况下，nginx不会从代理服务器对客户端的响应中传递标题字段“Date”，“Server”，“X-Pad”和“X-Accel -...”。   &lt;code class=&quot;notranslate&quot;&gt;proxy_hide_header&lt;/code&gt;指令设置不会传递的其他字段。  相反，如果需要允许传递字段，则可以使用&lt;a hhref=&quot;#proxy_pass_header&quot;&gt;proxy_pass_header&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;proxy_http_version&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_http_version&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;1.0&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;1.1&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_http_version 1.0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.1.4版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置代理的HTTP协议版本。  默认情况下，使用版本1.0。  建议将1.1版与&lt;a hhref=&quot;ngx_http_upstream_module.html#keepalive&quot;&gt;keepalive&lt;/a&gt;连接和&lt;a hhref=&quot;ngx_http_upstream_module.html#ntlm&quot;&gt;NTLM身份验证配合使用&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;proxy_ignore_client_abort&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ignore_client_abort&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ignore_client_abort off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定在客户端关闭连接而不等待响应时是否应关闭与代理服务器的连接。 &lt;/p&gt;&lt;a name=&quot;proxy_ignore_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ignore_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;field&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  禁用从代理服务器处理某些响应头字段。  可以忽略以下字段：“X-Accel-Redirect”，“X-Accel-Expires”，“X-Accel-Limit-Rate”（1.1.6），“X-Accel-Buffering”（1.1.6） ，“X-Accel-Charset”（1.1.6），“Expires”，“Cache-Control”，“Set-Cookie”（0.8.44）和“Vary”（1.7.7）。 &lt;/p&gt;&lt;p&gt;  如果未禁用，则处理这些标头字段会产生以下影响： &lt;/p&gt;&lt;ul&gt;&lt;li&gt;   “X-Accel-Expires”，“Expires”，“Cache-Control”，“Set-Cookie”和“Vary”设置响应&lt;a hhref=&quot;#proxy_cache_valid&quot;&gt;缓存&lt;/a&gt;的参数; &lt;/li&gt;&lt;li&gt;   “X-Accel-Redirect”执行&lt;a hhref=&quot;ngx_http_core_module.html#internal&quot;&gt;内部重定向&lt;/a&gt;到指定的URI; &lt;/li&gt;&lt;li&gt;   “X-Accel-Limit-Rate”设置向客户端传输响应的&lt;a hhref=&quot;ngx_http_core_module.html#limit_rate&quot;&gt;速率限制&lt;/a&gt; ; &lt;/li&gt;&lt;li&gt;   “X-Accel-Buffering”启用或禁用&lt;a hhref=&quot;#proxy_buffering&quot;&gt;缓冲&lt;/a&gt;响应; &lt;/li&gt;&lt;li&gt;   “X-Accel-Charset”设置了所需的响应&lt;a hhref=&quot;ngx_http_charset_module.html#charset&quot;&gt;字符集&lt;/a&gt; 。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;proxy_intercept_errors&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_intercept_errors&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_intercept_errors off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定代码大于或等于300的代理响应是应该传递给客户端还是被拦截并重定向到nginx以便使用&lt;a hhref=&quot;ngx_http_core_module.html#error_page&quot;&gt;error_page&lt;/a&gt;指令进行处理。 &lt;/p&gt;&lt;a name=&quot;proxy_limit_rate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_limit_rate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;rate&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_limit_rate 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制从代理服务器读取响应的速度。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;rate&lt;/i&gt;&lt;/code&gt;以每秒字节数指定。  零值禁用速率限制。  根据请求设置限制，因此如果nginx同时打开到代理服务器的两个连接，则总速率将是指定限制的两倍。  仅当启用了代理服务器的响应&lt;a hhref=&quot;#proxy_buffering&quot;&gt;缓冲时&lt;/a&gt; ，此限制才有效。 &lt;/p&gt;&lt;a name=&quot;proxy_max_temp_file_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_max_temp_file_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_max_temp_file_size 1024m;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  当启用来自代理服务器的响应&lt;a hhref=&quot;#proxy_buffering&quot;&gt;缓冲&lt;/a&gt; ，并且整个响应不适合&lt;a hhref=&quot;#proxy_buffer_size&quot;&gt;proxy_buffer_size&lt;/a&gt;和&lt;a hhref=&quot;#proxy_buffers&quot;&gt;proxy_buffers&lt;/a&gt;指令设置的缓冲区时，响应的一部分可以保存到临时文件中。  该指令设置临时文件的最大&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  一次写入临时文件的数据大小由&lt;a hhref=&quot;#proxy_temp_file_write_size&quot;&gt;proxy_temp_file_write_size&lt;/a&gt;指令设置。 &lt;/p&gt;&lt;p&gt;  零值禁用缓冲对临时文件的响应。 &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  此限制不适用于将&lt;a hhref=&quot;#proxy_cache&quot;&gt;缓存&lt;/a&gt;或&lt;a hhref=&quot;#proxy_store&quot;&gt;存储&lt;/a&gt;在磁盘上的响应。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;proxy_method&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_method&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;method&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定在转发到代理服务器的请求中使用的HTTP &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;method&lt;/i&gt;&lt;/code&gt; ，而不是客户端请求中的方法。  参数值可以包含变量（1.11.6）。 &lt;/p&gt;&lt;a name=&quot;proxy_next_upstream&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_next_upstream&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_502&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_504&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;non_idempotent&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_next_upstream error timeout;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定应将请求传递到下一个服务器的情况： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与服务器建立连接，向其传递请求或读取响应头时发生错误; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  在与服务器建立连接，向其传递请求或读取响应头时发生超时; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回空或无效响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为500的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_502&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为502的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为503的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_504&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码504的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为403的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为404的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为429的响应（1.11.13）; &lt;/dd&gt;&lt;dt id=&quot;non_idempotent&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;non_idempotent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  通常，如果请求已发送到上游服务器，则使用&lt;a hhref=&quot;https://tools.ietf.org/html/rfc7231#section-4.2.2&quot;&gt;非幂等&lt;/a&gt;方法（ &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;LOCK&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; ）的请求不会传递给下一个服务器（1.9.13）;  启用此选项显式允许重试此类请求; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  禁用将请求传递给下一个服务器。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  应该记住，只有在尚未向客户端发送任何内容的情况下，才能将请求传递给下一个服务器。  也就是说，如果在传输响应的过程中发生错误或超时，则无法修复此问题。 &lt;/p&gt;&lt;p&gt;  该指令还定义了与服务器通信的&lt;a hhref=&quot;ngx_http_upstream_module.html#max_fails&quot;&gt;不成功尝试&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt;情况始终被视为不成功的尝试，即使它们未在指令中指定。   &lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;http_502&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;http_504&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt;情况仅在指令中指定&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt;被视为不成功尝试。   &lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt;情况从未被视为不成功的尝试。 &lt;/p&gt;&lt;p&gt;  将请求传递到下一个服务器可能会受到&lt;a hhref=&quot;#proxy_next_upstream_tries&quot;&gt;尝试次数&lt;/a&gt;和&lt;a hhref=&quot;#proxy_next_upstream_timeout&quot;&gt;时间的限制&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;proxy_next_upstream_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_next_upstream_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_next_upstream_timeout 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.5版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制请求可以传递到&lt;a hhref=&quot;#proxy_next_upstream&quot;&gt;下一个服务器的时间&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;proxy_next_upstream_tries&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_next_upstream_tries&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_next_upstream_tries 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.5版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制将请求传递到&lt;a hhref=&quot;#proxy_next_upstream&quot;&gt;下一个服务器&lt;/a&gt;的可能尝试次数。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;proxy_no_cache&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_no_cache&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义不将响应保存到缓存的条件。  如果字符串参数的至少一个值不为空且不等于“0”，则不会保存响应： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_no_cache $cookie_nocache $arg_nocache$arg_comment;
</code></pre><p>proxy_no_cache $http_pragma    $http_authorization;<br></p><p>  可以与<a hhref="#proxy_cache_bypass">proxy_cache_bypass</a>指令一起使用。 </p><a name="proxy_pass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_pass</strong> <code class="notranslate"><i>URL</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;limit_except&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置代理服务器的协议和地址以及应映射位置的可选URI。  作为协议，可以指定“ &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; ”或“ &lt;code class=&quot;notranslate&quot;&gt;https&lt;/code&gt; ”。  可以将地址指定为域名或IP地址，以及可选端口： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_pass http://localhost:8000/uri/;
</code></pre><p></p><p>  或者作为在单词“ <code class="notranslate">unix</code> ”之后指定并用冒号括起来的UNIX域套接字路径： </p><blockquote class="example"><pre class="notranslate">proxy_pass <a href="http://unix:/tmp/backend.socket:/uri/" target="_blank" rel="noopener">http://unix:/tmp/backend.socket:/uri/</a>;<br></pre></blockquote><p></p><p>  如果域名解析为多个地址，则所有这些地址都将以循环方式使用。  此外，可以将地址指定为<a hhref="ngx_http_upstream_module.html">服务器组</a> 。 </p><p>  参数值可以包含变量。  在这种情况下，如果将地址指定为域名，则在所描述的服务器组中搜索名称，如果未找到，则使用<a hhref="ngx_http_core_module.html#resolver">解析器</a>确定。 </p><p>  请求URI按如下方式传递给服务器： </p><ul><li>  如果使用URI指定了<code class="notranslate">proxy_pass</code>指令，那么当请求传递给服务器时，与该位置匹配的<a hhref="ngx_http_core_module.html#location">规范化</a>请求URI的一部分将被指令中指定的URI替换： <blockquote class="example"><pre class="notranslate">location /name/ {<br>    proxy_pass <a href="http://127.0.0.1/remote/" target="_blank" rel="noopener">http://127.0.0.1/remote/</a>;<br>}<br></pre></blockquote></li><li>  如果指定了<code class="notranslate">proxy_pass</code>而没有URI，则请求URI将以与处理原始请求时客户端发送的格式相同的形式传递给服务器，或者在处理更改的URI时传递完整的规范化请求URI： <blockquote class="example"><pre class="notranslate">location /some/path/ {<br>    proxy_pass <a href="http://127.0.0.1" target="_blank" rel="noopener">http://127.0.0.1</a>;<br>}<br></pre></blockquote><blockquote class="note">  在版本1.1.12之前，如果指定了<code class="notranslate">proxy_pass</code>而没有URI，则在某些情况下可能会传递原始请求URI而不是更改的URI。 </blockquote></li></ul><p></p><p>  在某些情况下，无法确定要替换的请求URI的部分： </p><ul><li>  使用正则表达式指定位置时，以及在命名位置内指定位置。 <p>  在这些情况下，应指定<code class="notranslate">proxy_pass</code>而不使用URI。 </p></li><li>  使用<a hhref="ngx_http_rewrite_module.html#rewrite">rewrite</a>指令在代理位置内更改URI时，将使用相同的配置来处理请求（ <code class="notranslate">break</code> ）： <blockquote class="example"><pre class="notranslate">location /name/ {<br>    rewrite    /name/([^/]+) /users?name=$1 break;<br>    proxy_pass <a href="http://127.0.0.1" target="_blank" rel="noopener">http://127.0.0.1</a>;<br>}<br></pre></blockquote><p>  在这种情况下，将忽略指令中指定的URI，并将完整更改的请求URI传递给服务器。 </p></li><li>  在<code class="notranslate">proxy_pass</code>中使用变量时： <blockquote class="example"><pre class="notranslate">location /name/ {<br>    proxy_pass <a href="http://127.0.0.1$request_uri" target="_blank" rel="noopener">http://127.0.0.1$request_uri</a>;<br>}<br></pre></blockquote>  在这种情况下，如果在指令中指定了URI，则将其原样传递给服务器，替换原始请求URI。 </li></ul><p></p><p>   <a hhref="websocket.html">WebSocket</a>代理需要特殊配置，从版本1.3.13开始支持。 </p><a name="proxy_pass_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_pass_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将已&lt;a hhref=&quot;#proxy_hide_header&quot;&gt;禁用的&lt;/a&gt;头字段从代理服务器传递到客户端。 &lt;/p&gt;&lt;a name=&quot;proxy_pass_request_body&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_pass_request_body&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_pass_request_body on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指示是否将原始请求正文传递给代理服务器。 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location /x-accel-redirect-here/ {
proxy_method GET;
proxy_pass_request_body off;
proxy_set_header Content-Length &quot;&quot;;

proxy_pass ...
</code></pre><p>}<br></p><p>  另请参阅<a hhref="#proxy_set_header">proxy_set_header</a>和<a hhref="#proxy_pass_request_headers">proxy_pass_request_headers</a>指令。 </p><a name="proxy_pass_request_headers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_pass_request_headers</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_pass_request_headers on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  指示是否将原始请求的标头字段传递给代理服务器。 </p><blockquote class="example"><pre class="notranslate">location /x-accel-redirect-here/ {<br>    proxy_method GET;<br>    proxy_pass_request_headers off;<br>    proxy_pass_request_body off;<p></p>
<pre><code>proxy_pass ...
</code></pre><p>}<br></p></pre></blockquote><p>  另请参阅<a hhref="#proxy_set_header">proxy_set_header</a>和<a hhref="#proxy_pass_request_body">proxy_pass_request_body</a>指令。 </p><a name="proxy_read_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_read_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_read_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义从代理服务器读取响应的超时。  仅在两个连续的读操作之间设置超时，而不是为整个响应的传输。  如果代理服务器在此时间内未传输任何内容，则关闭连接。 </p><a name="proxy_redirect"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_redirect</strong> <code class="notranslate">default</code> ;</code> <br> <code class="notranslate"><strong>proxy_redirect</strong> <code class="notranslate">off</code> ;</code> <br> <code class="notranslate"><strong>proxy_redirect</strong> <code class="notranslate"><i>redirect</i></code> <code class="notranslate"><i>replacement</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_redirect default;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置应在代理服务器响应的“位置”和“刷新”标头字段中更改的文本。  假设代理服务器返回标题字段“ <code class="notranslate">Location: <a href="http://localhost:8000/two/some/uri/" target="_blank" rel="noopener">http://localhost:8000/two/some/uri/</a></code> ”。  指令 </p><blockquote class="example"><pre class="notranslate">proxy_redirect <a href="http://localhost:8000/two/" target="_blank" rel="noopener">http://localhost:8000/two/</a> <a href="http://frontend/one/" target="_blank" rel="noopener">http://frontend/one/</a>;<br></pre></blockquote><p>  将此字符串重写为“ <code class="notranslate">Location: <a href="http://frontend/one/some/uri/" target="_blank" rel="noopener">http://frontend/one/some/uri/</a></code> ”。 </p><p>   <code class="notranslate"><i>replacement</i></code>字符串中可能省略了服务器名称： </p><blockquote class="example"><pre class="notranslate">proxy_redirect <a href="http://localhost:8000/two/" target="_blank" rel="noopener">http://localhost:8000/two/</a> /;<br></pre></blockquote><p>  然后将插入主服务器的名称和端口（如果与80不同）。 </p><p>   <code class="notranslate">default</code>参数指定的默认替换使用<a hhref="ngx_http_core_module.html#location">location</a>和<a hhref="#proxy_pass">proxy_pass</a>指令的参数。  因此，以下两种配置是等效的： </p><blockquote class="example"><pre class="notranslate">location /one/ {<br>    proxy_pass     <a href="http://upstream:port/two/" target="_blank" rel="noopener">http://upstream:port/two/</a>;<br>    proxy_redirect default;<br></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate">location /one/ {<br>    proxy_pass     <a href="http://upstream:port/two/" target="_blank" rel="noopener">http://upstream:port/two/</a>;<br>    proxy_redirect <a href="http://upstream:port/two/" target="_blank" rel="noopener">http://upstream:port/two/</a> /one/;<br></pre></blockquote><p>  如果使用变量指定<a hhref="#proxy_pass">proxy_pass，</a>则不允许使用<code class="notranslate">default</code>参数。 </p><p>   <code class="notranslate"><i>replacement</i></code>字符串可以包含变量： </p><blockquote class="example"><pre class="notranslate">proxy_redirect <a href="http://localhost:8000/" target="_blank" rel="noopener">http://localhost:8000/</a> <a href="http://$host:$server_port/" target="_blank" rel="noopener">http://$host:$server_port/</a>;<br></pre></blockquote><p></p><p>   <code class="notranslate"><i>redirect</i></code>还可以包含（1.1.11）变量： </p><blockquote class="example"><pre class="notranslate">proxy_redirect <a href="http://$proxy_host:8000/" target="_blank" rel="noopener">http://$proxy_host:8000/</a> /;<br></pre></blockquote><p></p><p>  可以使用正则表达式指定（1.1.11）指令。  在这种情况下， <code class="notranslate"><i>redirect</i></code>应该以“ <code class="notranslate">~</code> ”符号开头，以区分大小写的匹配，或者使用“ <code class="notranslate">~<em></em></code> ”符号以区分大小写匹配。  正则表达式可以包含命名和位置捕获， <code class="notranslate"><i>replacement</i></code>可以引用它们： </p><blockquote class="example"><pre class="notranslate">proxy_redirect ~^(<a href="http://[^:]+):\d+(/.+)$" target="_blank" rel="noopener">http://[^:]+):\d+(/.+)$</a> $1$2;<br>proxy_redirect ~/user/([^/]+)/(.+)$      <a href="http://$1.example.com/$2" target="_blank" rel="noopener">http://$1.example.com/$2</a>;<br></pre></blockquote><p></p><p>  可能有几个<code class="notranslate">proxy_redirect</code>指令： </p><blockquote class="example"><pre class="notranslate">proxy_redirect default;<br>proxy_redirect <a href="http://localhost:8000/" target="_blank" rel="noopener">http://localhost:8000/</a>  /;<br>proxy_redirect <a href="http://www.example.com/" target="_blank" rel="noopener">http://www.example.com/</a> /;<br></pre></blockquote><p></p><p>   <code class="notranslate">off</code>参数取消所有<code class="notranslate">proxy_redirect</code>指令对当前级别的影响： </p><blockquote class="example"><pre class="notranslate">proxy_redirect off;<br>proxy_redirect default;<br>proxy_redirect <a href="http://localhost:8000/" target="_blank" rel="noopener">http://localhost:8000/</a>  /;<br>proxy_redirect <a href="http://www.example.com/" target="_blank" rel="noopener">http://www.example.com/</a> /;<br></pre></blockquote><p></p><p>  使用此指令，还可以将主机名添加到代理服务器发出的相对重定向： </p><blockquote class="example"><pre class="notranslate">proxy_redirect / /;<br></pre></blockquote><p></p><a name="proxy_request_buffering"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_request_buffering</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_request_buffering on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.11版本中。 </p></div><p>  启用或禁用客户端请求正文的缓冲。 </p><p>  启用缓冲后，在将请求发送到代理服务器之前，将从客户端<a hhref="ngx_http_core_module.html#client_body_buffer_size">读取</a>整个请求正文。 </p><p>  禁用缓冲时，请求主体在收到时立即发送到代理服务器。  在这种情况下，如果nginx已经开始发送请求主体，则无法将请求传递给<a hhref="#proxy_next_upstream">下一个服务器</a> 。 </p><p>  当使用HTTP / 1.1分块传输编码发送原始请求主体时，无论指令值如何，都将缓冲请求主体，除非为代理<a hhref="#proxy_http_version">启用</a>了HTTP / 1.1。 </p><a name="proxy_send_lowat"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_send_lowat</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_send_lowat 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  如果指令设置为非零值，则nginx将尝试通过使用<a hhref="events.html#kqueue">kqueue</a>方法的<code class="notranslate">NOTE_LOWAT</code>标志或具有指定<code class="notranslate"><i>size</i></code>的<code class="notranslate">SO_SNDLOWAT</code>套接字选项来最小化到代理服务器的传出连接上的发送操作数。 </p><p>  在Linux，Solaris和Windows上忽略此指令。 </p><a name="proxy_send_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_send_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_send_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置将请求传输到代理服务器的超时。  仅在两个连续的写操作之间设置超时，而不是为整个请求的传输。  如果代理服务器在此时间内未收到任何内容，则关闭连接。 </p><a name="proxy_set_body"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_set_body</strong> <code class="notranslate"><i>value</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许重新定义传递给代理服务器的请求正文。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。 &lt;/p&gt;&lt;a name=&quot;proxy_set_header&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_set_header&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;field&lt;/i&gt;&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;proxy_set_header Host $proxy_host;&lt;/pre&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_set_header Connection close;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将字段重新定义或附加到&lt;a hhref=&quot;#proxy_pass_request_headers&quot;&gt;传递&lt;/a&gt;给代理服务器的请求标头。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;proxy_set_header&lt;/code&gt;指令时，这些指令才从先前级别继承。  默认情况下，只重新定义了两个字段： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_set_header Host       $proxy_host;
</code></pre><p>proxy_set_header Connection close;<br></p><p>  如果启用了缓存，则标题字段为“If-Modified-Since”，“If-Unmodified-Since”，“If-None-Match”，“If-Match”，“Range”和“If-Range”来自原始请求不会传递给代理服务器。 </p><p>  未更改的“主机”请求标头字段可以像这样传递： </p><blockquote class="example"><pre class="notranslate">proxy_set_header Host       $http_host;<br></pre></blockquote><p></p><p>  但是，如果客户端请求标头中不存在此字段，则不会传递任何内容。  在这种情况下，最好使用<code class="notranslate">$host</code>变量 - 它的值等于“Host”请求头字段中的服务器名称，或者如果此字段不存在则等于主服务器名称： </p><blockquote class="example"><pre class="notranslate">proxy_set_header Host       $host;<br></pre></blockquote><p></p><p>  此外，服务器名称可以与代理服务器的端口一起传递： </p><blockquote class="example"><pre class="notranslate">proxy_set_header Host       $host:$proxy_port;<br></pre></blockquote><p></p><p>  如果标头字段的值为空字符串，则此字段将不会传递给代理服务器： </p><blockquote class="example"><pre class="notranslate">proxy_set_header Accept-Encoding “”;<br></pre></blockquote><p></p><a name="proxy_socket_keepalive"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_socket_keepalive</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_socket_keepalive off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.15.6版中。 </p></div><p>  配置到代理服务器的传出连接的“TCP keepalive”行为。  默认情况下，操作系统的设置对套接字有效。  如果指令设置为值“ <code class="notranslate">on</code> ”，则为套接字打开<code class="notranslate">SO_KEEPALIVE</code>套接字选项。 </p><a name="proxy_ssl_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_ssl_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该证书用于对代理的HTTPS服务器进行身份验证。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_certificate_key&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_certificate_key&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于对代理的HTTPS服务器进行身份验证。 &lt;/p&gt;&lt;p&gt;  可以指定value &lt;code class=&quot;notranslate&quot;&gt;engine&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;而不是&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; （1.7.9），该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;从OpenSSL引擎&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;加载具有指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;密钥。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_ciphers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_ciphers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ciphers&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_ciphers DEFAULT;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.6版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定对代理HTTPS服务器的请求的已启用密码。  密码以OpenSSL库理解的格式指定。 &lt;/p&gt;&lt;p&gt;  可以使用“ &lt;code class=&quot;notranslate&quot;&gt;openssl ciphers&lt;/code&gt; ”命令查看完整列表。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_crl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_crl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的已吊销证书（CRL）的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#proxy_ssl_verify&quot;&gt;验证&lt;/a&gt;代理HTTPS服务器的证书。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_name $proxy_host;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  允许覆盖用于&lt;a hhref=&quot;#proxy_ssl_verify&quot;&gt;验证&lt;/a&gt;代理HTTPS服务器证书的服务器名称，并在与代理HTTPS服务器建立连接时&lt;a hhref=&quot;#proxy_ssl_server_name&quot;&gt;通过SNI传递&lt;/a&gt; 。 &lt;/p&gt;&lt;p&gt;  默认情况下，使用&lt;a hhref=&quot;#proxy_pass&quot;&gt;proxy_pass&lt;/a&gt; URL的主机部分。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_password_file&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_password_file&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.8版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有密钥密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_protocols&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_protocols&lt;/strong&gt; 
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv3&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.3&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.6版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  为代理HTTPS服务器的请求启用指定的协议。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_server_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_server_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_server_name off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  在与代理的HTTPS服务器建立连接时，启用或禁用通过&lt;a hhref=&quot;http://en.wikipedia.org/wiki/Server_Name_Indication&quot;&gt;TLS服务器名称指示扩展&lt;/a&gt; （SNI，RFC 6066）传递服务器名称。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_session_reuse&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_session_reuse&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_session_reuse on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定在使用代理服务器时是否可以重用SSL会话。  如果日志中出现“ &lt;code class=&quot;notranslate&quot;&gt;SSL3_GET_FINISHED:digest check failed&lt;/code&gt; ”错误，请尝试禁用会话重用。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_trusted_certificate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_trusted_certificate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#proxy_ssl_verify&quot;&gt;验证&lt;/a&gt;代理HTTPS服务器的证书。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_verify&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_verify&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_verify off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用代理HTTPS服务器证书的验证。 &lt;/p&gt;&lt;a name=&quot;proxy_ssl_verify_depth&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_ssl_verify_depth&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_ssl_verify_depth 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.0版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  在代理的HTTPS服务器证书链中设置验证深度。 &lt;/p&gt;&lt;a name=&quot;proxy_store&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;proxy_store&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;proxy_store off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将文件保存到磁盘。   &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt;参数使用与指令&lt;a hhref=&quot;ngx_http_core_module.html#alias&quot;&gt;别名&lt;/a&gt;或&lt;a hhref=&quot;ngx_http_core_module.html#root&quot;&gt;root&lt;/a&gt;对应的路径保存文件。   &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;参数禁用文件保存。  此外，可以使用带变量的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt;显式设置文件名： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_store /data/www$original_uri;
</code></pre><p></p><p></p><p>  根据接收到的“Last-Modified”响应头字段设置文件的修改时间。  首先将响应写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和持久性存储可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，由<a hhref="#proxy_temp_path">proxy_temp_path</a>指令设置的保存文件和保存临时文件的目录都放在同一文件系统上。 </p><p>  该指令可用于创建静态不可更改文件的本地副本，例如： </p><blockquote class="example"><pre class="notranslate">location /images/ {<br>    root               /data/www;<br>    error_page         404 = /fetch$uri;<br>}<p></p>
<p>location /fetch/ {<br>    internal;</p>
<pre><code>proxy_pass         http://backend/;
proxy_store        on;
proxy_store_access user:rw group:rw all:r;
proxy_temp_path    /data/temp;

alias              /data/www/;
</code></pre><p>}<br></p></pre></blockquote><p></p><p>  或者像这样： </p><blockquote class="example"><pre class="notranslate">location /images/ {<br>    root               /data/www;<br>    error_page         404 = @fetch;<br>}<p></p>
<p>location @fetch {<br>    internal;</p>
<pre><code>proxy_pass         http://backend;
proxy_store        on;
proxy_store_access user:rw group:rw all:r;
proxy_temp_path    /data/temp;

root               /data/www;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="proxy_store_access"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_store_access</strong> <code class="notranslate"><i>users</i></code> : <code class="notranslate"><i>permissions</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_store_access user:rw;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  为新创建的文件和目录设置访问权限，例如： </p><blockquote class="example"><pre class="notranslate">proxy_store_access user:rw group:rw all:r;<br></pre></blockquote><p></p><p>  如果指定了任何<code class="notranslate">group</code>或<code class="notranslate">all</code>访问权限，则可以省略<code class="notranslate">user</code>权限： </p><blockquote class="example"><pre class="notranslate">proxy_store_access group:rw all:r;<br></pre></blockquote><p></p><a name="proxy_temp_file_write_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_temp_file_write_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_temp_file_write_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用从代理服务器到临时文件的响应缓冲时，限制一次写入临时文件的数据<code class="notranslate"><i>size</i></code> 。  默认情况下， <code class="notranslate"><i>size</i></code>由<a hhref="#proxy_buffer_size">proxy_buffer_size</a>和<a hhref="#proxy_buffers">proxy_buffers</a>指令设置的两个缓冲区限制。  临时文件的最大大小由<a hhref="#proxy_max_temp_file_size">proxy_max_temp_file_size</a>指令设置。 </p><a name="proxy_temp_path"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>proxy_temp_path</strong><br>    <code class="notranslate"><i>path</i></code><br>    [ <code class="notranslate"><i>level1</i></code><br>    [ <code class="notranslate"><i>level2</i></code><br>    [ <code class="notranslate"><i>level3</i></code> ]]];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">proxy_temp_path proxy_temp;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于存储临时文件的目录，其中包含从代理服务器接收的数据。  在指定目录下最多可以使用三级子目录层次结构。  例如，在以下配置中 </p><blockquote class="example"><pre class="notranslate">proxy_temp_path /spool/nginx/proxy_temp 1 2;<br></pre></blockquote><p>  临时文件可能如下所示： </p><blockquote class="example"><pre class="notranslate">/spool/nginx/proxy_temp/ <strong>7</strong> / <strong>45</strong> /00000123 <strong>457</strong><br></pre></blockquote><p></p><p>  另请参阅<a hhref="#proxy_cache_path">proxy_cache_path</a>指令的<code class="notranslate">use_temp_path</code>参数。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_proxy_module</code>模块支持嵌入式变量，这些变量可用于使用<a hhref="#proxy_set_header">proxy_set_header</a>指令组合头： </p><dl class="compact"><dt id="var_proxy_host"> <code class="notranslate">$proxy_host</code> </dt> <dd>   <a hhref="#proxy_pass">proxy_pass</a>指令中指定的代理服务器的名称和端口; </dd><dt id="var_proxy_port"> <code class="notranslate">$proxy_port</code> </dt> <dd>   <a hhref="#proxy_pass">proxy_pass</a>指令中指定的代理服务器的端口，或协议的默认端口; </dd><dt id="var_proxy_add_x_forwarded_for"> <code class="notranslate">$proxy_add_x_forwarded_for</code> </dt> <dd>   “X-Forwarded-For”客户端请求头字段，其中附加了<code class="notranslate">$remote_addr</code>变量，以逗号分隔。  如果客户端请求标头中不存在“X-Forwarded-For”字段，则<code class="notranslate">$proxy_add_x_forwarded_for</code>变量等于<code class="notranslate">$remote_addr</code>变量。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_perl_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_perl_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#issues">Known Issues</a> <br> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#perl">perl</a> <br>     <a hhref="#perl_modules">perl_modules</a> <br>     <a hhref="#perl_require">perl_require</a> <br>     <a hhref="#perl_set">perl_set</a> <br> <a hhref="#ssi">Calling Perl from SSI</a> <br> <a hhref="#methods">The $r Request Object Methods</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_perl_module</code>模块用于在Perl中实现位置和变量处理程序，并将Perl调用插入到SSI中。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_perl_module</code>配置参数启用它。 </p><blockquote class="note">  此模块需要<a hhref="https://www.perl.org/get.html">Perl</a> 5.6.1或更高版本。   C编译器应该与用于构建Perl的编译器兼容。 </blockquote><p></p><a name="issues"></a><center><h4>  已知的问题 </h4></center><p>  该模块是实验性的，需要注意的是经纪人。 </p><p>  为了让Perl在重新配置期间重新编译已修改的模块，它应该使用<code class="notranslate">-Dusemultiplicity=yes</code>或<code class="notranslate">-Dusethreads=yes</code>参数<code class="notranslate">-Dusethreads=yes</code> 。  另外，为了使Perl在运行时泄漏更少的内存，应该使用<code class="notranslate">-Dusemymalloc=no</code>参数构建它。  要在已构建的Perl中检查这些参数的值（在示例中指定了首选值），请运行： </p><blockquote class="example"><pre class="notranslate">$ perl -V:usemultiplicity -V:usemymalloc<br>usemultiplicity=’define’;<br>usemymalloc=’n’;<br></pre></blockquote><p></p><p>  请注意，在使用新的<code class="notranslate">-Dusemultiplicity=yes</code>或<code class="notranslate">-Dusethreads=yes</code>参数重建Perl之后，还必须重建所有二进制Perl模块 - 它们将停止使用新的Perl。 </p><p>  每次重新配置后，主进程和工作进程都有可能增大。  如果主进程增长到不可接受的大小，则可以在不更改可执行文件的情况下应用<a hhref="control.html#upgrade">实时升级</a>过程。 </p><p>  当Perl模块执行长时间运行的操作（例如解析域名，连接到另一个服务器或查询数据库）时，将不会处理分配给当前工作进程的其他请求。  因此，建议仅执行具有可预测和短执行时间的此类操作，例如访问本地文件系统。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<p></p>
<pre><code>perl_modules perl/lib;
perl_require hello.pm;

perl_set $msie6 &apos;

    sub {
        my $r = shift;
        my $ua = $r-&amp;gt;header_in(&quot;User-Agent&quot;);

        return &quot;&quot; if $ua =~ /Opera/;
        return &quot;1&quot; if $ua =~ / MSIE [6-9]\.\d+/;
        return &quot;&quot;;
    }

&apos;;

server {
    location / {
        perl hello::handler;
    }
}
</code></pre><p></p></pre></blockquote><p></p><p>   <code class="notranslate">perl/lib/hello.pm</code>模块： </p><blockquote class="example"><pre class="notranslate">package hello;<p></p>
<p>use nginx;</p>
<p>sub handler {<br>    my $r = shift;</p>
<pre><code>$r-&amp;gt;send_http_header(&quot;text/html&quot;);
return OK if $r-&amp;gt;header_only;

$r-&amp;gt;print(&quot;hello!\n&amp;lt;br/&amp;gt;&quot;);

if (-f $r-&amp;gt;filename or -d _) {
    $r-&amp;gt;print($r-&amp;gt;uri, &quot; exists!\n&quot;);
}

return OK;
</code></pre><p>}</p>
<p>1;<br><strong>END</strong><br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="perl"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>perl</strong> <code class="notranslate"><i>module</i></code> :: <code class="notranslate"><i>function</i></code> |’sub { … }’;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;limit_except&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为给定位置设置Perl处理程序。 &lt;/p&gt;&lt;a name=&quot;perl_modules&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;perl_modules&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;path&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为Perl模块设置其他路径。 &lt;/p&gt;&lt;a name=&quot;perl_require&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;perl_require&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;module&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义将在每次重新配置期间加载的模块的名称。  可以存在几个&lt;code class=&quot;notranslate&quot;&gt;perl_require&lt;/code&gt;指令。 &lt;/p&gt;&lt;a name=&quot;perl_set&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;perl_set&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;$variable&lt;/i&gt;&lt;/code&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;module&lt;/i&gt;&lt;/code&gt; :: &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;function&lt;/i&gt;&lt;/code&gt; |&apos;sub { ... }&apos;;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为指定的变量安装Perl处理程序。 &lt;/p&gt;&lt;a name=&quot;ssi&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  从SSI调用Perl &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;  调用Perl的SSI命令具有以下格式： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;&amp;lt;!--# perl sub=&quot; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;module&lt;/i&gt;&lt;/code&gt; :: &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;function&lt;/i&gt;&lt;/code&gt; &quot; arg=&quot; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameter1&lt;/i&gt;&lt;/code&gt; &quot; arg=&quot; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameter2&lt;/i&gt;&lt;/code&gt; &quot; ...
</code></pre><p>–&gt;<br></p><p></p><a name="methods"></a><center><h4>   $ r请求对象方法 </h4></center><p></p><dl class="compact"><dt> <code class="notranslate">$r-&gt;args</code> </dt> <dd>  返回请求参数。 </dd><dt> <code class="notranslate">$r-&gt;filename</code> </dt> <dd>  返回与请求URI对应的文件名。 </dd><dt> <code class="notranslate">$r-&gt;has_request_body( <code class="notranslate"><i>handler</i></code> )</code> </dt> <dd>  如果请求中没有正文，则返回0。  如果有正文，则为请求设置指定的处理程序，并返回1。  在读取请求主体后，nginx将调用指定的处理程序。  请注意，处理函数应该通过引用传递。  例： <blockquote class="example"><pre class="notranslate">package hello;<p></p>
<p>use nginx;</p>
<p>sub handler {<br>    my $r = shift;</p>
<pre><code>if ($r-&amp;gt;request_method ne &quot;POST&quot;) {
    return DECLINED;
}

if ($r-&amp;gt;has_request_body( &lt;strong&gt;\&amp;amp;post&lt;/strong&gt; )) {
    return OK;
}

return HTTP_BAD_REQUEST;
</code></pre><p>}</p>
<p>sub <strong>post</strong> {<br>    my $r = shift;</p>
<pre><code>$r-&amp;gt;send_http_header;

$r-&amp;gt;print(&quot;request_body: \&quot;&quot;, $r-&amp;gt;request_body, &quot;\&quot;&amp;lt;br/&amp;gt;&quot;);
$r-&amp;gt;print(&quot;request_body_file: \&quot;&quot;, $r-&amp;gt;request_body_file, &quot;\&quot;&amp;lt;br/&amp;gt;\n&quot;);

return OK;
</code></pre><p>}</p>
<p>1;</p>
<p><strong>END</strong><br></p></pre></blockquote></dd><dt> <code class="notranslate">$r-&gt;allow_ranges</code> </dt> <dd>  在发送响应时允许使用字节范围。 </dd><dt> <code class="notranslate">$r-&gt;discard_request_body</code> </dt> <dd>  指示nginx丢弃请求正文。 </dd><dt> <code class="notranslate">$r-&gt;header_in( <code class="notranslate"><i>field</i></code> )</code> </dt> <dd>  返回指定的客户端请求标头字段的值。 </dd><dt> <code class="notranslate">$r-&gt;header_only</code> </dt> <dd>  确定是应将整个响应还是仅应将其标头发送给客户端。 </dd><dt> <code class="notranslate">$r-&gt;header_out( <code class="notranslate"><i>field</i></code> , <code class="notranslate"><i>value</i></code> )</code> </dt> <dd>  为指定的响应头字段设置一个值。 </dd><dt> <code class="notranslate">$r-&gt;internal_redirect( <code class="notranslate"><i>uri</i></code> )</code> </dt> <dd>  内部重定向到指定的<code class="notranslate"><i>uri</i></code> 。   Perl处理程序执行完成后发生实际重定向。 <blockquote class="note">  目前不支持重定向到命名位置。 </blockquote></dd><dt> <code class="notranslate">$r-&gt;log_error( <code class="notranslate"><i>errno</i></code> , <code class="notranslate"><i>message</i></code> )</code> </dt> <dd>  将指定的<code class="notranslate"><i>message</i></code>写入<a hhref="ngx_core_module.html#error_log">error_log</a> 。  如果<code class="notranslate"><i>errno</i></code>不为零，则错误代码及其描述将附加到消息中。 </dd><dt> <code class="notranslate">$r-&gt;print( <code class="notranslate"><i>text</i></code> , …)</code> </dt> <dd>  将数据传递给客户端。 </dd><dt> <code class="notranslate">$r-&gt;request_body</code> </dt> <dd>  如果客户端请求正文尚未写入临时文件，则返回该请求正文。  要确保客户端请求正文在内存中，其大小应受<a hhref="ngx_http_core_module.html#client_max_body_size">client_max_body_size</a>限制，并且应使用<a hhref="ngx_http_core_module.html#client_body_buffer_size">client_body_buffer_size</a>设置足够的缓冲区大小。 </dd><dt> <code class="notranslate">$r-&gt;request_body_file</code> </dt> <dd>  返回客户端请求正文的文件名。  处理完毕后，应删除该文件。  要始终将请求主体写入文件，应启用<a hhref="ngx_http_core_module.html#client_body_in_file_only">client_body_in_file_only</a> 。 </dd><dt> <code class="notranslate">$r-&gt;request_method</code> </dt> <dd>  返回客户端请求HTTP方法。 </dd><dt> <code class="notranslate">$r-&gt;remote_addr</code> </dt> <dd>  返回客户端IP地址。 </dd><dt> <code class="notranslate">$r-&gt;flush</code> </dt> <dd>  立即将数据发送到客户端。 </dd><dt> <code class="notranslate">$r-&gt;sendfile( <code class="notranslate"><i>name</i></code> [, <code class="notranslate"><i>offset</i></code> [, <code class="notranslate"><i>length</i></code> ]])</code> </dt> <dd>  将指定的文件内容发送给客户端。  可选参数指定要传输的数据的初始偏移量和长度。  实际的数据传输发生在Perl处理程序完成之后。 </dd><dt> <code class="notranslate">$r-&gt;send_http_header([ <code class="notranslate"><i>type</i></code> ])</code> </dt> <dd>  将响应头发送给客户端。  可选的<code class="notranslate"><i>type</i></code>参数设置“Content-Type”响应头字段的值。  如果该值为空字符串，则不会发送“Content-Type”标头字段。 </dd><dt> <code class="notranslate">$r-&gt;status( <code class="notranslate"><i>code</i></code> )</code> </dt> <dd>  设置响应代码。 </dd><dt> <code class="notranslate">$r-&gt;sleep( <code class="notranslate"><i>milliseconds</i></code> , <code class="notranslate"><i>handler</i></code> )</code> </dt> <dd>  设置指定的处理程序并停止指定时间的请求处理。  与此同时，nginx继续处理其他请求。  经过指定的时间后，nginx将调用已安装的处理程序。  请注意，处理函数应该通过引用传递。  为了在处理程序之间传递数据，应该使用<code class="notranslate">$r-&gt;variable()</code> 。  例： <blockquote class="example"><pre class="notranslate">package hello;<p></p>
<p>use nginx;</p>
<p>sub handler {<br>    my $r = shift;</p>
<pre><code>$r-&amp;gt;discard_request_body;
$r-&amp;gt;variable(&quot;var&quot;, &quot;OK&quot;);
$r-&amp;gt;sleep(1000, &lt;strong&gt;\&amp;amp;next&lt;/strong&gt; );

return OK;
</code></pre><p>}</p>
<p>sub <strong>next</strong> {<br>    my $r = shift;</p>
<pre><code>$r-&amp;gt;send_http_header;
$r-&amp;gt;print($r-&amp;gt;variable(&quot;var&quot;));

return OK;
</code></pre><p>}</p>
<p>1;</p>
<p><strong>END</strong><br></p></pre></blockquote></dd><dt> <code class="notranslate">$r-&gt;unescape( <code class="notranslate"><i>text</i></code> )</code> </dt> <dd>  解码以“％XX”形式编码的文本。 </dd><dt> <code class="notranslate">$r-&gt;uri</code> </dt> <dd>  返回请求URI。 </dd><dt> <code class="notranslate">$r-&gt;variable( <code class="notranslate"><i>name</i></code> [, <code class="notranslate"><i>value</i></code> ])</code> </dt> <dd>  返回或设置指定变量的值。  变量是每个请求的本地变量。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_mp4_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_mp4_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#mp4">mp4</a> <br>     <a hhref="#mp4_buffer_size">mp4_buffer_size</a> <br>     <a hhref="#mp4_max_buffer_size">mp4_max_buffer_size</a> <br>     <a hhref="#mp4_limit_rate">mp4_limit_rate</a> <br>     <a hhref="#mp4_limit_rate_after">mp4_limit_rate_after</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_mp4_module</code>模块为MP4文件提供伪流服务器端支持。  此类文件通常具有<code class="notranslate">.mp4</code> ， <code class="notranslate">.m4v</code>或<code class="notranslate">.m4a</code>文件扩展名。 </p><p>  伪流与兼容的Flash播放器结合使用。  播放器使用查询字符串参数中指定的开始时间（仅命名为<code class="notranslate">start</code>并以秒为单位指定）向服务器发送HTTP请求，服务器以流响应，使其起始位置对应于请求的时间，例如： </p><blockquote class="example"><pre class="notranslate"><a href="http://example.com/elephants_dream.mp4?start=238.88" target="_blank" rel="noopener">http://example.com/elephants_dream.mp4?start=238.88</a><br></pre></blockquote><p>  这允许在任何时间执行随机搜索，或者在时间线的中间开始回放。 </p><p>  为了支持搜索，基于H.264的格式将元数据存储在所谓的“moov原子”中。  它是文件的一部分，用于保存整个文件的索引信息。 </p><p>  要开始播放，播放器首先需要读取元数据。  这是通过使用<code class="notranslate">start=0</code>参数发送特殊请求来完成的。  许多编码软件在文件末尾插入元数据。  这对于伪流是次优的，因为播放器必须在开始播放之前下载整个文件。  如果元数据位于文件的开头，则nginx只需开始发回文件内容就足够了。  如果元数据位于文件末尾，则nginx必须读取整个文件并准备新流，以便元数据位于媒体数据之前。  这涉及一些CPU，内存和磁盘I / O开销，因此最好事先<a hhref="http://flowplayer.org/plugins/streaming/pseudostreaming.html#prepare">准备一个用于伪流的原始文件</a> ，而不是让nginx在每个这样的请求上执行此操作。 </p><p>  该模块还支持HTTP请求的<code class="notranslate">end</code>参数（1.5.13），该请求设置回放的结束点。   <code class="notranslate">end</code>参数可以使用<code class="notranslate">start</code>参数指定，也可以单独指定： </p><blockquote class="example"><pre class="notranslate"><a href="http://example.com/elephants_dream.mp4?start=238.88&amp;end=555.55" target="_blank" rel="noopener">http://example.com/elephants_dream.mp4?start=238.88&amp;end=555.55</a><br></pre></blockquote><p></p><p>  对于具有非零<code class="notranslate">start</code>或<code class="notranslate">end</code>参数的匹配请求，nginx将从文件中读取元数据，准备具有所请求时间范围的流，并将其发送到客户端。  这具有与上述相同的开销。 </p><p>  如果匹配请求不包含<code class="notranslate">start</code>和<code class="notranslate">end</code>参数，则没有开销，并且文件仅作为静态资源发送。  一些播放器也支持字节范围请求，因此不需要此模块。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_mp4_module</code>配置参数启用它。 </p><blockquote class="note">  如果以前使用过第三方mp4模块，则应禁用它。 </blockquote><p></p><p>   <a hhref="ngx_http_flv_module.html">ngx_http_flv_module</a>模块提供了对FLV文件的类似伪流支持。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location /video/ {<br>    mp4;<br>    mp4_buffer_size       1m;<br>    mp4_max_buffer_size   5m;<br>    mp4_limit_rate        on;<br>    mp4_limit_rate_after  30s;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="mp4"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>mp4</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  打开周围位置的模块处理。 &lt;/p&gt;&lt;a name=&quot;mp4_buffer_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;mp4_buffer_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;mp4_buffer_size 512K;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置用于处理MP4文件的缓冲区的初始&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;a name=&quot;mp4_max_buffer_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;mp4_max_buffer_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;mp4_max_buffer_size 10M;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  在元数据处理期间，可能需要更大的缓冲区。  它的大小不能超过指定的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ，否则nginx将返回500（内部服务器错误）服务器错误，并记录以下消息： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;&quot;/some/movie/file.mp4&quot; mp4 moov atom is too large:
</code></pre><p>12583268, you may want to increase mp4_max_buffer_size<br></p><p></p><a name="mp4_limit_rate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>mp4_limit_rate</strong><br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">off</code> |<br>    <code class="notranslate"><i>factor</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">mp4_limit_rate off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  限制向客户端传输的响应速率。  根据所服务的MP4文件的平均比特率限制速率。  要计算速率，比特率乘以指定的<code class="notranslate"><i>factor</i></code> 。  特殊值“ <code class="notranslate">on</code> ”对应于因子1.1。  特殊值“ <code class="notranslate">off</code> ”禁用速率限制。  根据请求设置限制，因此如果客户端同时打开两个连接，则总速率将是指定限制的两倍。 </p><p></p><blockquote class="note">  该指令作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="mp4_limit_rate_after"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>mp4_limit_rate_after</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">mp4_limit_rate_after 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置媒体数据的初始量（以回放时间测量），之后对客户端的进一步传输将是速率限制的。 </p><p></p><blockquote class="note">  该指令作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_mirror_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_mirror_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#mirror">mirror</a> <br>     <a hhref="#mirror_request_body">mirror_request_body</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_mirror_module</code>模块（1.13.4）通过创建后台镜像子请求来实现原始请求的镜像。  忽略对镜像子请求的响应。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    mirror /mirror;<br>    proxy_pass <a href="http://backend" target="_blank" rel="noopener">http://backend</a>;<br>}<p></p>
<p>location = /mirror {<br>    internal;<br>    proxy_pass <a href="http://test_backend$request_uri" target="_blank" rel="noopener">http://test_backend$request_uri</a>;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="mirror"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>mirror</strong> <code class="notranslate"><i>uri</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">mirror off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置将镜像原始请求的URI。  可以在同一级别指定多个镜像。 </p><a name="mirror_request_body"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>mirror_request_body</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">mirror_request_body on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  指示是否镜像客户端请求正文。  启用后，将在创建镜像子请求之前读取客户端请求正文。  在这种情况下，将禁用由<a hhref="ngx_http_proxy_module.html#proxy_request_buffering">proxy_request_buffering</a> ， <a hhref="ngx_http_fastcgi_module.html#fastcgi_request_buffering">fastcgi_request_buffering</a> ， <a hhref="ngx_http_scgi_module.html#scgi_request_buffering">scgi_request_buffering</a>和<a hhref="ngx_http_uwsgi_module.html#uwsgi_request_buffering">uwsgi_request_buffering</a>指令设置的无缓冲客户机请求正文代理。 </p><blockquote class="example"><pre class="notranslate">location / {<br>    mirror /mirror;<br>    mirror_request_body off;<br>    proxy_pass <a href="http://backend" target="_blank" rel="noopener">http://backend</a>;<br>}<p></p>
<p>location = /mirror {<br>    internal;<br>    proxy_pass <a href="http://log_backend" target="_blank" rel="noopener">http://log_backend</a>;<br>    proxy_pass_request_body off;<br>    proxy_set_header Content-Length “”;<br>    proxy_set_header X-Original-URI $request_uri;<br>}<br></p></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_memcached_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_memcached_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#memcached_bind">memcached_bind</a> <br>     <a hhref="#memcached_buffer_size">memcached_buffer_size</a> <br>     <a hhref="#memcached_connect_timeout">memcached_connect_timeout</a> <br>     <a hhref="#memcached_force_ranges">memcached_force_ranges</a> <br>     <a hhref="#memcached_gzip_flag">memcached_gzip_flag</a> <br>     <a hhref="#memcached_next_upstream">memcached_next_upstream</a> <br>     <a hhref="#memcached_next_upstream_timeout">memcached_next_upstream_timeout</a> <br>     <a hhref="#memcached_next_upstream_tries">memcached_next_upstream_tries</a> <br>     <a hhref="#memcached_pass">memcached_pass</a> <br>     <a hhref="#memcached_read_timeout">memcached_read_timeout</a> <br>     <a hhref="#memcached_send_timeout">memcached_send_timeout</a> <br>     <a hhref="#memcached_socket_keepalive">memcached_socket_keepalive</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_memcached_module</code>模块用于从memcached服务器获取响应。  密钥在<code class="notranslate">$memcached_key</code>变量中设置。  响应应该通过nginx外部的方式预先存储在memcached中。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">server {<br>    location / {<br>        set            $memcached_key “$uri?$args”;<br>        memcached_pass host:11211;<br>        error_page     404 502 504 = @fallback;<br>    }<p></p>
<pre><code>location @fallback {
    proxy_pass     http://backend;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="memcached_bind"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>memcached_bind</strong><br>    <code class="notranslate"><i>address</i></code><br>    [ <code class="notranslate">transparent </code> ] |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.8.22版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  使用可选端口（1.11.2）从指定的本地IP地址发出到memcached服务器的传出连接。  参数值可以包含变量（1.3.12）。  特殊值&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; （1.3.12）取消了从先前配置级别继承的&lt;code class=&quot;notranslate&quot;&gt;memcached_bind&lt;/code&gt;指令的效果，该指令允许系统自动分配本地IP地址和端口。 &lt;/p&gt;&lt;a name=&quot;memcached_bind_transparent&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;transparent&lt;/code&gt;参数（1.11.0）允许到memcached服务器的传出连接源自非本地IP地址，例如，来自客户端的真实IP地址： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;memcached_bind $remote_addr transparent;
</code></pre><p></p><p>  为了使此参数有效，通常需要使用<a hhref="ngx_core_module.html#user">超级用户</a>权限运行nginx工作进程。  在Linux上，不需要（1.13.8），就像指定了<code class="notranslate">transparent</code>参数一样，工作进程从主进程继承<code class="notranslate">CAP_NET_RAW</code>功能。  还必须配置内核路由表以拦截来自memcached服务器的网络流量。 </p><a name="memcached_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>memcached_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">memcached_buffer_size 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取从memcached服务器接收的响应的缓冲区的<code class="notranslate"><i>size</i></code> 。  一旦收到响应，响应就会同步传递给客户端。 </p><a name="memcached_connect_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>memcached_connect_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">memcached_connect_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义与memcached服务器建立连接的超时。  应该注意，此超时通常不会超过75秒。 </p><a name="memcached_force_ranges"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>memcached_force_ranges</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">memcached_force_ranges off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.7版本中。 </p></div><p>  无论来自这些响应中的“Accept-Ranges”字段，都可以对来自memcached服务器的缓存和未缓存响应启用字节范围支持。 </p><a name="memcached_gzip_flag"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>memcached_gzip_flag</strong> <code class="notranslate"><i>flag</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.3.6版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果设置了&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;flag&lt;/i&gt;&lt;/code&gt; ，则在memcached服务器响应中启用&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;flag&lt;/i&gt;&lt;/code&gt;存在的测试，并将“ &lt;code class=&quot;notranslate&quot;&gt;Content-Encoding&lt;/code&gt; ”响应头字段设置为“ &lt;code class=&quot;notranslate&quot;&gt;gzip&lt;/code&gt; ”。 &lt;/p&gt;&lt;a name=&quot;memcached_next_upstream&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;memcached_next_upstream&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;invalid_response&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;not_found&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;memcached_next_upstream error timeout;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定应将请求传递到下一个服务器的情况： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与服务器建立连接，向其传递请求或读取响应头时发生错误; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  在与服务器建立连接，向其传递请求或读取响应头时发生超时; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;invalid_response&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回空或无效响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;not_found&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  在服务器上找不到响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  禁用将请求传递给下一个服务器。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  应该记住，只有在尚未向客户端发送任何内容的情况下，才能将请求传递给下一个服务器。  也就是说，如果在传输响应的过程中发生错误或超时，则无法修复此问题。 &lt;/p&gt;&lt;p&gt;  该指令还定义了与服务器通信的&lt;a hhref=&quot;ngx_http_upstream_module.html#max_fails&quot;&gt;不成功尝试&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;invalid_response&lt;/code&gt;情况始终被视为不成功的尝试，即使它们未在指令中指定。   &lt;code class=&quot;notranslate&quot;&gt;not_found&lt;/code&gt;情况从未被视为不成功的尝试。 &lt;/p&gt;&lt;p&gt;  将请求传递到下一个服务器可能会受到&lt;a hhref=&quot;#memcached_next_upstream_tries&quot;&gt;尝试次数&lt;/a&gt;和&lt;a hhref=&quot;#memcached_next_upstream_timeout&quot;&gt;时间的限制&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;memcached_next_upstream_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;memcached_next_upstream_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;memcached_next_upstream_timeout 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.5版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制请求可以传递到&lt;a hhref=&quot;#memcached_next_upstream&quot;&gt;下一个服务器的时间&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;memcached_next_upstream_tries&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;memcached_next_upstream_tries&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;memcached_next_upstream_tries 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.5版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制将请求传递到&lt;a hhref=&quot;#memcached_next_upstream&quot;&gt;下一个服务器&lt;/a&gt;的可能尝试次数。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;memcached_pass&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;memcached_pass&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置memcached服务器地址。  地址可以指定为域名或IP地址，以及端口： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;memcached_pass localhost:11211;
</code></pre><p></p><p>  或者作为UNIX域套接字路径： </p><blockquote class="example"><pre class="notranslate">memcached_pass unix:/tmp/memcached.socket;<br></pre></blockquote><p></p><p>  如果域名解析为多个地址，则所有这些地址都将以循环方式使用。  此外，可以将地址指定为<a hhref="ngx_http_upstream_module.html">服务器组</a> 。 </p><a name="memcached_read_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>memcached_read_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">memcached_read_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义从memcached服务器读取响应的超时。  仅在两个连续的读操作之间设置超时，而不是为整个响应的传输。  如果memcached服务器在此时间内未传输任何内容，则关闭连接。 </p><a name="memcached_send_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>memcached_send_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">memcached_send_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置将请求传输到memcached服务器的超时。  仅在两个连续的写操作之间设置超时，而不是为整个请求的传输。  如果memcached服务器在此时间内未收到任何内容，则关闭连接。 </p><a name="memcached_socket_keepalive"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>memcached_socket_keepalive</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">memcached_socket_keepalive off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.15.6版中。 </p></div><p>  配置到memcached服务器的传出连接的“TCP keepalive”行为。  默认情况下，操作系统的设置对套接字有效。  如果指令设置为值“ <code class="notranslate">on</code> ”，则为套接字打开<code class="notranslate">SO_KEEPALIVE</code>套接字选项。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p></p><dl class="compact"><dt id="var_memcached_key"> <code class="notranslate">$memcached_key</code> </dt> <dd>  定义用于从memcached服务器获取响应的密钥。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_map_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_map_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#map">map</a> <br>     <a hhref="#map_hash_bucket_size">map_hash_bucket_size</a> <br>     <a hhref="#map_hash_max_size">map_hash_max_size</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_map_module</code>模块创建的变量的值取决于其他变量的值。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">map $http_host $name {<br>    hostnames;<p></p>
<pre><code>default       0;

example.com   1;
*.example.com 1;
example.org   2;
*.example.org 2;
.example.net  3;
wap.*         4;
</code></pre><p>}</p>
<p>map $http_user_agent $mobile {<br>    default       0;<br>    “~Opera Mini” 1;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="map"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>map</strong><br>    <code class="notranslate"><i>string</i></code><br>    <code class="notranslate"><i>$variable</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  创建一个新变量，其值取决于第一个参数中指定的一个或多个源变量的值。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在0.9.0版之前，只能在第一个参数中指定单个变量。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  由于变量仅在使用时进行评估，因此即使是大量“ &lt;code class=&quot;notranslate&quot;&gt;map&lt;/code&gt; ”变量的声明也不会增加请求处理的额外成本。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  地图块内的参数指定源和结果值之间的映射。 &lt;/p&gt;&lt;p&gt;  源值指定为字符串或正则表达式（0.9.6）。 &lt;/p&gt;&lt;p&gt;  字符串匹配忽略大小写。 &lt;/p&gt;&lt;p&gt;  对于区分大小写的匹配，正则表达式应该从“ &lt;code class=&quot;notranslate&quot;&gt;~&lt;/code&gt; ”符号开始，或者对于不区分大小写的匹配，应该从“ &lt;code class=&quot;notranslate&quot;&gt;~*&lt;/code&gt; ”符号（1.0.4）开始。  正则表达式可以包含命名和位置捕获，以后可以在其他指令中使用结果变量。 &lt;/p&gt;&lt;p&gt;  如果源值与下面描述的特殊参数名称之一匹配，则应使用“ &lt;code class=&quot;notranslate&quot;&gt;\&lt;/code&gt; ”符号作为前缀。 &lt;/p&gt;&lt;p&gt;  结果值可以包含文本，变量（0.9.0）及其组合（1.11.0）。 &lt;/p&gt;&lt;p&gt;  还支持以下特殊参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;default&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; &lt;/dt&gt;&lt;dd&gt;  如果源值与任何指定的变量都不匹配，则设置结果值。  如果未指定default，则默认结果值将为空字符串。 &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;hostnames&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  表示源值可以是带有前缀或后缀掩码的主机名： &lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;*.example.com 1;
</code></pre><p>example.<em>     1;<br>  以下两条记录 <blockquote class="example"><pre class="notranslate">example.com   1;
</pre></blockquote></em>.example.com 1;<br>  可以合并： <blockquote class="example"><pre class="notranslate">.example.com  1;<br></pre></blockquote>  应在值列表之前指定此参数。 <dt>   <code class="notranslate">include</code> <code class="notranslate"><i>file</i></code> </dt><dd>  包含一个包含值的文件。  可能有几个夹杂物。 </dd><dt id="volatile"> <code class="notranslate">volatile</code> </dt> <dd>  表示该变量不可缓存（1.11.7）。 </dd></p><p></p><p>  如果源值与多个指定变量匹配，例如掩码和正则表达式匹配，则将按以下优先级顺序选择第一个匹配变量： </p><ol class="compact"><li>  没有掩码的字符串值 </li><li>  带有前缀掩码的最长字符串值，例如“ <code class="notranslate"><em>.example.com</em></code> ” </li><li>  带有后缀掩码的最长字符串值，例如“ <code class="notranslate">mail.</code> ” </li><li>  第一个匹配正则表达式（按配置文件中的出现顺序） </li><li>  默认值 </li></ol><p></p><a name="map_hash_bucket_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>map_hash_bucket_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">map_hash_bucket_size 32|64|128;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  设置<a hhref="#map">映射</a>变量哈希表的存储区大小。  默认值取决于处理器的缓存行大小。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="map_hash_max_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>map_hash_max_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">map_hash_max_size 2048;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  设置<a hhref="#map">映射</a>变量哈希表的最大<code class="notranslate"><i>size</i></code> 。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_log_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_log_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#access_log">access_log</a> <br>     <a hhref="#log_format">log_format</a> <br>     <a hhref="#open_log_file_cache">open_log_file_cache</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_log_module</code>模块以指定的格式写入请求日志。 </p><p>  请求记录在处理结束的位置的上下文中。  如果在请求处理期间发生<a hhref="ngx_http_core_module.html#internal">内部重定向</a> ，则它可能与原始位置不同。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">log_format compression ‘$remote_addr - $remote_user [$time_local] ‘<br>                       ‘“$request” $status $bytes_sent ‘<br>                       ‘“$http_referer” “$http_user_agent” “$gzip_ratio”‘;<p></p>
<p>access_log /spool/logs/nginx-access.log compression buffer=32k;<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="access_log"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>access_log</strong><br>    <code class="notranslate"><i>path</i></code><br>    [ <code class="notranslate"><i>format</i></code><br>    [ <code class="notranslate">buffer</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">gzip[= <code class="notranslate"><i>level</i></code> ]</code> ]<br>    [ <code class="notranslate">flush</code> = <code class="notranslate"><i>time</i></code> ]<br>    [ <code class="notranslate">if</code> = <code class="notranslate"><i>condition</i></code> ]];</code> <br> <code class="notranslate"><strong>access_log</strong> <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">access_log logs/access.log combined;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> , <code class="notranslate">limit_except</code> <br><br>                </td></tr></tbody></table></div><p>  设置缓冲日志写入的路径，格式和配置。  可以在同一级别指定多个日志。  可以通过在第一个参数中指定“ <code class="notranslate">syslog:</code> ”前缀来配置记录到<a hhref="syslog.html">syslog</a> 。  特殊值<code class="notranslate">off</code>取消当前级别的所有<code class="notranslate">access_log</code>指令。  如果未指定格式，则使用预定义的“ <code class="notranslate">combined</code> ”格式。 </p><p>  如果使用<code class="notranslate">buffer</code>或<code class="notranslate">gzip</code> （1.3.10,1.2.7）参数，则将缓冲写入日志。 </p><blockquote class="note">  缓冲区大小不得超过磁盘文件的原子写入大小。  对于FreeBSD，这个大小是无限的。 </blockquote><p></p><p>  启用缓冲后，数据将写入文件： </p><ul class="compact"><li>  如果下一个日志行不适合缓冲区; </li><li>  如果缓冲的数据早于<code class="notranslate">flush</code>参数（1.3.10,1.2.7）指定的数据; </li><li>  当工作进程<a hhref="control.html">重新打开</a>日志文件或正在关闭时。 </li></ul><p></p><p>  如果使用<code class="notranslate">gzip</code>参数，则在写入文件之前将压缩缓冲的数据。  压缩级别可以设置为1（最快，压缩较少）和9（最慢，最佳压缩）。  默认情况下，缓冲区大小等于64K字节，压缩级别设置为1.由于数据是以原子块压缩的，因此日志文件可以随时通过“ <code class="notranslate">zcat</code> ”解压缩或读取。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">access_log /path/to/log.gz combined gzip flush=5m;<br></pre></blockquote><p></p><p></p><blockquote class="note">  要使gzip压缩起作用，必须使用zlib库构建nginx。 </blockquote><p></p><p>  文件路径可以包含变量（0.7.6+），但是这样的日志有一些约束： </p><ul class="compact"><li>  工作进程使用其凭据的<a hhref="ngx_core_module.html#user">用户</a>应具有在具有此类日志的目录中创建文件的权限; </li><li>  缓冲写入不起作用; </li><li>  每个日志写入都会打开和关闭该文件。  但是，由于常用文件的描述符可以存储在<a hhref="#open_log_file_cache">缓存中</a> ，因此写入旧文件可以在<a hhref="#open_log_file_cache">open_log_file_cache</a>指令的<code class="notranslate">valid</code>参数指定的时间内继续写入 </li><li>  在每个日志写入期间，检查是否存在请求的<a hhref="ngx_http_core_module.html#root">根目录</a> ，如果它不存在，则不会创建日志。  因此，在同一级别指定<a hhref="ngx_http_core_module.html#root">root</a>和<code class="notranslate">access_log</code>是个好主意： <blockquote class="example"><pre class="notranslate">server {<br>    root       /spool/vhost/data/$host;<br>    access_log /spool/vhost/logs/$host;<br>    …<br></pre></blockquote></li></ul><p></p><p>   <code class="notranslate">if</code>参数（1.7.0）启用条件记录。  如果<code class="notranslate"><i>condition</i></code>评估为“0”或空字符串，则不会记录请求。  在以下示例中，将不记录响应代码为2xx和3xx的请求： </p><blockquote class="example"><pre class="notranslate">map $status $loggable {<br>    ~^[23]  0;<br>    default 1;<br>}<p></p>
<p>access_log /path/to/access.log combined if=$loggable;<br></p></pre></blockquote><p></p><a name="log_format"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>log_format</strong><br>    <code class="notranslate"><i>name</i></code><br>    [ <code class="notranslate">escape</code> = <code class="notranslate">default</code> | <code class="notranslate">json</code> | <code class="notranslate">none</code> ]<br>    <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">log_format combined “…”;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  指定日志格式。 </p><a name="log_format_escape"></a><p>   <code class="notranslate">escape</code>参数（1.11.8）允许设置在变量中转义的<code class="notranslate">json</code>或<code class="notranslate">default</code>字符，默认情况下，使用<code class="notranslate">default</code>转义。   <code class="notranslate">none</code>值（1.13.10）禁用转义。 </p><p>  日志格式可以包含公共变量，以及仅在日志写入时存在的变量： </p><dl class="compact"><dt id="var_bytes_sent"> <code class="notranslate">$bytes_sent</code> </dt> <dd>  发送到客户端的字节数 </dd><dt id="var_connection"> <code class="notranslate">$connection</code> </dt> <dd>  连接序列号 </dd><dt id="var_connection_requests"> <code class="notranslate">$connection_requests</code> </dt> <dd>  通过连接发出的当前请求数（1.1.18） </dd><dt id="var_msec"> <code class="notranslate">$msec</code> </dt> <dd>  以秒为单位的时间，日志写入时的分辨率为毫秒 </dd><dt id="var_pipe"> <code class="notranslate">$pipe</code> </dt> <dd>   “ <code class="notranslate">p</code> ”如果请求是流水线的，“ <code class="notranslate">.</code>   “ 除此以外 </dd><dt id="var_request_length"> <code class="notranslate">$request_length</code> </dt> <dd>  请求长度（包括请求行，标题和请求正文） </dd><dt id="var_request_time"> <code class="notranslate">$request_time</code> </dt> <dd>  以毫秒为单位请求处理时间（以秒为单位）;  从客户端读取第一个字节之间经过的时间，并将最后一个字节发送到客户端后的日志写入 </dd><dt id="var_status"> <code class="notranslate">$status</code> </dt> <dd>  回应状态 </dd><dt id="var_time_iso8601"> <code class="notranslate">$time_iso8601</code> </dt> <dd>  当地时间采用ISO 8601标准格式 </dd><dt id="var_time_local"> <code class="notranslate">$time_local</code> </dt> <dd>  通用日志格式的本地时间 </dd></dl><p></p><blockquote class="note">  在现代nginx版本变量<a hhref="ngx_http_core_module.html#var_status">$ status</a> （ <a hhref="ngx_http_core_module.html#var_bytes_sent">1.3.2,1.2.2</a> ）， <a hhref="ngx_http_core_module.html#var_bytes_sent">$ bytes_sent</a> （ <a hhref="ngx_http_core_module.html#var_bytes_sent">1.3.8,1.2.5</a> ）， <a hhref="ngx_http_core_module.html#var_connection">$ connection</a> （ <a hhref="ngx_http_core_module.html#var_bytes_sent">1.3.8,1.2.5</a> ）， <a hhref="ngx_http_core_module.html#var_connection">$ connection_requests</a> （ <a hhref="ngx_http_core_module.html#var_bytes_sent">1.3.8,1.2</a> ） .5）， <a hhref="ngx_http_core_module.html#var_msec">$ msec</a> （1.3.9,1.2.6）， <a hhref="ngx_http_core_module.html#var_request_time">$ request_time</a> （1.3.9,1.2.6）， <a hhref="ngx_http_core_module.html#var_pipe">$ pipe</a> （1.3.12,1.2.7）， <a hhref="ngx_http_core_module.html#var_request_length">$ request_length</a> （1.3.12,1.2.7） ）， <a hhref="ngx_http_core_module.html#var_time_iso8601">$ time_iso8601</a> （ <a hhref="ngx_http_core_module.html#var_time_iso8601">1.3.12,1.2.7</a> ）和<a hhref="ngx_http_core_module.html#var_time_local">$ time_local</a> （1.3.12,1.2.7）也可用作公共变量。 </blockquote><p></p><p>  发送到客户端的标题行具有前缀“ <code class="notranslate">sent<em>http</em></code> ”，例如<code class="notranslate">$sent_http_content_range</code> 。 </p><p>  配置始终包含预定义的“ <code class="notranslate">combined</code> ”格式： </p><blockquote class="example"><pre class="notranslate">log_format combined ‘$remote_addr - $remote_user [$time_local] ‘<br>                    ‘“$request” $status $body_bytes_sent ‘<br>                    ‘“$http_referer” “$http_user_agent”‘;<br></pre></blockquote><p></p><a name="open_log_file_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>open_log_file_cache</strong><br><code class="notranslate">max</code> = <code class="notranslate"><i>N</i></code><br>[ <code class="notranslate">inactive</code> = <code class="notranslate"><i>time</i></code> ]<br>[ <code class="notranslate">min_uses</code> = <code class="notranslate"><i>N</i></code> ]<br>[ <code class="notranslate">valid</code> = <code class="notranslate"><i>time</i></code> ];</code> <br> <code class="notranslate"><strong>open_log_file_cache</strong> <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">open_log_file_cache off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义一个缓存，用于存储名称中包含变量的常用日志的文件描述符。  该指令具有以下参数： </p><dl class="compact"><dt> <code class="notranslate">max</code> </dt> <dd>  设置缓存中的最大描述符数;  如果缓存变满，则最近最少使用（LRU）描述符将被关闭 </dd><dt> <code class="notranslate">inactive</code> </dt> <dd>  如果在此期间没有访问权限，则设置关闭缓存描述符的时间;  默认情况下，10秒 </dd><dt> <code class="notranslate">min_uses</code> </dt> <dd>  设置在<code class="notranslate">inactive</code>参数定义的时间内使文件使用的最小数量，以使描述符在缓存中保持打开状态;  默认情况下，1 </dd><dt> <code class="notranslate">valid</code> </dt> <dd>  设置应该检查文件是否仍然存在同名的时间;  默认情况下，60秒 </dd><dt> <code class="notranslate">off</code> </dt> <dd>  禁用缓存 </dd></dl><p></p><p>  用法示例： </p><blockquote class="example"><pre class="notranslate">open_log_file_cache max=1000 inactive=20s valid=1m min_uses=2;<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_limit_req_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_limit_req_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#limit_req">limit_req</a> <br>     <a hhref="#limit_req_log_level">limit_req_log_level</a> <br>     <a hhref="#limit_req_status">limit_req_status</a> <br>     <a hhref="#limit_req_zone">limit_req_zone</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_limit_req_module</code>模块（0.7.21）用于限制每个定义密钥的请求处理速率，特别是来自单个IP地址的请求的处理速率。  使用“漏桶”方法进行限制。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<br>    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;<p></p>
<pre><code>...

server {

    ...

    location /search/ {
        limit_req zone=one burst=5;
    }
</code></pre><p></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="limit_req"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_req</strong><br>    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code><br>    [ <code class="notranslate">burst</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">nodelay</code> |<br>     <code class="notranslate">delay</code> = <code class="notranslate"><i>number</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置共享内存区域和请求的最大突发大小。  如果请求速率超过为区域配置的速率，则延迟其处理，以便以定义的速率处理请求。  过多的请求被延迟，直到它们的数量超过最大突发大小，在这种情况下请求以&lt;a hhref=&quot;#limit_req_status&quot;&gt;错误&lt;/a&gt;终止。  默认情况下，最大突发大小等于零。  例如，指令 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;
</code></pre><p>server {<br>    location /search/ {<br>        limit_req zone=one burst=5;<br>    }<br></p><p>  允许每秒平均不超过1个请求，突发不超过5个请求。 </p><p>  如果不希望在请求受限的情况下延迟过多的请求，则应使用参数<code class="notranslate">nodelay</code> ： </p><blockquote class="example"><pre class="notranslate">limit_req zone=one burst=5 nodelay;<br></pre></blockquote><p></p><a name="limit_req_delay"></a><p>   <code class="notranslate">delay</code>参数（1.15.7）指定过多请求被延迟的限制。  默认值为零，即所有过多的请求都会延迟。 </p><p>  可能有几个<code class="notranslate">limit_req</code>指令。  例如，以下配置将限制来自单个IP地址的请求的处理速率，同时限制虚拟服务器的请求处理速率： </p><blockquote class="example"><pre class="notranslate">limit_req_zone $binary_remote_addr zone=perip:10m rate=1r/s;<br>limit_req_zone $server_name zone=perserver:10m rate=10r/s;<p></p>
<p>server {<br>    …<br>    limit_req zone=perip burst=5 nodelay;<br>    limit_req zone=perserver burst=10;<br>}<br></p></pre></blockquote><p></p><p>  当且仅当当前级别上没有<code class="notranslate">limit_req</code>指令时，这些指令才从先前级别继承。 </p><a name="limit_req_log_level"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_req_log_level</strong><br><code class="notranslate">info</code> |<br><code class="notranslate">notice</code> |<br><code class="notranslate">warn</code> |<br><code class="notranslate">error</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">limit_req_log_level error;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在0.8.18版本中。 </p></div><p>  为服务器因速率超过或延迟请求处理而拒绝处理请求的情况设置所需的日志记录级别。  延迟的记录水平比拒绝的记录水平低一个点;  例如，如果指定了“ <code class="notranslate">limit_req_log_level notice</code> ”，则会使用<code class="notranslate">info</code>级别记录延迟。 </p><a name="limit_req_status"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_req_status</strong> <code class="notranslate"><i>code</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">limit_req_status 503;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.3.15版本中。 </p></div><p>  设置要响应拒绝的请求而返回的状态代码。 </p><a name="limit_req_zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_req_zone</strong><br>    <code class="notranslate"><i>key</i></code><br>    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code><br>    <code class="notranslate">rate</code> = <code class="notranslate"><i>rate</i></code><br>    [ <code class="notranslate">sync</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置共享内存区域的参数，该区域将保留各种键的状态。  特别是，状态存储当前的过多请求数。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。  具有空键值的请求不计算在内。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.7.6版之前， &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;可以只包含一个变量。 &lt;/blockquote&gt;&lt;p&gt;  用法示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;
</code></pre><p></p><p></p><p>  这里，状态保持在10兆字节区域“1”，并且该区域的平均请求处理速率不能超过每秒1个请求。 </p><p>  客户端IP地址用作密钥。  请注意，此处使用<code class="notranslate">$binary_remote_addr</code>变量而不是<code class="notranslate">$remote_addr</code> 。  对于IPv4地址， <code class="notranslate">$binary_remote_addr</code>变量的大小始终为4个字节，对于IPv6地址，则为16个字节。  存储状态在32位平台上总是占用64个字节，在64位平台上占用128个字节。  一兆字节区域可以保留大约16,000个64字节状态或大约8千个128字节状态。 </p><p>  如果区域存储耗尽，则删除最近最少使用的状态。  即使在此之后无法创建新状态，该请求也会因<a hhref="#limit_req_status">错误</a>而终止。 </p><p>  速率以每秒请求数（r / s）指定。  如果需要每秒少于一个请求的速率，则在每分钟请求（r / m）中指定。  例如，每秒半请求为30r / m。 </p><a name="limit_req_zone_sync"></a><p>   <code class="notranslate">sync</code>参数（1.15.3）启用共享内存区域的<a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync">同步</a> 。 </p><blockquote class="note">   <code class="notranslate">sync</code>参数作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_limit_conn_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_limit_conn_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#limit_conn">limit_conn</a> <br>     <a hhref="#limit_conn_log_level">limit_conn_log_level</a> <br>     <a hhref="#limit_conn_status">limit_conn_status</a> <br>     <a hhref="#limit_conn_zone">limit_conn_zone</a> <br>     <a hhref="#limit_zone">limit_zone</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_limit_conn_module</code>模块用于限制每个定义密钥的连接数，特别是来自单个IP地址的连接数。 </p><p>  并非所有连接都被计算在内  仅当连接具有服务器正在处理的请求并且已经读取了整个请求标头时才计算连接。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<br>    limit_conn_zone $binary_remote_addr zone=addr:10m;<p></p>
<pre><code>...

server {

    ...

    location /download/ {
        limit_conn addr 1;
    }
</code></pre><p></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="limit_conn"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_conn</strong> <code class="notranslate"><i>zone</i></code> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置共享内存区域和给定键值的最大允许连接数。  超过此限制时，服务器将返回&lt;a hhref=&quot;#limit_conn_status&quot;&gt;错误&lt;/a&gt;以回复请求。  例如，指令 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;limit_conn_zone $binary_remote_addr zone=addr:10m;
</code></pre><p>server {<br>    location /download/ {<br>        limit_conn addr 1;<br>    }<br></p><p>  每次只允许一个IP地址连接一个。 </p><blockquote class="note">  在HTTP / 2和SPDY中，每个并发请求被视为单独的连接。 </blockquote><p></p><p>  可能有几个<code class="notranslate">limit_conn</code>指令。  例如，以下配置将限制每个客户端IP与服务器的连接数，同时限制与虚拟服务器的连接总数： </p><blockquote class="example"><pre class="notranslate">limit_conn_zone $binary_remote_addr zone=perip:10m;<br>limit_conn_zone $server_name zone=perserver:10m;<p></p>
<p>server {<br>    …<br>    limit_conn perip 10;<br>    limit_conn perserver 100;<br>}<br></p></pre></blockquote><p></p><p>  当且仅当当前级别上没有<code class="notranslate">limit_conn</code>指令时，这些指令才从前一级继承。 </p><a name="limit_conn_log_level"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_conn_log_level</strong><br><code class="notranslate">info</code> |<br><code class="notranslate">notice</code> |<br><code class="notranslate">warn</code> |<br><code class="notranslate">error</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">limit_conn_log_level error;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在0.8.18版本中。 </p></div><p>  为服务器限制连接数的情况设置所需的日志记录级别。 </p><a name="limit_conn_status"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_conn_status</strong> <code class="notranslate"><i>code</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">limit_conn_status 503;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.3.15版本中。 </p></div><p>  设置要响应拒绝的请求而返回的状态代码。 </p><a name="limit_conn_zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_conn_zone</strong><br>    <code class="notranslate"><i>key</i></code><br>    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code> : <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置共享内存区域的参数，该区域将保留各种键的状态。  特别是，状态包括当前的连接数。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。  具有空键值的请求不计算在内。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.7.6版之前， &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;可以只包含一个变量。 &lt;/blockquote&gt;&lt;p&gt;  用法示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;limit_conn_zone $binary_remote_addr zone=addr:10m;
</code></pre><p></p><p>  这里，客户端IP地址用作密钥。  请注意，此处使用<code class="notranslate">$binary_remote_addr</code>变量而不是<code class="notranslate">$remote_addr</code> 。   <code class="notranslate">$remote_addr</code>变量的大小可以在7到15个字节之间变化。  存储状态在32位平台上占用32或64字节的内存，在64位平台上占用64字节。  对于IPv4地址， <code class="notranslate">$binary_remote_addr</code>变量的大小始终为4个字节，对于IPv6地址，则为16个字节。  存储状态在32位平台上总是占用32或64字节，在64位平台上占用64字节。  一兆字节区域可以保留大约32,000个32字节状态或大约16,000个64字节状态。  如果区域存储空间耗尽，服务器将向所有其他请求返回<a hhref="#limit_conn_status">错误</a> 。 </p><a name="limit_zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_zone</strong><br>    <code class="notranslate"><i>name</i></code><br>    <code class="notranslate"><i>$variable</i></code><br>    <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  该指令在1.1.8版本中已过时，已在1.7.6版本中删除。  应使用具有更改语法的等效&lt;a hhref=&quot;#limit_conn_zone&quot;&gt;limit_conn_zone&lt;/a&gt;指令： &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;limit_conn_zone&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;$variable&lt;/i&gt;&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;zone&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ; &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_keyval_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_keyval_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#keyval">keyval</a> <br>     <a hhref="#keyval_zone">keyval_zone</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_keyval_module</code>模块（1.13.3）创建的变量的值取自<a hhref="ngx_http_api_module.html#http_keyvals_">API</a>管理的键值对。 </p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<p></p>
<pre><code>keyval_zone zone=one:32k state=one.keyval;
keyval $arg_text $text zone=one;
...
server {
    ...
    location / {
        return 200 $text;
    }

    location /api {
        api write=on;
    }
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="keyval"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>keyval</strong><br>    <code class="notranslate"><i>key</i></code><br>    <code class="notranslate"><i>$variable</i></code><br>    <code class="notranslate">zone</code> = <code class="notranslate"><i>name</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  创建一个新的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;$variable&lt;/i&gt;&lt;/code&gt;其值由&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;key&lt;/i&gt;&lt;/code&gt;数据库中的键查找。  字符串匹配忽略大小写。  数据库存储在&lt;code class=&quot;notranslate&quot;&gt;zone&lt;/code&gt;参数指定的共享内存区域中。 &lt;/p&gt;&lt;a name=&quot;keyval_zone&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;keyval_zone&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;zone&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; : &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;state&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;sync&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置保留键值数据库的共享内存区域的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。  键值对由&lt;a hhref=&quot;ngx_http_api_module.html#http_keyvals_&quot;&gt;API&lt;/a&gt;管理。 &lt;/p&gt;&lt;a name=&quot;keyval_state&quot;&gt;&lt;/a&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;state&lt;/code&gt;参数指定一个&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;以JSON格式保持键值数据库的当前状态，并使其在nginx重新启动时保持不变。 &lt;/p&gt;&lt;a name=&quot;keyval_timeout&quot;&gt;&lt;/a&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;参数（1.15.0）设置从区域中删除键值对的时间。 &lt;/p&gt;&lt;a name=&quot;keyval_sync&quot;&gt;&lt;/a&gt;&lt;p&gt;  可选的&lt;code class=&quot;notranslate&quot;&gt;sync&lt;/code&gt;参数（1.15.0）可以&lt;a hhref=&quot;stream/ngx_stream_zone_sync_module.html#zone_sync&quot;&gt;同步&lt;/a&gt;共享内存区域。  同步需要设置&lt;a hhref=&quot;#keyval_timeout&quot;&gt;超时&lt;/a&gt;参数。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_js_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_js_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#js_content">js_content</a> <br>     <a hhref="#js_include">js_include</a> <br>     <a hhref="#js_set">js_set</a> <br> <a hhref="#arguments">Request Argument</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_js_module</code>模块用于在<a hhref="njs/index.html">njs中</a>实现位置和变量处理程序 - 这是JavaScript语言的一个子集。 </p><p>  默认情况下不构建此模块。  可<a hhref="njs/install.html">在此处</a>下载和安装说明。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">load_module modules/ngx_http_js_module.so;<br>…<p></p>
<p>http {<br>    js_include http.js;</p>
<pre><code>js_set $foo     foo;
js_set $summary summary;

server {
    listen 8000;

    location / {
        add_header X-Foo $foo;
        js_content baz;
    }

    location = /summary {
        return 200 $summary;
    }

    location = /hello {
        js_content hello;
    }
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">http.js</code>文件： </p><blockquote class="example"><pre class="notranslate">function foo(r) {<br>    r.log(“hello from foo() handler”);<br>    return “foo”;<br>}<p></p>
<p>function summary(r) {<br>    var a, s, h;</p>
<pre><code>s = &quot;JS summary\n\n&quot;;

s += &quot;Method: &quot; + r.method + &quot;\n&quot;;
s += &quot;HTTP version: &quot; + r.httpVersion + &quot;\n&quot;;
s += &quot;Host: &quot; + r.headersIn.host + &quot;\n&quot;;
s += &quot;Remote Address: &quot; + r.remoteAddress + &quot;\n&quot;;
s += &quot;URI: &quot; + r.uri + &quot;\n&quot;;

s += &quot;Headers:\n&quot;;
for (h in r.headersIn) {
    s += &quot;  header &apos;&quot; + h + &quot;&apos; is &apos;&quot; + r.headersIn[h] + &quot;&apos;\n&quot;;
}

s += &quot;Args:\n&quot;;
for (a in r.args) {
    s += &quot;  arg &apos;&quot; + a + &quot;&apos; is &apos;&quot; + r.args[a] + &quot;&apos;\n&quot;;
}

return s;
</code></pre><p>}</p>
<p>function baz(r) {<br>    r.status = 200;<br>    r.headersOut.foo = 1234;<br>    r.headersOut[‘Content-Type’] = “text/plain; charset=utf-8”;<br>    r.headersOut[‘Content-Length’] = 15;<br>    r.sendHeader();<br>    r.send(“nginx”);<br>    r.send(“java”);<br>    r.send(“script”);</p>
<pre><code>r.finish();
</code></pre><p>}</p>
<p>function hello(r) {<br>    r.return(200, “Hello world!”);<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="js_content"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>js_content</strong> <code class="notranslate"><i>function</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;limit_except&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  将njs函数设置为位置内容处理程序。 &lt;/p&gt;&lt;a name=&quot;js_include&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;js_include&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定在njs中实现位置和变量处理程序的文件。 &lt;/p&gt;&lt;a name=&quot;js_set&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;js_set&lt;/strong&gt; 
</code></pre><p><code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>function</i></code> ; <br><br>                </p></td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为指定的变量设置njs函数。 &lt;/p&gt;&lt;a name=&quot;arguments&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  请求参数 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;  每个HTTP njs处理程序都接收一个参数，一个请求&lt;a hhref=&quot;njs/reference.html#http&quot;&gt;对象&lt;/a&gt; 。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_index_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_index_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#index">index</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_index_module</code>模块处理以斜杠字符（’ <code class="notranslate">/</code> ‘）结尾的请求。  这些请求也可以由<a hhref="ngx_http_autoindex_module.html">ngx_http_autoindex_module</a>和<a hhref="ngx_http_random_index_module.html">ngx_http_random_index_module</a>模块处理。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    index index.$geo.html index.html;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="index"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>index</strong> <code class="notranslate"><i>file</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">index index.html;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义将用作索引的文件。   <code class="notranslate"><i>file</i></code>名可以包含变量。  按指定顺序检查文件。  列表的最后一个元素可以是具有绝对路径的文件。  例： </p><blockquote class="example"><pre class="notranslate">index index.$geo.html index.0.html /index.html;<br></pre></blockquote><p></p><p>  应该注意，使用索引文件会导致内部重定向，并且可以在不同的位置处理请求。  例如，使用以下配置： </p><blockquote class="example"><pre class="notranslate">location = / {<br>    index index.html;<br>}<p></p>
<p>location / {<br>    …<br>}<br></p></pre></blockquote><p>   “ <code class="notranslate">/</code> ”请求实际上将在第二个位置处理为“ <code class="notranslate">/index.html</code> ”。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_image_filter_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_image_filter_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#image_filter">image_filter</a> <br>     <a hhref="#image_filter_buffer">image_filter_buffer</a> <br>     <a hhref="#image_filter_interlace">image_filter_interlace</a> <br>     <a hhref="#image_filter_jpeg_quality">image_filter_jpeg_quality</a> <br>     <a hhref="#image_filter_sharpen">image_filter_sharpen</a> <br>     <a hhref="#image_filter_transparency">image_filter_transparency</a> <br>     <a hhref="#image_filter_webp_quality">image_filter_webp_quality</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_image_filter_module</code>模块（0.7.54+）是一个过滤器，可以转换JPEG，GIF，PNG和WebP格式的图像。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_image_filter_module</code>配置参数启用它。 </p><blockquote class="note">  该模块使用<a hhref="http://libgd.org">libgd</a>库。  建议使用最新版本的库。 </blockquote><p></p><blockquote class="note">   WebP格式支持出现在1.11.6版中。  要以此格式转换图像，必须使用WebP支持编译<code class="notranslate">libgd</code>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location /img/ {<br>    proxy_pass   <a href="http://backend" target="_blank" rel="noopener">http://backend</a>;<br>    image_filter resize 150 100;<br>    image_filter rotate 90;<br>    error_page   415 = /empty;<br>}<p></p>
<p>location = /empty {<br>    empty_gif;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="image_filter"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>image_filter</strong> <code class="notranslate">off</code> ;</code> <br> <code class="notranslate"><strong>image_filter</strong> <code class="notranslate">test</code> ;</code> <br> <code class="notranslate"><strong>image_filter</strong> <code class="notranslate">size</code> ;</code> <br> <code class="notranslate"><strong>image_filter</strong><br>    <code class="notranslate">rotate</code><br>    <code class="notranslate">90</code> | <code class="notranslate">180</code> |<br>    <code class="notranslate">270</code> ;</code> <br> <code class="notranslate"><strong>image_filter</strong><br>    <code class="notranslate">resize</code><br>    <code class="notranslate"><i>width</i></code><br>    <code class="notranslate"><i>height</i></code> ;</code> <br> <code class="notranslate"><strong>image_filter</strong><br>    <code class="notranslate">crop</code><br>    <code class="notranslate"><i>width</i></code><br>    <code class="notranslate"><i>height</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">image_filter off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置要对图像执行的转换类型： </p><dl class="compact"><dt> <code class="notranslate">off</code> </dt> <dd>  关闭周围位置的模块处理。 </dd><dt> <code class="notranslate">test</code> </dt> <dd>  确保响应是JPEG，GIF，PNG或WebP格式的图像。  否则，将返回415（不支持的媒体类型）错误。 </dd><dt> <code class="notranslate">size</code> </dt> <dd>  以JSON格式输出有关图像的信息，例如： <blockquote class="example"><pre class="notranslate">{ “img” : { “width”: 100, “height”: 100, “type”: “gif” } }<br></pre></blockquote>  如果出现错误，输出如下： <blockquote class="example"><pre class="notranslate">{}<br></pre></blockquote></dd><dt>   <code class="notranslate">rotate</code> <code class="notranslate">90</code> |   <code class="notranslate">180</code> | <code class="notranslate">270</code> </dt><dd>  逆时针旋转图像指定的度数。  参数值可以包含变量。  此模式既可以单独使用，也可以与<code class="notranslate">resize</code>和<code class="notranslate">crop</code>变换一起使用。 </dd><dt>   <code class="notranslate">resize</code> <code class="notranslate"><i>width</i></code> <code class="notranslate"><i>height</i></code> </dt><dd>  按比例将图像缩小到指定的大小。  要仅减少一个维度，可以将另一个维度指定为“ <code class="notranslate">-</code> ”。  如果出现错误，服务器将返回代码415（不支持的介质类型）。  参数值可以包含变量。  与<code class="notranslate">rotate</code>参数一起使用时，旋转会<strong>在</strong>缩小<strong>后</strong>发生。 </dd><dt>   <code class="notranslate">crop</code> <code class="notranslate"><i>width</i></code> <code class="notranslate"><i>height</i></code> </dt><dd>  按比例将图像缩小到较大的边尺寸，并通过另一面裁剪外部边缘。  要仅减少一个维度，可以将另一个维度指定为“ <code class="notranslate">-</code> ”。  如果出现错误，服务器将返回代码415（不支持的介质类型）。  参数值可以包含变量。  与<code class="notranslate">rotate</code>参数一起使用时， <code class="notranslate">rotate</code> <strong>在</strong>缩小<strong>之前</strong>发生。 </dd></dl><p></p><a name="image_filter_buffer"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>image_filter_buffer</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">image_filter_buffer 1M;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取图像的缓冲区的最大大小。  超出大小时，服务器返回错误415（不支持的介质类型）。 </p><a name="image_filter_interlace"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>image_filter_interlace</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">image_filter_interlace off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.3.15版本中。 </p></div><p>  如果启用，最终图像将被隔行扫描。  对于JPEG，最终图像将采用“渐进式JPEG”格式。 </p><a name="image_filter_jpeg_quality"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>image_filter_jpeg_quality</strong> <code class="notranslate"><i>quality</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">image_filter_jpeg_quality 75;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置变换后的JPEG图像的所需<code class="notranslate"><i>quality</i></code> 。  可接受的值在1到100的范围内。较小的值通常意味着较低的图像质量和较少的传输数据。  建议的最大值为95.参数值可以包含变量。 </p><a name="image_filter_sharpen"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>image_filter_sharpen</strong> <code class="notranslate"><i>percent</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">image_filter_sharpen 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  增加最终图像的清晰度。  锐度百分比可以超过100.零值禁用锐化。  参数值可以包含变量。 </p><a name="image_filter_transparency"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>image_filter_transparency</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">image_filter_transparency on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义在使用调色板指定的颜色转换GIF图像或PNG图像时是否应保留透明度。  透明度的丧失导致图像质量更好。  始终保留PNG中的Alpha通道透明度。 </p><a name="image_filter_webp_quality"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>image_filter_webp_quality</strong> <code class="notranslate"><i>quality</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">image_filter_webp_quality 80;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.6版中。 </p></div><p>  设置转换的WebP图像的所需<code class="notranslate"><i>quality</i></code> 。  可接受的值在1到100的范围内。较小的值通常意味着较低的图像质量和较少的传输数据。  参数值可以包含变量。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_hls_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_hls_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#hls">hls</a> <br>     <a hhref="#hls_buffers">hls_buffers</a> <br>     <a hhref="#hls_forward_args">hls_forward_args</a> <br>     <a hhref="#hls_fragment">hls_fragment</a> <br>     <a hhref="#hls_mp4_buffer_size">hls_mp4_buffer_size</a> <br>     <a hhref="#hls_mp4_max_buffer_size">hls_mp4_max_buffer_size</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_hls_module</code>模块为MP4和MOV媒体文件提供HTTP实时流（HLS）服务器端支持。  此类文件通常具有<code class="notranslate">.mp4</code> ， <code class="notranslate">.m4v</code> ， <code class="notranslate">.m4a</code> ， <code class="notranslate">.mov</code>或<code class="notranslate">.qt</code>文件扩展名。  该模块支持H.264视频编解码器，AAC和MP3音频编解码器。 </p><p>  对于每个媒体文件，支持两个URI： </p><ul class="compact"><li>  带有“ <code class="notranslate">.m3u8</code> ”文件扩展名的播放列表URI。   URI可以接受可选参数： <ul class="compact"><li>   “ <code class="notranslate">start</code> ”和“ <code class="notranslate">end</code> ”以秒为单位定义播放列表边界（1.9.0）。 </li><li>   “ <code class="notranslate">offset</code> ”将初始播放位置移动到以秒为单位的时间偏移（1.9.0）。  正值设置从播放列表开头的时间偏移量。  负值设置播放列表中最后一个片段末尾的时间偏移量。 </li><li>   “ <code class="notranslate">len</code> ”以秒为单位定义片段长度。 </li></ul></li><li>  带有“ <code class="notranslate">.ts</code> ”文件扩展名的片段URI。   URI可以接受可选参数： <ul class="compact"><li>   “ <code class="notranslate">start</code> ”和“ <code class="notranslate">end</code> ”以秒为单位定义片段边界。 </li></ul></li></ul><p></p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    hls;<br>    hls_fragment            5s;<br>    hls_buffers             10 10m;<br>    hls_mp4_buffer_size     1m;<br>    hls_mp4_max_buffer_size 5m;<br>    root /var/video/;<br>}<br></pre></blockquote><p>  使用此配置，“/ <code class="notranslate">/var/video/test.mp4</code> ”文件支持以下URI： </p><blockquote class="example"><pre class="notranslate"><a href="http://hls.example.com/test.mp4.m3u8?offset=1.000&amp;start=1.000&amp;end=2.200" target="_blank" rel="noopener">http://hls.example.com/test.mp4.m3u8?offset=1.000&amp;start=1.000&amp;end=2.200</a><br><a href="http://hls.example.com/test.mp4.m3u8?len=8.000" target="_blank" rel="noopener">http://hls.example.com/test.mp4.m3u8?len=8.000</a><br><a href="http://hls.example.com/test.mp4.ts?start=1.000&amp;end=2.200" target="_blank" rel="noopener">http://hls.example.com/test.mp4.ts?start=1.000&amp;end=2.200</a><br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="hls"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>hls</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  打开周围位置的HLS流。 &lt;/p&gt;&lt;a name=&quot;hls_buffers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;hls_buffers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;hls_buffers 8 2m;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置用于读取和写入数据帧的缓冲区的最大&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;a name=&quot;hls_forward_args&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;hls_forward_args&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;hls_forward_args off;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.12版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  将播放列表请求中的参数添加到片段的URI中。  这对于在请求片段时或在使用&lt;a hhref=&quot;ngx_http_secure_link_module.html&quot;&gt;ngx_http_secure_link_module&lt;/a&gt;模块保护HLS流时执行客户端授权可能很有用。 &lt;/p&gt;&lt;p&gt;  例如，如果客户端请求播放列表&lt;code class=&quot;notranslate&quot;&gt;http://example.com/hls/test.mp4.m3u8?a=1&amp;amp;b=2&lt;/code&gt; ，则参数&lt;code class=&quot;notranslate&quot;&gt;a=1&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;b=2&lt;/code&gt;将添加到参数后的片段的URI中&lt;code class=&quot;notranslate&quot;&gt;start&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;end&lt;/code&gt; ： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;#EXTM3U
</code></pre><p>#EXT-X-VERSION:3</p>
<p>#EXT-X-TARGETDURATION:15</p>
<p>#EXT-X-PLAYLIST-TYPE:VOD</p>
<p>#EXTINF:9.333,<br>test.mp4.ts?start=0.000&amp;end=9.333&amp;a=1&amp;b=2</p>
<p>#EXTINF:7.167,<br>test.mp4.ts?start=9.333&amp;end=16.500&amp;a=1&amp;b=2</p>
<p>#EXTINF:5.416,<br>test.mp4.ts?start=16.500&amp;end=21.916&amp;a=1&amp;b=2</p>
<p>#EXTINF:5.500,<br>test.mp4.ts?start=21.916&amp;end=27.416&amp;a=1&amp;b=2</p>
<p>#EXTINF:15.167,<br>test.mp4.ts?start=27.416&amp;end=42.583&amp;a=1&amp;b=2</p>
<p>#EXTINF:9.626,<br>test.mp4.ts?start=42.583&amp;end=52.209&amp;a=1&amp;b=2</p>
<p>#EXT-X-ENDLIST<br></p><p></p><p>  如果使用<a hhref="ngx_http_secure_link_module.html">ngx_http_secure_link_module</a>模块保护HLS流，则不应在<a hhref="ngx_http_secure_link_module.html#secure_link_md5">secure_link_md5</a>表达式中使用<code class="notranslate">$uri</code> ，因为这会在请求片段时导致错误。  应该使用<a hhref="ngx_http_map_module.html#map">基URI</a>而不是<code class="notranslate">$uri</code> （ <code class="notranslate">$hls_uri</code>中为<code class="notranslate">$hls_uri</code> ）： </p><blockquote class="example"><pre class="notranslate">http {<br>    …<p></p>
<pre><code>map $uri $hls_uri {
    ~^(?&amp;lt;base_uri&amp;gt;.*).m3u8$ $base_uri;
    ~^(?&amp;lt;base_uri&amp;gt;.*).ts$   $base_uri;
    default                 $uri;
}

server {
    ...

    location /hls/ {
        hls;
        hls_forward_args on;

        alias /var/videos/;

        secure_link $arg_md5,$arg_expires;
        secure_link_md5 &quot;$secure_link_expires$hls_uri$remote_addr secret&quot;;

        if ($secure_link = &quot;&quot;) {
            return 403;
        }

        if ($secure_link = &quot;0&quot;) {
            return 410;
        }
    }
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="hls_fragment"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>hls_fragment</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">hls_fragment 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  为没有“ <code class="notranslate">len</code> ”参数的请求的播放列表URI定义默认片段长度。 </p><a name="hls_mp4_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>hls_mp4_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">hls_mp4_buffer_size 512k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于处理MP4和MOV文件的缓冲区的初始<code class="notranslate"><i>size</i></code> 。 </p><a name="hls_mp4_max_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>hls_mp4_max_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">hls_mp4_max_buffer_size 10m;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  在元数据处理期间，可能需要更大的缓冲区。  它的大小不能超过指定的<code class="notranslate"><i>size</i></code> ，否则nginx将返回服务器错误500（内部服务器错误），并记录以下消息： </p><blockquote class="example"><pre class="notranslate">“/some/movie/file.mp4” mp4 moov atom is too large:<br>12583268, you may want to increase hls_mp4_max_buffer_size<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_headers_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_headers_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#add_header">add_header</a> <br>     <a hhref="#add_trailer">add_trailer</a> <br>     <a hhref="#expires">expires</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_headers_module</code>模块允许将“Expires”和“Cache-Control”头字段以及任意字段添加到响应头。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">expires    24h;<br>expires    modified +24h;<br>expires    @24h;<br>expires    0;<br>expires    -1;<br>expires    epoch;<br>expires    $expires;<br>add_header Cache-Control private;<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="add_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>add_header</strong><br><code class="notranslate"><i>name</i></code> <code class="notranslate"><i>value</i></code><br>[ <code class="notranslate">always</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  将指定字段添加到响应头，前提是响应代码等于200,201（1.3.10），204,206,301,302,303,304,307（1.1.16,1.0.13）或308（1.13） .0）。  该值可以包含变量。 &lt;/p&gt;&lt;p&gt;  可能有几个&lt;code class=&quot;notranslate&quot;&gt;add_header&lt;/code&gt;指令。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;add_header&lt;/code&gt;指令时，这些指令才从前一级继承。 &lt;/p&gt;&lt;p&gt;  如果指定了&lt;code class=&quot;notranslate&quot;&gt;always&lt;/code&gt;参数（1.7.5），则无论响应代码如何，都将添加标题字段。 &lt;/p&gt;&lt;a name=&quot;add_trailer&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;add_trailer&lt;/strong&gt; 
</code></pre><p><code class="notranslate"><i>name</i></code> <code class="notranslate"><i>value</i></code><br>[ <code class="notranslate">always</code> ]; <br><br>                </p></td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.13.2版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果响应代码等于200,201,206,301,302,303,307或308，则将指定字段添加到响应的末尾。该值可以包含变量。 &lt;/p&gt;&lt;p&gt;  可能有几个&lt;code class=&quot;notranslate&quot;&gt;add_trailer&lt;/code&gt;指令。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;add_trailer&lt;/code&gt;指令时，这些指令才从先前级别继承。 &lt;/p&gt;&lt;p&gt;  如果指定了&lt;code class=&quot;notranslate&quot;&gt;always&lt;/code&gt;参数，则无论响应代码如何，都将添加指定的字段。 &lt;/p&gt;&lt;a name=&quot;expires&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;expires&lt;/strong&gt; [ &lt;code class=&quot;notranslate&quot;&gt;modified&lt;/code&gt; ] &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;expires&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;epoch&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;max&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;expires off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用添加或修改“Expires”和“Cache-Control”响应头字段，前提是响应代码等于200,201（1.3.10），204,206,301,302,303,304,307（1.1。 16,1.0.13）或308（1.13.0）。  参数可以是正&lt;a hhref=&quot;syntax.html&quot;&gt;时间&lt;/a&gt;或负&lt;a hhref=&quot;syntax.html&quot;&gt;时间&lt;/a&gt; 。 &lt;/p&gt;&lt;p&gt;   “Expires”字段中的时间计算为指令中指定的当前时间和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt;的总和。  如果使用&lt;code class=&quot;notranslate&quot;&gt;modified&lt;/code&gt;参数（0.7.0,0.6.32），则计算时间为文件修改时间与指令中指定时间的总和。 &lt;/p&gt;&lt;p&gt;  此外，可以使用“ &lt;code class=&quot;notranslate&quot;&gt;@&lt;/code&gt; ”前缀（0.7.9,0.6.34）指定一天中的时间： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;expires @15h30m;
</code></pre><p></p><p></p><p>   <code class="notranslate">epoch</code>参数对应于绝对时间“ <code class="notranslate">Thu, 01 Jan 1970 00:00:01 GMT</code> ”。   “Cache-Control”字段的内容取决于指定时间的符号： </p><ul class="compact"><li>  时间是负面的 - “Cache-Control：no-cache”。 </li><li>  时间为正或零 - “Cache-Control：max-age = <code class="notranslate"><i>t</i></code> ”，其中<code class="notranslate"><i>t</i></code>是指令中指定的时间，以秒为单位。 </li></ul><p></p><p>   <code class="notranslate">max</code>参数将“Expires”设置为值“ <code class="notranslate">Thu, 31 Dec 2037 23:55:55 GMT</code> ”，并将“Cache-Control”设置为10年。 </p><p>   <code class="notranslate">off</code>参数禁用添加或修改“Expires”和“Cache-Control”响应头字段。 </p><p>  最后一个参数值可以包含变量（1.7.9）： </p><blockquote class="example"><pre class="notranslate">map $sent_http_content_type $expires {<br>    default         off;<br>    application/pdf 42d;<br>    ~image/         max;<br>}<p></p>
<p>expires $expires;<br></p></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_gzip_static_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_gzip_static_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#gzip_static">gzip_static</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_gzip_static_module</code>模块允许发送带有“ <code class="notranslate">.gz</code> ”文件扩展名的预压缩文件，而不是常规文件。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_gzip_static_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">gzip_static  on;<br>gzip_proxied expired no-cache no-store private auth;<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="gzip_static"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>gzip_static</strong><br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">off</code> |<br>    <code class="notranslate">always</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">gzip_static off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用（“ <code class="notranslate">on</code> ”）或禁用（“ <code class="notranslate">off</code> ”）检查预压缩文件是否存在。  还考虑了以下指令： <a hhref="ngx_http_gzip_module.html#gzip_http_version">gzip_http_version</a> ， <a hhref="ngx_http_gzip_module.html#gzip_proxied">gzip_proxied</a> ， <a hhref="ngx_http_gzip_module.html#gzip_disable">gzip_disable</a>和<a hhref="ngx_http_gzip_module.html#gzip_vary">gzip_vary</a> 。 </p><p>  使用“ <code class="notranslate">always</code> ”值（1.3.6），在所有情况下都使用gzip压缩文件，而不检查客户端是否支持它。  如果磁盘上没有未压缩的文件或者使用了<a hhref="ngx_http_gunzip_module.html">ngx_http_gunzip_module，</a>则非常有用。 </p><p>  可以使用<code class="notranslate">gzip</code>命令或任何其他兼容的文件压缩文件。  建议原始文件和压缩文件的修改日期和时间相同。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_gzip_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_gzip_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#gzip">gzip</a> <br>     <a hhref="#gzip_buffers">gzip_buffers</a> <br>     <a hhref="#gzip_comp_level">gzip_comp_level</a> <br>     <a hhref="#gzip_disable">gzip_disable</a> <br>     <a hhref="#gzip_http_version">gzip_http_version</a> <br>     <a hhref="#gzip_min_length">gzip_min_length</a> <br>     <a hhref="#gzip_proxied">gzip_proxied</a> <br>     <a hhref="#gzip_types">gzip_types</a> <br>     <a hhref="#gzip_vary">gzip_vary</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_gzip_module</code>模块是一个使用“gzip”方法压缩响应的过滤器。  这通常有助于将传输数据的大小减少一半甚至更多。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">gzip            on;<br>gzip_min_length 1000;<br>gzip_proxied    expired no-cache no-store private auth;<br>gzip_types      text/plain application/xml;<br></pre></blockquote><p></p><p>   <code class="notranslate">$gzip_ratio</code>变量可用于记录实现的压缩比。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="gzip"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>gzip</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">gzip off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用gzipping响应。 </p><a name="gzip_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>gzip_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">gzip_buffers 32 4k|16 8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于压缩响应的缓冲区的<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> 。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 </p><blockquote class="note">  在版本0.7.28之前，默认使用四个4K或8K缓冲区。 </blockquote><p></p><a name="gzip_comp_level"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>gzip_comp_level</strong> <code class="notranslate"><i>level</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">gzip_comp_level 1;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置响应的gzip压缩<code class="notranslate"><i>level</i></code> 。  可接受的值范围为1到9。 </p><a name="gzip_disable"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>gzip_disable</strong> <code class="notranslate"><i>regex</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.6.23版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  对具有与任何指定正则表达式匹配的“User-Agent”标头字段的请求禁用gzipping响应。 &lt;/p&gt;&lt;p&gt;  特殊掩码“ &lt;code class=&quot;notranslate&quot;&gt;msie6&lt;/code&gt; ”（0.7.12）对应于正则表达式“ &lt;code class=&quot;notranslate&quot;&gt;MSIE [4-6]\.&lt;/code&gt;   “，但工作得更快。  从版本0.8.11开始，“ &lt;code class=&quot;notranslate&quot;&gt;MSIE 6.0; ... SV1&lt;/code&gt;   &lt;code class=&quot;notranslate&quot;&gt;MSIE 6.0; ... SV1&lt;/code&gt;此掩码中不包括“ &lt;code class=&quot;notranslate&quot;&gt;MSIE 6.0; ... SV1&lt;/code&gt; ”。 &lt;/p&gt;&lt;a name=&quot;gzip_http_version&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;gzip_http_version&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;1.0&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;1.1&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;gzip_http_version 1.1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置压缩响应所需的最低HTTP请求版本。 &lt;/p&gt;&lt;a name=&quot;gzip_min_length&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;gzip_min_length&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;length&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;gzip_min_length 20;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将被gzip压缩的响应的最小长度。  长度仅由“Content-Length”响应头字段确定。 &lt;/p&gt;&lt;a name=&quot;gzip_proxied&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;gzip_proxied&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;expired&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;no-cache&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;no-store&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;private&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;no_last_modified&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;no_etag&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;auth&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;any&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;gzip_proxied off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  根据请求和响应启用或禁用对代理请求的响应的gzipping。  代理请求的事实由“Via”请求头字段的存在确定。  该指令接受多个参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  禁用所有代理请求的压缩，忽略其他参数; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;expired&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  如果响应头包含“Expires”字段，其值为禁用缓存，则启用压缩; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;no-cache&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  如果响应头包含带有“ &lt;code class=&quot;notranslate&quot;&gt;no-cache&lt;/code&gt; ”参数的“Cache-Control”字段，则启用压缩; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;no-store&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  如果响应头包含带有“ &lt;code class=&quot;notranslate&quot;&gt;no-store&lt;/code&gt; ”参数的“Cache-Control”字段，则启用压缩; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;private&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  如果响应头包含带有“ &lt;code class=&quot;notranslate&quot;&gt;private&lt;/code&gt; ”参数的“Cache-Control”字段，则启用压缩; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;no_last_modified&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  如果响应头不包含“Last-Modified”字段，则启用压缩; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;no_etag&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  如果响应头不包含“ETag”字段，则启用压缩; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;auth&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  如果请求标头包含“授权”字段，则启用压缩; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;any&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  为所有代理请求启用压缩。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;gzip_types&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;gzip_types&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;mime-type&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;gzip_types text/html;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  除了“ &lt;code class=&quot;notranslate&quot;&gt;text/html&lt;/code&gt; ”之外，还允许对指定的MIME类型进行gzipping响应。  特殊值“ &lt;code class=&quot;notranslate&quot;&gt;*&lt;/code&gt; ”匹配任何MIME类型（0.8.29）。  始终压缩“ &lt;code class=&quot;notranslate&quot;&gt;text/html&lt;/code&gt; ”类型的响应。 &lt;/p&gt;&lt;a name=&quot;gzip_vary&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;gzip_vary&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;gzip_vary off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  如果指令&lt;a hhref=&quot;#gzip&quot;&gt;gzip&lt;/a&gt; ， &lt;a hhref=&quot;ngx_http_gzip_static_module.html#gzip_static&quot;&gt;gzip_static&lt;/a&gt;或&lt;a hhref=&quot;ngx_http_gunzip_module.html#gunzip&quot;&gt;gunzip&lt;/a&gt;处于活动状态，则启用或禁用插入“Vary：Accept-Encoding”响应头字段。 &lt;/p&gt;&lt;a name=&quot;variables&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  嵌入式变量 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;&lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_gzip_ratio&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$gzip_ratio&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  达到的压缩比，计算为原始和压缩响应大小之间的比率。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_gunzip_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_gunzip_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#gunzip">gunzip</a> <br>     <a hhref="#gunzip_buffers">gunzip_buffers</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_gunzip_module</code>模块是一个过滤器，它使用“ <code class="notranslate">Content-Encoding: gzip</code> ”解压缩响应，用于不支持“gzip”编码方法的客户端。  当需要存储压缩数据以节省空间并降低I / O成本时，该模块将非常有用。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_gunzip_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location /storage/ {<br>    gunzip on;<br>    …<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="gunzip"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>gunzip</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">gunzip off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用对缺少gzip支持的客户端的gzip压缩解压缩。  如果启用，则在确定客户端是否支持gzip时还会考虑以下指令： <a hhref="ngx_http_gzip_module.html#gzip_http_version">gzip_http_version</a> ， <a hhref="ngx_http_gzip_module.html#gzip_proxied">gzip_proxied</a>和<a hhref="ngx_http_gzip_module.html#gzip_disable">gzip_disable</a> 。  另请参见<a hhref="ngx_http_gzip_module.html#gzip_vary">gzip_vary</a>指令。 </p><a name="gunzip_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>gunzip_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">gunzip_buffers 32 4k|16 8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于解压缩响应的缓冲区的<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> 。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_grpc_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_grpc_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#grpc_bind">grpc_bind</a> <br>     <a hhref="#grpc_buffer_size">grpc_buffer_size</a> <br>     <a hhref="#grpc_connect_timeout">grpc_connect_timeout</a> <br>     <a hhref="#grpc_hide_header">grpc_hide_header</a> <br>     <a hhref="#grpc_ignore_headers">grpc_ignore_headers</a> <br>     <a hhref="#grpc_intercept_errors">grpc_intercept_errors</a> <br>     <a hhref="#grpc_next_upstream">grpc_next_upstream</a> <br>     <a hhref="#grpc_next_upstream_timeout">grpc_next_upstream_timeout</a> <br>     <a hhref="#grpc_next_upstream_tries">grpc_next_upstream_tries</a> <br>     <a hhref="#grpc_pass">grpc_pass</a> <br>     <a hhref="#grpc_pass_header">grpc_pass_header</a> <br>     <a hhref="#grpc_read_timeout">grpc_read_timeout</a> <br>     <a hhref="#grpc_send_timeout">grpc_send_timeout</a> <br>     <a hhref="#grpc_set_header">grpc_set_header</a> <br>     <a hhref="#grpc_socket_keepalive">grpc_socket_keepalive</a> <br>     <a hhref="#grpc_ssl_certificate">grpc_ssl_certificate</a> <br>     <a hhref="#grpc_ssl_certificate_key">grpc_ssl_certificate_key</a> <br>     <a hhref="#grpc_ssl_ciphers">grpc_ssl_ciphers</a> <br>     <a hhref="#grpc_ssl_crl">grpc_ssl_crl</a> <br>     <a hhref="#grpc_ssl_name">grpc_ssl_name</a> <br>     <a hhref="#grpc_ssl_password_file">grpc_ssl_password_file</a> <br>     <a hhref="#grpc_ssl_protocols">grpc_ssl_protocols</a> <br>     <a hhref="#grpc_ssl_server_name">grpc_ssl_server_name</a> <br>     <a hhref="#grpc_ssl_session_reuse">grpc_ssl_session_reuse</a> <br>     <a hhref="#grpc_ssl_trusted_certificate">grpc_ssl_trusted_certificate</a> <br>     <a hhref="#grpc_ssl_verify">grpc_ssl_verify</a> <br>     <a hhref="#grpc_ssl_verify_depth">grpc_ssl_verify_depth</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_grpc_module</code>模块允许将请求传递到gRPC服务器（1.13.10）。  该模块需要<a hhref="ngx_http_v2_module.html">ngx_http_v2_module</a>模块。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">server {<br>    listen 9000 http2;<p></p>
<pre><code>location / {
    grpc_pass 127.0.0.1:9000;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="grpc_bind"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>grpc_bind</strong><br>    <code class="notranslate"><i>address</i></code><br>    [ <code class="notranslate">transparent </code> ] |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  使用可选端口从指定的本地IP地址发出到gRPC服务器的传出连接。  参数值可以包含变量。  特殊值&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;取消了从先前配置级别继承的&lt;code class=&quot;notranslate&quot;&gt;grpc_bind&lt;/code&gt;指令的效果，该指令允许系统自动分配本地IP地址和端口。 &lt;/p&gt;&lt;a name=&quot;grpc_bind_transparent&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;transparent&lt;/code&gt;参数允许到gRPC服务器的传出连接源自非本地IP地址，例如，来自客户端的真实IP地址： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;grpc_bind $remote_addr transparent;
</code></pre><p></p><p>  为了使此参数有效，通常需要使用<a hhref="ngx_core_module.html#user">超级用户</a>权限运行nginx工作进程。  在Linux上，不需要像指定<code class="notranslate">transparent</code>参数那样，工作进程从主进程继承<code class="notranslate">CAP_NET_RAW</code>功能。  还必须配置内核路由表以拦截来自gRPC服务器的网络流量。 </p><a name="grpc_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>grpc_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">grpc_buffer_size 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取从gRPC服务器接收的响应的缓冲区的<code class="notranslate"><i>size</i></code> 。  一旦收到响应，响应就会同步传递给客户端。 </p><a name="grpc_connect_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>grpc_connect_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">grpc_connect_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义与gRPC服务器建立连接的超时。  应该注意，此超时通常不会超过75秒。 </p><a name="grpc_hide_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>grpc_hide_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  默认情况下，nginx不会从gRPC服务器对客户端的响应中传递标题字段“Date”，“Server”和“X-Accel -...”。   &lt;code class=&quot;notranslate&quot;&gt;grpc_hide_header&lt;/code&gt;指令设置了不会传递的其他字段。  相反，如果需要允许传递字段，则可以使用&lt;a hhref=&quot;#grpc_pass_header&quot;&gt;grpc_pass_header&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;grpc_ignore_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ignore_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;field&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  禁用从gRPC服务器处理某些响应头字段。  可以忽略以下字段：“X-Accel-Redirect”和“X-Accel-Charset”。 &lt;/p&gt;&lt;p&gt;  如果未禁用，则处理这些标头字段会产生以下影响： &lt;/p&gt;&lt;ul&gt;&lt;li&gt;   “X-Accel-Redirect”执行&lt;a hhref=&quot;ngx_http_core_module.html#internal&quot;&gt;内部重定向&lt;/a&gt;到指定的URI; &lt;/li&gt;&lt;li&gt;   “X-Accel-Charset”设置了所需的响应&lt;a hhref=&quot;ngx_http_charset_module.html#charset&quot;&gt;字符集&lt;/a&gt; 。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;grpc_intercept_errors&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_intercept_errors&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_intercept_errors off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定代码大于或等于300的gRPC服务器响应是应该传递给客户端还是被拦截并重定向到nginx以便使用&lt;a hhref=&quot;ngx_http_core_module.html#error_page&quot;&gt;error_page&lt;/a&gt;指令进行处理。 &lt;/p&gt;&lt;a name=&quot;grpc_next_upstream&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_next_upstream&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_502&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_504&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;non_idempotent&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_next_upstream error timeout;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定应将请求传递到下一个服务器的情况： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  与服务器建立连接，向其传递请求或读取响应头时发生错误; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  在与服务器建立连接，向其传递请求或读取响应头时发生超时; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回空或无效响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为500的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_502&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为502的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为503的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_504&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码504的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为403的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为404的响应; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  服务器返回代码为429的响应; &lt;/dd&gt;&lt;dt id=&quot;non_idempotent&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;non_idempotent&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  通常，如果请求已发送到上游服务器，则使用&lt;a hhref=&quot;https://tools.ietf.org/html/rfc7231#section-4.2.2&quot;&gt;非幂等&lt;/a&gt;方法（ &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;LOCK&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; ）的请求不会传递到下一个服务器;  启用此选项显式允许重试此类请求; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  禁用将请求传递给下一个服务器。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  应该记住，只有在尚未向客户端发送任何内容的情况下，才能将请求传递给下一个服务器。  也就是说，如果在传输响应的过程中发生错误或超时，则无法修复此问题。 &lt;/p&gt;&lt;p&gt;  该指令还定义了与服务器通信的&lt;a hhref=&quot;ngx_http_upstream_module.html#max_fails&quot;&gt;不成功尝试&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;timeout&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;invalid_header&lt;/code&gt;情况始终被视为不成功的尝试，即使它们未在指令中指定。   &lt;code class=&quot;notranslate&quot;&gt;http_500&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;http_502&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;http_503&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;http_504&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt;情况仅在指令中指定&lt;code class=&quot;notranslate&quot;&gt;http_429&lt;/code&gt;被视为不成功尝试。   &lt;code class=&quot;notranslate&quot;&gt;http_403&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;http_404&lt;/code&gt;情况从未被视为不成功的尝试。 &lt;/p&gt;&lt;p&gt;  将请求传递到下一个服务器可能会受到&lt;a hhref=&quot;#grpc_next_upstream_tries&quot;&gt;尝试次数&lt;/a&gt;和&lt;a hhref=&quot;#grpc_next_upstream_timeout&quot;&gt;时间的限制&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;grpc_next_upstream_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_next_upstream_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_next_upstream_timeout 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  限制请求可以传递到&lt;a hhref=&quot;#grpc_next_upstream&quot;&gt;下一个服务器的时间&lt;/a&gt; 。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;grpc_next_upstream_tries&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_next_upstream_tries&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_next_upstream_tries 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  限制将请求传递到&lt;a hhref=&quot;#grpc_next_upstream&quot;&gt;下一个服务器&lt;/a&gt;的可能尝试次数。   &lt;code class=&quot;notranslate&quot;&gt;0&lt;/code&gt;值关闭此限制。 &lt;/p&gt;&lt;a name=&quot;grpc_pass&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_pass&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置gRPC服务器地址。  地址可以指定为域名或IP地址，以及端口： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;grpc_pass localhost:9000;
</code></pre><p></p><p>  或者作为UNIX域套接字路径： </p><blockquote class="example"><pre class="notranslate">grpc_pass unix:/tmp/grpc.socket;<br></pre></blockquote><p>  或者，可以使用“ <code class="notranslate">grpc://</code> ”方案： </p><blockquote class="example"><pre class="notranslate">grpc_pass grpc://127.0.0.1:9000;<br></pre></blockquote><p>  要通过SSL使用gRPC，应使用“ <code class="notranslate">grpcs://</code> ”方案： </p><blockquote class="example"><pre class="notranslate">grpc_pass grpcs://127.0.0.1:443;<br></pre></blockquote><p></p><p>  如果域名解析为多个地址，则所有这些地址都将以循环方式使用。  此外，可以将地址指定为<a hhref="ngx_http_upstream_module.html">服务器组</a> 。 </p><a name="grpc_pass_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>grpc_pass_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将&lt;a hhref=&quot;#grpc_hide_header&quot;&gt;其他禁用的&lt;/a&gt;头字段从gRPC服务器传递到客户端。 &lt;/p&gt;&lt;a name=&quot;grpc_read_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_read_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;grpc_read_timeout 60s;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义从gRPC服务器读取响应的超时。  仅在两个连续的读操作之间设置超时，而不是为整个响应的传输。  如果gRPC服务器在此时间内未传输任何内容，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;grpc_send_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_send_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;grpc_send_timeout 60s;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将请求发送到gRPC服务器的超时。  仅在两个连续的写操作之间设置超时，而不是为整个请求的传输。  如果gRPC服务器在此时间内未收到任何内容，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;grpc_set_header&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_set_header&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;field&lt;/i&gt;&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;grpc_set_header Content-Length $content_length;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将字段重新定义或附加到&lt;a hhref=&quot;#grpc_pass_request_headers&quot;&gt;传递&lt;/a&gt;给gRPC服务器的请求标头。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;grpc_set_header&lt;/code&gt;指令时，这些指令才从前一级继承。 &lt;/p&gt;&lt;p&gt;  如果标头字段的值是空字符串，则该字段将不会传递给gRPC服务器： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;grpc_set_header Accept-Encoding &quot;&quot;;
</code></pre><p></p><p></p><a name="grpc_socket_keepalive"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>grpc_socket_keepalive</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">grpc_socket_keepalive off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.15.6版中。 </p></div><p>  配置与gRPC服务器的传出连接的“TCP keepalive”行为。  默认情况下，操作系统的设置对套接字有效。  如果指令设置为值“ <code class="notranslate">on</code> ”，则为套接字打开<code class="notranslate">SO_KEEPALIVE</code>套接字选项。 </p><a name="grpc_ssl_certificate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>grpc_ssl_certificate</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于对gRPC SSL服务器进行身份验证。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_certificate_key&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_certificate_key&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的密钥的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于对gRPC SSL服务器进行身份验证。 &lt;/p&gt;&lt;p&gt;  可以指定value &lt;code class=&quot;notranslate&quot;&gt;engine&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ： &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;而不是&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;从OpenSSL引擎&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;加载具有指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt;密钥。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_ciphers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_ciphers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ciphers&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_ssl_ciphers DEFAULT;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定对gRPC SSL服务器的请求的已启用密码。  密码以OpenSSL库理解的格式指定。 &lt;/p&gt;&lt;p&gt;  可以使用“ &lt;code class=&quot;notranslate&quot;&gt;openssl ciphers&lt;/code&gt; ”命令查看完整列表。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_crl&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_crl&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的已吊销证书（CRL）的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#grpc_ssl_verify&quot;&gt;验证&lt;/a&gt; gRPC SSL服务器的证书。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_ssl_name host from grpc_pass;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许覆盖用于&lt;a hhref=&quot;#grpc_ssl_verify&quot;&gt;验证&lt;/a&gt; gRPC SSL服务器证书的服务器名称，并在与gRPC SSL服务器建立连接时&lt;a hhref=&quot;#grpc_ssl_server_name&quot;&gt;通过SNI传递&lt;/a&gt; 。 &lt;/p&gt;&lt;p&gt;  默认情况下，使用&lt;a hhref=&quot;#grpc_pass&quot;&gt;grpc_pass&lt;/a&gt;的主机部分。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_password_file&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_password_file&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有密钥密码的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，其中每个密码在单独的行上指定。  在加载密钥时依次尝试密码短语。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_protocols&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_protocols&lt;/strong&gt; 
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;SSLv3&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.1&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.2&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;TLSv1.3&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为gRPC SSL服务器的请求启用指定的协议。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_server_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_server_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_ssl_server_name off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  在与gRPC SSL服务器建立连接时，启用或禁用通过&lt;a hhref=&quot;http://en.wikipedia.org/wiki/Server_Name_Indication&quot;&gt;TLS服务器名称指示扩展&lt;/a&gt; （SNI，RFC 6066）传递服务器名称。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_session_reuse&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_session_reuse&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_ssl_session_reuse on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定在使用gRPC服务器时是否可以重用SSL会话。  如果日志中出现“ &lt;code class=&quot;notranslate&quot;&gt;SSL3_GET_FINISHED:digest check failed&lt;/code&gt; ”错误，请尝试禁用会话重用。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_trusted_certificate&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_trusted_certificate&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定具有PEM格式的可信CA证书的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于&lt;a hhref=&quot;#grpc_ssl_verify&quot;&gt;验证&lt;/a&gt; gRPC SSL服务器的证书。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_verify&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_verify&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_ssl_verify off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用gRPC SSL服务器证书的验证。 &lt;/p&gt;&lt;a name=&quot;grpc_ssl_verify_depth&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;grpc_ssl_verify_depth&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;grpc_ssl_verify_depth 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置gRPC SSL服务器证书链中的验证深度。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_geo_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_geo_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#geo">geo</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_geo_module</code>模块使用取决于客户端IP地址的值创建变量。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">geo $geo {<br>    default        0;<p></p>
<pre><code>127.0.0.1      2;
192.168.1.0/24 1;
10.1.0.0/16    1;

::1            2;
2001:0db8::/32 1;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="geo"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>geo</strong> [ <code class="notranslate"><i>$address</i></code> ] <code class="notranslate"><i>$variable</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  描述指定变量的值对客户端IP地址的依赖性。  默认情况下，地址取自&lt;code class=&quot;notranslate&quot;&gt;$remote_addr&lt;/code&gt;变量，但也可以从另一个变量（0.7.27）获取，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;geo $arg_remote_addr $geo {
...;
</code></pre><p>}<br></p><p></p><p></p><blockquote class="note">  由于变量仅在使用时进行评估，因此即使存在大量已声明的“ <code class="notranslate">geo</code> ”变量也不会导致请求处理的任何额外成本。 </blockquote><p></p><p>  如果变量的值不表示有效的IP地址，则使用“ <code class="notranslate">255.255.255.255</code> ”地址。 </p><p>  地址指定为CIDR表示法中的前缀（包括单个地址）或范围（0.7.23）。 </p><blockquote class="note">  从版本1.3.10和1.2.7开始支持IPv6前缀。 </blockquote><p></p><p>  还支持以下特殊参数： </p><dl class="compact"><dt> <code class="notranslate">delete</code> </dt> <dd>  删除指定的网络（0.7.23）。 </dd><dt> <code class="notranslate">default</code> </dt> <dd>  如果客户端地址与任何指定的地址不匹配，则设置为该变量的值。  当以CIDR表示法指定地址时，可以使用“ <code class="notranslate">0.0.0.0/0</code> ”和“ <code class="notranslate">::/0</code> ”而不是<code class="notranslate">default</code> 。  如果未指定default，则默认值为空字符串。 </dd><dt> <code class="notranslate">include</code> </dt> <dd>  包括一个包含地址和值的文件。  可能有几个夹杂物。 </dd><dt> <code class="notranslate">proxy</code> </dt> <dd>  定义可信地址（0.8.7,0.7.63）。  当请求来自可信地址时，将使用来自“X-Forwarded-For”请求头字段的地址。  与常规地址相反，可靠地址被顺序检查。 <blockquote class="note">  从版本1.3.0和1.2.1开始支持受信任的IPv6地址。 </blockquote></dd><dt> <code class="notranslate">proxy_recursive</code> </dt> <dd>  启用递归地址搜索（1.3.0,1.2.1）。  如果禁用递归搜索，则不使用与其中一个可信地址匹配的原始客户端地址，而是使用“X-Forwarded-For”中发送的最后一个地址。  如果启用递归搜索，则不使用与其中一个可信地址匹配的原始客户端地址，而是使用在“X-Forwarded-For”中发送的最后一个不可信地址。 </dd><dt> <code class="notranslate">ranges</code> </dt> <dd>  表示地址被指定为范围（0.7.23）。  这个参数应该是第一个。  要加快地理基地的加载速度，地址应按升序排列。 </dd></dl><p></p><p>  例： </p><blockquote class="example"><pre class="notranslate">geo $country {<br>    default        ZZ;<br>    include        conf/geo.conf;<br>    delete         127.0.0.0/16;<br>    proxy          192.168.100.0/24;<br>    proxy          2001:0db8::/32;<p></p>
<pre><code>127.0.0.0/24   US;
127.0.0.1/32   RU;
10.1.0.0/16    RU;
192.168.1.0/24 UK;
</code></pre><p>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">conf/geo.conf</code>文件可以包含以下行： </p><blockquote class="example"><pre class="notranslate">10.2.0.0/16    RU;<br>192.168.2.0/24 RU;<br></pre></blockquote><p></p><p>  使用最具体匹配的值。  例如，对于127.0.0.1地址，将选择值“ <code class="notranslate">RU</code> ”，而不是“ <code class="notranslate">US</code> ”。 </p><p>  范围示例： </p><blockquote class="example"><pre class="notranslate">geo $country {<br>    ranges;<br>    default                   ZZ;<br>    127.0.0.0-127.0.0.0       US;<br>    127.0.0.1-127.0.0.1       RU;<br>    127.0.0.1-127.0.0.255     US;<br>    10.1.0.0-10.1.255.255     RU;<br>    192.168.1.0-192.168.1.255 UK;<br>}<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_geoip_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_geoip_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#geoip_country">geoip_country</a> <br>     <a hhref="#geoip_city">geoip_city</a> <br>     <a hhref="#geoip_org">geoip_org</a> <br>     <a hhref="#geoip_proxy">geoip_proxy</a> <br>     <a hhref="#geoip_proxy_recursive">geoip_proxy_recursive</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_geoip_module</code>模块（0.8.6+）使用预编译的<a hhref="http://www.maxmind.com">MaxMind</a>数据库创建具有取决于客户端IP地址的值的变量。 </p><p>  使用支持IPv6的数据库（1.3.12,1.2.7）时，IPv4地址将被查找为IPv4映射的IPv6地址。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_geoip_module</code>配置参数启用它。 </p><blockquote class="note">  该模块需要<a hhref="http://www.maxmind.com/app/c">MaxMind GeoIP</a>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<br>    geoip_country         GeoIP.dat;<br>    geoip_city            GeoLiteCity.dat;<br>    geoip_proxy           192.168.100.0/24;<br>    geoip_proxy           2001:0db8::/32;<br>    geoip_proxy_recursive on;<br>    …<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="geoip_country"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>geoip_country</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定用于根据客户端IP地址确定国家/地区的数据库。  使用此数据库时，以下变量可用： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_geoip_country_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_country_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  两个字母的国家/地区代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;RU&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;US&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_country_code3&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_country_code3&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  三个字母的国家/地区代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;RUS&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;USA&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_country_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_country_name&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  国名，例如“ &lt;code class=&quot;notranslate&quot;&gt;Russian Federation&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;United States&lt;/code&gt; ”。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;geoip_city&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;geoip_city&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定用于根据客户端IP地址确定国家，地区和城市的数据库。  使用此数据库时，以下变量可用： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_geoip_area_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_area_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  电话区号（仅限美国）。 &lt;blockquote class=&quot;note&quot;&gt;  此变量可能包含过时的信息，因为不推荐使用相应的数据库字段。 &lt;/blockquote&gt;&lt;/dd&gt;&lt;dt id=&quot;var_geoip_city_continent_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city_continent_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  两个字母的大陆代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;EU&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;NA&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_city_country_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city_country_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  两个字母的国家/地区代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;RU&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;US&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_city_country_code3&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city_country_code3&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  三个字母的国家/地区代码，例如“ &lt;code class=&quot;notranslate&quot;&gt;RUS&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;USA&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_city_country_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city_country_name&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  国名，例如“ &lt;code class=&quot;notranslate&quot;&gt;Russian Federation&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;United States&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_dma_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_dma_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  根据Google AdWords API中的&lt;a hhref=&quot;https://developers.google.com/adwords/api/appendix/cities-DMAregions&quot;&gt;地理位置定位&lt;/a&gt; ，美国的DMA区域代码（也称为“都市代码”）。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_latitude&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_latitude&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  纬度。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_longitude&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_longitude&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  经度。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_region&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_region&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  双符号国家区域代码（地区，领土，州，省，联邦土地等），例如“ &lt;code class=&quot;notranslate&quot;&gt;48&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;DC&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_region_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_region_name&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  国家地区名称（地区，领土，州，省，联邦土地等），例如“ &lt;code class=&quot;notranslate&quot;&gt;Moscow City&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;District of Columbia&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_city&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_city&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  城市名称，例如“ &lt;code class=&quot;notranslate&quot;&gt;Moscow&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;Washington&lt;/code&gt; ”。 &lt;/dd&gt;&lt;dt id=&quot;var_geoip_postal_code&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_postal_code&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  邮政编码。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;geoip_org&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;geoip_org&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.0.3版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定用于根据客户端IP地址确定组织的数据库。  使用此数据库时，以下变量可用： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;var_geoip_org&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;$geoip_org&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  组织名称，例如“墨尔本大学”。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;geoip_proxy&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;geoip_proxy&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;CIDR&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.3.0和1.2.1版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义可信地址。  当请求来自可信地址时，将使用来自“X-Forwarded-For”请求头字段的地址。 &lt;/p&gt;&lt;a name=&quot;geoip_proxy_recursive&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;geoip_proxy_recursive&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;geoip_proxy_recursive off;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.3.0和1.2.1版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果禁用递归搜索，则不使用与其中一个可信地址匹配的原始客户端地址，而是使用“X-Forwarded-For”中发送的最后一个地址。  如果启用递归搜索，则不使用与其中一个可信地址匹配的原始客户端地址，而是使用在“X-Forwarded-For”中发送的最后一个不可信地址。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_flv_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_flv_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#flv">flv</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_flv_module</code>模块为Flash Video（FLV）文件提供伪流服务器端支持。 </p><p>  它特别通过请求URI的查询字符串中的<code class="notranslate">start</code>参数处理请求，方法是从请求的字节偏移量和前置FLV头开始发回文件的内容。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_flv_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location ~ .flv$ {<br>    flv;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="flv"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>flv</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  打开周围位置的模块处理。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_fastcgi_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_fastcgi_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#fastcgi_bind">fastcgi_bind</a> <br>     <a hhref="#fastcgi_buffer_size">fastcgi_buffer_size</a> <br>     <a hhref="#fastcgi_buffering">fastcgi_buffering</a> <br>     <a hhref="#fastcgi_buffers">fastcgi_buffers</a> <br>     <a hhref="#fastcgi_busy_buffers_size">fastcgi_busy_buffers_size</a> <br>     <a hhref="#fastcgi_cache">fastcgi_cache</a> <br>     <a hhref="#fastcgi_cache_background_update">fastcgi_cache_background_update</a> <br>     <a hhref="#fastcgi_cache_bypass">fastcgi_cache_bypass</a> <br>     <a hhref="#fastcgi_cache_key">fastcgi_cache_key</a> <br>     <a hhref="#fastcgi_cache_lock">fastcgi_cache_lock</a> <br>     <a hhref="#fastcgi_cache_lock_age">fastcgi_cache_lock_age</a> <br>     <a hhref="#fastcgi_cache_lock_timeout">fastcgi_cache_lock_timeout</a> <br>     <a hhref="#fastcgi_cache_max_range_offset">fastcgi_cache_max_range_offset</a> <br>     <a hhref="#fastcgi_cache_methods">fastcgi_cache_methods</a> <br>     <a hhref="#fastcgi_cache_min_uses">fastcgi_cache_min_uses</a> <br>     <a hhref="#fastcgi_cache_path">fastcgi_cache_path</a> <br>     <a hhref="#fastcgi_cache_purge">fastcgi_cache_purge</a> <br>     <a hhref="#fastcgi_cache_revalidate">fastcgi_cache_revalidate</a> <br>     <a hhref="#fastcgi_cache_use_stale">fastcgi_cache_use_stale</a> <br>     <a hhref="#fastcgi_cache_valid">fastcgi_cache_valid</a> <br>     <a hhref="#fastcgi_catch_stderr">fastcgi_catch_stderr</a> <br>     <a hhref="#fastcgi_connect_timeout">fastcgi_connect_timeout</a> <br>     <a hhref="#fastcgi_force_ranges">fastcgi_force_ranges</a> <br>     <a hhref="#fastcgi_hide_header">fastcgi_hide_header</a> <br>     <a hhref="#fastcgi_ignore_client_abort">fastcgi_ignore_client_abort</a> <br>     <a hhref="#fastcgi_ignore_headers">fastcgi_ignore_headers</a> <br>     <a hhref="#fastcgi_index">fastcgi_index</a> <br>     <a hhref="#fastcgi_intercept_errors">fastcgi_intercept_errors</a> <br>     <a hhref="#fastcgi_keep_conn">fastcgi_keep_conn</a> <br>     <a hhref="#fastcgi_limit_rate">fastcgi_limit_rate</a> <br>     <a hhref="#fastcgi_max_temp_file_size">fastcgi_max_temp_file_size</a> <br>     <a hhref="#fastcgi_next_upstream">fastcgi_next_upstream</a> <br>     <a hhref="#fastcgi_next_upstream_timeout">fastcgi_next_upstream_timeout</a> <br>     <a hhref="#fastcgi_next_upstream_tries">fastcgi_next_upstream_tries</a> <br>     <a hhref="#fastcgi_no_cache">fastcgi_no_cache</a> <br>     <a hhref="#fastcgi_param">fastcgi_param</a> <br>     <a hhref="#fastcgi_pass">fastcgi_pass</a> <br>     <a hhref="#fastcgi_pass_header">fastcgi_pass_header</a> <br>     <a hhref="#fastcgi_pass_request_body">fastcgi_pass_request_body</a> <br>     <a hhref="#fastcgi_pass_request_headers">fastcgi_pass_request_headers</a> <br>     <a hhref="#fastcgi_read_timeout">fastcgi_read_timeout</a> <br>     <a hhref="#fastcgi_request_buffering">fastcgi_request_buffering</a> <br>     <a hhref="#fastcgi_send_lowat">fastcgi_send_lowat</a> <br>     <a hhref="#fastcgi_send_timeout">fastcgi_send_timeout</a> <br>     <a hhref="#fastcgi_socket_keepalive">fastcgi_socket_keepalive</a> <br>     <a hhref="#fastcgi_split_path_info">fastcgi_split_path_info</a> <br>     <a hhref="#fastcgi_store">fastcgi_store</a> <br>     <a hhref="#fastcgi_store_access">fastcgi_store_access</a> <br>     <a hhref="#fastcgi_temp_file_write_size">fastcgi_temp_file_write_size</a> <br>     <a hhref="#fastcgi_temp_path">fastcgi_temp_path</a> <br> <a hhref="#parameters">Parameters Passed to a FastCGI Server</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_fastcgi_module</code>模块允许将请求传递给FastCGI服务器。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    fastcgi_pass  localhost:9000;<br>    fastcgi_index index.php;<p></p>
<pre><code>fastcgi_param SCRIPT_FILENAME /home/www/scripts/php$fastcgi_script_name;
fastcgi_param QUERY_STRING    $query_string;
fastcgi_param REQUEST_METHOD  $request_method;
fastcgi_param CONTENT_TYPE    $content_type;
fastcgi_param CONTENT_LENGTH  $content_length;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="fastcgi_bind"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_bind</strong><br>    <code class="notranslate"><i>address</i></code><br>    [ <code class="notranslate">transparent</code> ] |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.8.22版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  使用可选端口（1.11.2）从指定的本地IP地址发出到FastCGI服务器的传出连接。  参数值可以包含变量（1.3.12）。  特殊值&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; （1.3.12）取消了从先前配置级别继承的&lt;code class=&quot;notranslate&quot;&gt;fastcgi_bind&lt;/code&gt;指令的效果，该指令允许系统自动分配本地IP地址和端口。 &lt;/p&gt;&lt;a name=&quot;fastcgi_bind_transparent&quot;&gt;&lt;/a&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;transparent&lt;/code&gt;参数（1.11.0）允许到FastCGI服务器的传出连接源自非本地IP地址，例如，来自客户端的真实IP地址： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_bind $remote_addr transparent;
</code></pre><p></p><p>  为了使此参数有效，通常需要使用<a hhref="ngx_core_module.html#user">超级用户</a>权限运行nginx工作进程。  在Linux上，不需要（1.13.8），就像指定了<code class="notranslate">transparent</code>参数一样，工作进程从主进程继承<code class="notranslate">CAP_NET_RAW</code>功能。  还必须配置内核路由表以拦截来自FastCGI服务器的网络流量。 </p><a name="fastcgi_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_buffer_size 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取从FastCGI服务器接收的响应的第一部分的缓冲区的<code class="notranslate"><i>size</i></code> 。  这部分通常包含一个小的响应头。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。  然而，它可以做得更小。 </p><a name="fastcgi_buffering"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_buffering</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_buffering on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.6版本中。 </p></div><p>  启用或禁用缓冲来自FastCGI服务器的响应。 </p><p>  启用缓冲后，nginx会尽快从FastCGI服务器接收响应，并将其保存到<a hhref="#fastcgi_buffer_size">fastcgi_buffer_size</a>和<a hhref="#fastcgi_buffers">fastcgi_buffers</a>指令设置的缓冲区中。  如果整个响应不适合内存，则可以将其中的一部分保存到磁盘上的<a hhref="#fastcgi_temp_path">临时文件中</a> 。  写入临时文件由<a hhref="#fastcgi_max_temp_file_size">fastcgi_max_temp_file_size</a>和<a hhref="#fastcgi_temp_file_write_size">fastcgi_temp_file_write_size</a>指令控制。 </p><p>  禁用缓冲时，响应会在收到响应时立即同步传递给客户端。   nginx不会尝试从FastCGI服务器读取整个响应。   nginx一次可以从服务器接收的数据的最大大小由<a hhref="#fastcgi_buffer_size">fastcgi_buffer_size</a>指令设置。 </p><p>  也可以通过在“X-Accel-Buffering”响应头字段中传递“ <code class="notranslate">yes</code> ”或“ <code class="notranslate">no</code> ”来启用或禁用缓冲。  可以使用<a hhref="#fastcgi_ignore_headers">fastcgi_ignore_headers</a>指令禁用此功能。 </p><a name="fastcgi_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_buffers 8 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于从FastCGI服务器读取响应的缓冲区的<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> ，用于单个连接。  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。 </p><a name="fastcgi_busy_buffers_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_busy_buffers_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_busy_buffers_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用从FastCGI服务器<a hhref="#fastcgi_buffering">缓冲</a>响应时，限制可能忙于向响应客户端发送响应的缓冲区的总<code class="notranslate"><i>size</i></code> ，而响应尚未完全读取。  同时，其余的缓冲区可用于读取响应，并在需要时缓冲部分响应临时文件。  默认情况下， <code class="notranslate"><i>size</i></code>由<a hhref="#fastcgi_buffer_size">fastcgi_buffer_size</a>和<a hhref="#fastcgi_buffers">fastcgi_buffers</a>指令设置的两个缓冲区的大小限制。 </p><a name="fastcgi_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache</strong> <code class="notranslate"><i>zone</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_cache off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于缓存的共享内存区域。  可以在多个地方使用相同的区域。  参数值可以包含变量（1.7.9）。   <code class="notranslate">off</code>参数禁用从先前配置级别继承的高速缓存。 </p><a name="fastcgi_cache_background_update"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_background_update</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_cache_background_update off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.10版中。 </p></div><p>  允许启动后台子请求以更新过期的缓存项，同时将过时的缓存响应返回给客户端。  请注意，在更新时必须<a hhref="#fastcgi_cache_use_stale_updating">允许</a>使用陈旧的缓存响应。 </p><a name="fastcgi_cache_bypass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_bypass</strong> <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义不从缓存中获取响应的条件。  如果字符串参数的至少一个值不为空且不等于“0”，则不会从缓存中获取响应： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_cache_bypass $cookie_nocache $arg_nocache$arg_comment;
</code></pre><p>fastcgi_cache_bypass $http_pragma    $http_authorization;<br></p><p>  可以与<a hhref="#fastcgi_no_cache">fastcgi_no_cache</a>指令一起使用。 </p><a name="fastcgi_cache_key"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_key</strong> <code class="notranslate"><i>string</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  例如，定义缓存的键 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_cache_key localhost:9000$request_uri;
</code></pre><p></p><p></p><a name="fastcgi_cache_lock"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_lock</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_cache_lock off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  启用后，通过将请求传递给FastCGI服务器，一次只允许一个请求填充根据<a hhref="#fastcgi_cache_key">fastcgi_cache_key</a>指令标识的新缓存元素。  同一缓存元素的其他请求将等待响应出现在缓存中或缓存锁定以释放此元素，直到<a hhref="#fastcgi_cache_lock_timeout">fastcgi_cache_lock_timeout</a>指令设置的时间。 </p><a name="fastcgi_cache_lock_age"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_lock_age</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_cache_lock_age 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.8版本中。 </p></div><p>  如果传递给FastCGI服务器以填充新缓存元素的最后一个请求在指定<code class="notranslate"><i>time</i></code>内没有完成，则可以将另一个请求传递给FastCGI服务器。 </p><a name="fastcgi_cache_lock_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_lock_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_cache_lock_timeout 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  为<a hhref="#fastcgi_cache_lock">fastcgi_cache_lock</a>设置超时。  当<code class="notranslate"><i>time</i></code>到期时，请求将被传递给FastCGI服务器，但是，响应将不会被缓存。 </p><blockquote class="note">  在1.7.8之前，可以缓存响应。 </blockquote><p></p><a name="fastcgi_cache_max_range_offset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_max_range_offset</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  设置字节范围请求的偏移量（以字节为单位）。  如果范围超出偏移量，则范围请求将传递给FastCGI服务器，并且不会缓存响应。 &lt;/p&gt;&lt;a name=&quot;fastcgi_cache_methods&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_cache_methods&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt;
...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_cache_methods GET HEAD;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.7.59版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  如果此指令中列出了客户端请求方法，则将缓存响应。   “ &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; ”方法总是添加到列表中，但建议明确指定它们。  另请参见&lt;a hhref=&quot;#fastcgi_no_cache&quot;&gt;fastcgi_no_cache&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;fastcgi_cache_min_uses&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_cache_min_uses&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_cache_min_uses 1;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将缓存响应的请求&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;a name=&quot;fastcgi_cache_path&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_cache_path&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;path&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;levels&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;levels&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;use_temp_path&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ]
&lt;code class=&quot;notranslate&quot;&gt;keys_zone&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; : &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;inactive&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;max_size&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;manager_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;loader_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_files&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_sleep&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ]
[ &lt;code class=&quot;notranslate&quot;&gt;purger_threshold&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置缓存的路径和其他参数。  缓存数据存储在文件中。  缓存中的密钥和文件名都是将MD5功能应用于代理URL的结果。   &lt;code class=&quot;notranslate&quot;&gt;levels&lt;/code&gt;参数定义高速缓存的层次结构级别：从1到3，每个级别接受值1或2.例如，在以下配置中 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;
</code></pre><p></p><p>  缓存中的文件名如下所示： </p><blockquote class="example"><pre class="notranslate">/data/nginx/cache/ <strong>c</strong> / <strong>29</strong> /b7f54b2df7773722d382f4809d650 <strong>29c</strong><br></pre></blockquote><p></p><p>  首先将缓存的响应写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和缓存可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，缓存和保存临时文件的目录都放在同一文件系统上。  根据<code class="notranslate">use_temp_path</code>参数（1.7.10）设置临时文件的目录。  如果省略此参数或将其设置为<code class="notranslate">on</code> ，则将使用<a hhref="#fastcgi_temp_path">fastcgi_temp_path</a>指令为给定位置设置的目录。  如果该值设置为<code class="notranslate">off</code> ，则临时文件将直接放入缓存目录中。 </p><p>  此外，所有活动密钥和有关数据的信息都存储在共享内存区域中，其<code class="notranslate"><i>name</i></code>和<code class="notranslate"><i>size</i></code>由<code class="notranslate">keys_zone</code>参数配置。  一兆字节区域可以存储大约8000个密钥。 </p><blockquote class="note">  作为<a hhref="http://nginx.com/products/">商业订阅的</a>一部分，共享存储器区域还存储扩展的高速缓存<a hhref="ngx_http_api_module.html#http_caches_">信息</a> ，因此，需要为相同数量的密钥指定更大的区域大小。  例如，一兆字节区域可以存储大约4000个密钥。 </blockquote><p></p><p>  在<code class="notranslate">inactive</code>参数指定的时间内未访问的缓存数据将从缓存中删除，无论其新鲜度如何。  默认情况下， <code class="notranslate">inactive</code>设置为10分钟。 </p><p>  特殊的“缓存管理器”进程监视<code class="notranslate">max_size</code>参数设置的最大缓存大小。  超过此大小时，它会删除最近最少使用的数据。  在<code class="notranslate">manager_files</code> ， <code class="notranslate">manager_threshold</code>和<code class="notranslate">manager_sleep</code>参数（1.11.5）配置的迭代中删除数据。  在一次迭代期间，不会删除<code class="notranslate">manager_files</code>项（默认情况下为100）。  一次迭代的持续时间受<code class="notranslate">manager_threshold</code>参数限制（默认情况下为200毫秒）。  在迭代之间，由<code class="notranslate">manager_sleep</code>参数（默认为50毫秒）配置的暂停。 </p><p>  启动一分钟后，激活特殊的“缓存加载程序”进程。  它将有关存储在文件系统中的先前缓存数据的信息加载到缓存区。  加载也是在迭代中完成的。  在一次迭代期间，加载的<code class="notranslate">loader_files</code>项目不超过（默认情况下为100）。  此外，一次迭代的持续时间受<code class="notranslate">loader_threshold</code>参数限制（默认为200毫秒）。  在迭代之间，由<code class="notranslate">loader_sleep</code>参数（默认为50毫秒）配置暂停。 </p><p>  此外，以下参数作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供： </p><p></p><dl class="compact"><dt id="purger">   <code class="notranslate">purger</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> </dt><dd>  指示缓存清除程序是否将从磁盘中删除与<a hhref="#fastcgi_cache_purge">通配符密钥</a>匹配的缓存条目（1.7.12）。  将参数设置为<code class="notranslate">on</code> （默认为<code class="notranslate">off</code> ）将激活“cache purger”进程，该进程将永久迭代所有缓存条目并删除与通配符键匹配的条目。 </dd><dt id="purger_files">   <code class="notranslate">purger_files</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置在一次迭代（1.7.12）期间将扫描的项目数。  默认情况下， <code class="notranslate">purger_files</code>设置为10。 </dd><dt id="purger_threshold">   <code class="notranslate">purger_threshold</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置一次迭代的持续时间（1.7.12）。  默认情况下， <code class="notranslate">purger_threshold</code>设置为50毫秒。 </dd><dt id="purger_sleep">   <code class="notranslate">purger_sleep</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  设置迭代之间的暂停（1.7.12）。  默认情况下， <code class="notranslate">purger_sleep</code>设置为50毫秒。 </dd></dl><p></p><p></p><blockquote class="note">  在版本1.7.3,1.7.7和1.11.10中，缓存头格式已更改。  升级到较新的nginx版本之前，缓存的响应将被视为无效。 </blockquote><p></p><a name="fastcgi_cache_purge"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_purge</strong> string …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.5.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义将请求视为缓存清除请求的条件。  如果字符串参数的至少一个值不为空并且不等于“0”，则移除具有相应&lt;a hhref=&quot;#fastcgi_cache_key&quot;&gt;高速缓存键&lt;/a&gt;的高速缓存条目。  通过返回204（无内容）响应来指示成功操作的结果。 &lt;/p&gt;&lt;p&gt;  如果清除请求的&lt;a hhref=&quot;#fastcgi_cache_key&quot;&gt;缓存键&lt;/a&gt;以星号（“ &lt;code class=&quot;notranslate&quot;&gt;*&lt;/code&gt; ”）结尾，则将从缓存中删除与通配符键匹配的所有缓存条目。  但是，这些条目将保留在磁盘上，直到它们被删除&lt;a hhref=&quot;#fastcgi_cache_path&quot;&gt;为非活动状态&lt;/a&gt; ，或由&lt;a hhref=&quot;#purger&quot;&gt;缓存&lt;/a&gt;清除程序（1.7.12）处理，或者客户端尝试访问它们。 &lt;/p&gt;&lt;p&gt;  配置示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_cache_path /data/nginx/cache keys_zone=cache_zone:10m;
</code></pre><p>map $request_method $purge_method {<br>    PURGE   1;<br>    default 0;<br>}</p>
<p>server {<br>    …<br>    location / {<br>        fastcgi_pass        backend;<br>        fastcgi_cache       cache_zone;<br>        fastcgi_cache_key   $uri;<br>        fastcgi_cache_purge $purge_method;<br>    }<br>}<br></p><p></p><blockquote class="note">  此功能作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="fastcgi_cache_revalidate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_revalidate</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_cache_revalidate off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.5.7版本中。 </p></div><p>  使用具有“If-Modified-Since”和“If-None-Match”标头字段的条件请求启用过期缓存项的重新验证。 </p><a name="fastcgi_cache_use_stale"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_use_stale</strong><br>    <code class="notranslate">error</code> |<br>    <code class="notranslate">timeout</code> |<br>    <code class="notranslate">invalid_header</code> |<br>    <code class="notranslate">updating</code> |<br>    <code class="notranslate">http_500</code> |<br>    <code class="notranslate">http_503</code> |<br>    <code class="notranslate">http_403</code> |<br>    <code class="notranslate">http_404</code> |<br>    <code class="notranslate">http_429</code> |<br>    <code class="notranslate">off</code><br>    …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_cache_use_stale off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  确定在与FastCGI服务器通信期间发生错误时可以使用过时的缓存响应的情况。  该指令的参数与<a hhref="#fastcgi_next_upstream">fastcgi_next_upstream</a>指令的参数匹配。 </p><p>  如果无法选择要处理请求的FastCGI服务器，则<code class="notranslate">error</code>参数还允许使用过时的缓存响应。 </p><a name="fastcgi_cache_use_stale_updating"></a><p>  此外，如果当前正在更新，则<code class="notranslate">updating</code>参数允许使用过时的缓存响应。  这样可以在更新缓存数据时最大限度地减少对FastCGI服务器的访问次数。 </p><p>  在响应变为失效后，也可以在响应头中直接启用过时的缓存响应指定的秒数（1.11.10）。  这比使用指令参数的优先级低。 </p><ul><li>   “Cache-Control”头字段的“ <a hhref="https://tools.ietf.org/html/rfc5861#section-3">stale-while-revalidate</a> ”扩展允许使用陈旧的缓存响应（如果当前正在更新）。 </li><li>   “Cache-Control”头字段的“ <a hhref="https://tools.ietf.org/html/rfc5861#section-4">stale-if-error</a> ”扩展允许在出现错误时使用陈旧的缓存响应。 </li></ul><p></p><p>  要在填充新缓存元素时最小化对FastCGI服务器的访问次数，可以使用<a hhref="#fastcgi_cache_lock">fastcgi_cache_lock</a>指令。 </p><a name="fastcgi_cache_valid"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_cache_valid</strong> [ <code class="notranslate"><i>code</i></code> …] <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置不同响应代码的缓存时间。  例如，以下指令 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_cache_valid 200 302 10m;
</code></pre><p>fastcgi_cache_valid 404      1m;<br></p><p>  为代码为200和302的响应设置10分钟的缓存，为代码404的响应设置1分钟。 </p><p>  如果仅指定了缓存<code class="notranslate"><i>time</i></code> </p><blockquote class="example"><pre class="notranslate">fastcgi_cache_valid 5m;<br></pre></blockquote><p>  然后只缓存200,301和302个响应。 </p><p>  此外，可以指定<code class="notranslate">any</code>参数来缓存任何响应： </p><blockquote class="example"><pre class="notranslate">fastcgi_cache_valid 200 302 10m;<br>fastcgi_cache_valid 301      1h;<br>fastcgi_cache_valid any      1m;<br></pre></blockquote><p></p><p>  缓存的参数也可以直接在响应头中设置。  这比使用该指令设置缓存时间具有更高的优先级。 </p><ul><li>   “X-Accel-Expires”标题字段以秒为单位设置响应的缓存时间。  零值禁用响应的缓存。  如果值以<code class="notranslate">@</code>前缀开头，则设置自Epoch以来的绝对时间（以秒为单位），响应可以高速缓存。 </li><li>  如果标题不包括“X-Accel-Expires”字段，则可以在标题字段“Expires”或“Cache-Control”中设置高速缓存的参数。 </li><li>  如果标头包含“Set-Cookie”字段，则不会缓存此类响应。 </li><li>  如果标题包含具有特殊值“ <code class="notranslate">*</code> ”的“Vary”字段，则不会缓存此类响应（1.7.7）。  如果标题包含具有另一个值的“Vary”字段，则将考虑相应的请求标题字段来缓存这样的响应（1.7.7）。 </li></ul><p>  可以使用<a hhref="#fastcgi_ignore_headers">fastcgi_ignore_headers</a>指令禁用这些响应头字段中的一个或多个的处理。 </p><a name="fastcgi_catch_stderr"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_catch_stderr</strong> <code class="notranslate"><i>string</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置要在从FastCGI服务器接收的响应的错误流中搜索的字符串。  如果找到该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ，则认为FastCGI服务器返回了&lt;a hhref=&quot;#fastcgi_next_upstream&quot;&gt;无效响应&lt;/a&gt; 。  这允许在nginx中处理应用程序错误，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location /php/ {
fastcgi_pass backend:9000;
...
fastcgi_catch_stderr &quot;PHP Fatal error&quot;;
fastcgi_next_upstream error timeout invalid_header;
</code></pre><p>}<br></p><p></p><a name="fastcgi_connect_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_connect_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_connect_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义与FastCGI服务器建立连接的超时。  应该注意，此超时通常不会超过75秒。 </p><a name="fastcgi_force_ranges"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_force_ranges</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_force_ranges off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.7版本中。 </p></div><p>  无论来自这些响应中的“Accept-Ranges”字段如何，都可以对来自FastCGI服务器的缓存和未缓存响应启用字节范围支持。 </p><a name="fastcgi_hide_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_hide_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  默认情况下，nginx不会将FastCGI服务器的响应中的标题字段“Status”和“X-Accel -...”传递给客户端。   &lt;code class=&quot;notranslate&quot;&gt;fastcgi_hide_header&lt;/code&gt;指令设置不会传递的其他字段。  相反，如果需要允许传递字段，则可以使用&lt;a hhref=&quot;#fastcgi_pass_header&quot;&gt;fastcgi_pass_header&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;fastcgi_ignore_client_abort&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_ignore_client_abort&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_ignore_client_abort off;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  确定客户端在不等待响应的情况下关闭连接时是否应关闭与FastCGI服务器的连接。 &lt;/p&gt;&lt;a name=&quot;fastcgi_ignore_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_ignore_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;field&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  禁用从FastCGI服务器处理某些响应头字段。  可以忽略以下字段：“X-Accel-Redirect”，“X-Accel-Expires”，“X-Accel-Limit-Rate”（1.1.6），“X-Accel-Buffering”（1.1.6） ，“X-Accel-Charset”（1.1.6），“Expires”，“Cache-Control”，“Set-Cookie”（0.8.44）和“Vary”（1.7.7）。 &lt;/p&gt;&lt;p&gt;  如果未禁用，则处理这些标头字段会产生以下影响： &lt;/p&gt;&lt;ul&gt;&lt;li&gt;   “X-Accel-Expires”，“Expires”，“Cache-Control”，“Set-Cookie”和“Vary”设置响应&lt;a hhref=&quot;#fastcgi_cache_valid&quot;&gt;缓存&lt;/a&gt;的参数; &lt;/li&gt;&lt;li&gt;   “X-Accel-Redirect”执行&lt;a hhref=&quot;ngx_http_core_module.html#internal&quot;&gt;内部重定向&lt;/a&gt;到指定的URI; &lt;/li&gt;&lt;li&gt;   “X-Accel-Limit-Rate”设置向客户端传输响应的&lt;a hhref=&quot;ngx_http_core_module.html#limit_rate&quot;&gt;速率限制&lt;/a&gt; ; &lt;/li&gt;&lt;li&gt;   “X-Accel-Buffering”启用或禁用&lt;a hhref=&quot;#fastcgi_buffering&quot;&gt;缓冲&lt;/a&gt;响应; &lt;/li&gt;&lt;li&gt;   “X-Accel-Charset”设置了所需的响应&lt;a hhref=&quot;ngx_http_charset_module.html#charset&quot;&gt;字符集&lt;/a&gt; 。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;fastcgi_index&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_index&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  在&lt;code class=&quot;notranslate&quot;&gt;$fastcgi_script_name&lt;/code&gt;变量的值中设置将在以斜杠结尾的URI之后附加的文件名。  例如，使用这些设置 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_index index.php;
</code></pre><p>fastcgi_param SCRIPT_FILENAME /home/www/scripts/php$fastcgi_script_name;<br></p><p>  和“ <code class="notranslate">/page.php</code> ”请求， <code class="notranslate">SCRIPT_FILENAME</code>参数将等于“ <code class="notranslate">/home/www/scripts/php/page.php</code> ”，并且使用“ <code class="notranslate">/</code> ”请求它将等于“ <code class="notranslate">/home/www/scripts/php/index.php</code> “。 </p><a name="fastcgi_intercept_errors"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_intercept_errors</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_intercept_errors off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  确定代码大于或等于300的FastCGI服务器响应是应该传递给客户端还是被拦截并重定向到nginx以便使用<a hhref="ngx_http_core_module.html#error_page">error_page</a>指令进行处理。 </p><a name="fastcgi_keep_conn"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_keep_conn</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_keep_conn off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.4版中。 </p></div><p>  默认情况下，FastCGI服务器将在发送响应后立即关闭连接。  但是，当此伪指令设置为<code class="notranslate">on</code> ，nginx将指示FastCGI服务器保持连接打开。  特别是，这对于FastCGI服务器的<a hhref="ngx_http_upstream_module.html#keepalive">keepalive</a>连接起作用是必要的。 </p><a name="fastcgi_limit_rate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_limit_rate</strong> <code class="notranslate"><i>rate</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_limit_rate 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.7版本中。 </p></div><p>  限制从FastCGI服务器读取响应的速度。   <code class="notranslate"><i>rate</i></code>以每秒字节数指定。  零值禁用速率限制。  根据请求设置限制，因此如果nginx同时打开两个到FastCFI服务器的连接，则总速率将是指定限制的两倍。  仅当启用了对来自FastCGI服务器的响应的<a hhref="#fastcgi_buffering">缓冲时</a> ，该限制才有效。 </p><a name="fastcgi_max_temp_file_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_max_temp_file_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_max_temp_file_size 1024m;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用来自FastCGI服务器的响应<a hhref="#fastcgi_buffering">缓冲</a> ，并且整个响应不适合<a hhref="#fastcgi_buffer_size">fastcgi_buffer_size</a>和<a hhref="#fastcgi_buffers">fastcgi_buffers</a>指令设置的缓冲区时，响应的一部分可以保存到临时文件中。  该指令设置临时文件的最大<code class="notranslate"><i>size</i></code> 。  一次写入临时文件的数据大小由<a hhref="#fastcgi_temp_file_write_size">fastcgi_temp_file_write_size</a>指令设置。 </p><p>  零值禁用缓冲对临时文件的响应。 </p><p></p><blockquote class="note">  此限制不适用于将<a hhref="#fastcgi_cache">缓存</a>或<a hhref="#fastcgi_store">存储</a>在磁盘上的响应。 </blockquote><p></p><a name="fastcgi_next_upstream"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_next_upstream</strong><br>    <code class="notranslate">error</code> |<br>    <code class="notranslate">timeout</code> |<br>    <code class="notranslate">invalid_header</code> |<br>    <code class="notranslate">http_500</code> |<br>    <code class="notranslate">http_503</code> |<br>    <code class="notranslate">http_403</code> |<br>    <code class="notranslate">http_404</code> |<br>    <code class="notranslate">http_429</code> |<br>    <code class="notranslate">non_idempotent</code> |<br>    <code class="notranslate">off</code><br>    …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_next_upstream error timeout;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  指定应将请求传递到下一个服务器的情况： </p><dl class="compact"><dt> <code class="notranslate">error</code> </dt> <dd>  与服务器建立连接，向其传递请求或读取响应头时发生错误; </dd><dt> <code class="notranslate">timeout</code> </dt> <dd>  在与服务器建立连接，向其传递请求或读取响应头时发生超时; </dd><dt> <code class="notranslate">invalid_header</code> </dt> <dd>  服务器返回空或无效响应; </dd><dt> <code class="notranslate">http_500</code> </dt> <dd>  服务器返回代码为500的响应; </dd><dt> <code class="notranslate">http_503</code> </dt> <dd>  服务器返回代码为503的响应; </dd><dt> <code class="notranslate">http_403</code> </dt> <dd>  服务器返回代码为403的响应; </dd><dt> <code class="notranslate">http_404</code> </dt> <dd>  服务器返回代码为404的响应; </dd><dt> <code class="notranslate">http_429</code> </dt> <dd>  服务器返回代码为429的响应（1.11.13）; </dd><dt id="non_idempotent"> <code class="notranslate">non_idempotent</code> </dt> <dd>  通常，如果请求已发送到上游服务器，则使用<a hhref="https://tools.ietf.org/html/rfc7231#section-4.2.2">非幂等</a>方法（ <code class="notranslate">POST</code> ， <code class="notranslate">LOCK</code> ， <code class="notranslate">PATCH</code> ）的请求不会传递给下一个服务器（1.9.13）;  启用此选项显式允许重试此类请求; </dd><dt> <code class="notranslate">off</code> </dt> <dd>  禁用将请求传递给下一个服务器。 </dd></dl><p></p><p>  应该记住，只有在尚未向客户端发送任何内容的情况下，才能将请求传递给下一个服务器。  也就是说，如果在传输响应的过程中发生错误或超时，则无法修复此问题。 </p><p>  该指令还定义了与服务器通信的<a hhref="ngx_http_upstream_module.html#max_fails">不成功尝试</a> 。   <code class="notranslate">error</code> ， <code class="notranslate">timeout</code>和<code class="notranslate">invalid_header</code>情况始终被视为不成功的尝试，即使它们未在指令中指定。   <code class="notranslate">http_500</code> ， <code class="notranslate">http_503</code>和<code class="notranslate">http_429</code>情况仅在指令中指定<code class="notranslate">http_429</code>被视为不成功尝试。   <code class="notranslate">http_403</code>和<code class="notranslate">http_404</code>情况从未被视为不成功的尝试。 </p><p>  将请求传递到下一个服务器可能会受到<a hhref="#fastcgi_next_upstream_tries">尝试次数</a>和<a hhref="#fastcgi_next_upstream_timeout">时间的限制</a> 。 </p><a name="fastcgi_next_upstream_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_next_upstream_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_next_upstream_timeout 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.5版本中。 </p></div><p>  限制请求可以传递到<a hhref="#fastcgi_next_upstream">下一个服务器的时间</a> 。   <code class="notranslate">0</code>值关闭此限制。 </p><a name="fastcgi_next_upstream_tries"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_next_upstream_tries</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_next_upstream_tries 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.5版本中。 </p></div><p>  限制将请求传递到<a hhref="#fastcgi_next_upstream">下一个服务器</a>的可能尝试次数。   <code class="notranslate">0</code>值关闭此限制。 </p><a name="fastcgi_no_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_no_cache</strong> <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义不将响应保存到缓存的条件。  如果字符串参数的至少一个值不为空且不等于“0”，则不会保存响应： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_no_cache $cookie_nocache $arg_nocache$arg_comment;
</code></pre><p>fastcgi_no_cache $http_pragma    $http_authorization;<br></p><p>  可以与<a hhref="#fastcgi_cache_bypass">fastcgi_cache_bypass</a>指令一起使用。 </p><a name="fastcgi_param"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_param</strong><br>    <code class="notranslate"><i>parameter</i></code> <code class="notranslate"><i>value</i></code><br>    [ <code class="notranslate">if_not_empty</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置应传递给FastCGI服务器的参数。  该&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt;可以包含文本，变量及其组合。  当且仅当在当前级别上没有定义&lt;code class=&quot;notranslate&quot;&gt;fastcgi_param&lt;/code&gt;指令时，这些指令才从前一级继承。 &lt;/p&gt;&lt;p&gt;  以下示例显示了PHP的最低必需设置： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_param SCRIPT_FILENAME /home/www/scripts/php$fastcgi_script_name;
</code></pre><p>fastcgi_param QUERY_STRING    $query_string;<br></p><p></p><p>   <code class="notranslate">SCRIPT_FILENAME</code>参数在PHP中用于确定脚本名称， <code class="notranslate">QUERY_STRING</code>参数用于传递请求参数。 </p><p>  对于处理<code class="notranslate">POST</code>请求的脚本，还需要以下三个参数： </p><blockquote class="example"><pre class="notranslate">fastcgi_param REQUEST_METHOD  $request_method;<br>fastcgi_param CONTENT_TYPE    $content_type;<br>fastcgi_param CONTENT_LENGTH  $content_length;<br></pre></blockquote><p></p><p>  如果PHP是使用<code class="notranslate">–enable-force-cgi-redirect</code>配置参数构建的，则还应使用值“200”传递<code class="notranslate">REDIRECT_STATUS</code>参数： </p><blockquote class="example"><pre class="notranslate">fastcgi_param REDIRECT_STATUS 200;<br></pre></blockquote><p></p><p>  如果使用<code class="notranslate">if_not_empty</code> （1.1.11）指定了该指令，则只有在其值不为空时，才会将此参数传递给服务器： </p><blockquote class="example"><pre class="notranslate">fastcgi_param HTTPS           $https if_not_empty;<br></pre></blockquote><p></p><a name="fastcgi_pass"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_pass</strong> <code class="notranslate"><i>address</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置FastCGI服务器的地址。  地址可以指定为域名或IP地址，以及端口： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;fastcgi_pass localhost:9000;
</code></pre><p></p><p>  或者作为UNIX域套接字路径： </p><blockquote class="example"><pre class="notranslate">fastcgi_pass unix:/tmp/fastcgi.socket;<br></pre></blockquote><p></p><p>  如果域名解析为多个地址，则所有这些地址都将以循环方式使用。  此外，可以将地址指定为<a hhref="ngx_http_upstream_module.html">服务器组</a> 。 </p><p>  参数值可以包含变量。  在这种情况下，如果将地址指定为域名，则在所描述的<a hhref="ngx_http_upstream_module.html">服务器组中</a>搜索名称，如果未找到，则使用<a hhref="ngx_http_core_module.html#resolver">解析器</a>确定。 </p><a name="fastcgi_pass_header"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_pass_header</strong> <code class="notranslate"><i>field</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许将FastCGI服务器上&lt;a hhref=&quot;#fastcgi_hide_header&quot;&gt;禁用的&lt;/a&gt;标头字段传递给客户端。 &lt;/p&gt;&lt;a name=&quot;fastcgi_pass_request_body&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_pass_request_body&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_pass_request_body on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指示是否将原始请求正文传递给FastCGI服务器。  另请参见&lt;a hhref=&quot;#fastcgi_pass_request_headers&quot;&gt;fastcgi_pass_request_headers&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;fastcgi_pass_request_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_pass_request_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_pass_request_headers on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指示原始请求的标头字段是否传递给FastCGI服务器。  另请参见&lt;a hhref=&quot;#fastcgi_pass_request_body&quot;&gt;fastcgi_pass_request_body&lt;/a&gt;指令。 &lt;/p&gt;&lt;a name=&quot;fastcgi_read_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_read_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_read_timeout 60s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义从FastCGI服务器读取响应的超时。  仅在两个连续的读操作之间设置超时，而不是为整个响应的传输。  如果FastCGI服务器在此时间内未传输任何内容，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;fastcgi_request_buffering&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_request_buffering&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_request_buffering on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用客户端请求正文的缓冲。 &lt;/p&gt;&lt;p&gt;  启用缓冲后，在将请求发送到FastCGI服务器之前，将从客户端&lt;a hhref=&quot;ngx_http_core_module.html#client_body_buffer_size&quot;&gt;读取&lt;/a&gt;整个请求正文。 &lt;/p&gt;&lt;p&gt;  禁用缓冲时，请求主体在收到时立即发送到FastCGI服务器。  在这种情况下，如果nginx已经开始发送请求主体，则无法将请求传递给&lt;a hhref=&quot;#fastcgi_next_upstream&quot;&gt;下一个服务器&lt;/a&gt; 。 &lt;/p&gt;&lt;a name=&quot;fastcgi_send_lowat&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_send_lowat&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_send_lowat 0;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  如果指令设置为非零值，则nginx将尝试通过使用&lt;a hhref=&quot;events.html#kqueue&quot;&gt;kqueue&lt;/a&gt;方法的&lt;code class=&quot;notranslate&quot;&gt;NOTE_LOWAT&lt;/code&gt;标志或具有指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt;的&lt;code class=&quot;notranslate&quot;&gt;SO_SNDLOWAT&lt;/code&gt;套接字选项来最小化到FastCGI服务器的传出连接上的发送操作数。 &lt;/p&gt;&lt;p&gt;  在Linux，Solaris和Windows上忽略此指令。 &lt;/p&gt;&lt;a name=&quot;fastcgi_send_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_send_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_send_timeout 60s;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置将请求传输到FastCGI服务器的超时。  仅在两个连续的写操作之间设置超时，而不是为整个请求的传输。  如果FastCGI服务器在此时间内未收到任何内容，则关闭连接。 &lt;/p&gt;&lt;a name=&quot;fastcgi_socket_keepalive&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_socket_keepalive&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;fastcgi_socket_keepalive off;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  配置到FastCGI服务器的传出连接的“TCP keepalive”行为。  默认情况下，操作系统的设置对套接字有效。  如果指令设置为值“ &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; ”，则为套接字打开&lt;code class=&quot;notranslate&quot;&gt;SO_KEEPALIVE&lt;/code&gt;套接字选项。 &lt;/p&gt;&lt;a name=&quot;fastcgi_split_path_info&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;fastcgi_split_path_info&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;regex&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义捕获&lt;code class=&quot;notranslate&quot;&gt;$fastcgi_path_info&lt;/code&gt;变量值的正则表达式。  正则表达式应该有两个捕获：第一个变为&lt;code class=&quot;notranslate&quot;&gt;$fastcgi_script_name&lt;/code&gt;变量的值，第二个变为&lt;code class=&quot;notranslate&quot;&gt;$fastcgi_path_info&lt;/code&gt;变量的值。  例如，使用这些设置 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location ~ ^(.+\.php)(.*)$ {
fastcgi_split_path_info       ^(.+\.php)(.*)$;
fastcgi_param SCRIPT_FILENAME /path/to/php$fastcgi_script_name;
fastcgi_param PATH_INFO       $fastcgi_path_info;
</code></pre><p></p><p>  和“ <code class="notranslate">/show.php/article/0001</code> ”请求， <code class="notranslate">SCRIPT_FILENAME</code>参数将等于“ <code class="notranslate">/path/to/php/show.php</code>参数将等于“ <code class="notranslate">/article/0001</code> ”。 </p><a name="fastcgi_store"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_store</strong><br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">off</code> |<br>    <code class="notranslate"><i>string</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_store off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  允许将文件保存到磁盘。   <code class="notranslate">on</code>参数使用与指令<a hhref="ngx_http_core_module.html#alias">别名</a>或<a hhref="ngx_http_core_module.html#root">root</a>对应的路径保存文件。   <code class="notranslate">off</code>参数禁用文件保存。  此外，可以使用带变量的<code class="notranslate"><i>string</i></code>显式设置文件名： </p><blockquote class="example"><pre class="notranslate">fastcgi_store /data/www$original_uri;<br></pre></blockquote><p></p><p>  根据接收到的“Last-Modified”响应头字段设置文件的修改时间。  首先将响应写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和持久性存储可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，由<a hhref="#fastcgi_temp_path">fastcgi_temp_path</a>指令设置的保存文件和保存临时文件的目录都放在同一文件系统上。 </p><p>  该指令可用于创建静态不可更改文件的本地副本，例如： </p><blockquote class="example"><pre class="notranslate">location /images/ {<br>    root                 /data/www;<br>    error_page           404 = /fetch$uri;<br>}<p></p>
<p>location /fetch/ {<br>    internal;</p>
<pre><code>fastcgi_pass         backend:9000;
...

fastcgi_store        on;
fastcgi_store_access user:rw group:rw all:r;
fastcgi_temp_path    /data/temp;

alias                /data/www/;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="fastcgi_store_access"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_store_access</strong> <code class="notranslate"><i>users</i></code> : <code class="notranslate"><i>permissions</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_store_access user:rw;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  为新创建的文件和目录设置访问权限，例如： </p><blockquote class="example"><pre class="notranslate">fastcgi_store_access user:rw group:rw all:r;<br></pre></blockquote><p></p><p>  如果指定了任何<code class="notranslate">group</code>或<code class="notranslate">all</code>访问权限，则可以省略<code class="notranslate">user</code>权限： </p><blockquote class="example"><pre class="notranslate">fastcgi_store_access group:rw all:r;<br></pre></blockquote><p></p><a name="fastcgi_temp_file_write_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_temp_file_write_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_temp_file_write_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当启用从FastCGI服务器到临时文件的响应缓冲时，限制一次写入临时文件的数据<code class="notranslate"><i>size</i></code> 。  默认情况下， <code class="notranslate"><i>size</i></code>由<a hhref="#fastcgi_buffer_size">fastcgi_buffer_size</a>和<a hhref="#fastcgi_buffers">fastcgi_buffers</a>指令设置的两个缓冲区限制。  临时文件的最大大小由<a hhref="#fastcgi_max_temp_file_size">fastcgi_max_temp_file_size</a>指令设置。 </p><a name="fastcgi_temp_path"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>fastcgi_temp_path</strong><br>    <code class="notranslate"><i>path</i></code><br>    [ <code class="notranslate"><i>level1</i></code><br>    [ <code class="notranslate"><i>level2</i></code><br>    [ <code class="notranslate"><i>level3</i></code> ]]];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">fastcgi_temp_path fastcgi_temp;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于存储临时文件的目录，其中包含从FastCGI服务器接收的数据。  在指定目录下最多可以使用三级子目录层次结构。  例如，在以下配置中 </p><blockquote class="example"><pre class="notranslate">fastcgi_temp_path /spool/nginx/fastcgi_temp 1 2;<br></pre></blockquote><p>  临时文件可能如下所示： </p><blockquote class="example"><pre class="notranslate">/spool/nginx/fastcgi_temp/ <strong>7</strong> / <strong>45</strong> /00000123 <strong>457</strong><br></pre></blockquote><p></p><p>  另请参见<a hhref="#fastcgi_cache_path">fastcgi_cache_path</a>指令的<code class="notranslate">use_temp_path</code>参数。 </p><a name="parameters"></a><center><h4>  传递给FastCGI服务器的参数 </h4></center><p>   HTTP请求标头字段作为参数传递给FastCGI服务器。  在作为FastCGI服务器运行的应用程序和脚本中，这些参数通常可用作环境变量。  例如，“User-Agent”标头字段作为<code class="notranslate">HTTP_USER_AGENT</code>参数传递。  除HTTP请求头字段外，还可以使用<a hhref="#fastcgi_param">fastcgi_param</a>指令传递任意参数。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_fastcgi_module</code>模块支持可用于使用<a hhref="#fastcgi_param">fastcgi_param</a>指令设置参数的嵌入变量： </p><dl class="compact"><dt id="var_fastcgi_script_name"> <code class="notranslate">$fastcgi_script_name</code> </dt> <dd>  请求URI，或者，如果URI以斜杠结尾，请求带有由附加的<a hhref="#fastcgi_index">fastcgi_index</a>指令配置的索引文件名的URI。  此变量可用于设置确定PHP中脚本名称的<code class="notranslate">SCRIPT_FILENAME</code>和<code class="notranslate">PATH_TRANSLATED</code>参数。  例如，对于具有以下指令的“ <code class="notranslate">/info/</code> ”请求 <blockquote class="example"><pre class="notranslate">fastcgi_index index.php;<br>fastcgi_param SCRIPT_FILENAME /home/www/scripts/php$fastcgi_script_name;<br></pre></blockquote>   <code class="notranslate">SCRIPT_FILENAME</code>参数将等于“ <code class="notranslate">/home/www/scripts/php/info/index.php</code> ”。 <p>  使用<a hhref="#fastcgi_split_path_info">fastcgi_split_path_info</a>指令时， <code class="notranslate">$fastcgi_script_name</code>变量等于指令设置的第一个捕获的值。 </p></dd><dt id="var_fastcgi_path_info"> <code class="notranslate">$fastcgi_path_info</code> </dt> <dd>   <a hhref="#fastcgi_split_path_info">fastcgi_split_path_info</a>指令设置的第二个捕获的值。  此变量可用于设置<code class="notranslate">PATH_INFO</code>参数。 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_f4f_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_f4f_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#f4f">f4f</a> <br>     <a hhref="#f4f_buffer_size">f4f_buffer_size</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_f4f_module</code>模块为Adobe HTTP动态流（HDS）提供服务器端支持。 </p><p>  该模块以“ <code class="notranslate">/videoSeg1-Frag1</code> ”形式实现HTTP动态流式处理请求的处理 - 使用<code class="notranslate">videoSeg1.f4x</code>索引文件从<code class="notranslate">videoSeg1.f4f</code>文件中提取所需的片段。  该模块是Apache的Adobe f4f模块（HTTP Origin Module）的替代品。 </p><p>  需要使用Adobe的f4fpackager进行常规预处理，有关详细信息，请参阅相关文档。 </p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location /video/ {<br>    f4f;<br>    …<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="f4f"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>f4f</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  打开周围位置的模块处理。 &lt;/p&gt;&lt;a name=&quot;f4f_buffer_size&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;f4f_buffer_size&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;f4f_buffer_size 512k;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置用于读取&lt;code class=&quot;notranslate&quot;&gt;.f4x&lt;/code&gt;索引文件的缓冲区的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;size&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_empty_gif_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_empty_gif_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#empty_gif">empty_gif</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_empty_gif<em>module</em></code>模块发出单像素透明GIF。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location = /.gif {<br>    empty_gif;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="empty_gif"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>empty_gif</strong> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  打开周围位置的模块处理。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_dav_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_dav_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#create_full_put_path">create_full_put_path</a> <br>     <a hhref="#dav_access">dav_access</a> <br>     <a hhref="#dav_methods">dav_methods</a> <br>     <a hhref="#min_delete_depth">min_delete_depth</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_dav_module</code>模块用于通过WebDAV协议进行文件管理自动化。  该模块处理HTTP和WebDAV方法PUT，DELETE，MKCOL，COPY和MOVE。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_dav_module</code>配置参数启用它。 </p><p></p><blockquote class="note">  需要其他WebDAV方法才能运行的WebDAV客户端不适用于此模块。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    root                  /data/www;<p></p>
<pre><code>client_body_temp_path /data/client_temp;

dav_methods PUT DELETE MKCOL COPY MOVE;

create_full_put_path  on;
dav_access            group:rw  all:r;

limit_except GET {
    allow 192.168.1.0/32;
    deny  all;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="create_full_put_path"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>create_full_put_path</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">create_full_put_path off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>   WebDAV规范仅允许在现有目录中创建文件。  该指令允许创建所有需要的中间目录。 </p><a name="dav_access"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>dav_access</strong> <code class="notranslate"><i>users</i></code> : <code class="notranslate"><i>permissions</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">dav_access user:rw;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  为新创建的文件和目录设置访问权限，例如： </p><blockquote class="example"><pre class="notranslate">dav_access user:rw group:rw all:r;<br></pre></blockquote><p></p><p>  如果指定了任何<code class="notranslate">group</code>或<code class="notranslate">all</code>访问权限，则可以省略<code class="notranslate">user</code>权限： </p><blockquote class="example"><pre class="notranslate">dav_access group:rw all:r;<br></pre></blockquote><p></p><a name="dav_methods"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>dav_methods</strong><br>    <code class="notranslate">off</code> | <code class="notranslate"><i>method</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">dav_methods off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  允许指定的HTTP和WebDAV方法。  参数<code class="notranslate">off</code>拒绝此模块处理的所有方法。  支持以下方法： <code class="notranslate">PUT</code> ， <code class="notranslate">DELETE</code> ， <code class="notranslate">MKCOL</code> ， <code class="notranslate">COPY</code>和<code class="notranslate">MOVE</code> 。 </p><p>  使用PUT方法上载的文件首先写入临时文件，然后重命名该文件。  从版本0.8.9开始，临时文件和持久性存储可以放在不同的文件系统上。  但是，请注意，在这种情况下，文件将跨两个文件系统复制，而不是廉价的重命名操作。  因此，建议对于任何给定位置，由<a hhref="ngx_http_core_module.html#client_body_temp_path">client_body_temp_path</a>指令设置的保存文件和保存临时文件的目录都放在同一文件系统上。 </p><p>  使用PUT方法创建文件时，可以通过在“Date”标题字段中传递修改日期来指定修改日期。 </p><a name="min_delete_depth"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>min_delete_depth</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">min_delete_depth 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  允许DELETE方法删除文件，前提是请求路径中的元素数不小于指定的数。  例如，指令 </p><blockquote class="example"><pre class="notranslate">min_delete_depth 4;<br></pre></blockquote><p>  允许删除请求中的文件 </p><blockquote class="example"><pre class="notranslate">/users/00/00/name<br>/users/00/00/name/pic.jpg<br>/users/00/00/page.html<br></pre></blockquote><p>  并否认删除 </p><blockquote class="example"><pre class="notranslate">/users/00/00<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_core_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_core_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#directives">Directives</a> <br>     <a hhref="#absolute_redirect">absolute_redirect</a> <br>     <a hhref="#aio">aio</a> <br>     <a hhref="#aio_write">aio_write</a> <br>     <a hhref="#alias">alias</a> <br>     <a hhref="#chunked_transfer_encoding">chunked_transfer_encoding</a> <br>     <a hhref="#client_body_buffer_size">client_body_buffer_size</a> <br>     <a hhref="#client_body_in_file_only">client_body_in_file_only</a> <br>     <a hhref="#client_body_in_single_buffer">client_body_in_single_buffer</a> <br>     <a hhref="#client_body_temp_path">client_body_temp_path</a> <br>     <a hhref="#client_body_timeout">client_body_timeout</a> <br>     <a hhref="#client_header_buffer_size">client_header_buffer_size</a> <br>     <a hhref="#client_header_timeout">client_header_timeout</a> <br>     <a hhref="#client_max_body_size">client_max_body_size</a> <br>     <a hhref="#connection_pool_size">connection_pool_size</a> <br>     <a hhref="#default_type">default_type</a> <br>     <a hhref="#directio">directio</a> <br>     <a hhref="#directio_alignment">directio_alignment</a> <br>     <a hhref="#disable_symlinks">disable_symlinks</a> <br>     <a hhref="#error_page">error_page</a> <br>     <a hhref="#etag">etag</a> <br>     <a hhref="#http">http</a> <br>     <a hhref="#if_modified_since">if_modified_since</a> <br>     <a hhref="#ignore_invalid_headers">ignore_invalid_headers</a> <br>     <a hhref="#internal">internal</a> <br>     <a hhref="#keepalive_disable">keepalive_disable</a> <br>     <a hhref="#keepalive_requests">keepalive_requests</a> <br>     <a hhref="#keepalive_timeout">keepalive_timeout</a> <br>     <a hhref="#large_client_header_buffers">large_client_header_buffers</a> <br>     <a hhref="#limit_except">limit_except</a> <br>     <a hhref="#limit_rate">limit_rate</a> <br>     <a hhref="#limit_rate_after">limit_rate_after</a> <br>     <a hhref="#lingering_close">lingering_close</a> <br>     <a hhref="#lingering_time">lingering_time</a> <br>     <a hhref="#lingering_timeout">lingering_timeout</a> <br>     <a hhref="#listen">listen</a> <br>     <a hhref="#location">location</a> <br>     <a hhref="#log_not_found">log_not_found</a> <br>     <a hhref="#log_subrequest">log_subrequest</a> <br>     <a hhref="#max_ranges">max_ranges</a> <br>     <a hhref="#merge_slashes">merge_slashes</a> <br>     <a hhref="#msie_padding">msie_padding</a> <br>     <a hhref="#msie_refresh">msie_refresh</a> <br>     <a hhref="#open_file_cache">open_file_cache</a> <br>     <a hhref="#open_file_cache_errors">open_file_cache_errors</a> <br>     <a hhref="#open_file_cache_min_uses">open_file_cache_min_uses</a> <br>     <a hhref="#open_file_cache_valid">open_file_cache_valid</a> <br>     <a hhref="#output_buffers">output_buffers</a> <br>     <a hhref="#port_in_redirect">port_in_redirect</a> <br>     <a hhref="#postpone_output">postpone_output</a> <br>     <a hhref="#read_ahead">read_ahead</a> <br>     <a hhref="#recursive_error_pages">recursive_error_pages</a> <br>     <a hhref="#request_pool_size">request_pool_size</a> <br>     <a hhref="#reset_timedout_connection">reset_timedout_connection</a> <br>     <a hhref="#resolver">resolver</a> <br>     <a hhref="#resolver_timeout">resolver_timeout</a> <br>     <a hhref="#root">root</a> <br>     <a hhref="#satisfy">satisfy</a> <br>     <a hhref="#send_lowat">send_lowat</a> <br>     <a hhref="#send_timeout">send_timeout</a> <br>     <a hhref="#sendfile">sendfile</a> <br>     <a hhref="#sendfile_max_chunk">sendfile_max_chunk</a> <br>     <a hhref="#server">server</a> <br>     <a hhref="#server_name">server_name</a> <br>     <a hhref="#server_name_in_redirect">server_name_in_redirect</a> <br>     <a hhref="#server_names_hash_bucket_size">server_names_hash_bucket_size</a> <br>     <a hhref="#server_names_hash_max_size">server_names_hash_max_size</a> <br>     <a hhref="#server_tokens">server_tokens</a> <br>     <a hhref="#subrequest_output_buffer_size">subrequest_output_buffer_size</a> <br>     <a hhref="#tcp_nodelay">tcp_nodelay</a> <br>     <a hhref="#tcp_nopush">tcp_nopush</a> <br>     <a hhref="#try_files">try_files</a> <br>     <a hhref="#types">types</a> <br>     <a hhref="#types_hash_bucket_size">types_hash_bucket_size</a> <br>     <a hhref="#types_hash_max_size">types_hash_max_size</a> <br>     <a hhref="#underscores_in_headers">underscores_in_headers</a> <br>     <a hhref="#variables_hash_bucket_size">variables_hash_bucket_size</a> <br>     <a hhref="#variables_hash_max_size">variables_hash_max_size</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="directives"></a><center><h4>  指令 </h4></center><a name="absolute_redirect"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>absolute_redirect</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">absolute_redirect on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.11.8版中。 </p></div><p>  如果禁用，nginx发出的重定向将是相对的。 </p><p>  另请参见<a hhref="#server_name_in_redirect">server_name_in_redirect</a>和<a hhref="#port_in_redirect">port_in_redirect</a>指令。 </p><a name="aio"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>aio</strong><br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">off</code> |<br>    <code class="notranslate">threads</code> [ <code class="notranslate">=</code> <code class="notranslate"><i>pool</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">aio off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在0.8.11版本中。 </p></div><p>  启用或禁用在FreeBSD和Linux上使用异步文件I / O（AIO）： </p><blockquote class="example"><pre class="notranslate">location /video/ {<br>    aio            on;<br>    output_buffers 1 64k;<br>}<br></pre></blockquote><p></p><p>  在FreeBSD上，可以从FreeBSD 4.3开始使用AIO。  在FreeBSD 11.0之前，AIO可以静态链接到内核： </p><blockquote class="example"><pre class="notranslate">options VFS_AIO<br></pre></blockquote><p>  或作为内核可加载模块动态加载： </p><blockquote class="example"><pre class="notranslate">kldload aio<br></pre></blockquote><p></p><p>  在Linux上，可以从内核版本2.6.22开始使用AIO。  此外，有必要启用<a hhref="#directio">directio</a> ，否则读取将被阻止： </p><blockquote class="example"><pre class="notranslate">location /video/ {<br>    aio            on;<br>    directio       512;<br>    output_buffers 1 128k;<br>}<br></pre></blockquote><p></p><p>  在Linux上， <a hhref="#directio">directio</a>只能用于读取在512字节边界（或XFS为4K）上对齐的块。  在阻塞模式下读取文件的未对齐结束。  对于字节范围请求和不是从文件开头的FLV请求也是如此：在文件开头和结尾读取未对齐数据将被阻塞。 </p><p>  当在Linux上启用AIO和<a hhref="#sendfile">sendfile时</a> ，AIO用于大于或等于<a hhref="#directio">directio</a>指令中指定大小的文件，而<a hhref="#sendfile">sendfile</a>用于较小大小的文件或禁用<a hhref="#directio">directio</a>时。 </p><blockquote class="example"><pre class="notranslate">location /video/ {<br>    sendfile       on;<br>    aio            on;<br>    directio       8m;<br>}<br></pre></blockquote><p></p><p>  最后，可以使用多线程（1.7.11）读取和<a hhref="#sendfile">发送</a>文件，而不会阻止工作进程： </p><blockquote class="example"><pre class="notranslate">location /video/ {<br>    sendfile       on;<br>    aio            threads;<br>}<br></pre></blockquote><p>  读取和发送文件操作被卸载到指定<a hhref="ngx_core_module.html#thread_pool">池的</a>线程。  如果省略池名称，则使用名称为“ <code class="notranslate">default</code> ”的池。  池名称也可以使用变量设置： </p><blockquote class="example"><pre class="notranslate">aio threads=pool$disk;<br></pre></blockquote><p>  默认情况下，禁用多线程，应使用<code class="notranslate">–with-threads</code>配置参数启用它。  目前，多线程仅与<a hhref="events.html#epoll">epoll</a> ， <a hhref="events.html#kqueue">kqueue</a>和<a hhref="events.html#eventport">eventport</a>方法兼容。  只在Linux上支持多线程文件发送。 </p><p>  另请参见<a hhref="#sendfile">sendfile</a>指令。 </p><a name="aio_write"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>aio_write</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">aio_write off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.9.13版本中。 </p></div><p>  如果启用了<a hhref="#aio">aio</a> ，则指定是否用于写入文件。  目前，这仅在使用<code class="notranslate">aio threads</code> ，并且仅限于使用从代理服务器接收的数据编写临时文件。 </p><a name="alias"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>alias</strong> <code class="notranslate"><i>path</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义指定位置的替换。  例如，使用以下配置 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location /i/ {
alias /data/w3/images/;
</code></pre><p>}<br></p><p>  根据“ <code class="notranslate">/i/top.gif</code> ”的请求，将发送文件<code class="notranslate">/data/w3/images/top.gif</code> 。 </p><p>   <code class="notranslate"><i>path</i></code>值可以包含变量， <code class="notranslate">$document_root</code>和<code class="notranslate">$realpath_root</code>除外。 </p><p>  如果在使用正则表达式定义的位置内使用<code class="notranslate">alias</code>则此类正则表达式应包含捕获，而<code class="notranslate">alias</code>应引用这些捕获（0.7.40），例如： </p><blockquote class="example"><pre class="notranslate">location ~ ^/users/(.+.(?:gif|jpe?g|png))$ {<br>    alias /data/w3/images/$1;<br>}<br></pre></blockquote><p></p><p>  当location匹配指令值的最后一部分时： </p><blockquote class="example"><pre class="notranslate">location /images/ {<br>    alias /data/w3/images/;<br>}<br></pre></blockquote><p>  最好使用<a hhref="#root">root</a>指令： </p><blockquote class="example"><pre class="notranslate">location /images/ {<br>    root /data/w3;<br>}<br></pre></blockquote><p></p><a name="chunked_transfer_encoding"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>chunked_transfer_encoding</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">chunked_transfer_encoding on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  允许在HTTP / 1.1中禁用分块传输编码。  尽管符合标准要求，但在使用软件无法支持分块编码时，它可能会派上用场。 </p><a name="client_body_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>client_body_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">client_body_buffer_size 8k|16k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置读取客户端请求正文的缓冲区大小。  如果请求主体大于缓冲区，则整个主体或仅其部分被写入<a hhref="#client_body_temp_path">临时文件</a> 。  默认情况下，缓冲区大小等于两个内存页。  这是x86上的8K，其他32位平台和x86-64。  在其他64位平台上通常为16K。 </p><a name="client_body_in_file_only"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>client_body_in_file_only</strong><br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">clean</code> |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">client_body_in_file_only off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  确定nginx是否应将整个客户端请求主体保存到文件中。  该指令可以在调试期间使用，或者在使用<code class="notranslate">$request_body_file</code>变量或模块<a hhref="ngx_http_perl_module.html">ngx_http_perl_module</a>的<a hhref="ngx_http_perl_module.html#methods">$ r-&gt; request_body_file</a>方法时使用。 </p><p>  设置为打开值<code class="notranslate">on</code> ，请求处理后不会删除临时文件。 </p><p>  值<code class="notranslate">clean</code>将导致删除请求处理后留下的临时文件。 </p><a name="client_body_in_single_buffer"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>client_body_in_single_buffer</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">client_body_in_single_buffer off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  确定nginx是否应将整个客户端请求主体保存在单个缓冲区中。  使用<code class="notranslate">$request_body</code>变量时，建议使用该指令，以保存所涉及的复制操作数。 </p><a name="client_body_temp_path"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>client_body_temp_path</strong><br>    <code class="notranslate"><i>path</i></code><br>    [ <code class="notranslate"><i>level1</i></code><br>    [ <code class="notranslate"><i>level2</i></code><br>    [ <code class="notranslate"><i>level3</i></code> ]]];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">client_body_temp_path client_body_temp;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义用于存储包含客户端请求主体的临时文件的目录。  在指定目录下最多可以使用三级子目录层次结构。  例如，在以下配置中 </p><blockquote class="example"><pre class="notranslate">client_body_temp_path /spool/nginx/client_temp 1 2;<br></pre></blockquote><p>  临时文件的路径可能如下所示： </p><blockquote class="example"><pre class="notranslate">/spool/nginx/client_temp/7/45/00000123457<br></pre></blockquote><p></p><a name="client_body_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>client_body_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">client_body_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义读取客户端请求正文的超时。  超时仅设置为两个连续读取操作之间的时间段，而不是整个请求主体的传输。  如果客户端在此时间内未传输任何内容，请求将以408（请求超时）错误终止。 </p><a name="client_header_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>client_header_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">client_header_buffer_size 1k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置缓冲区大小以读取客户端请求标头。  对于大多数请求，1K字节的缓冲区就足够了。  但是，如果请求包含长cookie或来自WAP客户端，则可能不适合1K。  如果请求行或请求头字段不适合此缓冲区，则分配由<a hhref="#large_client_header_buffers">large_client_header_buffers</a>指令配置的较大缓冲区。 </p><a name="client_header_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>client_header_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">client_header_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  定义读取客户端请求标头的超时。  如果客户端在此时间内未传输整个标头，请求将以408（请求超时）错误终止。 </p><a name="client_max_body_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>client_max_body_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">client_max_body_size 1m;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置客户端请求正文的最大允许大小，在“Content-Length”请求标头字段中指定。  如果请求中的大小超过配置的值，则会将413（请求实体太大）错误返回给客户端。  请注意，浏览器无法正确显示此错误。  将<code class="notranslate"><i>size</i></code>设置为0将禁用检查客户端请求正文大小。 </p><a name="connection_pool_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>connection_pool_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">connection_pool_size 256|512;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  允许精确调整每个连接的内存分配。  该指令对性能的影响最小，通常不应使用。  默认情况下，大小在32位平台上等于256字节，在64位平台上等于512字节。 </p><blockquote class="note">  在1.9.8版之前，所有平台上的默认值均为256。 </blockquote><p></p><a name="default_type"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>default_type</strong> <code class="notranslate"><i>mime-type</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">default_type text/plain;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  定义响应的默认MIME类型。  可以使用<a hhref="#types">types</a>指令设置文件扩展名到MIME类型的映射。 </p><a name="directio"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>directio</strong> <code class="notranslate"><i>size</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">directio off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在0.7.7版本中。 </p></div><p>  在读取大于或等于指定<code class="notranslate"><i>size</i></code>文件时，允许使用<code class="notranslate">O_DIRECT</code>标志（FreeBSD，Linux）， <code class="notranslate">F_NOCACHE</code>标志（macOS）或<code class="notranslate">directio()</code>函数（Solaris）。  该指令自动禁用（0.7.15）对给定请求使用<a hhref="#sendfile">sendfile</a> 。  它对于提供大型文件非常有用： </p><blockquote class="example"><pre class="notranslate">directio 4m;<br></pre></blockquote><p>  或者在Linux上使用<a hhref="#aio">aio</a>时。 </p><a name="directio_alignment"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>directio_alignment</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">directio_alignment 512;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在0.8.11版本中。 </p></div><p>  设置<a hhref="#directio">directio</a>的对齐方式。  在大多数情况下，512字节对齐就足够了。  但是，在Linux下使用XFS时，需要将其增加到4K。 </p><a name="disable_symlinks"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>disable_symlinks</strong> <code class="notranslate">off</code> ;</code> <br> <code class="notranslate"><strong>disable_symlinks</strong><br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">if_not_owner</code><br>    [ <code class="notranslate">from</code> = <code class="notranslate"><i>part</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">disable_symlinks off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.15版中。 </p></div><p>  确定打开文件时应如何处理符号链接： </p><dl class="compact"><dt> <code class="notranslate">off</code> </dt> <dd>  路径名中的符号链接是允许的，不会被选中。  这是默认行为。 </dd><dt> <code class="notranslate">on</code> </dt> <dd>  如果路径名的任何组件是符号链接，则拒绝访问文件。 </dd><dt> <code class="notranslate">if_not_owner</code> </dt> <dd>  如果路径名的任何组件是符号链接，并且链接指向的链接和对象具有不同的所有者，则拒绝访问文件。 </dd><dt>   <code class="notranslate">from</code> = <code class="notranslate"><i>part</i></code> </dt><dd>  检查符号链接（参数<code class="notranslate">on</code>和<code class="notranslate">if_not_owner</code> ）时，通常会检查路径名的所有组件。  通过另外指定<code class="notranslate">from</code> = <code class="notranslate"><i>part</i></code>参数，可以避免检查路径名的初始部分中的符号链接。  在这种情况下，仅从指定的初始部分后面的路径名组件检查符号链接。  如果该值不是检查的路径名的初始部分，则检查整个路径名，就好像根本没有指定此参数一样。  如果值与整个文件名匹配，则不检查符号链接。  参数值可以包含变量。 </dd></dl><p></p><p>  例： </p><blockquote class="example"><pre class="notranslate">disable_symlinks on from=$document_root;<br></pre></blockquote><p></p><p>  该指令仅适用于具有<code class="notranslate">openat()</code>和<code class="notranslate">fstatat()</code>接口的系统。  这些系统包括FreeBSD，Linux和Solaris的现代版本。 </p><p>  参数<code class="notranslate">on</code>和<code class="notranslate">if_not_owner</code>添加了处理开销。 </p><blockquote class="note">  在不支持仅为搜索打开目录的系统上，要使用这些参数，需要工作进程对所有正在检查的目录具有读取权限。 </blockquote><p></p><p></p><blockquote class="note">   <a hhref="ngx_http_autoindex_module.html">ngx_http_autoindex_module</a> ， <a hhref="ngx_http_random_index_module.html">ngx_http_random_index_module</a>和<a hhref="ngx_http_dav_module.html">ngx_http_dav_module</a>模块当前忽略此指令。 </blockquote><p></p><a name="error_page"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>error_page</strong><br>    <code class="notranslate"><i>code</i></code> …<br>    [ <code class="notranslate">=</code> [ <code class="notranslate"><i>response</i></code> ]]<br>    <code class="notranslate"><i>uri</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义将为指定错误显示的URI。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;uri&lt;/i&gt;&lt;/code&gt;值可以包含变量。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;error_page 404             /404.html;
</code></pre><p>error_page 500 502 503 504 /50x.html;<br></p><p></p><p>  这导致内部重定向到指定的<code class="notranslate"><i>uri</i></code> ，客户端请求方法更改为“ <code class="notranslate">GET</code> ”（对于“ <code class="notranslate">GET</code> ”和“ <code class="notranslate">HEAD</code> ”以外的所有方法）。 </p><p>  此外，可以使用“ <code class="notranslate">=</code> <code class="notranslate"><i>response</i></code> ”语法将响应代码更改为另一个，例如： </p><blockquote class="example"><pre class="notranslate">error_page 404 =200 /empty.gif;<br></pre></blockquote><p></p><p>  如果代理服务器或FastCGI / uwsgi / SCGI / gRPC服务器处理错误响应，并且服务器可能返回不同的响应代码（例如，200,302,401或404），则可以使用代码进行响应收益： </p><blockquote class="example"><pre class="notranslate">error_page 404 = /404.php;<br></pre></blockquote><p></p><p>  如果在内部重定向期间无需更改URI和方法，则可以将错误处理传递到命名位置： </p><blockquote class="example"><pre class="notranslate">location / {<br>    error_page 404 = @fallback;<br>}<p></p>
<p>location @fallback {<br>    proxy_pass <a href="http://backend" target="_blank" rel="noopener">http://backend</a>;<br>}<br></p></pre></blockquote><p></p><p></p><blockquote class="note">  如果<code class="notranslate"><i>uri</i></code>处理导致错误，则将上次发生的错误的状态代码返回给客户端。 </blockquote><p></p><p>  也可以使用URL重定向进行错误处理： </p><blockquote class="example"><pre class="notranslate">error_page 403      <a href="http://example.com/forbidden.html" target="_blank" rel="noopener">http://example.com/forbidden.html</a>;<br>error_page 404 =301 <a href="http://example.com/notfound.html" target="_blank" rel="noopener">http://example.com/notfound.html</a>;<br></pre></blockquote><p>  在这种情况下，默认情况下，响应代码302返回给客户端。  它只能更改为重定向状态代码之一（301,302,303,307和308）。 </p><blockquote class="note">  在版本1.1.16和1.0.13之前，代码307不被视为重定向。 </blockquote><p></p><blockquote class="note">  在版本1.13.0之前，代码308不被视为重定向。 </blockquote><p></p><p>  当且仅当在当前级别上没有定义<code class="notranslate">error_page</code>指令时，这些指令才从前一级继承。 </p><a name="etag"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>etag</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">etag on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.3.3版本中。 </p></div><p>  启用或禁用自动生成静态资源的“ETag”响应头字段。 </p><a name="http"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>http</strong> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  提供指定HTTP服务器指令的配置文件上下文。 &lt;/p&gt;&lt;a name=&quot;if_modified_since&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;if_modified_since&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;exact&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;before&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;if_modified_since exact;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.7.24版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  指定如何将响应的修改时间与“If-Modified-Since”请求标头字段中的时间进行比较： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  忽略“If-Modified-Since”请求头字段（0.7.34）; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;exact&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  完全符合; &lt;/dd&gt;&lt;dt&gt; &lt;code class=&quot;notranslate&quot;&gt;before&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  响应的修改时间小于或等于“If-Modified-Since”请求头字段中的时间。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;ignore_invalid_headers&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ignore_invalid_headers&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;ignore_invalid_headers on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  控制是否应忽略具有无效名称的标头字段。  有效名称由英文字母，数字，连字符和可能的下划线组成（由&lt;a hhref=&quot;#underscores_in_headers&quot;&gt;underscores_in_headers&lt;/a&gt;指令控制）。 &lt;/p&gt;&lt;p&gt;  如果在&lt;a hhref=&quot;#server&quot;&gt;服务器&lt;/a&gt;级别指定了该指令，则仅在服务器是默认服务器时使用其值。  指定的值也适用于侦听同一地址和端口的所有虚拟服务器。 &lt;/p&gt;&lt;a name=&quot;internal&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;internal&lt;/strong&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定给定位置只能用于内部请求。  对于外部请求，返回客户端错误404（未找到）。  内部请求如下： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;  由&lt;a hhref=&quot;#error_page&quot;&gt;error_page&lt;/a&gt; ， &lt;a hhref=&quot;ngx_http_index_module.html#index&quot;&gt;index&lt;/a&gt; ， &lt;a hhref=&quot;ngx_http_random_index_module.html#random_index&quot;&gt;random_index&lt;/a&gt;和&lt;a hhref=&quot;#try_files&quot;&gt;try_files&lt;/a&gt;指令重定向的请求; &lt;/li&gt;&lt;li&gt;  来自上游服务器的“X-Accel-Redirect”响应头字段重定向的请求; &lt;/li&gt;&lt;li&gt;  由&lt;a hhref=&quot;ngx_http_ssi_module.html&quot;&gt;ngx_http_ssi_module&lt;/a&gt;模块的“ &lt;code class=&quot;notranslate&quot;&gt;include virtual&lt;/code&gt; ”命令， &lt;a hhref=&quot;ngx_http_addition_module.html&quot;&gt;ngx_http_addition_module&lt;/a&gt;模块指令以及&lt;a hhref=&quot;ngx_http_auth_request_module.html#auth_request&quot;&gt;auth_request&lt;/a&gt;和&lt;a hhref=&quot;ngx_http_mirror_module.html#mirror&quot;&gt;mirror&lt;/a&gt;指令形成的子请求; &lt;/li&gt;&lt;li&gt;  请求由&lt;a hhref=&quot;ngx_http_rewrite_module.html#rewrite&quot;&gt;重写&lt;/a&gt;指令更改。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;error_page 404 /404.html;
</code></pre><p>location = /404.html {<br>    internal;<br>}<br></p><p></p><blockquote class="note">  每个请求最多有10个内部重定向，以防止在错误配置中发生的请求处理周期。  如果达到此限制，则返回错误500（内部服务器错误）。  在这种情况下，可以在错误日志中看到“重写或内部重定向周期”消息。 </blockquote><p></p><a name="keepalive_disable"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>keepalive_disable</strong> <code class="notranslate">none</code> | <code class="notranslate"><i>browser</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">keepalive_disable msie6;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  禁用与行为不当的浏览器保持连接状态。   <code class="notranslate"><i>browser</i></code>参数指定将受影响的浏览器。  一旦收到POST请求，值<code class="notranslate">msie6</code>将禁用与旧版本MSIE的保持活动连接。  值<code class="notranslate">safari</code>禁用与macOS和类似macOS的操作系统上的Safari和类似Safari的浏览器的保持活动连接。  值<code class="notranslate">none</code>与所有浏览器保持连接。 </p><blockquote class="note">  在版本1.1.18之前，值<code class="notranslate">safari</code>与所有操作系统上的所有Safari和类似Safari的浏览器相匹配，默认情况下禁用与它们保持连接的连接。 </blockquote><p></p><a name="keepalive_requests"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>keepalive_requests</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">keepalive_requests 100;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在0.8.0版本中。 </p></div><p>  设置可通过一个保持活动连接提供的最大请求数。  在发出最大请求数后，将关闭连接。 </p><a name="keepalive_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>keepalive_timeout</strong><br>    <code class="notranslate"><i>timeout</i></code><br>    [ <code class="notranslate"><i>header_timeout</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">keepalive_timeout 75s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  第一个参数设置一个超时，在此期间保持活动的客户端连接将在服务器端保持打开状态。  零值禁用保持活动的客户端连接。  可选的第二个参数在“Keep-Alive：timeout = <code class="notranslate"><i>time</i></code> ”响应头字段中设置一个值。  两个参数可能不同。 </p><p>   Mozilla和Konqueror识别“Keep-Alive：timeout = <code class="notranslate"><i>time</i></code> ”标题字段。   MSIE在大约60秒内自行关闭保持连接。 </p><a name="large_client_header_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>large_client_header_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">large_client_header_buffers 4 8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于读取大客户机请求标头的缓冲区的最大<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> 。  请求行不能超过一个缓冲区的大小，否则会将414（Request-URI Too Large）错误返回给客户端。  请求头字段也不能超过一个缓冲区的大小，或者400（错误请求）错误返回给客户端。  缓冲区仅按需分配。  默认情况下，缓冲区大小等于8K字节。  如果在请求处理结束后连接转换为保持活动状态，则释放这些缓冲区。 </p><a name="limit_except"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_except</strong> <code class="notranslate"><i>method</i></code> … { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  限制允许位置内的HTTP方法。   &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;method&lt;/i&gt;&lt;/code&gt;参数可以是以下之一： &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;PUT&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;MKCOL&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;COPY&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;MOVE&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;OPTIONS&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;PROPFIND&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;PROPPATCH&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;LOCK&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;UNLOCK&lt;/code&gt;或&lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; 。  允许&lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt;方法也允许使用&lt;code class=&quot;notranslate&quot;&gt;HEAD&lt;/code&gt;方法。  使用&lt;a hhref=&quot;ngx_http_access_module.html&quot;&gt;ngx_http_access_module&lt;/a&gt; ， &lt;a hhref=&quot;ngx_http_auth_basic_module.html&quot;&gt;ngx_http_auth_basic_module&lt;/a&gt;和&lt;a hhref=&quot;ngx_http_auth_jwt_module.html&quot;&gt;ngx_http_auth_jwt_module&lt;/a&gt; （1.13.10）模块指令可以限制对其他方法的访问： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;limit_except GET {
allow 192.168.1.0/32;
deny  all;
</code></pre><p>}<br></p><p>  请注意，这将限制对<strong>除</strong> GET和HEAD <strong>之外的</strong>所有方法的访问。 </p><a name="limit_rate"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_rate</strong> <code class="notranslate"><i>rate</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">limit_rate 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br><br>                </td></tr></tbody></table></div><p>  限制向客户端传输的响应速率。   <code class="notranslate"><i>rate</i></code>以每秒字节数指定。  零值禁用速率限制。  根据请求设置限制，因此如果客户端同时打开两个连接，则总速率将是指定限制的两倍。 </p><p>  也可以在<code class="notranslate">$limit_rate</code>变量中设置速率限制。  在根据特定条件限制费率的情况下，它可能很有用： </p><blockquote class="example"><pre class="notranslate">server {<p></p>
<pre><code>if ($slow) {
    set $limit_rate 4k;
}

...
</code></pre><p>}<br></p></pre></blockquote><p></p><p>  还可以在代理服务器响应的“X-Accel-Limit-Rate”头字段中设置速率限制。  可以使用<a hhref="ngx_http_proxy_module.html#proxy_ignore_headers">proxy_ignore_headers</a> ， <a hhref="ngx_http_fastcgi_module.html#fastcgi_ignore_headers">fastcgi_ignore_headers</a> ， <a hhref="ngx_http_uwsgi_module.html#uwsgi_ignore_headers">uwsgi_ignore_headers</a>和<a hhref="ngx_http_scgi_module.html#scgi_ignore_headers">scgi_ignore_headers</a>指令禁用此功能。 </p><a name="limit_rate_after"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>limit_rate_after</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">limit_rate_after 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在0.8.0版本中。 </p></div><p>  设置初始量，在此之后，对客户端的响应的进一步传输将受到速率限制。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">location /flv/ {<br>    flv;<br>    limit_rate_after 500k;<br>    limit_rate       50k;<br>}<br></pre></blockquote><p></p><a name="lingering_close"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>lingering_close</strong><br>    <code class="notranslate">off</code> |<br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">always</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">lingering_close on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.0和1.0.6版本中。 </p></div><p>  控制nginx如何关闭客户端连接。 </p><p>  默认值“ <code class="notranslate">on</code> ”指示nginx在完全关闭连接之前<a hhref="#lingering_timeout">等待</a>并<a hhref="#lingering_time">处理</a>来自客户端的其他数据，但仅当启发式表明客户端可能正在发送更多数据时。 </p><p>  值“ <code class="notranslate">always</code> ”将导致nginx无条件地等待并处理其他客户端数据。 </p><p>  值“ <code class="notranslate">off</code> ”告诉nginx永远不要等待更多数据并立即关闭连接。  此行为会破坏协议，不应在正常情况下使用。 </p><a name="lingering_time"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>lingering_time</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">lingering_time 30s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当<a hhref="#lingering_close">lingering_close</a>生效时，此指令指定nginx处理（读取和忽略）来自客户端的其他数据的最长时间。  之后，即使有更多数据，连接也将关闭。 </p><a name="lingering_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>lingering_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">lingering_timeout 5s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  当<a hhref="#lingering_close">lingering_close</a>生效时，此指令指定更多客户端数据到达的最长等待时间。  如果在此期间未收到数据，则关闭连接。  否则，将读取并忽略数据，并且nginx会再次开始等待更多数据。  重复“wait-read-ignore”循环，但不会超过<a hhref="#lingering_time">lingering_time</a>指令指定的循环。 </p><a name="listen"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>listen</strong><br>    <code class="notranslate"><i>address</i></code> [: <code class="notranslate"><i>port</i></code> ]<br>    [ <code class="notranslate">default_server</code> ]<br>    [ <code class="notranslate">ssl</code> ]<br>    [ <code class="notranslate">http2</code> | <code class="notranslate">spdy</code> ]<br>    [ <code class="notranslate">proxy_protocol</code> ]<br>    [ <code class="notranslate">setfib</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">fastopen</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">accept_filter</code> = <code class="notranslate"><i>filter</i></code> ]<br>    [ <code class="notranslate">deferred</code> ]<br>    [ <code class="notranslate">bind</code> ]<br>    [ <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> ]<br>    [ <code class="notranslate">reuseport</code> ]<br>    [ <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> |[ <code class="notranslate"><i>keepidle</i></code> ]:[ <code class="notranslate"><i>keepintvl</i></code> ]:[ <code class="notranslate"><i>keepcnt</i></code> ]];</code> <br> <code class="notranslate"><strong>listen</strong><br>    <code class="notranslate"><i>port</i></code><br>    [ <code class="notranslate">default_server</code> ]<br>    [ <code class="notranslate">ssl</code> ]<br>    [ <code class="notranslate">http2</code> | <code class="notranslate">spdy</code> ]<br>    [ <code class="notranslate">proxy_protocol</code> ]<br>    [ <code class="notranslate">setfib</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">fastopen</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">accept_filter</code> = <code class="notranslate"><i>filter</i></code> ]<br>    [ <code class="notranslate">deferred</code> ]<br>    [ <code class="notranslate">bind</code> ]<br>    [ <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> ]<br>    [ <code class="notranslate">reuseport</code> ]<br>    [ <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> |[ <code class="notranslate"><i>keepidle</i></code> ]:[ <code class="notranslate"><i>keepintvl</i></code> ]:[ <code class="notranslate"><i>keepcnt</i></code> ]];</code> <br> <code class="notranslate"><strong>listen</strong><br>    <code class="notranslate">unix:</code> <code class="notranslate"><i>path</i></code><br>    [ <code class="notranslate">default_server</code> ]<br>    [ <code class="notranslate">ssl</code> ]<br>    [ <code class="notranslate">http2</code> | <code class="notranslate">spdy</code> ]<br>    [ <code class="notranslate">proxy_protocol</code> ]<br>    [ <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> ]<br>    [ <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> ]<br>    [ <code class="notranslate">accept_filter</code> = <code class="notranslate"><i>filter</i></code> ]<br>    [ <code class="notranslate">deferred</code> ]<br>    [ <code class="notranslate">bind</code> ]<br>    [ <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> |[ <code class="notranslate"><i>keepidle</i></code> ]:[ <code class="notranslate"><i>keepintvl</i></code> ]:[ <code class="notranslate"><i>keepcnt</i></code> ]];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">listen <em>:80 | </em>:8000;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  设置IP的<code class="notranslate"><i>address</i></code>和<code class="notranslate"><i>port</i></code> ，或服务器将接受请求的UNIX域套接字的<code class="notranslate"><i>path</i></code> 。  可以指定<code class="notranslate"><i>address</i></code>和<code class="notranslate"><i>port</i></code> ，或仅指定<code class="notranslate"><i>address</i></code>或仅<code class="notranslate"><i>port</i></code> 。   <code class="notranslate"><i>address</i></code>也可以是主机名，例如： </p><blockquote class="example"><pre class="notranslate">listen 127.0.0.1:8000;<br>listen 127.0.0.1;<br>listen 8000;<br>listen <em>:8000;<br>listen localhost:8000;<br></em></pre></blockquote><p>   IPv6地址（0.7.36）在方括号中指定： </p><blockquote class="example"><pre class="notranslate">listen [::]:8000;<br>listen [::1];<br></pre></blockquote><p>   UNIX域套接字（0.8.21）使用“ <code class="notranslate">unix:</code> ”前缀指定： </p><blockquote class="example"><pre class="notranslate">listen unix:/var/run/nginx.sock;<br></pre></blockquote><p></p><p>  如果仅给出<code class="notranslate"><i>address</i></code> ，则使用端口80。 </p><p>  如果指令不存在，那么如果nginx以超级用户权限运行，则使用<code class="notranslate">:80</code> ，否则使用<code class="notranslate"><em>:8000</em></code> 。 </p><p>   <code class="notranslate">default_server</code>参数（如果存在）将使服务器成为指定<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对的默认服务器。  如果没有任何指令具有<code class="notranslate">default_server</code>参数，则具有<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对的第一个服务器将成为该对的默认服务器。 </p><blockquote class="note">  在0.8.21之前的版本中，此参数仅命名为<code class="notranslate">default</code> 。 </blockquote><p></p><p>   <code class="notranslate">ssl</code>参数（0.7.14）允许指定此端口上接受的所有连接都应在SSL模式下工作。  这样可以为处理HTTP和HTTPS请求的服务器提供更紧凑的<a hhref="configuring_https_servers.html#single_http_https_server">配置</a> 。 </p><p>   <code class="notranslate">http2</code>参数（1.9.5）将端口配置为接受<a hhref="ngx_http_v2_module.html">HTTP / 2</a>连接。  通常，为了使其工作，也应该指定<code class="notranslate">ssl</code>参数，但是也可以将nginx配置为接受没有SSL的HTTP / 2连接。 </p><p>   <code class="notranslate">spdy</code>参数（1.3.15-1.9.4）允许接受此端口上的<a hhref="ngx_http_spdy_module.html">SPDY</a>连接。  通常，为了使其工作，还应指定<code class="notranslate">ssl</code>参数，但也可以将nginx配置为接受不带SSL的SPDY连接。 </p><p>   <code class="notranslate">proxy_protocol</code>参数（1.5.12）允许指定此端口上接受的所有连接都应使用<a hhref="http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt">PROXY协议</a> 。 </p><blockquote class="note">  自版本1.13.11起支持PROXY协议版本2。 </blockquote><p></p><p>   <code class="notranslate">listen</code>指令可以有几个特定于与套接字相关的系统调用的附加参数。  这些参数可以在任何<code class="notranslate">listen</code>指令中指定，但对于给定的<code class="notranslate"><i>address</i></code>只能指定一次： <code class="notranslate"><i>port</i></code>对。 </p><blockquote class="note">  在0.8.21之前的版本中，它们只能在<code class="notranslate">listen</code>指令中与<code class="notranslate">default</code>参数一起指定。 </blockquote><p></p><dl class="compact"><dt>   <code class="notranslate">setfib</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  此参数（0.8.44）设置侦听套接字的关联路由表FIB（ <code class="notranslate">SO_SETFIB</code>选项）。  这目前仅适用于FreeBSD。 </dd><dt>   <code class="notranslate">fastopen</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  为侦听套接字启用“ <a hhref="http://en.wikipedia.org/wiki/TCP_Fast_Open">TCP Fast Open</a> ”（1.5.8）并<a hhref="https://tools.ietf.org/html/rfc7413#section-5.1">限制</a>尚未完成三次握手的连接队列的最大长度。 <blockquote class="note">  除非服务器可以处理多次<a hhref="https://tools.ietf.org/html/rfc7413#section-6.1">使用数据</a>的<a hhref="https://tools.ietf.org/html/rfc7413#section-6.1">同一SYN数据包，</a>否则不要启用此功能。 </blockquote></dd><dt>   <code class="notranslate">backlog</code> = <code class="notranslate"><i>number</i></code> </dt><dd>  在<code class="notranslate">listen()</code>调用中设置<code class="notranslate">backlog</code>参数，该参数限制挂起连接队列的最大长度。  默认情况下， <code class="notranslate">backlog</code>在FreeBSD，DragonFly BSD和macOS上设置为-1，在其他平台上设置为511。 </dd><dt>   <code class="notranslate">rcvbuf</code> = <code class="notranslate"><i>size</i></code> </dt><dd>  设置侦听套接字的接收缓冲区大小（ <code class="notranslate">SO_RCVBUF</code>选项）。 </dd><dt>   <code class="notranslate">sndbuf</code> = <code class="notranslate"><i>size</i></code> </dt><dd>  设置侦听套接字的发送缓冲区大小（ <code class="notranslate">SO_SNDBUF</code>选项）。 </dd><dt>   <code class="notranslate">accept_filter</code> = <code class="notranslate"><i>filter</i></code> </dt><dd>  为侦听套接字设置接受过滤器的名称（ <code class="notranslate">SO_ACCEPTFILTER</code>选项），该套接字在将传入连接传递给<code class="notranslate">accept()</code>之前对其进行过滤。  这仅适用于FreeBSD和NetBSD 5.0+。  可能的值是<a hhref="http://man.freebsd.org/accf_data">dataready</a>和<a hhref="http://man.freebsd.org/accf_http">httpready</a> 。 </dd><dt> <code class="notranslate">deferred</code> </dt> <dd>  指示在Linux上使用延迟的<code class="notranslate">accept()</code> （ <code class="notranslate">TCP_DEFER_ACCEPT</code>套接字选项）。 </dd><dt> <code class="notranslate">bind</code> </dt> <dd>  指示对给定<code class="notranslate"><i>address</i></code>进行单独的<code class="notranslate">bind()</code>调用： <code class="notranslate"><i>port</i></code>对。  这很有用，因为如果有几个具有相同端口但不同地址的<code class="notranslate">listen</code>指令，并且其中一个<code class="notranslate">listen</code>指令侦听给定端口（ <code class="notranslate">:</code> <code class="notranslate"><i>port</i></code> ）的所有地址，则nginx将<code class="notranslate">bind()</code>仅限于<code class="notranslate"><em>:</em></code> <code class="notranslate"><i>port</i></code> 。  应该注意的是，在这种情况下将进行<code class="notranslate">getsockname()</code>系统调用以确定接受连接的地址。  如果使用<code class="notranslate">setfib</code> ， <code class="notranslate">backlog</code> ， <code class="notranslate">rcvbuf</code> ， <code class="notranslate">sndbuf</code> ， <code class="notranslate">accept_filter</code> ， <code class="notranslate">deferred</code> ， <code class="notranslate">ipv6only</code>或<code class="notranslate">so_keepalive</code>参数，那么对于给定的<code class="notranslate"><i>address</i></code> ： <code class="notranslate"><i>port</i></code>对将始终进行单独的<code class="notranslate">bind()</code>调用。 </dd><dt>   <code class="notranslate">ipv6only</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> </dt><dd>  此参数（0.7.42）确定（通过<code class="notranslate">IPV6_V6ONLY</code>套接字选项）侦听通配符地址<code class="notranslate">[::]</code>的IPv6套接字是仅接受IPv6连接还是仅接受IPv6和IPv4连接。  默认情况下，此参数处于启用状态。  它只能在开始时设置一次。 <blockquote class="note">  在1.3.4版之前，如果省略此参数，则操作系统的设置对套接字有效。 </blockquote></dd><dt id="reuseport"> <code class="notranslate">reuseport</code> </dt> <dd>  此参数（1.9.1）指示为每个工作进程创建一个单独的侦听套接字（使用Linux 3.9+和DragonFly BSD上的<code class="notranslate">SO_REUSEPORT</code>套接字选项，或FreeBSD 12+上的<code class="notranslate">SO_REUSEPORT_LB</code> ），允许内核在工作进程之间分配传入连接。  目前仅适用于Linux 3.9 +，DragonFly BSD和FreeBSD 12+（1.15.1）。 <blockquote class="note">  不恰当地使用此选项可能会产生安全<a hhref="http://man7.org/linux/man-pages/man7/socket.7.html">隐患</a> 。 </blockquote></dd><dt>   <code class="notranslate">so_keepalive</code> = <code class="notranslate">on</code> |   <code class="notranslate">off</code> | [ <code class="notranslate"><i>keepidle</i></code> ]：[ <code class="notranslate"><i>keepintvl</i></code> ]：[ <code class="notranslate"><i>keepcnt</i></code> ] </dt><dd>  此参数（1.1.11）配置侦听套接字的“TCP keepalive”行为。  如果省略此参数，则操作系统的设置将对套接字有效。  如果将其设置为值“ <code class="notranslate">on</code> ”，则为套接字打开<code class="notranslate">SO_KEEPALIVE</code>选项。  如果将其设置为值“ <code class="notranslate">off</code> ”，则为套接字关闭<code class="notranslate">SO_KEEPALIVE</code>选项。  某些操作系统支持使用<code class="notranslate">TCP_KEEPIDLE</code> ， <code class="notranslate">TCP_KEEPINTVL</code>和<code class="notranslate">TCP_KEEPCNT</code>套接字选项在每个套接字的基础上设置TCP keepalive参数。  在这样的系统上（目前，Linux 2.4 +，NetBSD 5+和FreeBSD 9.0-STABLE），可以使用<code class="notranslate"><i>keepidle</i></code> ， <code class="notranslate"><i>keepintvl</i></code>和<code class="notranslate"><i>keepcnt</i></code>参数配置它们。  可以省略一个或两个参数，在这种情况下，相应套接字选项的系统默认设置将生效。  例如， <blockquote class="example"><pre class="notranslate">so_keepalive=30m::10</pre></blockquote>  将空闲超时（ <code class="notranslate">TCP_KEEPIDLE</code> ）设置为30分钟，将探测间隔（ <code class="notranslate">TCP_KEEPINTVL</code> ）保留为系统默认值，并将探测计数（ <code class="notranslate">TCP_KEEPCNT</code> ）设置为10个探测。 </dd></dl><p></p><p>  例： </p><blockquote class="example"><pre class="notranslate">listen 127.0.0.1 default_server accept_filter=dataready backlog=1024;<br></pre></blockquote><p></p><a name="location"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>location</strong> [<br>    <code class="notranslate">=</code> |<br>    <code class="notranslate">~</code> |<br>    <code class="notranslate">~</code> |<br>    <code class="notranslate">^~</code><br>    ] <code class="notranslate"><i>uri</i></code> { … }</code> <br> <code class="notranslate"><strong>location</strong> <code class="notranslate">@</code> <code class="notranslate"><i>name</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  根据请求URI设置配置。 &lt;/p&gt;&lt;p&gt;  在解码以“ &lt;code class=&quot;notranslate&quot;&gt;%XX&lt;/code&gt; ”形式编码的文本，解析对相对路径分量的引用之后，针对规范化的URI执行匹配&lt;code class=&quot;notranslate&quot;&gt;.&lt;/code&gt;   “和” &lt;code class=&quot;notranslate&quot;&gt;..&lt;/code&gt; “，并且可能&lt;a hhref=&quot;#merge_slashes&quot;&gt;将&lt;/a&gt;两个或多个相邻斜线&lt;a hhref=&quot;#merge_slashes&quot;&gt;压缩&lt;/a&gt;成单个斜线。 &lt;/p&gt;&lt;p&gt;  位置可以由前缀字符串或正则表达式定义。  正则表达式使用前面的“ &lt;code class=&quot;notranslate&quot;&gt;~*&lt;/code&gt; ”修饰符（用于不区分大小写的匹配）或“ &lt;code class=&quot;notranslate&quot;&gt;~&lt;/code&gt; ”修饰符（用于区分大小写的匹配）指定。  为了找到与给定请求匹配的位置，nginx首先检查使用前缀字符串（前缀位置）定义的位置。  其中，选择并记住具有最长匹配前缀的位置。  然后按照它们在配置文件中的出现顺序检查正则表达式。  正则表达式的搜索在第一个匹配时终止，并使用相应的配置。  如果未找到与正则表达式的匹配，则使用先前记住的前缀位置的配置。 &lt;/p&gt;&lt;p&gt;  可以嵌套&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt;块，但下面提到了一些例外情况。 &lt;/p&gt;&lt;p&gt;  对于不区分大小写的操作系统（如macOS和Cygwin），与前缀字符串匹配会忽略大小写（0.7.7）。  但是，比较仅限于一个字节的区域设置。 &lt;/p&gt;&lt;p&gt;  正则表达式可以包含稍后可以在其他指令中使用的捕获（0.7.40）。 &lt;/p&gt;&lt;p&gt;  如果最长匹配前缀位置具有“ &lt;code class=&quot;notranslate&quot;&gt;^~&lt;/code&gt; ”修饰符，则不检查正则表达式。 &lt;/p&gt;&lt;p&gt;  此外，使用“ &lt;code class=&quot;notranslate&quot;&gt;=&lt;/code&gt; ”修饰符可以定义URI和位置的精确匹配。  如果找到完全匹配，则搜索终止。  例如，如果频繁发生“ &lt;code class=&quot;notranslate&quot;&gt;/&lt;/code&gt; ”请求，则定义“ &lt;code class=&quot;notranslate&quot;&gt;location = /&lt;/code&gt; ”将加速这些请求的处理，因为搜索在第一次比较之后立即终止。  这样的位置显然不能包含嵌套位置。 &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在0.7.1到0.8.41的版本中，如果请求与前缀位置匹配而没有“ &lt;code class=&quot;notranslate&quot;&gt;=&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;^~&lt;/code&gt; ”修饰符，则搜索也会终止，并且不会检查正则表达式。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  让我们通过一个例子来说明以上内容： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location = / {
[ configuration A ]
</code></pre><p>}</p>
<p>location / {<br>    [ configuration B ]<br>}</p>
<p>location /documents/ {<br>    [ configuration C ]<br>}</p>
<p>location ^~ /images/ {<br>    [ configuration D ]<br>}</p>
<p>location ~* .(gif|jpg|jpeg)$ {<br>    [ configuration E ]<br>}<br></p><p>   “ <code class="notranslate">/</code> ”请求将匹配配置A，“/ <code class="notranslate">/index.html</code> ”请求将匹配配置B，“/ <code class="notranslate">/documents/document.html</code> ”请求将匹配配置C，“/ <code class="notranslate">/images/1.gif</code> ”请求将匹配配置D，“/ <code class="notranslate">/documents/1.jpg</code> ”请求将匹配配置E. </p><p>   “ <code class="notranslate">@</code> ”前缀定义了命名位置。  这样的位置不用于常规请求处理，而是用于请求重定向。  它们不能嵌套，也不能包含嵌套位置。 </p><p>  如果位置由以斜杠字符结尾的前缀字符串定义，并且请求由<a hhref="ngx_http_proxy_module.html#proxy_pass">proxy_pass</a> ， <a hhref="ngx_http_fastcgi_module.html#fastcgi_pass">fastcgi_pass</a> ， <a hhref="ngx_http_uwsgi_module.html#uwsgi_pass">uwsgi_pass</a> ， <a hhref="ngx_http_scgi_module.html#scgi_pass">scgi_pass</a> ， <a hhref="ngx_http_memcached_module.html#memcached_pass">memcached_pa​​ss</a>或<a hhref="ngx_http_grpc_module.html#grpc_pass">grpc_pass之一</a>处理，则执行特殊处理。  为了响应URI等于此字符串但没有尾部斜杠的请求，带有代码301的永久重定向将返回到请求的URI，并附加斜杠。  如果不需要，可以像下面这样定义URI和位置的完全匹配： </p><blockquote class="example"><pre class="notranslate">location /user/ {<br>    proxy_pass <a href="http://user.example.com" target="_blank" rel="noopener">http://user.example.com</a>;<br>}<p></p>
<p>location = /user {<br>    proxy_pass <a href="http://login.example.com" target="_blank" rel="noopener">http://login.example.com</a>;<br>}<br></p></pre></blockquote><p></p><a name="log_not_found"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>log_not_found</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">log_not_found on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用将未找到的文件的错误记录到<a hhref="ngx_core_module.html#error_log">error_log中</a> 。 </p><a name="log_subrequest"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>log_subrequest</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">log_subrequest off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用将子请求记录到<a hhref="ngx_http_log_module.html#access_log">access_log中</a> 。 </p><a name="max_ranges"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>max_ranges</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.1.2版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  限制字节范围请求中允许的最大范围数。  超出限制的请求将被处理，就像没有指定字节范围一样。  默认情况下，范围数量不受限制。  零值完全禁用字节范围支持。 &lt;/p&gt;&lt;a name=&quot;merge_slashes&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;merge_slashes&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;on&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;off&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;merge_slashes on;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  启用或禁用将URI中的两个或多个相邻斜杠压缩为单个斜杠。 &lt;/p&gt;&lt;p&gt;  请注意，压缩对于正确匹配前缀字符串和正则表达式位置至关重要。  没有它，“ &lt;code class=&quot;notranslate&quot;&gt;//scripts/one.php&lt;/code&gt; ”请求将不匹配 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location /scripts/ {
...
</code></pre><p>}<br></p><p>  并且可能被处理为静态文件。  所以它被转换为“ <code class="notranslate">/scripts/one.php</code> ”。 </p><p>  如果URI包含base64编码的名称，则必须<code class="notranslate">off</code>压缩，因为base64在内部使用“ <code class="notranslate">/</code> ”字符。  但是，出于安全考虑，最好避免关闭压缩。 </p><p>  如果在<a hhref="#server">服务器</a>级别指定了该指令，则仅在服务器是默认服务器时使用其值。  指定的值也适用于侦听同一地址和端口的所有虚拟服务器。 </p><a name="msie_padding"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>msie_padding</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">msie_padding on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用向状态大于400的MSIE客户端的响应添加注释，以将响应大小增加到512字节。 </p><a name="msie_refresh"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>msie_refresh</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">msie_refresh off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用发布刷新而不是MSIE客户端的重定向。 </p><a name="open_file_cache"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>open_file_cache</strong> <code class="notranslate">off</code> ;</code> <br> <code class="notranslate"><strong>open_file_cache</strong><br><code class="notranslate">max</code> = <code class="notranslate"><i>N</i></code><br>[ <code class="notranslate">inactive</code> = <code class="notranslate"><i>time</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">open_file_cache off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  配置可以存储的缓存： </p><ul class="compact"><li>  打开文件描述符，它们的大小和修改时间; </li><li>  关于目录存在的信息; </li><li>  文件查找错误，例如“找不到文件”，“没有读取权限”等。 <blockquote class="note">  应该通过<a hhref="#open_file_cache_errors">open_file_cache_errors</a>指令单独启用缓存错误。 </blockquote></li></ul><p></p><p>  该指令具有以下参数： </p><dl class="compact"><dt> <code class="notranslate">max</code> </dt> <dd>  设置缓存中的最大元素数;  在缓存溢出时，删除最近最少使用（LRU）的元素; </dd><dt> <code class="notranslate">inactive</code> </dt> <dd>  定义一个时间，如果在此期间未访问该元素，则从该缓存中删除该元素;  默认情况下，它是60秒; </dd><dt> <code class="notranslate">off</code> </dt> <dd>  禁用缓存。 </dd></dl><p></p><p>  例： </p><blockquote class="example"><pre class="notranslate">open_file_cache          max=1000 inactive=20s;<br>open_file_cache_valid    30s;<br>open_file_cache_min_uses 2;<br>open_file_cache_errors   on;<br></pre></blockquote><p></p><a name="open_file_cache_errors"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>open_file_cache_errors</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">open_file_cache_errors off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  通过<a hhref="#open_file_cache">open_file_cache</a>启用或禁用文件查找错误的缓存。 </p><a name="open_file_cache_min_uses"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>open_file_cache_min_uses</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">open_file_cache_min_uses 1;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置在<a hhref="#open_file_cache">open_file_cache</a>指令的<code class="notranslate">inactive</code>参数配置的时间段内文件访问的最小<code class="notranslate"><i>number</i></code> ，这是文件描述符在缓存中保持打开所必需的。 </p><a name="open_file_cache_valid"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>open_file_cache_valid</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">open_file_cache_valid 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置应验证<a hhref="#open_file_cache">open_file_cache</a>元素的时间。 </p><a name="output_buffers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>output_buffers</strong> <code class="notranslate"><i>number</i></code> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">output_buffers 2 32k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置用于从磁盘读取响应的缓冲区的<code class="notranslate"><i>number</i></code>和<code class="notranslate"><i>size</i></code> 。 </p><blockquote class="note">  在1.9.5版之前，默认值为1 32k。 </blockquote><p></p><a name="port_in_redirect"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>port_in_redirect</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">port_in_redirect on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用在nginx发出的<a hhref="#absolute_redirect">绝对</a>重定向中指定端口。 </p><p>  在重定向中使用主服务器名称由<a hhref="#server_name_in_redirect">server_name_in_redirect</a>指令控制。 </p><a name="postpone_output"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>postpone_output</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">postpone_output 1460;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  如果可能，客户端数据的传输将被推迟，直到nginx至少要发送<code class="notranslate"><i>size</i></code>字节的数据。  零值禁用推迟数据传输。 </p><a name="read_ahead"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>read_ahead</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">read_ahead 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置使用文件时内核的预读取量。 </p><p>  在Linux上，使用<code class="notranslate">posix_fadvise(0, 0, 0, POSIX_FADV_SEQUENTIAL)</code>系统调用，因此忽略<code class="notranslate"><i>size</i></code>参数。 </p><p>  在FreeBSD上，使用了自FreeBSD 9.0-CURRENT以来支持的<code class="notranslate">fcntl(O_READAHEAD,</code> <code class="notranslate"><i>size</i></code> <code class="notranslate">)</code>系统调用。   FreeBSD 7必须<a hhref="http://sysoev.ru/freebsd/patch.readahead.txt">打补丁</a> 。 </p><a name="recursive_error_pages"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>recursive_error_pages</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">recursive_error_pages off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  使用<a hhref="#error_page">error_page</a>指令启用或禁用多个重定向。  此类重定向的数量<a hhref="#internal">有限</a> 。 </p><a name="request_pool_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>request_pool_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">request_pool_size 4k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p>  允许精确调整每个请求的内存分配。  该指令对性能的影响最小，通常不应使用。 </p><a name="reset_timedout_connection"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>reset_timedout_connection</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">reset_timedout_connection off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用重置超时连接。  重置如下进行。  在关闭套接字之前，在其上设置<code class="notranslate">SO_LINGER</code>选项，超时值为0.当套接字关闭时，TCP RST将发送到客户端，并释放此套接字占用的所有内存。  这有助于避免将已填充缓冲区的已关闭套接字保持在FIN_WAIT1状态很长时间。 </p><p>  应该注意，超时保持连接正常关闭。 </p><a name="resolver"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>resolver</strong><br>    <code class="notranslate"><i>address</i></code> …<br>    [ <code class="notranslate">valid</code> = <code class="notranslate"><i>time</i></code> ]<br>    [ <code class="notranslate">ipv6</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  将用于解析上游服务器名称的名称服务器配置到地址中，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;resolver 127.0.0.1 [::1]:5353;
</code></pre><p></p><p>  可以将地址指定为域名或IP地址，以及可选端口（1.3.1,1.2.2）。  如果未指定端口，则使用端口53。  以循环方式查询名称服务器。 </p><blockquote class="note">  在1.1.7版之前，只能配置一个名称服务器。  从版本1.3.1和1.2.2开始支持使用IPv6地址指定名称服务器。 </blockquote><p>  默认情况下，nginx将在解析时查找IPv4和IPv6地址。  如果不需要查找IPv6地址，可以指定<code class="notranslate">ipv6=off</code>参数。 </p><blockquote class="note">  从版本1.5.8开始支持将名称解析为IPv6地址。 </blockquote><p>  默认情况下，nginx使用响应的TTL值缓存答案。  可选的<code class="notranslate">valid</code>参数允许覆盖它： </p><blockquote class="example"><pre class="notranslate">resolver 127.0.0.1 [::1]:5353 valid=30s;<br></pre></blockquote><p></p><blockquote class="note">  在版本1.1.9之前，无法调整缓存时间，并且nginx始终缓存5分钟的持续时间。 </blockquote><p></p><blockquote class="note">  为防止DNS欺骗，建议在正确安全的受信任本地网络中配置DNS服务器。 </blockquote><p></p><a name="resolver_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>resolver_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">resolver_timeout 30s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置名称解析的超时，例如： </p><blockquote class="example"><pre class="notranslate">resolver_timeout 5s;<br></pre></blockquote><p></p><a name="root"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>root</strong> <code class="notranslate"><i>path</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">root html;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br><br>                </td></tr></tbody></table></div><p>  设置请求的根目录。  例如，使用以下配置 </p><blockquote class="example"><pre class="notranslate">location /i/ {<br>    root /data/w3;<br>}<br></pre></blockquote><p>  将发送<code class="notranslate">/data/w3/i/top.gif</code>文件以响应“ <code class="notranslate">/i/top.gif</code> ”请求。 </p><p>   <code class="notranslate"><i>path</i></code>值可以包含变量， <code class="notranslate">$document_root</code>和<code class="notranslate">$realpath_root</code>除外。 </p><p>  仅通过向<code class="notranslate">root</code>指令的值添加URI来构造文件的路径。  如果必须修改URI，则应使用<a hhref="#alias">别名</a>指令。 </p><a name="satisfy"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>satisfy</strong> <code class="notranslate">all</code> | <code class="notranslate">any</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">satisfy all;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  如果所有（ <code class="notranslate">all</code> ）或至少一个（ <code class="notranslate">any</code> ） <a hhref="ngx_http_access_module.html">ngx_http_access_module</a> ， <a hhref="ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a> ， <a hhref="ngx_http_auth_request_module.html">ngx_http_auth_request_module</a>或<a hhref="ngx_http_auth_jwt_module.html">ngx_http_auth_jwt_module</a>模块允许访问，则允许访问。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">location / {<br>    satisfy any;<p></p>
<pre><code>allow 192.168.1.0/32;
deny  all;

auth_basic           &quot;closed site&quot;;
auth_basic_user_file conf/htpasswd;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="send_lowat"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>send_lowat</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">send_lowat 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  如果指令设置为非零值，nginx将尝试通过使用<a hhref="events.html#kqueue">kqueue</a>方法的<code class="notranslate">NOTE_LOWAT</code>标志或<code class="notranslate">SO_SNDLOWAT</code>套接字选项来最小化客户端套接字上的发送操作数。  在这两种情况下都使用指定的<code class="notranslate"><i>size</i></code> 。 </p><p>  在Linux，Solaris和Windows上忽略此指令。 </p><a name="send_timeout"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>send_timeout</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">send_timeout 60s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置将响应传输到客户端的超时。  仅在两次连续写操作之间设置超时，而不是整个响应的传输。  如果客户端在此时间内未收到任何内容，则会关闭连接。 </p><a name="sendfile"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>sendfile</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">sendfile off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用<code class="notranslate">sendfile()</code>的使用。 </p><p>  从nginx 0.8.12和FreeBSD 5.2.1开始， <a hhref="#aio">aio</a>可用于预加载<code class="notranslate">sendfile()</code>数据： </p><blockquote class="example"><pre class="notranslate">location /video/ {<br>    sendfile       on;<br>    tcp_nopush     on;<br>    aio            on;<br>}<br></pre></blockquote><p>  在此配置中，使用<code class="notranslate">SF_NODISKIO</code>标志调用<code class="notranslate">sendfile()</code> ，这会导致它不阻塞磁盘I / O，而是报告数据不在内存中。  然后，nginx通过读取一个字节来启动异步数据加载。  在第一次读取时，FreeBSD内核将文件的前128K字节加载到内存中，尽管下一次读取只会以16K块的形式加载数据。  可以使用<a hhref="#read_ahead">read_ahead</a>指令更改此<a hhref="#read_ahead">设置</a> 。 </p><blockquote class="note">  在1.7.11版之前，可以使用<code class="notranslate">aio sendfile;</code>启用预加载<code class="notranslate">aio sendfile;</code>   。 </blockquote><p></p><a name="sendfile_max_chunk"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>sendfile_max_chunk</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">sendfile_max_chunk 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  设置为非零值时，限制可在单个<code class="notranslate">sendfile()</code>调用中传输的数据量。  没有限制，一个快速连接可能完全占用工作进程。 </p><a name="server"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server</strong> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置虚拟服务器的配置。  基于IP（基于IP地址）和基于名称（基于“主机”请求标头字段）的虚拟服务器之间没有明确的区别。  相反， &lt;a hhref=&quot;#listen&quot;&gt;listen&lt;/a&gt;指令描述了应该接受服务器连接的所有地址和端口， &lt;a hhref=&quot;#server_name&quot;&gt;server_name&lt;/a&gt;指令列出了所有服务器名称。   “ &lt;a hhref=&quot;request_processing.html&quot;&gt;如何nginx处理请求&lt;/a&gt; ”文档中提供了示例配置。 &lt;/p&gt;&lt;a name=&quot;server_name&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;server_name&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;server_name &quot;&quot;;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置虚拟服务器的名称，例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;server {
server_name example.com www.example.com;
</code></pre><p>}<br></p><p></p><p>  第一个名称成为主服务器名称。 </p><p>  服务器名称可以包含替换名称的第一个或最后一个部分的星号（“ <code class="notranslate"><em></em></code> ”）： </p><blockquote class="example"><pre class="notranslate">server {<br>    server_name example.com .example.com www.example.*;<br>}<br></pre></blockquote><p>  这些名称称为通配符名称。 </p><p>  上面提到的前两个名称可以合二为一： </p><blockquote class="example"><pre class="notranslate">server {<br>    server_name .example.com;<br>}<br></pre></blockquote><p></p><p>  也可以在服务器名称中使用正则表达式，在名称前面加上波浪号（“ <code class="notranslate">~</code> ”）： </p><blockquote class="example"><pre class="notranslate">server {<br>    server_name www.example.com ~^www\d+.example.com$;<br>}<br></pre></blockquote><p></p><p>  正则表达式可以包含以后可以在其他指令中使用的捕获（0.7.40）： </p><blockquote class="example"><pre class="notranslate">server {<br>    server_name ~^(www.)?(.+)$;<p></p>
<pre><code>location / {
    root /sites/$2;
}
</code></pre><p>}</p>
<p>server {<br>    server<em>name </em>;</p>
<pre><code>location / {
    root /sites/default;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p>  正则表达式中的命名捕获创建变量（0.8.25），以后可以在其他指令中使用它们： </p><blockquote class="example"><pre class="notranslate">server {<br>    server_name ~^(www.)?(?&lt;domain&gt;.+)$;<p></p>
<pre><code>location / {
    root /sites/$domain;
}
</code></pre><p>}</p>
<p>server {<br>    server<em>name </em>;</p>
<pre><code>location / {
    root /sites/default;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p>  如果指令的参数设置为“ <code class="notranslate">$hostname</code> ”（0.9.4），则插入机器的主机名。 </p><p>  也可以指定一个空的服务器名称（0.7.11）： </p><blockquote class="example"><pre class="notranslate">server {<br>    server_name www.example.com “”;<br>}<br></pre></blockquote><p>  它允许此服务器处理请求而不使用“Host”头字段 - 而不是默认服务器 - 用于给定地址：端口对。  这是默认设置。 </p><blockquote class="note">  在0.8.48之前，默认使用机器的主机名。 </blockquote><p></p><p>  在按名称搜索虚拟服务器期间，如果名称与多个指定的变体匹配（例如，通配符名称和正则表达式匹配），将按以下优先级顺序选择第一个匹配的变体： </p><ol class="compact"><li>  确切的名字 </li><li>  以星号开头的最长通配符名称，例如“ <code class="notranslate"><em>.example.com</em></code> ” </li><li>  最长的通配符名称以星号结尾，例如“ <code class="notranslate">mail.</code> ” </li><li>  第一个匹配的正则表达式（按配置文件中的出现顺序） </li></ol><p></p><p>  服务器名称的详细描述在单独的<a hhref="server_names.html">服务器名称</a>文档中提供。 </p><a name="server_name_in_redirect"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server_name_in_redirect</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">server_name_in_redirect off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  在nginx发出的<a hhref="#absolute_redirect">绝对</a>重定向中启用或禁用<a hhref="#server_name">server_name</a>指令指定的主服务器名称。  禁用主服务器名称时，将使用“主机”请求标头字段中的名称。  如果此字段不存在，则使用服务器的IP地址。 </p><p>  在重定向中使用端口由<a hhref="#port_in_redirect">port_in_redirect</a>指令控制。 </p><a name="server_names_hash_bucket_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server_names_hash_bucket_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">server_names_hash_bucket_size 32|64|128;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  设置服务器名称哈希表的存储桶大小。  默认值取决于处理器缓存行的大小。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="server_names_hash_max_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server_names_hash_max_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">server_names_hash_max_size 512;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  设置服务器名称哈希表的最大<code class="notranslate"><i>size</i></code> 。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="server_tokens"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>server_tokens</strong><br>    <code class="notranslate">on</code> |<br>    <code class="notranslate">off</code> |<br>    <code class="notranslate">build</code> |<br>    <code class="notranslate"><i>string</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">server_tokens on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用在错误页面和“服务器”响应头字段中发出nginx版本。 </p><a name="server_tokens_build"></a><p>   <code class="notranslate">build</code>参数（1.11.10）允许发出<a hhref="configure.html#build">构建名称</a>和nginx版本。 </p><p>  此外，作为<a hhref="http://nginx.com/products/">商业订阅的</a>一部分，从版本1.9.13开始，错误页面上的签名和“服务器”响应头字段值可以使用带变量的<code class="notranslate"><i>string</i></code>显式设置。  空字符串禁用“服务器”字段的发射。 </p><a name="subrequest_output_buffer_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>subrequest_output_buffer_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">subrequest_output_buffer_size 4k|8k;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.13.10版本中。 </p></div><p> Sets the <code class="notranslate"><i>size</i></code> of the buffer used for storing the response body of a subrequest.  默认情况下，缓冲区大小等于一个内存页面。  这是4K或8K，具体取决于平台。  然而，它可以做得更小。 </p><p> The directive is applicable only for subrequests with response bodies saved into memory. For example, such subrequests are created by <a hhref="ngx_http_ssi_module.html#ssi_include_set">SSI</a> . </p><a name="tcp_nodelay"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>tcp_nodelay</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">tcp_nodelay on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用<code class="notranslate">TCP_NODELAY</code>选项的使用。 The option is enabled when a connection is transitioned into the keep-alive state. Additionally, it is enabled on SSL connections, for unbuffered proxying, and for <a hhref="websocket.html">WebSocket</a> proxying. </p><a name="tcp_nopush"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>tcp_nopush</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">tcp_nopush off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p> Enables or disables the use of the <code class="notranslate">TCP_NOPUSH</code> socket option on FreeBSD or the <code class="notranslate">TCP_CORK</code> socket option on Linux. The options are enabled only when <a hhref="#sendfile">sendfile</a> is used. Enabling the option allows </p><ul class="compact"><li> sending the response header and the beginning of a file in one packet, on Linux and FreeBSD 4.*; </li><li> sending a file in full packets. </li></ul><p></p><a name="try_files"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>try_files</strong> <code class="notranslate"><i>file</i></code> … <code class="notranslate"><i>uri</i></code> ;</code> <br> <code class="notranslate"><strong>try_files</strong> <code class="notranslate"><i>file</i></code> … = <code class="notranslate"><i>code</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt; Checks the existence of files in the specified order and uses the first found file for request processing; the processing is performed in the current context. The path to a file is constructed from the &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; parameter according to the &lt;a hhref=&quot;#root&quot;&gt;root&lt;/a&gt; and &lt;a hhref=&quot;#alias&quot;&gt;alias&lt;/a&gt; directives. It is possible to check directory&apos;s existence by specifying a slash at the end of a name, eg “ &lt;code class=&quot;notranslate&quot;&gt;$uri/&lt;/code&gt; ”. If none of the files were found, an internal redirect to the &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;uri&lt;/i&gt;&lt;/code&gt; specified in the last parameter is made.  例如： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location /images/ {
try_files $uri /images/default.gif;
</code></pre><p>}</p>
<p>location = /images/default.gif {<br>    expires 30s;<br>}<br></p><p> The last parameter can also point to a named location, as shown in examples below. Starting from version 0.7.51, the last parameter can also be a <code class="notranslate"><i>code</i></code> : </p><blockquote class="example"><pre class="notranslate">location / {<br>    try_files $uri $uri/index.html $uri.html =404;<br>}<br></pre></blockquote><p></p><p> Example in proxying Mongrel: </p><blockquote class="example"><pre class="notranslate">location / {<br>    try_files /system/maintenance.html<br>              $uri $uri/index.html $uri.html<br>              @mongrel;<br>}<p></p>
<p>location @mongrel {<br>    proxy_pass <a href="http://mongrel" target="_blank" rel="noopener">http://mongrel</a>;<br>}<br></p></pre></blockquote><p></p><p> Example for Drupal/FastCGI: </p><blockquote class="example"><pre class="notranslate">location / {<br>    try_files $uri $uri/ @drupal;<br>}<p></p>
<p>location ~ .php$ {<br>    try_files $uri @drupal;</p>
<pre><code>fastcgi_pass ...;

fastcgi_param SCRIPT_FILENAME /path/to$fastcgi_script_name;
fastcgi_param SCRIPT_NAME     $fastcgi_script_name;
fastcgi_param QUERY_STRING    $args;

... other fastcgi_param&apos;s
</code></pre><p>}</p>
<p>location @drupal {<br>    fastcgi_pass …;</p>
<pre><code>fastcgi_param SCRIPT_FILENAME /path/to/index.php;
fastcgi_param SCRIPT_NAME     /index.php;
fastcgi_param QUERY_STRING    q=$uri&amp;amp;$args;

... other fastcgi_param&apos;s
</code></pre><p>}<br></p></pre></blockquote><p> In the following example, </p><blockquote class="example"><pre class="notranslate">location / {<br>    try_files $uri $uri/ @drupal;<br>}<br></pre></blockquote><p> the <code class="notranslate">try_files</code> directive is equivalent to </p><blockquote class="example"><pre class="notranslate">location / {<br>    error_page 404 = @drupal;<br>    log_not_found off;<br>}<br></pre></blockquote><p> And here, </p><blockquote class="example"><pre class="notranslate">location ~ .php$ {<br>    try_files $uri @drupal;<p></p>
<pre><code>fastcgi_pass ...;

fastcgi_param SCRIPT_FILENAME /path/to$fastcgi_script_name;

...
</code></pre><p>}<br></p></pre></blockquote><p> <code class="notranslate">try_files</code> checks the existence of the PHP file before passing the request to the FastCGI server. </p><p> Example for Wordpress and Joomla: </p><blockquote class="example"><pre class="notranslate">location / {<br>    try_files $uri $uri/ @wordpress;<br>}<p></p>
<p>location ~ .php$ {<br>    try_files $uri @wordpress;</p>
<pre><code>fastcgi_pass ...;

fastcgi_param SCRIPT_FILENAME /path/to$fastcgi_script_name;
... other fastcgi_param&apos;s
</code></pre><p>}</p>
<p>location @wordpress {<br>    fastcgi_pass …;</p>
<pre><code>fastcgi_param SCRIPT_FILENAME /path/to/index.php;
... other fastcgi_param&apos;s
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="types"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>types</strong> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">types {<br>    text/html  html;<br>    image/gif  gif;<br>    image/jpeg jpg;<br>}</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p> Maps file name extensions to MIME types of responses. Extensions are case-insensitive. Several extensions can be mapped to one type, for example: </p><blockquote class="example"><pre class="notranslate">types {<br>    application/octet-stream bin exe dll;<br>    application/octet-stream deb;<br>    application/octet-stream dmg;<br>}<br></pre></blockquote><p></p><p> A sufficiently full mapping table is distributed with nginx in the <code class="notranslate">conf/mime.types</code> file. </p><p> To make a particular location emit the “ <code class="notranslate">application/octet-stream</code> ” MIME type for all requests, the following configuration can be used: </p><blockquote class="example"><pre class="notranslate">location /download/ {<br>    types        { }<br>    default_type application/octet-stream;<br>}<br></pre></blockquote><p></p><a name="types_hash_bucket_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>types_hash_bucket_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">types_hash_bucket_size 64;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p> Sets the bucket size for the types hash tables.  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><blockquote class="note"> Prior to version 1.5.13, the default value depended on the size of the processor’s cache line. </blockquote><p></p><a name="types_hash_max_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>types_hash_max_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">types_hash_max_size 1024;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p> Sets the maximum <code class="notranslate"><i>size</i></code> of the types hash tables.  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="underscores_in_headers"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>underscores_in_headers</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">underscores_in_headers off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> <br><br>                </td></tr></tbody></table></div><p> Enables or disables the use of underscores in client request header fields. When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the <a hhref="#ignore_invalid_headers">ignore_invalid_headers</a> directive. </p><p> If the directive is specified on the <a hhref="#server">server</a> level, its value is only used if a server is a default one. The value specified also applies to all virtual servers listening on the same address and port. </p><a name="variables_hash_bucket_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>variables_hash_bucket_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">variables_hash_bucket_size 64;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  设置变量哈希表的桶大小。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><a name="variables_hash_max_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>variables_hash_max_size</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">variables_hash_max_size 1024;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> <br><br>                </td></tr></tbody></table></div><p>  设置变量哈希表的最大<code class="notranslate"><i>size</i></code> 。  设置哈希表的详细信息在单独的<a hhref="hash.html">文档</a>中提供。 </p><blockquote class="note"> Prior to version 1.5.13, the default value was 512. </blockquote><p></p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p> The <code class="notranslate">ngx_http_core_module</code> module supports embedded variables with names matching the Apache Server variables. First of all, these are variables representing client request header fields, such as <code class="notranslate">$http_user_agent</code> , <code class="notranslate">$http_cookie</code> , and so on. Also there are other variables: </p><dl class="compact"><dt id="var_arg_"> <code class="notranslate">$arg_</code> <code class="notranslate"><i>name</i></code> </dt><dd> argument <code class="notranslate"><i>name</i></code> in the request line </dd><dt id="var_args"> <code class="notranslate">$args</code> </dt> <dd> arguments in the request line </dd><dt id="var_binary_remote_addr"> <code class="notranslate">$binary_remote_addr</code> </dt> <dd>  客户端地址采用二进制形式，值的长度始终为IPv4地址的4个字节或IPv6地址的16个字节 </dd><dt id="var_body_bytes_sent"> <code class="notranslate">$body_bytes_sent</code> </dt> <dd> number of bytes sent to a client, not counting the response header; this variable is compatible with the “ <code class="notranslate">%B</code> ” parameter of the <code class="notranslate">mod_log_config</code> Apache module </dd><dt id="var_bytes_sent"> <code class="notranslate">$bytes_sent</code> </dt> <dd> number of bytes sent to a client (1.3.8, 1.2.5) </dd><dt id="var_connection"> <code class="notranslate">$connection</code> </dt> <dd> connection serial number (1.3.8, 1.2.5) </dd><dt id="var_connection_requests"> <code class="notranslate">$connection_requests</code> </dt> <dd> current number of requests made through a connection (1.3.8, 1.2.5) </dd><dt id="var_content_length"> <code class="notranslate">$content_length</code> </dt> <dd> “Content-Length” request header field </dd><dt id="var_content_type"> <code class="notranslate">$content_type</code> </dt> <dd> “Content-Type” request header field </dd><dt id="var_cookie_"> <code class="notranslate">$cookie_</code> <code class="notranslate"><i>name</i></code> </dt><dd> the <code class="notranslate"><i>name</i></code> cookie </dd><dt id="var_document_root"> <code class="notranslate">$document_root</code> </dt> <dd> <a hhref="#root">root</a> or <a hhref="#alias">alias</a> directive’s value for the current request </dd><dt id="var_document_uri"> <code class="notranslate">$document_uri</code> </dt> <dd> same as <code class="notranslate">$uri</code> </dd><dt id="var_host"> <code class="notranslate">$host</code> </dt> <dd> in this order of precedence: host name from the request line, or host name from the “Host” request header field, or the server name matching a request </dd><dt id="var_hostname"> <code class="notranslate">$hostname</code> </dt> <dd>  主机名 </dd><dt id="var_http_"> <code class="notranslate">$http_</code> <code class="notranslate"><i>name</i></code> </dt><dd> arbitrary request header field; the last part of a variable name is the field name converted to lower case with dashes replaced by underscores </dd><dt id="var_https"> <code class="notranslate">$https</code> </dt> <dd> “ <code class="notranslate">on</code> ” if connection operates in SSL mode, or an empty string otherwise </dd><dt id="var_is_args"> <code class="notranslate">$is_args</code> </dt> <dd> “ <code class="notranslate">?</code> ” if a request line has arguments, or an empty string otherwise </dd><dt id="var_limit_rate"> <code class="notranslate">$limit_rate</code> </dt> <dd> setting this variable enables response rate limiting; see <a hhref="#limit_rate">limit_rate</a> </dd><dt id="var_msec"> <code class="notranslate">$msec</code> </dt> <dd> current time in seconds with the milliseconds resolution (1.3.9, 1.2.6) </dd><dt id="var_nginx_version"> <code class="notranslate">$nginx_version</code> </dt> <dd>   nginx版本 </dd><dt id="var_pid"> <code class="notranslate">$pid</code> </dt> <dd>  工作进程的PID </dd><dt id="var_pipe"> <code class="notranslate">$pipe</code> </dt> <dd>   “ <code class="notranslate">p</code> ”如果请求是流水线的，“ <code class="notranslate">.</code> ” otherwise (1.3.12, 1.2.7) </dd><dt id="var_proxy_protocol_addr"> <code class="notranslate">$proxy_protocol_addr</code> </dt> <dd> client address from the PROXY protocol header, or an empty string otherwise (1.5.12) <p>  必须先通过在<a hhref="#listen">listen</a>指令中设置<code class="notranslate">proxy_protocol</code>参数来启用PROXY协议。 </p></dd><dt id="var_proxy_protocol_port"> <code class="notranslate">$proxy_protocol_port</code> </dt> <dd> client port from the PROXY protocol header, or an empty string otherwise (1.11.0) <p>  必须先通过在<a hhref="#listen">listen</a>指令中设置<code class="notranslate">proxy_protocol</code>参数来启用PROXY协议。 </p></dd><dt id="var_query_string"> <code class="notranslate">$query_string</code> </dt> <dd> same as <code class="notranslate">$args</code> </dd><dt id="var_realpath_root"> <code class="notranslate">$realpath_root</code> </dt> <dd> an absolute pathname corresponding to the <a hhref="#root">root</a> or <a hhref="#alias">alias</a> directive’s value for the current request, with all symbolic links resolved to real paths </dd><dt id="var_remote_addr"> <code class="notranslate">$remote_addr</code> </dt> <dd>  客户地址 </dd><dt id="var_remote_port"> <code class="notranslate">$remote_port</code> </dt> <dd>  客户端端口 </dd><dt id="var_remote_user"> <code class="notranslate">$remote_user</code> </dt> <dd> user name supplied with the Basic authentication </dd><dt id="var_request"> <code class="notranslate">$request</code> </dt> <dd> full original request line </dd><dt id="var_request_body"> <code class="notranslate">$request_body</code> </dt> <dd>  请求机构 <p> The variable’s value is made available in locations processed by the <a hhref="ngx_http_proxy_module.html#proxy_pass">proxy_pass</a> , <a hhref="ngx_http_fastcgi_module.html#fastcgi_pass">fastcgi_pass</a> , <a hhref="ngx_http_uwsgi_module.html#uwsgi_pass">uwsgi_pass</a> , and <a hhref="ngx_http_scgi_module.html#scgi_pass">scgi_pass</a> directives when the request body was read to a <a hhref="#client_body_buffer_size">memory buffer</a> . </p></dd><dt id="var_request_body_file"> <code class="notranslate">$request_body_file</code> </dt> <dd> name of a temporary file with the request body <p> At the end of processing, the file needs to be removed. To always write the request body to a file, <a hhref="#client_body_in_file_only">client_body_in_file_only</a> needs to be enabled. When the name of a temporary file is passed in a proxied request or in a request to a FastCGI/uwsgi/SCGI server, passing the request body should be disabled by the <a hhref="ngx_http_proxy_module.html#proxy_pass_request_body">proxy_pass_request_body off</a> , <a hhref="ngx_http_fastcgi_module.html#fastcgi_pass_request_body">fastcgi_pass_request_body off</a> , <a hhref="ngx_http_uwsgi_module.html#uwsgi_pass_request_body">uwsgi_pass_request_body off</a> , or <a hhref="ngx_http_scgi_module.html#scgi_pass_request_body">scgi_pass_request_body off</a> directives, respectively. </p></dd><dt id="var_request_completion"> <code class="notranslate">$request_completion</code> </dt> <dd> “ <code class="notranslate">OK</code> ” if a request has completed, or an empty string otherwise </dd><dt id="var_request_filename"> <code class="notranslate">$request_filename</code> </dt> <dd> file path for the current request, based on the <a hhref="#root">root</a> or <a hhref="#alias">alias</a> directives, and the request URI </dd><dt id="var_request_id"> <code class="notranslate">$request_id</code> </dt> <dd> unique request identifier generated from 16 random bytes, in hexadecimal (1.11.0) </dd><dt id="var_request_length"> <code class="notranslate">$request_length</code> </dt> <dd> request length (including request line, header, and request body) (1.3.12, 1.2.7) </dd><dt id="var_request_method"> <code class="notranslate">$request_method</code> </dt> <dd> request method, usually “ <code class="notranslate">GET</code> ” or “ <code class="notranslate">POST</code> ” </dd><dt id="var_request_time"> <code class="notranslate">$request_time</code> </dt> <dd> request processing time in seconds with a milliseconds resolution (1.3.9, 1.2.6); time elapsed since the first bytes were read from the client </dd><dt id="var_request_uri"> <code class="notranslate">$request_uri</code> </dt> <dd> full original request URI (with arguments) </dd><dt id="var_scheme"> <code class="notranslate">$scheme</code> </dt> <dd> request scheme, “ <code class="notranslate">http</code> ” or “ <code class="notranslate">https</code> ” </dd><dt id="var_sent_http_"> <code class="notranslate">$sent<em>http</em></code> <code class="notranslate"><i>name</i></code> </dt><dd> arbitrary response header field; the last part of a variable name is the field name converted to lower case with dashes replaced by underscores </dd><dt id="var_sent_trailer_"> <code class="notranslate">$sent<em>trailer</em></code> <code class="notranslate"><i>name</i></code> </dt><dd> arbitrary field sent at the end of the response (1.13.2); the last part of a variable name is the field name converted to lower case with dashes replaced by underscores </dd><dt id="var_server_addr"> <code class="notranslate">$server_addr</code> </dt> <dd> an address of the server which accepted a request <p>  计算此变量的值通常需要一次系统调用。  为避免系统调用， <a hhref="#listen">listen</a>指令必须指定地址并使用<code class="notranslate">bind</code>参数。 </p></dd><dt id="var_server_name"> <code class="notranslate">$server_name</code> </dt> <dd> name of the server which accepted a request </dd><dt id="var_server_port"> <code class="notranslate">$server_port</code> </dt> <dd> port of the server which accepted a request </dd><dt id="var_server_protocol"> <code class="notranslate">$server_protocol</code> </dt> <dd> request protocol, usually “ <code class="notranslate">HTTP/1.0</code> ”, “ <code class="notranslate">HTTP/1.1</code> ”, or “ <a hhref="ngx_http_v2_module.html">HTTP/2.0</a> ” </dd><dt id="var_status"> <code class="notranslate">$status</code> </dt> <dd> response status (1.3.2, 1.2.2) </dd><dt id="var_tcpinfo_"> <code class="notranslate">$tcpinfo_rtt</code> , <code class="notranslate">$tcpinfo_rttvar</code> , <code class="notranslate">$tcpinfo_snd_cwnd</code> , <code class="notranslate">$tcpinfo_rcv_space</code> </dt><dd> information about the client TCP connection; available on systems that support the <code class="notranslate">TCP_INFO</code> socket option </dd><dt id="var_time_iso8601"> <code class="notranslate">$time_iso8601</code> </dt> <dd> local time in the ISO 8601 standard format (1.3.12, 1.2.7) </dd><dt id="var_time_local"> <code class="notranslate">$time_local</code> </dt> <dd> local time in the Common Log Format (1.3.12, 1.2.7) </dd><dt id="var_uri"> <code class="notranslate">$uri</code> </dt> <dd> current URI in request, <a hhref="#location">normalized</a> <p> The value of <code class="notranslate">$uri</code> may change during request processing, eg when doing internal redirects, or when using index files. </p></dd></dl><p></p> <p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_charset_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_charset_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#charset">charset</a> <br>     <a hhref="#charset_map">charset_map</a> <br>     <a hhref="#charset_types">charset_types</a> <br>     <a hhref="#override_charset">override_charset</a> <br>     <a hhref="#source_charset">source_charset</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_charset_module</code>模块将指定的字符集添加到“Content-Type”响应头字段。  此外，该模块可以将数据从一个字符集转换为另一个字符集，但有一些限制： </p><ul class="compact"><li>  转换是以一种方式执行的 - 从服务器到客户端， </li><li>  只能转换单字节字符集 </li><li>  或者来自UTF-8的单字节字符集。 </li></ul><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">include        conf/koi-win;<p></p>
<p>charset        windows-1251;<br>source_charset koi8-r;<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="charset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>charset</strong> <code class="notranslate"><i>charset</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">charset off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br><br>                </td></tr></tbody></table></div><p>  将指定的charset添加到“Content-Type”响应头字段。  如果此charset与<a hhref="#source_charset">source_charset</a>指令中指定的charset不同，则执行转换。 </p><p>  参数<code class="notranslate">off</code>取消将charset添加到“Content-Type”响应头字段。 </p><p>  可以使用变量定义charset： </p><blockquote class="example"><pre class="notranslate">charset $charset;<br></pre></blockquote><p>  在这种情况下，变量的所有可能值需要以<a hhref="#charset_map">charset_map</a> ， <a hhref="#charset">charset</a>或<a hhref="#source_charset">source_charset</a>指令的形式存在于配置中至少一次。  对于<code class="notranslate">utf-8</code> ， <code class="notranslate">windows-1251</code>和<code class="notranslate">koi8-r</code> charsets，将文件<code class="notranslate">conf/koi-win</code> ， <code class="notranslate">conf/koi-utf</code>和<code class="notranslate">conf/win-utf</code>包含在<code class="notranslate">conf/koi-win</code>就足够了。  对于其他字符集，只需制作虚构的转换表即可，例如： </p><blockquote class="example"><pre class="notranslate">charset<em>map iso-8859-5 </em> { }<br></pre></blockquote><p></p><p>  此外，可以在“X-Accel-Charset”响应头字段中设置字符集。  可以使用<a hhref="ngx_http_proxy_module.html#proxy_ignore_headers">proxy_ignore_headers</a> ， <a hhref="ngx_http_fastcgi_module.html#fastcgi_ignore_headers">fastcgi_ignore_headers</a> ， <a hhref="ngx_http_uwsgi_module.html#uwsgi_ignore_headers">uwsgi_ignore_headers</a> ， <a hhref="ngx_http_scgi_module.html#scgi_ignore_headers">scgi_ignore_headers</a>和<a hhref="ngx_http_grpc_module.html#grpc_ignore_headers">grpc_ignore_headers</a>指令禁用此功能。 </p><a name="charset_map"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>charset_map</strong> <code class="notranslate"><i>charset1</i></code> <code class="notranslate"><i>charset2</i></code> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  描述从一个字符集到另一个字符集的转换表。  使用相同的数据构建反向转换表。  字符代码以十六进制给出。   80-FF范围内的缺失字符被替换为“ &lt;code class=&quot;notranslate&quot;&gt;?&lt;/code&gt;   ”。  从UTF-8转换时，单字节字符集中缺少的字符将替换为“ &lt;code class=&quot;notranslate&quot;&gt;&amp;amp;#XXXX;&lt;/code&gt;   ”。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;charset_map koi8-r windows-1251 {
C0 FE ; # small yu
C1 E0 ; # small a
C2 E1 ; # small b
C3 F6 ; # small ts
...
</code></pre><p>}<br></p><p></p><p>  在将转换表描述为UTF-8时，应在第二列中给出UTF-8字符集的代码，例如： </p><blockquote class="example"><pre class="notranslate">charset_map koi8-r utf-8 {<br>    C0 D18E ; # small yu<br>    C1 D0B0 ; # small a<br>    C2 D0B1 ; # small b<br>    C3 D186 ; # small ts<br>    …<br>}<br></pre></blockquote><p></p><p>  在分配文件<code class="notranslate">conf/koi-win</code> ， <code class="notranslate">conf/koi-utf</code>和<code class="notranslate">conf/win-utf</code>中提供了从<code class="notranslate">koi8-r</code>到<code class="notranslate">windows-1251</code> ，从<code class="notranslate">koi8-r</code>和<code class="notranslate">windows-1251</code>到<code class="notranslate">utf-8</code>完整转换表。 </p><a name="charset_types"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>charset_types</strong> <code class="notranslate"><i>mime-type</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">charset_types text/html text/xml text/plain text/vnd.wap.wml<br>application/javascript application/rss+xml;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在0.7.9版本中。 </p></div><p>  除了“ <code class="notranslate">text/html</code> ”之外，还可以在具有指定MIME类型的响应中启用模块处理。  特殊值“ <code class="notranslate">*</code> ”匹配任何MIME类型（0.8.29）。 </p><p></p><blockquote class="note">  在版本1.5.4之前，“ <code class="notranslate">application/x-javascript</code> ”被用作默认MIME类型而不是“ <code class="notranslate">application/javascript</code> ”。 </blockquote><p></p><a name="override_charset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>override_charset</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">override_charset off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">if in location</code> <br><br>                </td></tr></tbody></table></div><p>  确定当答案已在“Content-Type”响应头字段中携带字符集时，是否应对从代理或FastCGI / uwsgi / SCGI / gRPC服务器接收的答案执行转换。  如果启用了转换，则将接收到的响应中指定的字符集用作源字符集。 </p><blockquote class="note">  应当注意，如果在子请求中接收到响应，则始终执行从响应字符集到主请求字符集的转换，而不管<code class="notranslate">override_charset</code>指令设置如何。 </blockquote><p></p><a name="source_charset"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>source_charset</strong> <code class="notranslate"><i>charset</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;if in location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义响应的源字符集。  如果此charset与&lt;a hhref=&quot;#charset&quot;&gt;charset&lt;/a&gt;指令中指定的&lt;a hhref=&quot;#charset&quot;&gt;charset&lt;/a&gt;不同，则执行转换。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_browser_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_browser_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#ancient_browser">ancient_browser</a> <br>     <a hhref="#ancient_browser_value">ancient_browser_value</a> <br>     <a hhref="#modern_browser">modern_browser</a> <br>     <a hhref="#modern_browser_value">modern_browser_value</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_browser_module</code>模块创建的变量的值取决于“User-Agent”请求标头字段的值： </p><dl class="compact"><dt id="var_modern_browser"> <code class="notranslate">$modern_browser</code> </dt> <dd>  如果浏览器被识别为现代，则等于<a hhref="#modern_browser_value">modern_browser_value</a>指令设置的值; </dd><dt id="var_ancient_browser"> <code class="notranslate">$ancient_browser</code> </dt> <dd>  如果浏览器被识别为古代，则等于<a hhref="#ancient_browser_value">ancient_browser_value</a>指令设置的值; </dd><dt id="var_msie"> <code class="notranslate">$msie</code> </dt> <dd>  如果浏览器被识别为任何版本的MSIE，则等于“1”。 </dd></dl><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p>  选择索引文件： </p><blockquote class="example"><pre class="notranslate">modern_browser_value “modern.”;<p></p>
<p>modern_browser msie      5.5;<br>modern_browser gecko     1.0.0;<br>modern_browser opera     9.0;<br>modern_browser safari    413;<br>modern_browser konqueror 3.0;</p>
<p>index index.${modern_browser}html index.html;<br></p></pre></blockquote><p></p><p>  旧浏览器的重定向： </p><blockquote class="example"><pre class="notranslate">modern_browser msie      5.0;<br>modern_browser gecko     0.9.1;<br>modern_browser opera     8.0;<br>modern_browser safari    413;<br>modern_browser konqueror 3.0;<p></p>
<p>modern_browser unlisted;</p>
<p>ancient_browser Links Lynx netscape4;</p>
<p>if ($ancient_browser) {<br>    rewrite ^ /ancient.html;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="ancient_browser"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ancient_browser</strong> <code class="notranslate"><i>string</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  如果在“User-Agent”请求标头字段中找到任何指定的子字符串，则浏览器将被视为古代。  特殊字符串“ &lt;code class=&quot;notranslate&quot;&gt;netscape4&lt;/code&gt; ”对应于正则表达式“ &lt;code class=&quot;notranslate&quot;&gt;^Mozilla/[1-4]&lt;/code&gt; ”。 &lt;/p&gt;&lt;a name=&quot;ancient_browser_value&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;ancient_browser_value&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;ancient_browser_value 1;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置&lt;code class=&quot;notranslate&quot;&gt;$ancient_browser&lt;/code&gt;变量的值。 &lt;/p&gt;&lt;a name=&quot;modern_browser&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;modern_browser&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;browser&lt;/i&gt;&lt;/code&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;version&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;modern_browser&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;unlisted&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定从中将浏览器视为现代的版本。  浏览器可以是以下任何一种： &lt;code class=&quot;notranslate&quot;&gt;msie&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;gecko&lt;/code&gt; （基于Mozilla的浏览器）， &lt;code class=&quot;notranslate&quot;&gt;opera&lt;/code&gt; ， &lt;code class=&quot;notranslate&quot;&gt;safari&lt;/code&gt;或&lt;code class=&quot;notranslate&quot;&gt;konqueror&lt;/code&gt; 。 &lt;/p&gt;&lt;p&gt;  可以使用以下格式指定版本：X，XX，XXX或XXXX每种格式的最大值分别为4000,4000.99,4000.99.99和4000.99.99.99。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;unlisted&lt;/code&gt;的特殊值指定将浏览器视为现代浏览器，如果它未被&lt;code class=&quot;notranslate&quot;&gt;modern_browser&lt;/code&gt;和&lt;a hhref=&quot;#ancient_browser&quot;&gt;ancient_browser&lt;/a&gt;指令列出。  否则这样的浏览器被认为是古老的。  如果请求未在标头中提供“User-Agent”字段，则将浏览器视为未列出。 &lt;/p&gt;&lt;a name=&quot;modern_browser_value&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;modern_browser_value&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;string&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;modern_browser_value 1;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置&lt;code class=&quot;notranslate&quot;&gt;$modern_browser&lt;/code&gt;变量的值。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_autoindex_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_autoindex_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#autoindex">autoindex</a> <br>     <a hhref="#autoindex_exact_size">autoindex_exact_size</a> <br>     <a hhref="#autoindex_format">autoindex_format</a> <br>     <a hhref="#autoindex_localtime">autoindex_localtime</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_autoindex_module</code>模块处理以斜杠字符（’ <code class="notranslate">/</code> ‘）结尾的请求，并生成目录列表。  当<a hhref="ngx_http_index_module.html">ngx_http_index_module</a>模块找不到索引文件时，通常<code class="notranslate">ngx_http_autoindex_module</code>请求传递给<code class="notranslate">ngx_http_autoindex_module</code>模块。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    autoindex on;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="autoindex"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>autoindex</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">autoindex off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  启用或禁用目录列表输出。 </p><a name="autoindex_exact_size"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>autoindex_exact_size</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">autoindex_exact_size on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  对于HTML <a hhref="#autoindex_format">格式</a> ，指定是否应在目录列表中输出确切的文件大小，或者更确切地舍入为千字节，兆字节和千兆字节。 </p><a name="autoindex_format"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>autoindex_format</strong><br>    <code class="notranslate">html</code> |<br>    <code class="notranslate">xml</code> |<br>    <code class="notranslate">json</code> |<br>    <code class="notranslate">jsonp</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">autoindex_format html;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.7.9版本中。 </p></div><p>  设置目录列表的格式。 </p><p>  使用JSONP格式时，使用<code class="notranslate">callback</code>请求参数设置回调函数的名称。  如果参数缺失或具有空值，则使用JSON格式。 </p><p>  可以使用<a hhref="ngx_http_xslt_module.html">ngx_http_xslt_module</a>模块转换XML输出。 </p><a name="autoindex_localtime"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>autoindex_localtime</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">autoindex_localtime off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  对于HTML <a hhref="#autoindex_format">格式</a> ，指定目录列表中的时间是应以本地时区还是UTC输出。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_auth_request_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_auth_request_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#auth_request">auth_request</a> <br>     <a hhref="#auth_request_set">auth_request_set</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_auth_request_module</code>模块（1.5.4+）基于子请求的结果实现客户端授权。  如果子请求返回2xx响应代码，则允许访问。  如果它返回401或403，则拒绝访问，并显示相应的错误代码。  子请求返回的任何其他响应代码都被视为错误。 </p><p>  对于401错误，客户端还从子请求响应中接收“WWW-Authenticate”头。 </p><p>  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_auth_request_module</code>配置参数启用它。 </p><p>  该模块可以通过<a hhref="ngx_http_core_module.html#satisfy">满足</a>指令与其他访问模块组合，例如<a hhref="ngx_http_access_module.html">ngx_http_access_module</a> ， <a hhref="ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a>和<a hhref="ngx_http_auth_jwt_module.html">ngx_http_auth_jwt_module</a> 。 </p><blockquote class="note">  在1.7.3版之前，无法缓存对授权子请求的响应（使用<a hhref="ngx_http_proxy_module.html#proxy_cache">proxy_cache</a> ， <a hhref="ngx_http_proxy_module.html#proxy_store">proxy_store</a>等）。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location /private/ {<br>    auth_request /auth;<br>    …<br>}<p></p>
<p>location = /auth {<br>    proxy_pass …<br>    proxy_pass_request_body off;<br>    proxy_set_header Content-Length “”;<br>    proxy_set_header X-Original-URI $request_uri;<br>}<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="auth_request"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_request</strong> <code class="notranslate"><i>uri</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">auth_request off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  根据子请求的结果启用授权，并设置子请求将发送到的URI。 </p><a name="auth_request_set"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_request_set</strong> <code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>value</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  授权请求完成后，将请求&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;variable&lt;/i&gt;&lt;/code&gt;设置为给定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; 。  该值可能包含授权请求中的变量，例如&lt;code class=&quot;notranslate&quot;&gt;$upstream_http_*&lt;/code&gt; 。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_auth_jwt_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_auth_jwt_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#auth_jwt">auth_jwt</a> <br>     <a hhref="#auth_jwt_claim_set">auth_jwt_claim_set</a> <br>     <a hhref="#auth_jwt_header_set">auth_jwt_header_set</a> <br>     <a hhref="#auth_jwt_key_file">auth_jwt_key_file</a> <br>     <a hhref="#auth_jwt_key_request">auth_jwt_key_request</a> <br>     <a hhref="#auth_jwt_leeway">auth_jwt_leeway</a> <br> <a hhref="#variables">Embedded Variables</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_auth_jwt_module</code>模块（1.11.3）通过使用指定的密钥验证提供的<a hhref="https://tools.ietf.org/html/rfc7519">JSON Web令牌</a> （JWT）来实现客户端授权。   JWT声明必须以<a hhref="https://tools.ietf.org/html/rfc7515">JSON Web签名</a> （JWS）结构进行编码。  该模块可用于<a hhref="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a>身份验证。 </p><p>  该模块可以通过<a hhref="ngx_http_core_module.html#satisfy">满足</a>指令与其他访问模块组合，例如<a hhref="ngx_http_access_module.html">ngx_http_access_module</a> ， <a hhref="ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a>和<a hhref="ngx_http_auth_request_module.html">ngx_http_auth_request_module</a> 。 </p><p>  该模块支持以下加密<a hhref="https://www.iana.org/assignments/jose/jose.xhtml#web-signature-encryption-algorithms">算法</a> ： </p><ul class="compact"><li>   HS256，HS384，HS512 </li><li>   RS256，RS384，RS512 </li><li>   ES256，ES384，ES512 </li><li>   EdDSA（Ed25519和Ed448签名）（1.15.7） </li></ul><p>  在1.13.7版之前，仅支持HS256，RS256，ES256算法。 </p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    auth_jwt          “closed site”;<br>    auth_jwt_key_file conf/keys.json;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="auth_jwt"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_jwt</strong><br>    <code class="notranslate"><i>string</i></code><br>    [ <code class="notranslate">token=</code> <code class="notranslate"><i>$variable</i></code> ] |<br>    <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">auth_jwt off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">limit_except</code> <br><br>                </td></tr></tbody></table></div><p>  启用JSON Web Token的验证。  指定的<code class="notranslate"><i>string</i></code>用作域。  参数值可以包含变量。 </p><p>  可选的<code class="notranslate">token</code>参数指定包含JSON Web Token的变量。  默认情况下，JWT作为<a hhref="https://tools.ietf.org/html/rfc6750">承载令牌</a>在“授权”标头中传递。   JWT也可以作为cookie或查询字符串的一部分传递： </p><blockquote class="example"><pre class="notranslate">auth_jwt “closed site” token=$cookie_auth_token;<br></pre></blockquote><p></p><p>  特殊值<code class="notranslate">off</code>取消了从先前配置级别继承的<code class="notranslate">auth_jwt</code>伪指令的效果。 </p><a name="auth_jwt_claim_set"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_jwt_claim_set</strong> <code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>name</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.10版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  将&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;variable&lt;/i&gt;&lt;/code&gt;设置为由键名标识的JWT声明参数。  名称匹配从JSON树的顶级开始。  对于数组，变量保留由逗号分隔的数组元素列表。 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;location / {
auth_jwt           &quot;closed site&quot;;
auth_jwt_key_file  conf/keys.json;
auth_jwt_claim_set $email info e-mail;
auth_jwt_claim_set $job info &quot;job title&quot;;
</code></pre><p>}<br></p><p></p><blockquote class="note">  在1.13.7版之前，只能指定一个键名，并且数组的结果未定义。 </blockquote><p></p><a name="auth_jwt_header_set"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_jwt_header_set</strong> <code class="notranslate"><i>$variable</i></code> <code class="notranslate"><i>name</i></code> …;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.10版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  将&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;variable&lt;/i&gt;&lt;/code&gt;设置为由键名标识的JOSE标头参数。  名称匹配从JSON树的顶级开始。  对于数组，变量保留由逗号分隔的数组元素列表。 &lt;/p&gt;&lt;blockquote class=&quot;note&quot;&gt;  在1.13.7版之前，只能指定一个键名，并且数组的结果未定义。 &lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;auth_jwt_key_file&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;auth_jwt_key_file&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;limit_except&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定&lt;a hhref=&quot;https://tools.ietf.org/html/rfc7517#section-5&quot;&gt;JSON Web Key Set&lt;/a&gt;格式的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; ，用于验证JWT签名。  参数值可以包含变量。 &lt;/p&gt;&lt;a name=&quot;auth_jwt_key_request&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;auth_jwt_key_request&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;uri&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;limit_except&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.15.6版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  允许从子请求中检索&lt;a hhref=&quot;https://tools.ietf.org/html/rfc7517#section-5&quot;&gt;JSON Web Key Set&lt;/a&gt;文件以验证JWT签名，并设置子请求将发送到的URI。  为避免验证开销，建议缓存密钥文件： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;proxy_cache_path /data/nginx/cache levels=1 keys_zone=foo:10m;
</code></pre><p>server {<br>    …</p>
<pre><code>location / {
    auth_jwt             &quot;closed site&quot;;
    auth_jwt_key_request /jwks_uri;
}

location = /jwks_uri {
    internal;
    proxy_cache foo;
    proxy_pass  http://idp.example.com/keys;
}
</code></pre><p>}<br></p><p></p><a name="auth_jwt_leeway"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_jwt_leeway</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">auth_jwt_leeway 0s;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.13.10版本中。 </p></div><p>  设置最大允许余地，以在验证<a hhref="https://tools.ietf.org/html/rfc7519#section-4.1.4">exp</a>和<a hhref="https://tools.ietf.org/html/rfc7519#section-4.1.5">nbf</a> JWT声明时补偿时钟偏差。 </p><a name="variables"></a><center><h4>  嵌入式变量 </h4></center><p>   <code class="notranslate">ngx_http_auth_jwt_module</code>模块支持嵌入变量： </p><p></p><dl class="compact"><dt id="var_jwt_header_">   <code class="notranslate">$jwt<em>header</em></code> <code class="notranslate"><i>name</i></code> </dt><dd>  返回指定<a hhref="https://tools.ietf.org/html/rfc7515#section-4">JOSE标头</a>的值 </dd><dt id="var_jwt_claim_">   <code class="notranslate">$jwt<em>claim</em></code> <code class="notranslate"><i>name</i></code> </dt><dd>  返回指定<a hhref="https://tools.ietf.org/html/rfc7519#section-4">JWT声明</a>的值 </dd></dl><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_auth_basic_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_auth_basic_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#auth_basic">auth_basic</a> <br>     <a hhref="#auth_basic_user_file">auth_basic_user_file</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_auth_basic_module</code>模块允许通过使用“HTTP基本身份验证”协议验证用户名和密码来限制对资源的访问。 </p><p>  访问也可以通过<a hhref="ngx_http_access_module.html">地址</a> ， <a hhref="ngx_http_auth_request_module.html">子请求</a>的<a hhref="ngx_http_auth_request_module.html">结果</a>或<a hhref="ngx_http_auth_jwt_module.html">JWT来限制</a> 。  通过地址和密码同时限制访问由<a hhref="ngx_http_core_module.html#satisfy">satisf</a>指令控制。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    auth_basic           “closed site”;<br>    auth_basic_user_file conf/htpasswd;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="auth_basic"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_basic</strong> <code class="notranslate"><i>string</i></code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">auth_basic off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">http</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> , <code class="notranslate">limit_except</code> <br><br>                </td></tr></tbody></table></div><p>  使用“HTTP基本身份验证”协议启用用户名和密码验证。  指定的参数用作域。  参数值可以包含变量（1.3.10,1.2.7）。  特殊值<code class="notranslate">off</code>允许取消从先前配置级别继承的<code class="notranslate">auth_basic</code>伪指令的效果。 </p><a name="auth_basic_user_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>auth_basic_user_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;limit_except&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定保存用户名和密码的文件，格式如下： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;# comment
</code></pre><p>name1:password1<br>name2:password2:comment<br>name3:password3<br></p><p>   <code class="notranslate"><i>file</i></code>名可以包含变量。 </p><p>  支持以下密码类型： </p><ul class="compact"><li>  用<code class="notranslate">crypt()</code>函数加密;  可以使用Apache HTTP Server分发中的“ <code class="notranslate">htpasswd</code> ”实用程序或“ <code class="notranslate">openssl passwd</code> ”命令生成; </li><li>  使用基于MD5的密码算法（apr1）的Apache变体进行散列;  可以使用相同的工具生成; </li><li>  由<a hhref="https://tools.ietf.org/html/rfc2307#section-5.3">RFC 2307中</a>描述的“ <code class="notranslate">{</code> <code class="notranslate"><i>scheme</i></code> <code class="notranslate">}</code> <code class="notranslate"><i>data</i></code> ”语法（1.0.3+）指定;  目前实现的方案包括<code class="notranslate">PLAIN</code> （不应使用示例一）， <code class="notranslate">SHA</code> （1.3.13）（不应使用普通SHA-1哈希）和<code class="notranslate">SSHA</code> （盐渍SHA-1哈希，一些软件包使用，特别是OpenLDAP和Dovecot）。 <blockquote class="note">  仅添加了对<code class="notranslate">SHA</code>方案的支持，以帮助从其他Web服务器迁移。  它不应该用于新密码，因为它使用的无盐SHA-1散列很容易受到<a hhref="http://en.wikipedia.org/wiki/Rainbow_attack">彩虹表</a>攻击。 </blockquote></li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_api_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_api_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#api">api</a> <br>     <a hhref="#status_zone">status<em>zone</em></a> <br> <a hhref="#compatibility">Compatibility</a> <br> <a hhref="#endpoints">Endpoints</a> <br>     <a hhref="#root">/</a> <br>     <a hhref="#nginx">/nginx</a> <br>     <a hhref="#processes">/processes</a> <br>     <a hhref="#connections">/connections</a> <br>     <a hhref="#ssl">/ssl</a> <br>     &lt;a hhref=”#slabs“&gt;/slabs/ <br>     <a hhref="#slabs_slab_zone_name">/slabs/{slabZoneName}</a> <br>     <a hhref="#http_">/http/</a> <br>     <a hhref="#http_requests">/http/requests</a> <br>     <a hhref="#http_server_zones_">/http/server_zones/</a> <br>     <a hhref="#http_server_zones_http_server_zone_name">/http/server_zones/{httpServerZoneName}</a> <br>     <a hhref="#http_caches_">/http/caches/</a> <br>     <a hhref="#http_caches_http_cache_zone_name">/http/caches/{httpCacheZoneName}</a> <br>     <a hhref="#http_upstreams_">/http/upstreams/</a> <br>     <a hhref="#http_upstreams_http_upstream_name_">/http/upstreams/{httpUpstreamName}/</a> <br>     <a hhref="#http_upstreams_http_upstream_name_servers_">/http/upstreams/{httpUpstreamName}/servers/</a> <br>     <a hhref="#http_upstreams_http_upstream_name_servers_http_upstream_server_id">/http/upstreams/{httpUpstreamName}/servers/{httpUpstreamServerId}</a> <br>     <a hhref="#http_keyvals_">/http/keyvals/</a> <br>     <a hhref="#http_keyvals_http_keyval_zone_name">/http/keyvals/{httpKeyvalZoneName}</a> <br>     <a hhref="#stream_">/stream/</a> <br>     <a hhref="#stream_server_zones_">/stream/server_zones/</a> <br>     <a hhref="#stream_server_zones_stream_server_zone_name">/stream/server_zones/{streamServerZoneName}</a> <br>     <a hhref="#stream_upstreams_">/stream/upstreams/</a> <br>     <a hhref="#stream_upstreams_stream_upstream_name_">/stream/upstreams/{streamUpstreamName}/</a> <br>     <a hhref="#stream_upstreams_stream_upstream_name_servers_">/stream/upstreams/{streamUpstreamName}/servers/</a> <br>     <a hhref="#stream_upstreams_stream_upstream_name_servers_stream_upstream_server_id">/stream/upstreams/{streamUpstreamName}/servers/{streamUpstreamServerId}</a> <br>     <a hhref="#stream_keyvals_">/stream/keyvals/</a> <br>     <a hhref="#stream_keyvals_stream_keyval_zone_name">/stream/keyvals/{streamKeyvalZoneName}</a> <br>     <a hhref="#stream_zone_sync_">/stream/zone_sync/</a> <br> <a hhref="#definitions">Response Objects</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_api_module</code>模块（1.13.3）提供REST API，用于访问各种状态信息，即时配置上游服务器组以及管理<a hhref="ngx_http_keyval_module.html">键值对，</a>而无需重新配置nginx。 </p><p></p><blockquote class="note">  该模块取代了<a hhref="ngx_http_status_module.html">ngx_http_status_module</a>和<a hhref="ngx_http_upstream_conf_module.html">ngx_http_upstream_conf_module</a>模块。 </blockquote><p></p><p></p><blockquote class="note">  该模块作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分提供。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">http {<br>    upstream backend {<br>        zone http_backend 64k;<p></p>
<pre><code>    server backend1.example.com weight=5;
    server backend2.example.com;
}

proxy_cache_path /data/nginx/cache_backend keys_zone=cache_backend:10m;

server {
    server_name backend.example.com;

    location / {
        proxy_pass  http://backend;
        proxy_cache cache_backend;

        health_check;
    }

    status_zone server_backend;
}

keyval_zone zone=one:32k state=one.keyval;
keyval $arg_text $text zone=one;

server {
    listen 127.0.0.1;

    location /api {
        &lt;strong&gt;api&lt;/strong&gt; write=on;
        allow 127.0.0.1;
        deny all;
    }
}
</code></pre><p>}</p>
<p>stream {<br>    upstream backend {<br>        zone stream_backend 64k;</p>
<pre><code>    server backend1.example.com:12345 weight=5;
    server backend2.example.com:12345;
}

server {
    listen      127.0.0.1:12345;
    proxy_pass  backend;
    status_zone server_backend;
    health_check;
}
</code></pre><p>}<br></p></pre></blockquote><p>  所有API请求都包含URI中支持的API <a hhref="#api_version">版本</a> 。  使用此配置的API请求示例： </p><blockquote class="example"><pre class="notranslate"><a href="http://127.0.0.1/api/3/" target="_blank" rel="noopener">http://127.0.0.1/api/3/</a><br><a href="http://127.0.0.1/api/3/nginx" target="_blank" rel="noopener">http://127.0.0.1/api/3/nginx</a><br><a href="http://127.0.0.1/api/3/connections" target="_blank" rel="noopener">http://127.0.0.1/api/3/connections</a><br><a href="http://127.0.0.1/api/3/http/requests" target="_blank" rel="noopener">http://127.0.0.1/api/3/http/requests</a><br><a href="http://127.0.0.1/api/3/http/server_zones/server_backend" target="_blank" rel="noopener">http://127.0.0.1/api/3/http/server_zones/server_backend</a><br><a href="http://127.0.0.1/api/3/http/caches/cache_backend" target="_blank" rel="noopener">http://127.0.0.1/api/3/http/caches/cache_backend</a><br><a href="http://127.0.0.1/api/3/http/upstreams/backend" target="_blank" rel="noopener">http://127.0.0.1/api/3/http/upstreams/backend</a><br><a href="http://127.0.0.1/api/3/http/upstreams/backend/servers/" target="_blank" rel="noopener">http://127.0.0.1/api/3/http/upstreams/backend/servers/</a><br><a href="http://127.0.0.1/api/3/http/upstreams/backend/servers/1" target="_blank" rel="noopener">http://127.0.0.1/api/3/http/upstreams/backend/servers/1</a><br><a href="http://127.0.0.1/api/3/http/keyvals/one?key=arg1" target="_blank" rel="noopener">http://127.0.0.1/api/3/http/keyvals/one?key=arg1</a><br><a href="http://127.0.0.1/api/3/stream/" target="_blank" rel="noopener">http://127.0.0.1/api/3/stream/</a><br><a href="http://127.0.0.1/api/3/stream/server_zones/server_backend" target="_blank" rel="noopener">http://127.0.0.1/api/3/stream/server_zones/server_backend</a><br><a href="http://127.0.0.1/api/3/stream/upstreams/" target="_blank" rel="noopener">http://127.0.0.1/api/3/stream/upstreams/</a><br><a href="http://127.0.0.1/api/3/stream/upstreams/backend" target="_blank" rel="noopener">http://127.0.0.1/api/3/stream/upstreams/backend</a><br><a href="http://127.0.0.1/api/3/stream/upstreams/backend/servers/1" target="_blank" rel="noopener">http://127.0.0.1/api/3/stream/upstreams/backend/servers/1</a><br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="api"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>api</strong><br>[ <code class="notranslate">write</code> = <code class="notranslate">on</code> | <code class="notranslate">off</code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  打开周围位置的REST API接口。  应&lt;a hhref=&quot;ngx_http_core_module.html#satisfy&quot;&gt;限制&lt;/a&gt;访问此位置。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;write&lt;/code&gt;参数确定API是只读还是读写。  默认情况下，API是只读的。 &lt;/p&gt;&lt;a name=&quot;api_version&quot;&gt;&lt;/a&gt;&lt;p&gt;  所有API请求都应在URI中包含受支持的API版本。  如果请求URI等于位置前缀，则返回支持的API版本列表。  当前的API版本为“ &lt;code class=&quot;notranslate&quot;&gt;3&lt;/code&gt; ”。 &lt;/p&gt;&lt;p&gt;  请求行中的可选“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”参数指定将输出所请求对象的哪些字段： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;http://127.0.0.1/api/3/nginx?fields=version,build
</code></pre><p></p><p></p><a name="status_zone"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>status_zone</strong> <code class="notranslate"><i>zone</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.13.12版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  允许在指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;zone&lt;/i&gt;&lt;/code&gt;收集虚拟&lt;a hhref=&quot;ngx_http_core_module.html#server&quot;&gt;http&lt;/a&gt;或&lt;a hhref=&quot;stream/ngx_stream_core_module.html#server&quot;&gt;流&lt;/a&gt;服务器状态信息。  多个服务器可能共享同一个区域。 &lt;/p&gt;&lt;a name=&quot;compatibility&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  兼容性 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;&lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   &lt;a hhref=&quot;#stream_zone_sync_&quot;&gt;/ stream / zone_sync /&lt;/a&gt; data在&lt;a hhref=&quot;#api_version&quot;&gt;版本&lt;/a&gt; 3中添加。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#api_version&quot;&gt;版本&lt;/a&gt; 2中添加了&lt;a hhref=&quot;#def_nginx_http_upstream_conf_server&quot;&gt;drain&lt;/a&gt;参数。 &lt;/li&gt;&lt;li&gt;   &lt;a hhref=&quot;#stream_keyvals_&quot;&gt;/ stream / keyvals /&lt;/a&gt; data在&lt;a hhref=&quot;#api_version&quot;&gt;版本&lt;/a&gt; 2中添加。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;endpoints&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  端点 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;&lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt id=&quot;root&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getAPIEndpoints&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回根端点列表 &lt;p&gt;  返回根端点列表。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回一个字符串数组 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;nginx&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/nginx&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getNginx&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回nginx运行实例的状态 &lt;p&gt;  返回nginx版本，构建名称，地址，配置重新加载次数，主进程和工作进程的ID。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出运行实例的nginx字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_object&quot;&gt;nginx&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;processes&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/processes&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getProcesses&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回nginx进程状态 &lt;p&gt;  返回异常终止和重生的子进程的数量。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，退货&lt;a hhref=&quot;#def_nginx_processes&quot;&gt;流程&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteProcesses&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置nginx处理统计信息 &lt;p&gt;  重置异常终止和重生的子进程的计数器。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;connections&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/connections&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getConnections&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回客户端连接统计信息 &lt;p&gt;  返回客户端连接的统计信息 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出连接统计信息的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_connections&quot;&gt;连接&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteConnections&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置客户端连接统计信息 &lt;p&gt;  重置已接受和已删除客户端连接的统计信息。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;ssl&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/ssl&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getSsl&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回SSL统计信息 &lt;p&gt;  返回SSL统计信息。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出SSL统计信息的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_ssl_object&quot;&gt;SSL&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteSslStat&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置SSL统计信息 &lt;p&gt;  重置SSL握手和会话重用的计数器。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;slabs_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/slabs/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getSlabs&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 所有楼板的返回状态 &lt;p&gt;  使用slab分配器返回每个共享内存区域的slab状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出板区域的哪些区域。  如果“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”值为空，则仅输出区域名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回所有楼板的“ &lt;a hhref=&quot;#def_nginx_slab_zone&quot;&gt;带有slab分配器的共享内存区域&lt;/a&gt; ”对象的集合 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;slabs_slab_zone_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/slabs/{slabZoneName}&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;slabZoneName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  带有slab分配器的共享内存区域的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getSlabZone&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回板的状态 &lt;p&gt;  使用slab分配器返回特定共享内存区域的slab状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出板区域的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_slab_zone&quot;&gt;带有slab分配器的共享内存区域&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到平板（ &lt;code class=&quot;notranslate&quot;&gt;SlabNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteSlabZoneStats&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置slab统计信息 &lt;p&gt;  重置每个内存插槽的“ &lt;code class=&quot;notranslate&quot;&gt;reqs&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;reqs&lt;/code&gt; ”指标。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   404  - 未找到平板（ &lt;code class=&quot;notranslate&quot;&gt;SlabNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttp&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回与HTTP相关的端点列表 &lt;p&gt;  返回第一级HTTP端点的列表。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回一个字符串数组 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_requests&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/requests&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpRequests&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回HTTP请求统计信息 &lt;p&gt;  返回客户端HTTP请求的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出客户端HTTP请求统计信息的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_requests&quot;&gt;HTTP请求&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteHttpRequests&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置HTTP请求统计信息 &lt;p&gt;  重置客户端HTTP请求总数。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_server_zones_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/server_zones/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpServerZones&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回所有HTTP服务器区域的状态 &lt;p&gt;  返回每个HTTP &lt;a hhref=&quot;https://nginx.org/en/http/ngx_http_api_module.html#status_zone&quot;&gt;服务器区域的&lt;/a&gt;状态信息。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出服务器区域的哪些字段。  如果“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”值为空，则仅输出服务器区域名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回所有http服务器区域的“ &lt;a hhref=&quot;#def_nginx_http_server_zone&quot;&gt;HTTP服务器区域&lt;/a&gt; ”对象的集合 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_server_zones_http_server_zone_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/server_zones/{httpServerZoneName}&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;httpServerZoneName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;   HTTP服务器区域的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpServerZone&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回HTTP服务器区域的状态 &lt;p&gt;  返回特定HTTP服务器区域的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出服务器区域的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_server_zone&quot;&gt;HTTP服务器区域&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 找不到服务器区域（ &lt;code class=&quot;notranslate&quot;&gt;ServerZoneNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteHttpServerZoneStat&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置HTTP服务器区域的统计信息 &lt;p&gt;  重置特定HTTP服务器区域中接受和丢弃的请求，响应，接收和发送字节的统计信息。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   404  - 找不到服务器区域（ &lt;code class=&quot;notranslate&quot;&gt;ServerZoneNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_caches_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/caches/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpCaches&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回所有缓存的状态 &lt;p&gt;  返回由&lt;a hhref=&quot;https://nginx.org/en/http/ngx_http_proxy_module.html#proxy_cache_path&quot;&gt;proxy_cache_path&lt;/a&gt;和其他“ &lt;code class=&quot;notranslate&quot;&gt;*_cache_path&lt;/code&gt; ”指令配置的每个缓存的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出缓存区域的哪些字段。  如果“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”值为空，则仅输出缓存区的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回所有http缓存的“ &lt;a hhref=&quot;#def_nginx_http_cache&quot;&gt;HTTP缓存&lt;/a&gt; ”对象集合 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_caches_http_cache_zone_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/caches/{httpCacheZoneName}&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;httpCacheZoneName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  缓存区的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpCacheZone&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回缓存的状态 &lt;p&gt;  返回特定缓存的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出缓存区的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_cache&quot;&gt;HTTP缓存&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到缓存（ &lt;code class=&quot;notranslate&quot;&gt;CacheNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteHttpCacheZoneStat&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置缓存统计信息 &lt;p&gt;  重置特定缓存区域中缓存命中/未命中的统计信息。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   404  - 未找到缓存（ &lt;code class=&quot;notranslate&quot;&gt;CacheNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_upstreams_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/upstreams/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpUpstreams&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回所有HTTP上游服务器组的状态 &lt;p&gt;  返回每个HTTP上游服务器组及其服务器的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出上游服务器组的哪些字段。  如果“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”值为空，则仅输出上游的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  -  Success，返回所有http上游的“ &lt;a hhref=&quot;#def_nginx_http_upstream&quot;&gt;HTTP Upstream&lt;/a&gt; ”对象集合 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_upstreams_http_upstream_name_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/upstreams/{httpUpstreamName}/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;httpUpstreamName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;   HTTP上游服务器组的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpUpstreamName&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; -  HTTP上游服务器组的返回状态 &lt;p&gt;  返回特定HTTP上游服务器组及其服务器的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出上游服务器组的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_upstream&quot;&gt;HTTP上游&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 找不到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteHttpUpstreamStat&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置HTTP上游服务器组的统计信息 &lt;p&gt;  重置上游服务器组中每个上游服务器的统计信息和队列统计信息。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 找不到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_upstreams_http_upstream_name_servers_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/upstreams/{httpUpstreamName}/servers/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;httpUpstreamName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  上游服务器组的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpUpstreamServers&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回HTTP上游服务器组中所有服务器的配置 &lt;p&gt;  返回特定HTTP上游服务器组中每个服务器的配置。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_upstream_conf_server&quot;&gt;HTTP上游服务器&lt;/a&gt;阵列 &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 找不到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;postHttpUpstreamServer&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; - 将服务器添加到HTTP上游服务器组 &lt;p&gt;  将新服务器添加到HTTP上游服务器组。  服务器参数以JSON格式指定。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;postHttpUpstreamServer&lt;/code&gt; （ &lt;a hhref=&quot;#def_nginx_http_upstream_conf_server&quot;&gt;HTTP上游服务器&lt;/a&gt; ，必需） &lt;/dt&gt;&lt;dd&gt;   JSON格式的新服务器和其他可选参数的地址。  无法更改“ &lt;code class=&quot;notranslate&quot;&gt;ID&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;backup&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; ”参数。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   201  - 创建，返回&lt;a hhref=&quot;#def_nginx_http_upstream_conf_server&quot;&gt;HTTP上游服务器&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  - 上游是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameter&lt;/i&gt;&lt;/code&gt; ”值（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），缺少“ &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; ”参数（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），未知参数“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），嵌套对象或列表（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），解析时&lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; “ &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），服务上游“ &lt;code class=&quot;notranslate&quot;&gt;host&lt;/code&gt; ”可能没有端口（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），服务上游“ &lt;code class=&quot;notranslate&quot;&gt;host&lt;/code&gt; ”需要域名（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;weight&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadWeight&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadMaxConns&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;max_fails&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadMaxFails&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadFailTimeout&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;slow_start&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadSlowStart&lt;/code&gt; ），路径太长（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadRoute&lt;/code&gt; ），“ &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; ”为空（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadService&lt;/code&gt; ），没有解析定义解析（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfNoResolver&lt;/code&gt; ），上游“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ”没有备份（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNoBackup&lt;/code&gt; ），上游“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ”内存耗尽（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamOutOfMemory&lt;/code&gt;   &lt;code class=&quot;notranslate&quot;&gt;UpstreamOutOfMemory&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 找不到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   415  -  JSON错误（ &lt;code class=&quot;notranslate&quot;&gt;JsonError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_upstreams_http_upstream_name_servers_http_upstream_server_id&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/upstreams/{httpUpstreamName}/servers/{httpUpstreamServerId}&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;httpUpstreamName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  上游服务器组的名称。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;httpUpstreamServerId&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  服务器的ID。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpUpstreamPeer&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回HTTP上游服务器组中服务器的配置 &lt;p&gt;  返回HTTP上游服务器组中特定服务器的配置。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_upstream_conf_server&quot;&gt;HTTP上游服务器&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），无效的服务器ID（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadServerId&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），ID为“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt; ”的服务器不存在（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;patchHttpUpstreamPeer&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; - 修改HTTP上游服务器组中的服务器 &lt;p&gt;  修改HTTP上游服务器组中特定服务器的设置。  服务器参数以JSON格式指定。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;patchHttpUpstreamServer&lt;/code&gt; （ &lt;a hhref=&quot;#def_nginx_http_upstream_conf_server&quot;&gt;HTTP上游服务器&lt;/a&gt; ，必需） &lt;/dt&gt;&lt;dd&gt;  服务器参数，以JSON格式指定。  无法更改“ &lt;code class=&quot;notranslate&quot;&gt;ID&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;backup&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; ”参数。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_upstream_conf_server&quot;&gt;HTTP上游服务器&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  - 上游是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameter&lt;/i&gt;&lt;/code&gt; ”值（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），未知参数“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），嵌套对象或列表（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），解析时的“ &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; ”参数（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），无效的服务器ID（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadServerId&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;weight&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadWeight&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadMaxConns&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;max_fails&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadMaxFails&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadFailTimeout&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;slow_start&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadSlowStart&lt;/code&gt; ），路由太长（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadRoute&lt;/code&gt; ），“ &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; ”为空（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadService&lt;/code&gt; ），服务器“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ID&lt;/i&gt;&lt;/code&gt; ”地址是不可变的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerImmutable&lt;/code&gt; ），服务器“ &lt;code class=&quot;notranslate&quot;&gt;ID&lt;/code&gt; ”权重是不可变的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerWeightImmutable&lt;/code&gt; ），上游“ &lt;code class=&quot;notranslate&quot;&gt;name&lt;/code&gt; ”内存耗尽（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamOutOfMemory&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），ID为“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt; ”的服务器不存在（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   415  -  JSON错误（ &lt;code class=&quot;notranslate&quot;&gt;JsonError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteHttpUpstreamServer&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 从HTTP上游服务器组中删除服务器 &lt;p&gt;  从HTTP上游服务器组中删除服务器。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_upstream_conf_server&quot;&gt;HTTP上游服务器&lt;/a&gt;阵列 &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），无效的服务器ID（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadServerId&lt;/code&gt; ），服务器“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt; ”不可移动（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerImmutable&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），ID为“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt; ”的服务器不存在（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_keyvals_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/keyvals/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpKeyvalZones&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 从所有HTTP keyval区域返回键值对 &lt;p&gt;  返回每个HTTP keyval共享内存&lt;a hhref=&quot;https://nginx.org/en/http/ngx_http_keyval_module.html#keyval_zone&quot;&gt;区域&lt;/a&gt;的键值对。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  如果“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”值为空，则仅输出HTTP keyval区域名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回所有http密钥的“ &lt;a hhref=&quot;#def_nginx_http_keyval_zone&quot;&gt;HTTP Keyval共享内存区域&lt;/a&gt; ”对象的集合 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;http_keyvals_http_keyval_zone_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/http/keyvals/{httpKeyvalZoneName}&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;httpKeyvalZoneName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;   HTTP keyval共享内存区域的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getHttpKeyvalZoneKeysValues&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 从HTTP键区域返回键值对 &lt;p&gt;  返回存储在特定HTTP keyval共享内存&lt;a hhref=&quot;https://nginx.org/en/http/ngx_http_keyval_module.html#keyval_zone&quot;&gt;区域&lt;/a&gt;中的键值对。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;key&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  从HTTP keyval区域获取特定的键值对。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_http_keyval_zone&quot;&gt;HTTP Keyval共享内存区域&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; ），未找到keyval键（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalKeyNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;postHttpKeyvalZoneData&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; - 将键值对添加到HTTP键值区域 &lt;p&gt;  向HTTP keyval共享内存&lt;a hhref=&quot;https://nginx.org/en/http/ngx_http_keyval_module.html#keyval_zone&quot;&gt;区域&lt;/a&gt;添加新的键值对。  如果HTTP keyval共享内存区域为空，则可以输入多个键值对。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;Key-value&lt;/code&gt; （ &lt;a hhref=&quot;#def_nginx_http_keyval_zone&quot;&gt;HTTP Keyval共享内存区域&lt;/a&gt; ，必需） &lt;/dt&gt;&lt;dd&gt;  键值对以JSON格式指定。  如果HTTP keyval共享内存区域为空，则可以输入多个键值对。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   201  - 创建 &lt;/li&gt;&lt;li&gt;   400  - 需要密钥（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），只能添加一个密钥（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），嵌套对象或列表（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   409  - 密钥已存在（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalKeyExists&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   415  -  JSON错误（ &lt;code class=&quot;notranslate&quot;&gt;JsonError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;patchHttpKeyvalZoneKeyValue&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; - 修改键值或删除键 &lt;p&gt;  更改键值对中所选键的值，或通过将键值设置为&lt;code class=&quot;notranslate&quot;&gt;null&lt;/code&gt;来删除键。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;httpKeyvalZoneKeyValue&lt;/code&gt; （ &lt;a hhref=&quot;#def_nginx_http_keyval_zone&quot;&gt;HTTP Keyval共享内存区域&lt;/a&gt; ，必需） &lt;/dt&gt;&lt;dd&gt;  密钥的新值以JSON格式指定。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   400  - 需要密钥（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），只能更新一个密钥（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），嵌套对象或列表（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; ），未找到keyval键（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalKeyNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   415  -  JSON错误（ &lt;code class=&quot;notranslate&quot;&gt;JsonError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteHttpKeyvalZoneData&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 清空HTTP keyval区域 &lt;p&gt;  从HTTP keyval共享内存&lt;a hhref=&quot;https://nginx.org/en/http/ngx_http_keyval_module.html#keyval_zone&quot;&gt;区域中&lt;/a&gt;删除所有键值对。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStream&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回与流相关的端点列表 &lt;p&gt;  返回第一级流端点的列表。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回一个字符串数组 &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_server_zones_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/server_zones/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamServerZones&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回所有流服务器区域的状态 &lt;p&gt;  返回每个流&lt;a hhref=&quot;https://nginx.org/en/http/ngx_http_api_module.html#status_zone&quot;&gt;服务器区域的&lt;/a&gt;状态信息。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出服务器区域的哪些字段。  如果“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”值为空，则仅输出服务器区域名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回所有流服务器区域的“ &lt;a hhref=&quot;#def_nginx_stream_server_zone&quot;&gt;Stream Server Zone&lt;/a&gt; ”对象集合 &lt;/li&gt;&lt;li&gt;   404  - 未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_server_zones_stream_server_zone_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/server_zones/{streamServerZoneName}&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;streamServerZoneName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  流服务器区域的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamServerZone&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回流服务器区域的状态 &lt;p&gt;  返回特定流服务器区域的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出服务器区域的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_stream_server_zone&quot;&gt;Stream Server Zone&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到服务器区域（ &lt;code class=&quot;notranslate&quot;&gt;ServerZoneNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteStreamServerZoneStat&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置流服务器区域的统计信息 &lt;p&gt;  重置特定流服务器区域中接受和丢弃的连接，会话，接收和发送字节的统计信息。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   404  - 未找到服务器区域（ &lt;code class=&quot;notranslate&quot;&gt;ServerZoneNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_upstreams_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/upstreams/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamUpstreams&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回所有流上游服务器组的状态 &lt;p&gt;  返回每个流上游服务器组及其服务器的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出上游服务器组的哪些字段。  如果“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”值为空，则仅输出上游的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，为所有流上游返回“ &lt;a hhref=&quot;#def_nginx_stream_upstream&quot;&gt;Stream Upstream&lt;/a&gt; ”对象的集合 &lt;/li&gt;&lt;li&gt;   404  - 未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_upstreams_stream_upstream_name_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/upstreams/{streamUpstreamName}/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;streamUpstreamName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  流上游服务器组的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamUpstream&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回流上游服务器组的状态 &lt;p&gt;  返回特定流上游服务器组及其服务器的状态。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  限制将输出上游服务器组的哪些字段。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_stream_upstream&quot;&gt;Stream Upstream&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteStreamUpstreamStat&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 重置流上游服务器组的统计信息 &lt;p&gt;  重置上游服务器组中每个上游服务器的统计信息。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_upstreams_stream_upstream_name_servers_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/upstreams/{streamUpstreamName}/servers/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;streamUpstreamName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  上游服务器组的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamUpstreamServers&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回流上游服务器组中所有服务器的配置 &lt;p&gt;  返回特定流上游服务器组中每个服务器的配置。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回一组&lt;a hhref=&quot;#def_nginx_stream_upstream_conf_server&quot;&gt;Stream Upstream Servers&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;postStreamUpstreamServer&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; - 将服务器添加到流上游服务器组 &lt;p&gt;  将新服务器添加到流上游服务器组。  服务器参数以JSON格式指定。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;postStreamUpstreamServer&lt;/code&gt; （ &lt;a hhref=&quot;#def_nginx_stream_upstream_conf_server&quot;&gt;Stream Upstream Server&lt;/a&gt; ，必需） &lt;/dt&gt;&lt;dd&gt;   JSON格式的新服务器和其他可选参数的地址。  无法更改“ &lt;code class=&quot;notranslate&quot;&gt;ID&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;backup&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; ”参数。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   201  - 创建，返回&lt;a hhref=&quot;#def_nginx_stream_upstream_conf_server&quot;&gt;Stream Upstream Server&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  - 上游是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameter&lt;/i&gt;&lt;/code&gt; ”值（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），缺少“ &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; ”参数（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），未知参数“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），嵌套对象或列表（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），解析时&lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; “ &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），服务器“ &lt;code class=&quot;notranslate&quot;&gt;host&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ）中没有端口，服务上游“ &lt;code class=&quot;notranslate&quot;&gt;host&lt;/code&gt; ”可能没有端口（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），服务上游“ &lt;code class=&quot;notranslate&quot;&gt;host&lt;/code&gt; ”需要域名（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;weight&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadWeight&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt; “（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadMaxConns&lt;/code&gt; ），无效” &lt;code class=&quot;notranslate&quot;&gt;max_fails&lt;/code&gt; “（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadMaxFails&lt;/code&gt; ），无效” &lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt; “（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadFailTimeout&lt;/code&gt; ），无效” &lt;code class=&quot;notranslate&quot;&gt;slow_start&lt;/code&gt; “（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadSlowStart&lt;/code&gt; ），” &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; “为空（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadService&lt;/code&gt; ），无法解析解析器（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfNoResolver&lt;/code&gt; ），上游” &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; “没有备份（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNoBackup&lt;/code&gt; ），上游” &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; “内存耗尽（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamOutOfMemory&lt;/code&gt;   &lt;code class=&quot;notranslate&quot;&gt;UpstreamOutOfMemory&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   415  -  JSON错误（ &lt;code class=&quot;notranslate&quot;&gt;JsonError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_upstreams_stream_upstream_name_servers_stream_upstream_server_id&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/upstreams/{streamUpstreamName}/servers/{streamUpstreamServerId}&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;streamUpstreamName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  上游服务器组的名称。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;streamUpstreamServerId&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，required） &lt;/dt&gt;&lt;dd&gt;  服务器的ID。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamUpstreamServer&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回流上游服务器组中服务器的配置 &lt;p&gt;  返回流上游服务器组中特定服务器的配置。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_stream_upstream_conf_server&quot;&gt;Stream Upstream Server&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），无效的服务器ID（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadServerId&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  -  Upstream not found（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），ID为“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt; ”的服务器不存在（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerNotFound&lt;/code&gt; ）， &lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt;未配置（ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;patchStreamUpstreamServer&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; - 修改流上游服务器组中的服务器 &lt;p&gt;  修改流上游服务器组中特定服务器的设置。  服务器参数以JSON格式指定。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;patchStreamUpstreamServer&lt;/code&gt; （ &lt;a hhref=&quot;#def_nginx_stream_upstream_conf_server&quot;&gt;Stream Upstream Server&lt;/a&gt; ，必需） &lt;/dt&gt;&lt;dd&gt;  服务器参数，以JSON格式指定。  无法更改“ &lt;code class=&quot;notranslate&quot;&gt;ID&lt;/code&gt; ”，“ &lt;code class=&quot;notranslate&quot;&gt;backup&lt;/code&gt; ”和“ &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; ”参数。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_stream_upstream_conf_server&quot;&gt;Stream Upstream Server&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  - 上游是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;parameter&lt;/i&gt;&lt;/code&gt; ”值（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），未知参数“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），嵌套对象或列表（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamConfFormatError&lt;/code&gt; ），解析时的“ &lt;code class=&quot;notranslate&quot;&gt;error&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），无效的“ &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; ”参数（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ），服务器“ &lt;code class=&quot;notranslate&quot;&gt;host&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadAddress&lt;/code&gt; ）中没有端口，服务器ID无效（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadServerId&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;weight&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadWeight&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;max_conns&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadMaxConns&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;max_fails&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadMaxFails&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;fail_timeout&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadFailTimeout&lt;/code&gt; ），无效“ &lt;code class=&quot;notranslate&quot;&gt;slow_start&lt;/code&gt; ”（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadSlowStart&lt;/code&gt; ），“ &lt;code class=&quot;notranslate&quot;&gt;service&lt;/code&gt; ”为空（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadService&lt;/code&gt; ），服务器“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ID&lt;/i&gt;&lt;/code&gt; ”地址为不可变（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerImmutable&lt;/code&gt; ），服务器“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;ID&lt;/i&gt;&lt;/code&gt; ”权重为不可变（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerWeightImmutable&lt;/code&gt; ），上游“ &lt;code class=&quot;notranslate&quot;&gt;name&lt;/code&gt; ”内存耗尽（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamOutOfMemory&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  -  Upstream not found（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），ID为“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt; ”的服务器不存在（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerNotFound&lt;/code&gt; ）， &lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt;未配置（ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   415  -  JSON错误（ &lt;code class=&quot;notranslate&quot;&gt;JsonError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteStreamUpstreamServer&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 从流上游服务器组中删除服务器 &lt;p&gt;  从流服务器组中删除服务器。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回一组&lt;a hhref=&quot;#def_nginx_stream_upstream_conf_server&quot;&gt;Stream Upstream Servers&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   400  -  Upstream是静态的（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamStatic&lt;/code&gt; ），无效的服务器ID（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamBadServerId&lt;/code&gt; ），服务器“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt; ”不可移动（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerImmutable&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  -  Upstream not found（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamNotFound&lt;/code&gt; ），ID为“ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;id&lt;/i&gt;&lt;/code&gt; ”的服务器不存在（ &lt;code class=&quot;notranslate&quot;&gt;UpstreamServerNotFound&lt;/code&gt; ）， &lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt;未配置（ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_keyvals_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/keyvals/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamKeyvalZones&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 从所有流键区域返回键值对 &lt;p&gt;  返回每个流keyval共享内存&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_keyval_module.html#keyval_zone&quot;&gt;区域&lt;/a&gt;的键值对。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  如果“ &lt;code class=&quot;notranslate&quot;&gt;fields&lt;/code&gt; ”值为空，则仅输出流密钥区域名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回所有流关键字的“ &lt;a hhref=&quot;#def_nginx_stream_keyval_zone&quot;&gt;Stream Keyval Shared Memory Zone&lt;/a&gt; ”对象的集合 &lt;/li&gt;&lt;li&gt;   404  - 未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_keyvals_stream_keyval_zone_name&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/keyvals/{streamKeyvalZoneName}&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;  所有方法通用的参数： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;streamKeyvalZoneName&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，必填） &lt;/dt&gt;&lt;dd&gt;  流keyval共享内存区域的名称。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamKeyvalZoneKeysValues&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 从流键区域返回键 - 值对 &lt;p&gt;  返回存储在特定流keyval共享内存&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_keyval_module.html#keyval_zone&quot;&gt;区域&lt;/a&gt;中的键值对。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;key&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ，可选） &lt;/dt&gt;&lt;dd&gt;  从流密钥区域获取特定键值对。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_stream_keyval_zone&quot;&gt;Stream Keyval共享内存区域&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; ），未找到keyval键（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalKeyNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;postStreamKeyvalZoneData&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;POST&lt;/code&gt; - 将键值对添加到流键值区域 &lt;p&gt;  将新键值对添加到流键值共享内存&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_keyval_module.html#keyval_zone&quot;&gt;区域&lt;/a&gt; 。  如果流键值共享内存区域为空，则可以输入多个键值对。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;Key-value&lt;/code&gt; （ &lt;a hhref=&quot;#def_nginx_stream_keyval_zone&quot;&gt;Stream Keyval共享内存区域&lt;/a&gt; ，必需） &lt;/dt&gt;&lt;dd&gt;  键值对以JSON格式指定。  如果流键值共享内存区域为空，则可以输入多个键值对。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   201  - 创建 &lt;/li&gt;&lt;li&gt;   400  - 需要密钥（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），只能添加一个密钥（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），嵌套对象或列表（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   409  - 密钥已存在（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalKeyExists&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   415  -  JSON错误（ &lt;code class=&quot;notranslate&quot;&gt;JsonError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;patchStreamKeyvalZoneKeyValue&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;PATCH&lt;/code&gt; - 修改键值或删除键 &lt;p&gt;  更改键值对中所选键的值，或通过将键值设置为&lt;code class=&quot;notranslate&quot;&gt;null&lt;/code&gt;来删除键。 &lt;/p&gt;&lt;p&gt;  请求参数： &lt;/p&gt;&lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;streamKeyvalZoneKeyValue&lt;/code&gt; （ &lt;a hhref=&quot;#def_nginx_stream_keyval_zone&quot;&gt;Stream Keyval共享内存区域&lt;/a&gt; ，必需） &lt;/dt&gt;&lt;dd&gt;  密钥的新值以JSON格式指定。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   400  - 需要密钥（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），只能更新一个密钥（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），嵌套对象或列表（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalFormatError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; ），未找到keyval键（ &lt;code class=&quot;notranslate&quot;&gt;KeyvalKeyNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   415  -  JSON错误（ &lt;code class=&quot;notranslate&quot;&gt;JsonError&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li id=&quot;deleteStreamKeyvalZoneData&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;DELETE&lt;/code&gt; - 清空流键值区域 &lt;p&gt;  从流keyval共享内存&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_keyval_module.html#keyval_zone&quot;&gt;区域中&lt;/a&gt;删除所有键值对。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   204  - 成功 &lt;/li&gt;&lt;li&gt;   404  - 未找到&lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;KeyvalNotFound&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   405  - 禁用方法（ &lt;code class=&quot;notranslate&quot;&gt;MethodDisabled&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;Error&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;dt id=&quot;stream_zone_sync_&quot;&gt; &lt;code class=&quot;notranslate&quot;&gt;/stream/zone_sync/&lt;/code&gt; &lt;/dt&gt; &lt;dd&gt;&lt;p&gt;  支持的方法： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;getStreamZoneSync&quot;&gt;   &lt;code class=&quot;notranslate&quot;&gt;GET&lt;/code&gt; - 返回节点的同步状态 &lt;p&gt;  返回群集节点的同步状态。 &lt;/p&gt;&lt;p&gt;  可能的回应： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;   200  - 成功，返回&lt;a hhref=&quot;#def_nginx_stream_zone_sync&quot;&gt;Stream Zone Sync节点&lt;/a&gt; &lt;/li&gt;&lt;li&gt;   404  - 未配置区域同步（ &lt;code class=&quot;notranslate&quot;&gt;ZoneSyncNotConfigured&lt;/code&gt; ），未配置&lt;a hhref=&quot;https://nginx.org/en/stream/ngx_stream_core_module.html#stream&quot;&gt;流&lt;/a&gt; （ &lt;code class=&quot;notranslate&quot;&gt;StreamNotConfigured&lt;/code&gt; ），返回&lt;a hhref=&quot;#def_nginx_error&quot;&gt;错误&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;&lt;/p&gt;&lt;a name=&quot;definitions&quot;&gt;&lt;/a&gt;&lt;center&gt;&lt;h4&gt;  响应对象 &lt;/h4&gt;&lt;/center&gt;&lt;p&gt;&lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li id=&quot;def_nginx_object&quot;&gt;&lt;p&gt;   nginx的： &lt;/p&gt;  有关nginx的一般信息： &lt;dl class=&quot;compact&quot;&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;version&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ） &lt;/dt&gt;&lt;dd&gt;   nginx的版本。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;build&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ） &lt;/dt&gt;&lt;dd&gt;   nginx构建的名称。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;address&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ） &lt;/dt&gt;&lt;dd&gt;  接受状态请求的服务器的地址。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;generation&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;integer&lt;/code&gt; ） &lt;/dt&gt;&lt;dd&gt;  配置&lt;a hhref=&quot;https://nginx.org/en/control.html#reconfiguration&quot;&gt;重新加载&lt;/a&gt;的总数。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;load_timestamp&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ） &lt;/dt&gt;&lt;dd&gt;  上次重新加载配置的时间，采用ISO 8601格式，分辨率为毫秒。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;timestamp&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;string&lt;/code&gt; ） &lt;/dt&gt;&lt;dd&gt;   ISO 8601格式的当前时间，分辨率为毫秒。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;pid&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;integer&lt;/code&gt; ） &lt;/dt&gt;&lt;dd&gt;  处理状态请求的工作进程的ID。 &lt;/dd&gt;&lt;dt&gt;   &lt;code class=&quot;notranslate&quot;&gt;ppid&lt;/code&gt; （ &lt;code class=&quot;notranslate&quot;&gt;integer&lt;/code&gt; ） &lt;/dt&gt;&lt;dd&gt;  启动&lt;a hhref=&quot;https://nginx.org/en/http/ngx_http_status_module.html#pid&quot;&gt;工作进程&lt;/a&gt;的主进程的ID。 &lt;/dd&gt;&lt;/dl&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;{
</code></pre><p>  “nginx” : {<br>    “version” : “1.15.2”,<br>    “build” : “nginx-plus-r16”,<br>    “address” : “206.251.255.64”,<br>    “generation” : 6,<br>    “load_timestamp” : “2018-10-08T09:05:48.776Z”,<br>    “timestamp” : “2018-10-08T15:23:17.056Z”,<br>    “pid” : 32212,<br>    “ppid” : 32210<br>  }<br>}<li id="def_nginx_processes"><p>  流程： </p><dl class="compact"><dt>   <code class="notranslate">respawned</code> （ <code class="notranslate">integer</code> ） </dt><dd>  异常终止和重生的子进程的总数。 </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “respawned” : 0<br>}</pre></blockquote></li><li id="def_nginx_connections"><p>  连接： </p>  已接受，已删除，活动和空闲连接的数量。 <dl class="compact"><dt>   <code class="notranslate">accepted</code> （ <code class="notranslate">integer</code> ） </dt><dd>  已接受的客户端连接总数。 </dd><dt>   <code class="notranslate">dropped</code> （ <code class="notranslate">integer</code> ） </dt><dd>  已删除的客户端连接总数。 </dd><dt>   <code class="notranslate">active</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前活动客户端连接数。 </dd><dt>   <code class="notranslate">idle</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前空闲客户端连接数。 </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “accepted” : 4968119,<br>  “dropped” : 0,<br>  “active” : 5,<br>  “idle” : 117<br>}</pre></blockquote></li><li id="def_nginx_ssl_object"><p>   SSL： </p><dl class="compact"><dt>   <code class="notranslate">handshakes</code> （ <code class="notranslate">integer</code> ） </dt><dd>  成功的SSL握手总数。 </dd><dt>   <code class="notranslate">handshakes_failed</code> （ <code class="notranslate">integer</code> ） </dt><dd>  失败的SSL握手总数。 </dd><dt>   <code class="notranslate">session_reuses</code> （ <code class="notranslate">integer</code> ） </dt><dd>   SSL握手期间会话​​重用的总次数。 </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “handshakes” : 79572,<br>  “handshakes_failed” : 21025,<br>  “session_reuses” : 15762<br>}</pre></blockquote></li><li id="def_nginx_slab_zone"><p>  带有slab分配器的共享内存区域： </p><dl class="compact"><dt> <code class="notranslate">pages</code> </dt> <dd>  空闲和已用内存页面的数量。 <dl class="compact"><dt>   <code class="notranslate">used</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前使用的内存页数。 </dd><dt>   <code class="notranslate">free</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前可用内存页数。 </dd></dl></dd><dt> <code class="notranslate">slots</code> </dt> <dd><p>  内存插槽的状态数据（8,16,32,64,128等） </p><p>   “ <a hhref="#def_nginx_slab_zone_slot">Memory Slot</a> ”对象的集合 </p></dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “pages” : {<br>    “used” : 1143,<br>    “free” : 2928<br>  },<br>  “slots” : {<br>    “8” : {<br>      “used” : 0,<br>      “free” : 0,<br>      “reqs” : 0,<br>      “fails” : 0<br>    },<br>    “16” : {<br>      “used” : 0,<br>      “free” : 0,<br>      “reqs” : 0,<br>      “fails” : 0<br>    },<br>    “32” : {<br>      “used” : 0,<br>      “free” : 0,<br>      “reqs” : 0,<br>      “fails” : 0<br>    },<br>    “64” : {<br>      “used” : 1,<br>      “free” : 63,<br>      “reqs” : 1,<br>      “fails” : 0<br>    },<br>    “128” : {<br>      “used” : 0,<br>      “free” : 0,<br>      “reqs” : 0,<br>      “fails” : 0<br>    },<br>    “256” : {<br>      “used” : 18078,<br>      “free” : 178,<br>      “reqs” : 1635736,<br>      “fails” : 0<br>    }<br>  }<br>}</pre></blockquote></li><li id="def_nginx_slab_zone_slot"><p>  内存插槽： </p><dl class="compact"><dt>   <code class="notranslate">used</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前使用的内存插槽数。 </dd><dt>   <code class="notranslate">free</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前可用内存插槽的数量。 </dd><dt>   <code class="notranslate">reqs</code> （ <code class="notranslate">integer</code> ） </dt><dd>  分配指定大小内存的总尝试次数。 </dd><dt>   <code class="notranslate">fails</code> （ <code class="notranslate">integer</code> ） </dt><dd>  分配指定大小内存的尝试失败次数。 </dd></dl></li><li id="def_nginx_http_requests"><p>   HTTP请求： </p><dl class="compact"><dt>   <code class="notranslate">total</code> （ <code class="notranslate">integer</code> ） </dt><dd>  客户端请求的总数。 </dd><dt>   <code class="notranslate">current</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前的客户端请求数。 </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “total” : 10624511,<br>  “current” : 4<br>}</pre></blockquote></li><li id="def_nginx_http_server_zone"><p>   HTTP服务器区域： </p><dl class="compact"><dt>   <code class="notranslate">processing</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前正在处理的客户端请求数。 </dd><dt>   <code class="notranslate">requests</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从客户端收到的客户端请求总数。 </dd><dt> <code class="notranslate">responses</code> </dt> <dd>  发送给客户端的响应总数和状态代码为“ <code class="notranslate">1xx</code> ”，“ <code class="notranslate">2xx</code> ”，“ <code class="notranslate">3xx</code> ”，“ <code class="notranslate">4xx</code> ”和“ <code class="notranslate">5xx</code> ”的响应数。 <dl class="compact"><dt>   <code class="notranslate">1xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">1xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">2xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">2xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">3xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">3xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">4xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">4xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">5xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">5xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">total</code> （ <code class="notranslate">integer</code> ） </dt><dd>  发送给客户端的响应总数。 </dd></dl></dd><dt>   <code class="notranslate">discarded</code> （ <code class="notranslate">integer</code> ） </dt><dd>  未发送响应而完成的请求总数。 </dd><dt>   <code class="notranslate">received</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从客户端收到的总字节数。 </dd><dt>   <code class="notranslate">sent</code> （ <code class="notranslate">integer</code> ） </dt><dd>  发送给客户端的总字节数。 </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “processing” : 1,<br>  “requests” : 706690,<br>  “responses” : {<br>    “1xx” : 0,<br>    “2xx” : 699482,<br>    “3xx” : 4522,<br>    “4xx” : 907,<br>    “5xx” : 266,<br>    “total” : 705177<br>  },<br>  “discarded” : 1513,<br>  “received” : 172711587,<br>  “sent” : 19415530115<br>}</pre></blockquote></li><li id="def_nginx_http_cache"><p>   HTTP缓存： </p><dl class="compact"><dt>   <code class="notranslate">size</code> （ <code class="notranslate">integer</code> ） </dt><dd>  缓存的当前大小。 </dd><dt>   <code class="notranslate">max_size</code> （ <code class="notranslate">integer</code> ） </dt><dd>  配置中指定的高速缓存的最大大小限制。 </dd><dt>   <code class="notranslate">cold</code> （ <code class="notranslate">boolean</code> ） </dt><dd>  一个布尔值，指示“缓存加载器”进程是否仍在将数据从磁盘加载到缓存中。 </dd><dt> <code class="notranslate">hit</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">responses</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从缓存中读取的<a hhref="https://nginx.org/en/http/ngx_http_proxy_module.html#proxy_cache_valid">有效</a>响应总数。 </dd><dt>   <code class="notranslate">bytes</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从缓存中读取的总字节数。 </dd></dl></dd><dt> <code class="notranslate">stale</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">responses</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从缓存中读取的过期响应总数（请参阅<a hhref="https://nginx.org/en/http/ngx_http_proxy_module.html#proxy_cache_use_stale">proxy_cache_use_stale</a>和其他“ <code class="notranslate"><em>_cache_use_stale</em></code> ”指令）。 </dd><dt>   <code class="notranslate">bytes</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从缓存中读取的总字节数。 </dd></dl></dd><dt> <code class="notranslate">updating</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">responses</code> （ <code class="notranslate">integer</code> ） </dt><dd>  在响应更新时从缓存读取的过期响应总数（请参阅<a hhref="https://nginx.org/en/http/ngx_http_proxy_module.html#proxy_cache_use_stale_updating">proxy_cache_use_stale</a>和其他“ <code class="notranslate">_cache_use_stale</code> ”指令）。 </dd><dt>   <code class="notranslate">bytes</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从缓存中读取的总字节数。 </dd></dl></dd><dt> <code class="notranslate">revalidated</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">responses</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从缓存中读取的过期和重新验证响应的总数（请参阅<a hhref="https://nginx.org/en/http/ngx_http_proxy_module.html#proxy_cache_revalidate">proxy_cache_revalidate</a>和其他“ <code class="notranslate"><em>_cache_revalidate</em></code> <a hhref="https://nginx.org/en/http/ngx_http_proxy_module.html#proxy_cache_revalidate">_cache_revalidate</a> ”指令。 </dd><dt>   <code class="notranslate">bytes</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从缓存中读取的总字节数。 </dd></dl></dd><dt> <code class="notranslate">miss</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">responses</code> （ <code class="notranslate">integer</code> ） </dt><dd>  在缓存中找不到的响应总数。 </dd><dt>   <code class="notranslate">bytes</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从代理服务器读取的总字节数。 </dd><dt>   <code class="notranslate">responses_written</code> （ <code class="notranslate">integer</code> ） </dt><dd>  写入缓存的响应总数。 </dd><dt>   <code class="notranslate">bytes_written</code> （ <code class="notranslate">integer</code> ） </dt><dd>  写入缓存的总字节数。 </dd></dl></dd><dt> <code class="notranslate">expired</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">responses</code> （ <code class="notranslate">integer</code> ） </dt><dd>  未从缓存中获取的过期响应总数。 </dd><dt>   <code class="notranslate">bytes</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从代理服务器读取的总字节数。 </dd><dt>   <code class="notranslate">responses_written</code> （ <code class="notranslate">integer</code> ） </dt><dd>  写入缓存的响应总数。 </dd><dt>   <code class="notranslate">bytes_written</code> （ <code class="notranslate">integer</code> ） </dt><dd>  写入缓存的总字节数。 </dd></dl></dd><dt> <code class="notranslate">bypass</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">responses</code> （ <code class="notranslate">integer</code> ） </dt><dd>  由于<a hhref="https://nginx.org/en/http/ngx_http_proxy_module.html#proxy_cache_bypass">proxy_cache_bypass</a>和其他“ <code class="notranslate">_cache_bypass</code> ”指令，缓存中未查找的响应总数。 </dd><dt>   <code class="notranslate">bytes</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从代理服务器读取的总字节数。 </dd><dt>   <code class="notranslate">responses_written</code> （ <code class="notranslate">integer</code> ） </dt><dd>  写入缓存的响应总数。 </dd><dt>   <code class="notranslate">bytes_written</code> （ <code class="notranslate">integer</code> ） </dt><dd>  写入缓存的总字节数。 </dd></dl></dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “size” : 530915328,<br>  “max_size” : 536870912,<br>  “cold” : false,<br>  “hit” : {<br>    “responses” : 254032,<br>    “bytes” : 6685627875<br>  },<br>  “stale” : {<br>    “responses” : 0,<br>    “bytes” : 0<br>  },<br>  “updating” : {<br>    “responses” : 0,<br>    “bytes” : 0<br>  },<br>  “revalidated” : {<br>    “responses” : 0,<br>    “bytes” : 0<br>  },<br>  “miss” : {<br>    “responses” : 1619201,<br>    “bytes” : 53841943822<br>  },<br>  “expired” : {<br>    “responses” : 45859,<br>    “bytes” : 1656847080,<br>    “responses_written” : 44992,<br>    “bytes_written” : 1641825173<br>  },<br>  “bypass” : {<br>    “responses” : 200187,<br>    “bytes” : 5510647548,<br>    “responses_written” : 200173,<br>    “bytes_written” : 44992<br>  }<br>}</pre></blockquote></li><li id="def_nginx_http_upstream"><p>   HTTP上游： </p><dl class="compact"><dt> <code class="notranslate">peers</code> </dt> <dd>  一系列的： <dl class="compact"><dt>   <code class="notranslate">id</code> （ <code class="notranslate">integer</code> ） </dt><dd>  服务器的ID。 </dd><dt>   <code class="notranslate">server</code> （ <code class="notranslate">string</code> ） </dt><dd>  服务器的<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#server">地址</a> 。 </dd><dt>   <code class="notranslate">service</code> （ <code class="notranslate">string</code> ） </dt><dd>   <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#server">server</a>指令的<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#service">服务</a>参数值。 </dd><dt>   <code class="notranslate">name</code> （ <code class="notranslate">string</code> ） </dt><dd>   <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#server">server</a>指令中指定的<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#server">服务器</a>名称。 </dd><dt>   <code class="notranslate">backup</code> （ <code class="notranslate">boolean</code> ） </dt><dd>  一个布尔值，指示服务器是否为<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#backup">备份</a>服务器。 </dd><dt>   <code class="notranslate">weight</code> （ <code class="notranslate">integer</code> ） </dt><dd>  服务器的<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#weight">重量</a> 。 </dd><dt>   <code class="notranslate">state</code> （ <code class="notranslate">string</code> ） </dt><dd>  当前状态，可以是“ <code class="notranslate">up</code> ”，“ <code class="notranslate">draining</code> ”，“ <code class="notranslate">down</code> ”，“ <code class="notranslate">unavail</code> ”，“ <code class="notranslate">checking</code> ”和“ <code class="notranslate">unhealthy</code> ”之一。 </dd><dt>   <code class="notranslate">active</code> （ <code class="notranslate">integer</code> ） </dt><dd>  当前活动连接数。 </dd><dt>   <code class="notranslate">max_conns</code> （ <code class="notranslate">integer</code> ） </dt><dd>  服务器的<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#max_conns">max_conns</a>限制。 </dd><dt>   <code class="notranslate">requests</code> （ <code class="notranslate">integer</code> ） </dt><dd>  转发到此服务器的客户端请求总数。 </dd><dt> <code class="notranslate">responses</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">1xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">1xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">2xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">2xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">3xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">3xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">4xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">4xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">5xx</code> （ <code class="notranslate">integer</code> ） </dt><dd>  带有“ <code class="notranslate">5xx</code> ”状态代码的响应数。 </dd><dt>   <code class="notranslate">total</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从此服务器获取的响应总数。 </dd></dl></dd><dt>   <code class="notranslate">sent</code> （ <code class="notranslate">integer</code> ） </dt><dd>  发送到此服务器的总字节数。 </dd><dt>   <code class="notranslate">received</code> （ <code class="notranslate">integer</code> ） </dt><dd>  从此服务器接收的总字节数。 </dd><dt>   <code class="notranslate">fails</code> （ <code class="notranslate">integer</code> ） </dt><dd>  与服务器通信失败的总次数。 </dd><dt>   <code class="notranslate">unavail</code> （ <code class="notranslate">integer</code> ） </dt><dd>  由于尝试达到<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#max_fails">max_fails</a>阈值的次数不成功，服务器因客户端请求（状态为“ <code class="notranslate">unavail</code> ”）而变为不可用的次数。 </dd><dt> <code class="notranslate">health_checks</code> </dt> <dd><dl class="compact"><dt>   <code class="notranslate">checks</code> （ <code class="notranslate">integer</code> ） </dt><dd>  进行的<a hhref="https://nginx.org/en/http/ngx_http_upstream_hc_module.html#health_check">健康检查</a>请求总数。 </dd><dt>   <code class="notranslate">fails</code> （ <code class="notranslate">integer</code> ） </dt><dd>  健康检查失败的次数。 </dd><dt>   <code class="notranslate">unhealthy</code> （ <code class="notranslate">integer</code> ） </dt><dd>  服务器变得不健康的次数（状态“ <code class="notranslate">unhealthy</code> ”）。 </dd><dt>   <code class="notranslate">last_passed</code> （ <code class="notranslate">boolean</code> ） </dt><dd>  布尔值，指示上次运行状况检查请求是否成功并通过了<a hhref="https://nginx.org/en/http/ngx_http_upstream_hc_module.html#match">测试</a> 。 </dd></dl></dd><dt>   <code class="notranslate">downtime</code> （ <code class="notranslate">integer</code> ） </dt><dd>  服务器处于“ <code class="notranslate">unavail</code> ”，“ <code class="notranslate">checking</code> ”和“ <code class="notranslate">unhealthy</code> ”状态的总时间。 </dd><dt>   <code class="notranslate">downstart</code> （ <code class="notranslate">string</code> ） </dt><dd>  服务器变为“ <code class="notranslate">unavail</code> ”，“ <code class="notranslate">checking</code> ”或“ <code class="notranslate">unhealthy</code> ”的时间，采用ISO 8601格式，分辨率为毫秒。 </dd><dt> <code class="notranslate">selected</code> ( <code class="notranslate">string</code> ) </dt><dd> The time when the server was last selected to process a request, in the ISO 8601 format with millisecond resolution. </dd><dt> <code class="notranslate">header_time</code> ( <code class="notranslate">integer</code> ) </dt><dd> The average time to get the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#var_upstream_header_time">response header</a> from the server. </dd><dt> <code class="notranslate">response_time</code> ( <code class="notranslate">integer</code> ) </dt><dd> The average time to get the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#var_upstream_response_time">full response</a> from the server. </dd></dl></dd><dt> <code class="notranslate">keepalive</code> ( <code class="notranslate">integer</code> ) </dt><dd>  当前空闲<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#keepalive">keepalive</a>连接数。 </dd><dt> <code class="notranslate">zombies</code> ( <code class="notranslate">integer</code> ) </dt><dd>  从组中删除但仍处理活动客户端请求的当前服务器数。 </dd><dt> <code class="notranslate">zone</code> ( <code class="notranslate">string</code> ) </dt><dd>  保持组配置和运行时状态的共享内存<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#zone">区域</a>的名称。 </dd><dt> <code class="notranslate">queue</code> </dt> <dd>  对于请求<a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#queue">队列</a> ，提供以下数据： <dl class="compact"><dt> <code class="notranslate">size</code> ( <code class="notranslate">integer</code> ) </dt><dd>  队列中当前的请求数。 </dd><dt> <code class="notranslate">max_size</code> ( <code class="notranslate">integer</code> ) </dt><dd>  可以同时在队列中的最大请求数。 </dd><dt> <code class="notranslate">overflows</code> ( <code class="notranslate">integer</code> ) </dt><dd>  由于队列溢出而拒绝的请求总数。 </dd></dl></dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “upstream_backend” : {<br>    “peers” : [<br>      {<br>        “id” : 0,<br>        “server” : “10.0.0.1:8088”,<br>        “name” : “10.0.0.1:8088”,<br>        “backup” : false,<br>        “weight” : 5,<br>        “state” : “up”,<br>        “active” : 0,<br>        “max_conns” : 20,<br>        “requests” : 667231,<br>        “header_time” : 20,<br>        “response_time” : 36,<br>        “responses” : {<br>          “1xx” : 0,<br>          “2xx” : 666310,<br>          “3xx” : 0,<br>          “4xx” : 915,<br>          “5xx” : 6,<br>          “total” : 667231<br>        },<br>        “sent” : 251946292,<br>        “received” : 19222475454,<br>        “fails” : 0,<br>        “unavail” : 0,<br>        “health_checks” : {<br>          “checks” : 26214,<br>          “fails” : 0,<br>          “unhealthy” : 0,<br>          “last_passed” : true<br>        },<br>        “downtime” : 0,<br>        “downstart” : “2017-07-07T11:09:21.602Z”,<br>        “selected” : “2017-07-17T15:01:25.000Z”<br>      },<br>      {<br>        “id” : 1,<br>        “server” : “10.0.0.1:8089”,<br>        “name” : “10.0.0.1:8089”,<br>        “backup” : true,<br>        “weight” : 1,<br>        “state” : “unhealthy”,<br>        “active” : 0,<br>        “max_conns” : 20,<br>        “requests” : 0,<br>        “responses” : {<br>          “1xx” : 0,<br>          “2xx” : 0,<br>          “3xx” : 0,<br>          “4xx” : 0,<br>          “5xx” : 0,<br>          “total” : 0<br>        },<br>        “sent” : 0,<br>        “received” : 0,<br>        “fails” : 0,<br>        “unavail” : 0,<br>        “health_checks” : {<br>          “checks” : 26284,<br>          “fails” : 26284,<br>          “unhealthy” : 1,<br>          “last_passed” : false<br>        },<br>        “downtime” : 262925617,<br>        “downstart” : “2017-07-07T11:09:21.602Z”,<br>        “selected” : “2017-07-17T15:01:25.000Z”<br>      }<br>    ],<br>    “keepalive” : 0,<br>    “zombies” : 0,<br>    “zone” : “upstream_backend”<br>  }<br>}</pre></blockquote></li><li id="def_nginx_http_upstream_conf_server"><p> HTTP Upstream Server: </p> Dynamically configurable parameters of an HTTP upstream <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#server">server</a> : <dl class="compact"><dt> <code class="notranslate">id</code> ( <code class="notranslate">integer</code> ) </dt><dd> The ID of the HTTP upstream server. The ID is assigned automatically and cannot be changed. </dd><dt> <code class="notranslate">server</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#address">address</a> parameter of the HTTP upstream server.  添加服务器时，可以将其指定为域名。 In this case, changes of the IP addresses that correspond to a domain name will be monitored and automatically applied to the upstream configuration without the need of restarting nginx. This requires the <a hhref="https://nginx.org/en/http/ngx_http_core_module.html#resolver">resolver</a> directive in the “ <code class="notranslate">http</code> ” block. See also the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#resolve">resolve</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">service</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#service">service</a> parameter of the HTTP upstream server. This parameter cannot be changed. </dd><dt> <code class="notranslate">weight</code> ( <code class="notranslate">integer</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#weight">weight</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">max_conns</code> ( <code class="notranslate">integer</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#max_conns">max_conns</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">max_fails</code> ( <code class="notranslate">integer</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#max_fails">max_fails</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">fail_timeout</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#fail_timeout">fail_timeout</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">slow_start</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#slow_start">slow_start</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">route</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#route">route</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">backup</code> ( <code class="notranslate">boolean</code> ) </dt><dd> When <code class="notranslate">true</code> , adds a <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#backup">backup</a> server. This parameter cannot be changed. </dd><dt> <code class="notranslate">down</code> ( <code class="notranslate">boolean</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#down">down</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">drain</code> ( <code class="notranslate">boolean</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/http/ngx_http_upstream_module.html#drain">drain</a> parameter of the HTTP upstream server. </dd><dt> <code class="notranslate">parent</code> ( <code class="notranslate">string</code> ) </dt><dd> Parent server ID of the resolved server. The ID is assigned automatically and cannot be changed. </dd><dt> <code class="notranslate">host</code> ( <code class="notranslate">string</code> ) </dt><dd> Hostname of the resolved server. The hostname is assigned automatically and cannot be changed. </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “id” : 1,<br>  “server” : “10.0.0.1:8089”,<br>  “weight” : 4,<br>  “max_conns” : 0,<br>  “max_fails” : 0,<br>  “fail_timeout” : “10s”,<br>  “slow_start” : “10s”,<br>  “route” : “”,<br>  “backup” : true,<br>  “down” : true<br>}</pre></blockquote></li><li id="def_nginx_http_keyval_zone"><p> HTTP Keyval Shared Memory Zone: </p> Contents of an HTTP keyval shared memory zone. <p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “key1” : “value1”,<br>  “key2” : “value2”,<br>  “key3” : “value3”<br>}</pre></blockquote></li><li id="def_nginx_stream_server_zone"><p> Stream Server Zone: </p><dl class="compact"><dt> <code class="notranslate">processing</code> ( <code class="notranslate">integer</code> ) </dt><dd>  当前正在处理的客户端连接数。 </dd><dt> <code class="notranslate">connections</code> ( <code class="notranslate">integer</code> ) </dt><dd>  从客户端接受的连接总数。 </dd><dt> <code class="notranslate">sessions</code> </dt> <dd> The total number of completed sessions, and the number of sessions completed with status codes “ <code class="notranslate">2xx</code> ”, “ <code class="notranslate">4xx</code> ”, or “ <code class="notranslate">5xx</code> ”. <dl class="compact"><dt> <code class="notranslate">2xx</code> ( <code class="notranslate">integer</code> ) </dt><dd> The total number of sessions completed with <a hhref="https://nginx.org/en/stream/ngx_stream_core_module.html#var_status">status codes</a> “ <code class="notranslate">2xx</code> ”. </dd><dt> <code class="notranslate">4xx</code> ( <code class="notranslate">integer</code> ) </dt><dd> The total number of sessions completed with <a hhref="https://nginx.org/en/stream/ngx_stream_core_module.html#var_status">status codes</a> “ <code class="notranslate">4xx</code> ”. </dd><dt> <code class="notranslate">5xx</code> ( <code class="notranslate">integer</code> ) </dt><dd> The total number of sessions completed with <a hhref="https://nginx.org/en/stream/ngx_stream_core_module.html#var_status">status codes</a> “ <code class="notranslate">5xx</code> ”. </dd><dt> <code class="notranslate">total</code> ( <code class="notranslate">integer</code> ) </dt><dd>  已完成的客户会话总数。 </dd></dl></dd><dt> <code class="notranslate">discarded</code> ( <code class="notranslate">integer</code> ) </dt><dd>  在不创建会话的情况下完成的连接总数。 </dd><dt> <code class="notranslate">received</code> ( <code class="notranslate">integer</code> ) </dt><dd>  从客户端收到的总字节数。 </dd><dt> <code class="notranslate">sent</code> ( <code class="notranslate">integer</code> ) </dt><dd>  发送给客户端的总字节数。 </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “dns” : {<br>    “processing” : 1,<br>    “connections” : 155569,<br>    “sessions” : {<br>      “2xx” : 155564,<br>      “4xx” : 0,<br>      “5xx” : 0,<br>      “total” : 155569<br>    },<br>    “discarded” : 0,<br>    “received” : 4200363,<br>    “sent” : 20489184<br>  }<br>}</pre></blockquote></li><li id="def_nginx_stream_upstream"><p> Stream Upstream: </p><dl class="compact"><dt> <code class="notranslate">peers</code> </dt> <dd> An array of: <dl class="compact"><dt> <code class="notranslate">id</code> ( <code class="notranslate">integer</code> ) </dt><dd>  服务器的ID。 </dd><dt> <code class="notranslate">server</code> ( <code class="notranslate">string</code> ) </dt><dd>  服务器的<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#server">地址</a> 。 </dd><dt> <code class="notranslate">service</code> ( <code class="notranslate">string</code> ) </dt><dd>   <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#server">server</a>指令的<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#service">服务</a>参数值。 </dd><dt> <code class="notranslate">name</code> ( <code class="notranslate">string</code> ) </dt><dd>   <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#server">server</a>指令中指定的<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#server">服务器</a>名称。 </dd><dt> <code class="notranslate">backup</code> ( <code class="notranslate">boolean</code> ) </dt><dd>  一个布尔值，指示服务器是否为<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#backup">备份</a>服务器。 </dd><dt> <code class="notranslate">weight</code> ( <code class="notranslate">integer</code> ) </dt><dd>  服务器的<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#weight">重量</a> 。 </dd><dt> <code class="notranslate">state</code> ( <code class="notranslate">string</code> ) </dt><dd>  当前状态，可以是“ <code class="notranslate">up</code> ”，“ <code class="notranslate">down</code> ”，“ <code class="notranslate">unavail</code> ”，“ <code class="notranslate">checking</code> ”或“ <code class="notranslate">unhealthy</code> ”之一。 </dd><dt> <code class="notranslate">active</code> ( <code class="notranslate">integer</code> ) </dt><dd>  当前的连接数。 </dd><dt> <code class="notranslate">max_conns</code> ( <code class="notranslate">integer</code> ) </dt><dd>  服务器的<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#max_conns">max_conns</a>限制。 </dd><dt> <code class="notranslate">connections</code> ( <code class="notranslate">integer</code> ) </dt><dd>  转发到此服务器的客户端连接总数。 </dd><dt> <code class="notranslate">connect_time</code> ( <code class="notranslate">integer</code> ) </dt><dd>  连接上游服务器的平均时间。 </dd><dt> <code class="notranslate">first_byte_time</code> ( <code class="notranslate">integer</code> ) </dt><dd>  接收第一个数据字节的平均时间。 </dd><dt> <code class="notranslate">response_time</code> ( <code class="notranslate">integer</code> ) </dt><dd>  接收最后一个数据字节的平均时间。 </dd><dt> <code class="notranslate">sent</code> ( <code class="notranslate">integer</code> ) </dt><dd>  发送到此服务器的总字节数。 </dd><dt> <code class="notranslate">received</code> ( <code class="notranslate">integer</code> ) </dt><dd>  从此服务器接收的总字节数。 </dd><dt> <code class="notranslate">fails</code> ( <code class="notranslate">integer</code> ) </dt><dd>  与服务器通信失败的总次数。 </dd><dt> <code class="notranslate">unavail</code> ( <code class="notranslate">integer</code> ) </dt><dd>  由于尝试达到<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#max_fails">max_fails</a>阈值的次数不成功，服务器无法进行客户端连接（状态为“ <code class="notranslate">unavail</code> ”）的次数。 </dd><dt> <code class="notranslate">health_checks</code> </dt> <dd><dl class="compact"><dt> <code class="notranslate">checks</code> ( <code class="notranslate">integer</code> ) </dt><dd>  进行的<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_hc_module.html#health_check">健康检查</a>请求总数。 </dd><dt> <code class="notranslate">fails</code> ( <code class="notranslate">integer</code> ) </dt><dd>  健康检查失败的次数。 </dd><dt> <code class="notranslate">unhealthy</code> ( <code class="notranslate">integer</code> ) </dt><dd>  服务器变得不健康的次数（状态“ <code class="notranslate">unhealthy</code> ”）。 </dd><dt> <code class="notranslate">last_passed</code> ( <code class="notranslate">boolean</code> ) </dt><dd> Boolean indicating whether the last health check request was successful and passed <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_hc_module.html#match">tests</a> . </dd></dl></dd><dt> <code class="notranslate">downtime</code> ( <code class="notranslate">integer</code> ) </dt><dd>  服务器处于“ <code class="notranslate">unavail</code> ”，“ <code class="notranslate">checking</code> ”和“ <code class="notranslate">unhealthy</code> ”状态的总时间。 </dd><dt> <code class="notranslate">downstart</code> ( <code class="notranslate">string</code> ) </dt><dd> The time when the server became “ <code class="notranslate">unavail</code> ”, “ <code class="notranslate">checking</code> ”, or “ <code class="notranslate">unhealthy</code> ”, in the ISO 8601 format with millisecond resolution. </dd><dt> <code class="notranslate">selected</code> ( <code class="notranslate">string</code> ) </dt><dd> The time when the server was last selected to process a connection, in the ISO 8601 format with millisecond resolution. </dd></dl></dd><dt> <code class="notranslate">zombies</code> ( <code class="notranslate">integer</code> ) </dt><dd>  当前从组中删除但仍处理活动客户端连接的服务器数。 </dd><dt> <code class="notranslate">zone</code> ( <code class="notranslate">string</code> ) </dt><dd>  保持组配置和运行时状态的共享内存<a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#zone">区域</a>的名称。 </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “dns” : {<br>    “peers” : [<br>      {<br>        “id” : 0,<br>        “server” : “10.0.0.1:12347”,<br>        “name” : “10.0.0.1:12347”,<br>        “backup” : false,<br>        “weight” : 5,<br>        “state” : “up”,<br>        “active” : 0,<br>        “max_conns” : 50,<br>        “connections” : 667231,<br>        “sent” : 251946292,<br>        “received” : 19222475454,<br>        “fails” : 0,<br>        “unavail” : 0,<br>        “health_checks” : {<br>          “checks” : 26214,<br>          “fails” : 0,<br>          “unhealthy” : 0,<br>          “last_passed” : true<br>        },<br>        “downtime” : 0,<br>        “downstart” : “2017-07-07T11:09:21.602Z”,<br>        “selected” : “2017-07-17T15:01:25.000Z”<br>      },<br>      {<br>        “id” : 1,<br>        “server” : “10.0.0.1:12348”,<br>        “name” : “10.0.0.1:12348”,<br>        “backup” : true,<br>        “weight” : 1,<br>        “state” : “unhealthy”,<br>        “active” : 0,<br>        “max_conns” : 50,<br>        “connections” : 0,<br>        “sent” : 0,<br>        “received” : 0,<br>        “fails” : 0,<br>        “unavail” : 0,<br>        “health_checks” : {<br>          “checks” : 26284,<br>          “fails” : 26284,<br>          “unhealthy” : 1,<br>          “last_passed” : false<br>        },<br>        “downtime” : 262925617,<br>        “downstart” : “2017-07-07T11:09:21.602Z”,<br>        “selected” : “2017-07-17T15:01:25.000Z”<br>      }<br>    ],<br>    “zombies” : 0,<br>    “zone” : “dns”<br>  }<br>}</pre></blockquote></li><li id="def_nginx_stream_upstream_conf_server"><p> Stream Upstream Server: </p> Dynamically configurable parameters of a stream upstream <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#server">server</a> : <dl class="compact"><dt> <code class="notranslate">id</code> ( <code class="notranslate">integer</code> ) </dt><dd> The ID of the stream upstream server. The ID is assigned automatically and cannot be changed. </dd><dt> <code class="notranslate">server</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#server">address</a> parameter of the stream upstream server.  添加服务器时，可以将其指定为域名。 In this case, changes of the IP addresses that correspond to a domain name will be monitored and automatically applied to the upstream configuration without the need of restarting nginx. This requires the <a hhref="https://nginx.org/en/stream/ngx_stream_core_module.html#resolver">resolver</a> directive in the “ <code class="notranslate">stream</code> ” block. See also the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#resolve">resolve</a> parameter of the stream upstream server. </dd><dt> <code class="notranslate">service</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#service">service</a> parameter of the stream upstream server. This parameter cannot be changed. </dd><dt> <code class="notranslate">weight</code> ( <code class="notranslate">integer</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#weight">weight</a> parameter of the stream upstream server. </dd><dt> <code class="notranslate">max_conns</code> ( <code class="notranslate">integer</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#max_conns">max_conns</a> parameter of the stream upstream server. </dd><dt> <code class="notranslate">max_fails</code> ( <code class="notranslate">integer</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#max_fails">max_fails</a> parameter of the stream upstream server. </dd><dt> <code class="notranslate">fail_timeout</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#fail_timeout">fail_timeout</a> parameter of the stream upstream server. </dd><dt> <code class="notranslate">slow_start</code> ( <code class="notranslate">string</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#slow_start">slow_start</a> parameter of the stream upstream server. </dd><dt> <code class="notranslate">backup</code> ( <code class="notranslate">boolean</code> ) </dt><dd> When <code class="notranslate">true</code> , adds a <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#backup">backup</a> server. This parameter cannot be changed. </dd><dt> <code class="notranslate">down</code> ( <code class="notranslate">boolean</code> ) </dt><dd> Same as the <a hhref="https://nginx.org/en/stream/ngx_stream_upstream_module.html#down">down</a> parameter of the stream upstream server. </dd><dt> <code class="notranslate">parent</code> ( <code class="notranslate">string</code> ) </dt><dd> Parent server ID of the resolved server. The ID is assigned automatically and cannot be changed. </dd><dt> <code class="notranslate">host</code> ( <code class="notranslate">string</code> ) </dt><dd> Hostname of the resolved server. The hostname is assigned automatically and cannot be changed. </dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “id” : 0,<br>  “server” : “10.0.0.1:12348”,<br>  “weight” : 1,<br>  “max_conns” : 0,<br>  “max_fails” : 1,<br>  “fail_timeout” : “10s”,<br>  “slow_start” : 0,<br>  “backup” : false,<br>  “down” : false<br>}</pre></blockquote></li><li id="def_nginx_stream_keyval_zone"><p> Stream Keyval Shared Memory Zone: </p> Contents of a stream keyval shared memory zone. <p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “key1” : “value1”,<br>  “key2” : “value2”,<br>  “key3” : “value3”<br>}</pre></blockquote></li><li id="def_nginx_stream_zone_sync"><p> Stream Zone Sync Node: </p><dl class="compact"><dt> <code class="notranslate">zones</code> </dt> <dd><p> Synchronization information per each shared memory zone. </p><p> A collection of “ <a hhref="#def_nginx_stream_zone_sync_zone">Sync Zone</a> “ objects </p></dd><dt> <code class="notranslate">status</code> </dt> <dd> Synchronization information per node in a cluster. <dl class="compact"><dt> <code class="notranslate">bytes_in</code> ( <code class="notranslate">integer</code> ) </dt><dd> The number of bytes received by this node. </dd><dt> <code class="notranslate">msgs_in</code> ( <code class="notranslate">integer</code> ) </dt><dd> The number of messages received by this node. </dd><dt> <code class="notranslate">msgs_out</code> ( <code class="notranslate">integer</code> ) </dt><dd> The number of messages sent by this node. </dd><dt> <code class="notranslate">bytes_out</code> ( <code class="notranslate">integer</code> ) </dt><dd> The number of bytes sent by this node. </dd><dt> <code class="notranslate">nodes_online</code> ( <code class="notranslate">integer</code> ) </dt><dd> The number of peers this node is connected to. </dd></dl></dd></dl><p>  例： </p><blockquote class="example"><pre class="notranslate">{<br>  “zones” : {<br>    “zone1” : {<br>      “records_pending” : 2061,<br>      “records_total” : 260575<br>    },<br>    “zone2” : {<br>      “records_pending” : 0,<br>      “records_total” : 14749<br>    }<br>  },<br>  “status” : {<br>    “bytes_in” : 1364923761,<br>    “msgs_in” : 337236,<br>    “msgs_out” : 346717,<br>    “bytes_out” : 1402765472,<br>    “nodes_online” : 15<br>  }<br>}</pre></blockquote></li><li id="def_nginx_stream_zone_sync_zone"><p> Sync Zone: </p> Synchronization status of a shared memory zone. <dl class="compact"><dt> <code class="notranslate">records_pending</code> ( <code class="notranslate">integer</code> ) </dt><dd> The number of records that need to be sent to the cluster. </dd><dt> <code class="notranslate">records_total</code> ( <code class="notranslate">integer</code> ) </dt><dd> The total number of records stored in the shared memory zone. </dd></dl></li><li id="def_nginx_error"><p>  错误： </p> nginx error object. <dl class="compact"><dt> <code class="notranslate">path</code> ( <code class="notranslate">string</code> ) </dt><dd> API path. </dd><dt> <code class="notranslate">method</code> ( <code class="notranslate">string</code> ) </dt><dd> HTTP method. </dd><dt> <code class="notranslate">error</code> </dt> <dd><dl class="compact"><dt> <code class="notranslate">status</code> ( <code class="notranslate">integer</code> ) </dt><dd> HTTP error code. </dd><dt> <code class="notranslate">text</code> ( <code class="notranslate">string</code> ) </dt><dd> Error description. </dd><dt> <code class="notranslate">code</code> ( <code class="notranslate">string</code> ) </dt><dd> Internal nginx error code. </dd></dl></dd><dt> <code class="notranslate">request_id</code> ( <code class="notranslate">string</code> ) </dt><dd> The ID of the request, equals the value of the <a hhref="https://nginx.org/en/http/ngx_http_core_module.html#var_request_id">$request_id</a> variable. </dd><dt> <code class="notranslate">href</code> ( <code class="notranslate">string</code> ) </dt><dd> Link to reference documentation. </dd></dl></li></p><p></p> <p></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_addition_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_addition_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#add_before_body">add_before_body</a> <br>     <a hhref="#add_after_body">add_after_body</a> <br>     <a hhref="#addition_types">addition_types</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_addition_module</code>模块是一个过滤器，用于在响应之前和之后添加文本。  默认情况下不构建此模块，应使用<code class="notranslate">–with-http_addition_module</code>配置参数启用它。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    add_before_body /before_action;<br>    add_after_body  /after_action;<br>}<br></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="add_before_body"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>add_before_body</strong> <code class="notranslate"><i>uri</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  添加由于在响应主体之前处理给定子请求而返回的文本。  作为参数的空字符串（ &lt;code class=&quot;notranslate&quot;&gt;&quot;&quot;&lt;/code&gt; ）取消从先前配置级别继承的添加。 &lt;/p&gt;&lt;a name=&quot;add_after_body&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;add_after_body&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;uri&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  添加由于在响应主体之后处理给定子请求而返回的文本。  作为参数的空字符串（ &lt;code class=&quot;notranslate&quot;&gt;&quot;&quot;&lt;/code&gt; ）取消从先前配置级别继承的添加。 &lt;/p&gt;&lt;a name=&quot;addition_types&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;addition_types&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;mime-type&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;addition_types text/html;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在0.7.9版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  除了“ &lt;code class=&quot;notranslate&quot;&gt;text/html&lt;/code&gt; ”之外，还允许在具有指定MIME类型的响应中添加文本。  特殊值“ &lt;code class=&quot;notranslate&quot;&gt;*&lt;/code&gt; ”匹配任何MIME类型（0.8.29）。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/ngx_http_access_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_http_access_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#allow">allow</a> <br>     <a hhref="#deny">deny</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_http_access_module</code>模块允许限制对某些客户端地址的访问。 </p><p>  访问也可以通过<a hhref="ngx_http_auth_basic_module.html">密码</a> ， <a hhref="ngx_http_auth_request_module.html">子请求</a>的<a hhref="ngx_http_auth_request_module.html">结果</a>或<a hhref="ngx_http_auth_jwt_module.html">JWT来限制</a> 。  通过地址和密码同时限制访问由<a hhref="ngx_http_core_module.html#satisfy">satisf</a>指令控制。 </p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">location / {<br>    deny  192.168.1.1;<br>    allow 192.168.1.0/24;<br>    allow 10.1.1.0/16;<br>    allow 2001:0db8::/32;<br>    deny  all;<br>}<br></pre></blockquote><p></p><p>  按顺序检查规则，直到找到第一个匹配项。  在此示例中，仅允许IPv4网络<code class="notranslate">10.1.1.0/16</code>和<code class="notranslate">192.168.1.0/24</code>不包括地址<code class="notranslate">192.168.1.1</code> ）和IPv6网络<code class="notranslate">2001:0db8::/32</code> 。  如果有很多规则，最好使用<a hhref="ngx_http_geo_module.html">ngx_http_geo_module</a>模块变量。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="allow"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>allow</strong><br>    <code class="notranslate"><i>address</i></code> |<br>    <code class="notranslate"><i>CIDR</i></code> |<br>    <code class="notranslate">unix:</code> |<br>    <code class="notranslate">all</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;limit_except&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  允许访问指定的网络或地址。  如果指定了特殊值&lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt; （1.5.1），则允许访问所有UNIX域套接字。 &lt;/p&gt;&lt;a name=&quot;deny&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;deny&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;address&lt;/i&gt;&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;CIDR&lt;/i&gt;&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt; |
&lt;code class=&quot;notranslate&quot;&gt;all&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;http&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;server&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;location&lt;/code&gt; , &lt;code class=&quot;notranslate&quot;&gt;limit_except&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  拒绝访问指定的网络或地址。  如果指定了特殊值&lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt; （1.5.1），则拒绝所有UNIX域套接字的访问。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/load_balancing.html</url>
      <content type="html"><![CDATA[<p></p><h2>  使用nginx作为HTTP负载均衡器 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#nginx_load_balancing_methods">Load balancing methods</a> <br> <a hhref="#nginx_load_balancing_configuration">Default load balancing configuration</a> <br> <a hhref="#nginx_load_balancing_with_least_connected">Least connected load balancing</a> <br> <a hhref="#nginx_load_balancing_with_ip_hash">Session persistence</a> <br> <a hhref="#nginx_weighted_load_balancing">Weighted load balancing</a> <br> <a hhref="#nginx_load_balancing_health_checks">Health checks</a> <br> <a hhref="#nginx_load_balancing_additional_information">Further reading</a> <br></td></tr></tbody></table><center><h4>  介绍 </h4></center><p>  跨多个应用程序实例的负载平衡是一种常用技术，用于优化资源利用率，最大化吞吐量，减少延迟并确保容错配置。 </p><p>  可以使用nginx作为非常有效的HTTP负载平衡器，将流量分配到多个应用程序服务器，并使用nginx提高Web应用程序的性能，可伸缩性和可靠性。 </p><a name="nginx_load_balancing_methods"></a><center><h4>  负载均衡方法 </h4></center><p>   nginx支持以下负载平衡机制（或​​方法）： </p><ul><li>  循环 - 对应用程序服务器的请求以循环方式分发， </li><li>  最少连接 - 下一个请求被分配给活动连接数最少的服务器， </li><li>   ip-hash  - 哈希函数用于确定应为下一个请求选择哪个服务器（基于客户端的IP地址）。 </li></ul><p></p><a name="nginx_load_balancing_configuration"></a><center><h4>  默认负载均衡配置 </h4></center><p>  使用nginx进行负载平衡的最简单配置可能如下所示： </p><blockquote class="example"><pre class="notranslate">http {<br>    upstream myapp1 {<br>        server srv1.example.com;<br>        server srv2.example.com;<br>        server srv3.example.com;<br>    }<p></p>
<pre><code>server {
    listen 80;

    location / {
        proxy_pass http://myapp1;
    }
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p>  在上面的示例中，在srv1-srv3上运行了3个相同应用程序的实例。  如果未特别配置负载平衡方法，则默认为循环。  所有请求都<a hhref="ngx_http_proxy_module.html#proxy_pass">代理</a>到服务器组myapp1，nginx应用HTTP负载平衡来分发请求。 </p><p>   nginx中的反向代理实现包括HTTP，HTTPS，FastCGI，uwsgi，SCGI，memcached和gRPC的负载平衡。 </p><p>  要为HTTPS而不是HTTP配置负载平衡，只需使用“https”作为协议。 </p><p>  为FastCGI，uwsgi，SCGI，memcached或gRPC设置负载平衡时，分别使用<a hhref="ngx_http_fastcgi_module.html#fastcgi_pass">fastcgi_pass</a> ， <a hhref="ngx_http_uwsgi_module.html#uwsgi_pass">uwsgi_pass</a> ， <a hhref="ngx_http_scgi_module.html#scgi_pass">scgi_pass</a> ， <a hhref="ngx_http_memcached_module.html#memcached_pass">memcached_pa​​ss</a>和<a hhref="ngx_http_grpc_module.html#grpc_pass">grpc_pass</a>指令。 </p><a name="nginx_load_balancing_with_least_connected"></a><center><h4>  最小连接负载平衡 </h4></center><p>  另一个负载平衡规则是最少连接的。  在某些请求需要更长时间才能完成的情况下，最小连接允许更公平地控制应用程序实例上的负载。 </p><p>  使用最少连接的负载平衡，nginx将尽量不会使繁忙的应用程序服务器过载请求，而是将新请求分发给不太繁忙的服务器。 </p><p>  当<a hhref="ngx_http_upstream_module.html#least_conn">least_conn</a>指令用作服务器组配置的一部分时，将激活nginx中的最小连接负载平衡： </p><blockquote class="example"><pre class="notranslate">    upstream myapp1 {<br>        least_conn;<br>        server srv1.example.com;<br>        server srv2.example.com;<br>        server srv3.example.com;<br>    }<br></pre></blockquote><p></p><a name="nginx_load_balancing_with_ip_hash"></a><center><h4>  会话持久性 </h4></center><p>  请注意，通过循环或最少连接的负载平衡，每个后续客户端的请求可能会分发到不同的服务器。  无法保证同一客户端始终指向同一服务器。 </p><p>  如果需要将客户端绑定到特定的应用程序服务器 - 换句话说，就始终尝试选择特定服务器而言，使客户端的会话“粘滞”或“持久” -  ip-hash负载平衡机制可以是用过的。 </p><p>  使用ip-hash，客户端的IP地址将用作散列密钥，以确定应为客户端的请求选择服务器组中的哪个服务器。  此方法可确保来自同一客户端的请求始终定向到同一服务器，但此服务器不可用时除外。 </p><p>  要配置ip-hash负载平衡，只需将<a hhref="ngx_http_upstream_module.html#ip_hash">ip_hash</a>指令添加到服务器（上游）组配置： </p><blockquote class="example"><pre class="notranslate">upstream myapp1 {<br>    ip_hash;<br>    server srv1.example.com;<br>    server srv2.example.com;<br>    server srv3.example.com;<br>}<br></pre></blockquote><p></p><a name="nginx_weighted_load_balancing"></a><center><h4>  加权负载平衡 </h4></center><p>  通过使用服务器权重，甚至可以进一步影响nginx负载平衡算法。 </p><p>  在上面的示例中，未配置服务器权重，这意味着所有指定的服务器都被视为对特定负载平衡方法具有同等资格。 </p><p>  特别是对于循环，它还意味着在服务器上或多或少地平等分配请求 - 只要有足够的请求，并且以统一的方式处理请求并且足够快地完成。 </p><p>  当为服务器指定<a hhref="ngx_http_upstream_module.html#server">权重</a>参数时， <a hhref="ngx_http_upstream_module.html#server">权</a>重被计入负载平衡决策的一部分。 </p><blockquote class="example"><pre class="notranslate">    upstream myapp1 {<br>        server srv1.example.com weight=3;<br>        server srv2.example.com;<br>        server srv3.example.com;<br>    }<br></pre></blockquote><p></p><p>  使用此配置，每5个新请求将分布在应用程序实例中，如下所示：3个请求将定向到srv1，一个请求将转到srv2，另一个请求转到srv3。 </p><p>  同样可以在最近的nginx版本中使用具有最少连接和ip-hash负载平衡的权重。 </p><a name="nginx_load_balancing_health_checks"></a><center><h4>  健康检查 </h4></center><p>   nginx中的反向代理实现包括带内（或被动）服务器运行状况检查。  如果来自特定服务器的响应失败并显示错误，则nginx会将此服务器标记为失败，并将尝试避免为后续入站请求选择此服务器一段时间。 </p><p>   <a hhref="ngx_http_upstream_module.html#server">max_fails</a>指令设置在<a hhref="ngx_http_upstream_module.html#server">fail_timeout</a>期间应该发生的与服务器通信的连续不成功尝试次数。  默认情况下， <a hhref="ngx_http_upstream_module.html#server">max_fails</a>设置为1.当设置为0时，将禁用此服务器的运行状况检查。   <a hhref="ngx_http_upstream_module.html#server">fail_timeout</a>参数还定义服务器将标记为失败的时间。  在服务器发生故障后的<a hhref="ngx_http_upstream_module.html#server">fail_timeout</a>时间间隔后，nginx将开始使用实时客户端的请求正常探测服务器。  如果探测成功，则将服务器标记为实时。 </p><a name="nginx_load_balancing_additional_information"></a><center><h4>  进一步阅读 </h4></center><p>  此外，还有更多指令和参数可以控制nginx中的服务器负载平衡，例如<a hhref="ngx_http_proxy_module.html#proxy_next_upstream">proxy_next_upstream</a> ， <a hhref="ngx_http_upstream_module.html#server">backup</a> ， <a hhref="ngx_http_upstream_module.html#server">down</a>和<a hhref="ngx_http_upstream_module.html#keepalive">keepalive</a> 。  有关更多信息，请查看我们的<a hhref="..">参考文档</a> 。 </p><p>  最后但同样重要的是， <a hhref="https://www.nginx.com/products/application-load-balancing/">应用程序负载平衡</a> ， <a hhref="https://www.nginx.com/products/application-health-checks/">应用程序运行状况检查</a> ， <a hhref="https://www.nginx.com/products/live-activity-monitoring/">活动监视</a>和服务器组的动态<a hhref="https://www.nginx.com/products/on-the-fly-reconfiguration/">重新配置</a>是我们付费NGINX Plus订阅的一部分。 </p><p>  以下文章更详细地描述了与NGINX Plus的负载平衡： </p><ul><li>   <a hhref="https://www.nginx.com/blog/load-balancing-with-nginx-plus/">使用NGINX和NGINX Plus进行负载均衡</a> </li><li>   <a hhref="https://www.nginx.com/blog/load-balancing-with-nginx-plus-part2/">使用NGINX和NGINX Plus第2部分进行负载平衡</a> </li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/converting_rewrite_rules.html</url>
      <content type="html"><![CDATA[<p></p><h2>  转换重写规则 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#converting_mongrel_rules">Converting Mongrel rules</a> <br></td></tr></tbody></table><center><h4>  重定向到主站点 </h4></center><p>  在共享托管生活期间用于<i>仅</i>使用Apache的.htaccess文件配置<i>所有内容</i>的人通常会翻译以下规则： </p><blockquote class="example"><pre class="notranslate">RewriteCond  %{HTTP_HOST}  example.org<br>RewriteRule  (.<em>)          <a href="http://www.example.org$1" target="_blank" rel="noopener">http://www.example.org$1</a><br></em></pre></blockquote><p>  这样的事情： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server_name  www.example.org  example.org;<br>    if ($http_host = example.org) {<br>        rewrite  (.)  <a href="http://www.example.org$1" target="_blank" rel="noopener">http://www.example.org$1</a>;<br>    }<br>    …<br>}<br></pre></blockquote><p></p><p>  这是一种错误，繁琐且无效的方式。  正确的方法是为<code class="notranslate">example.org</code>定义一个单独的服务器： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server_name  example.org;<br>    return       301 <a href="http://www.example.org$request_uri" target="_blank" rel="noopener">http://www.example.org$request_uri</a>;<br>}<p></p>
<p>server {<br>    listen       80;<br>    server_name  www.example.org;<br>    …<br>}<br></p></pre></blockquote><p></p><blockquote class="note">  在0.9.1之前的版本上，重定向可以使用： <blockquote class="example"><pre class="notranslate">    rewrite      ^ <a href="http://www.example.org$request_uri?" target="_blank" rel="noopener">http://www.example.org$request_uri?</a>;<br></pre></blockquote></blockquote><p></p><p>  另一个例子。  而不是“倒置”逻辑“所有不是<code class="notranslate">example.com</code>而不是<code class="notranslate">www.example.com</code> ”： </p><blockquote class="example"><pre class="notranslate">RewriteCond  %{HTTP_HOST}  !example.com<br>RewriteCond  %{HTTP_HOST}  !www.example.com<br>RewriteRule  (.*)          <a href="http://www.example.com$1" target="_blank" rel="noopener">http://www.example.com$1</a><br></pre></blockquote><p>  一个人应该简单地定义<code class="notranslate">example.com</code> ， <code class="notranslate">www.example.com</code>和“其他一切”： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen       80;<br>    server_name  example.com www.example.com;<br>    …<br>}<p></p>
<p>server {<br>    listen       80 default_server;<br>    server<em>name  </em>;<br>    return       301 <a href="http://example.com$request_uri" target="_blank" rel="noopener">http://example.com$request_uri</a>;<br>}<br></p></pre></blockquote><p></p><blockquote class="note">  在0.9.1之前的版本上，重定向可以使用： <blockquote class="example"><pre class="notranslate">    rewrite      ^ <a href="http://example.com$request_uri?" target="_blank" rel="noopener">http://example.com$request_uri?</a>;<br></pre></blockquote></blockquote><p></p><a name="converting_mongrel_rules"></a><center><h4>  转换Mongrel规则 </h4></center><p>  典型的Mongrel规则： </p><blockquote class="example"><pre class="notranslate">DocumentRoot /var/www/myapp.com/current/public<p></p>
<p>RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f<br>RewriteCond %{SCRIPT_FILENAME} !maintenance.html<br>RewriteRule ^.*$ %{DOCUMENT_ROOT}/system/maintenance.html [L]</p>
<p>RewriteCond %{REQUEST_FILENAME} -f<br>RewriteRule ^(.*)$ $1 [QSA,L]</p>
<p>RewriteCond %{REQUEST_FILENAME}/index.html -f<br>RewriteRule ^(.*)$ $1/index.html [QSA,L]</p>
<p>RewriteCond %{REQUEST_FILENAME}.html -f<br>RewriteRule ^(.*)$ $1.html [QSA,L]</p>
<p>RewriteRule ^/(.*)$ balancer://mongrel_cluster%{REQUEST_URI} [P,QSA,L]<br></p></pre></blockquote><p>  应转换为 </p><blockquote class="example"><pre class="notranslate">location / {<br>    root       /var/www/myapp.com/current/public;<p></p>
<pre><code>try_files  /system/maintenance.html
           $uri  $uri/index.html $uri.html
           @mongrel;
</code></pre><p>}</p>
<p>location @mongrel {<br>    proxy_pass  <a href="http://mongrel" target="_blank" rel="noopener">http://mongrel</a>;<br>}<br></p></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/http/configuring_https_servers.html</url>
      <content type="html"><![CDATA[<p></p><h2>  配置HTTPS服务器 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#optimization">HTTPS server optimization</a> <br> <a hhref="#chains">SSL certificate chains</a> <br> <a hhref="#single_http_https_server">A single HTTP/HTTPS server</a> <br> <a hhref="#name_based_https_servers">Name-based HTTPS servers</a> <br>     <a hhref="#certificate_with_several_names">An SSL certificate with several names</a> <br>     <a hhref="#sni">Server Name Indication</a> <br> <a hhref="#compatibility">Compatibility</a> <br></td></tr></tbody></table><p>  要配置HTTPS服务器，必须在<a hhref="ngx_http_core_module.html#server">服务器</a>块中的<a hhref="ngx_http_core_module.html#listen">侦听套接字</a>上启用<code class="notranslate">ssl</code>参数，并且应指定<a hhref="ngx_http_ssl_module.html#ssl_certificate">服务器证书</a>和<a hhref="ngx_http_ssl_module.html#ssl_certificate_key">私钥</a>文件的位置： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen              443 <b>ssl</b> ;<br>    server_name         www.example.com;<br>    ssl_certificate     <b>www.example.com.crt</b> ;<br>    ssl_certificate_key <b>www.example.com.key</b> ;<br>    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;<br>    ssl_ciphers         HIGH:!aNULL:!MD5;<br>    …<br>}<br></pre></blockquote><p>  服务器证书是公共实体。  它被发送到连接到服务器的每个客户端。  私钥是一个安全的实体，应该存储在具有受限访问权限的文件中，但是，它必须是nginx的主进程可读的。  私钥可以替代地存储在与证书相同的文件中： </p><blockquote class="example"><pre class="notranslate">    ssl_certificate     www.example.com.cert;<br>    ssl_certificate_key www.example.com.cert;<br></pre></blockquote><p>  在这种情况下，还应限制文件访问权限。  虽然证书和密钥存储在一个文件中，但只有证书才会发送到客户端。 </p><p>  指令<a hhref="ngx_http_ssl_module.html#ssl_protocols">ssl_protocols</a>和<a hhref="ngx_http_ssl_module.html#ssl_ciphers">ssl_ciphers</a>可用于限制连接以仅包括SSL / TLS的强版本和密码。  默认情况下，nginx使用“ <code class="notranslate">ssl_protocols TLSv1 TLSv1.1 TLSv1.2</code> ”和“ <code class="notranslate">ssl_ciphers HIGH:!aNULL:!MD5</code> ”，因此通常不需要明确配置它们。  请注意，这些指令的默认值已多次<a hhref="#compatibility">更改</a> 。 </p><a name="optimization"></a><center><h4>   HTTPS服务器优化 </h4></center><p>   SSL操作会消耗额外的CPU资源。  在多处理器系统上，应运行多个<a hhref="ngx_core_module.html#worker_processes">工作进程</a> ，不少于可用CPU核心数。   CPU占用最多的操作是SSL握手。  有两种方法可以最大限度地减少每个客户端的这些操作数量：第一种方法是通过启用<a hhref="ngx_http_core_module.html#keepalive_timeout">keepalive</a>连接来通过一个连接发送多个请求，第二种方法是重用SSL会话参数以避免SSL并行连接和后续连接。  会话存储在工作<a hhref="ngx_http_ssl_module.html#ssl_session_cache">线程</a>之间共享的SSL会话高速缓存中，并由<a hhref="ngx_http_ssl_module.html#ssl_session_cache">ssl_session_cache</a>指令配置。  一兆字节的缓存包含大约4000个会话。  默认缓存超时为5分钟。  可以使用<a hhref="ngx_http_ssl_module.html#ssl_session_timeout">ssl_session_timeout</a>指令增加它。  以下是针对具有10兆字节共享会话缓存的多核系统优化的示例配置： </p><blockquote class="example"><pre class="notranslate"> <b>worker_processes auto</b> ;<p></p>
<p>http {<br>    <b>ssl_session_cache   shared:SSL:10m</b> ;<br>    <b>ssl_session_timeout 10m</b> ;</p>
<pre><code>server {
    listen              443 ssl;
    server_name         www.example.com;
    &lt;b&gt;keepalive_timeout   70&lt;/b&gt; ;

    ssl_certificate     www.example.com.crt;
    ssl_certificate_key www.example.com.key;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers         HIGH:!aNULL:!MD5;
    ...
</code></pre><p></p></pre></blockquote><p></p><a name="chains"></a><center><h4>   SSL证书链 </h4></center><p>  某些浏览器可能会抱怨由知名证书颁发机构签名的证书，而其他浏览器可能会毫无问题地接受证书。  发生这种情况是因为颁发机构使用中间证书对服务器证书进行了签名，该中间证书不存在于与特定浏览器一起分发的知名可信证书颁发机构的证书库中。  在这种情况下，授权机构提供一组链式证书，这些证书应连接到签名的服务器证书。  服务器证书必须出现在组合文件中的链接证书之前： </p><blockquote class="example"><pre class="notranslate">$ cat www.example.com.crt bundle.crt &gt; www.example.com.chained.crt<br></pre></blockquote><p>  生成的文件应该在<a hhref="ngx_http_ssl_module.html#ssl_certificate">ssl_certificate</a>指令中使用： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen              443 ssl;<br>    server_name         www.example.com;<br>    ssl_certificate     www.example.com.chained.crt;<br>    ssl_certificate_key www.example.com.key;<br>    …<br>}<br></pre></blockquote><p>  如果服务器证书和软件包已按错误的顺序连接，则nginx将无法启动并显示错误消息： </p><blockquote class="example"><pre class="notranslate">SSL_CTX_use_PrivateKey_file(“ … /www.example.com.key”) failed<br>   (SSL: error:0B080074:x509 certificate routines:<br>    X509_check_private_key:key values mismatch)<br></pre></blockquote><p>  因为nginx试图将私钥与bundle的第一个证书而不是服务器证书一起使用。 </p><p>  浏览器通常存储他们收到的中间证书，并由受信任的权威机构签名，因此主动使用的浏览器可能已经拥有所需的中间证书，并且可能不会抱怨没有链接束发送的证书。  要确保服务器发送完整的证书链，可以使用<code class="notranslate">openssl</code>命令行实用程序，例如： </p><blockquote class="example"><pre class="notranslate">$ openssl s_client -connect www.godaddy.com:443<br>…<br>Certificate chain<br> 0 s:/C=US/ST=Arizona/L=Scottsdale/1.3.6.1.4.1.311.60.2.1.3=US<br>     /1.3.6.1.4.1.311.60.2.1.2=AZ/O=GoDaddy.com, Inc<br>     /OU=MIS Department/ <b>CN=www.GoDaddy.com</b><br>     /serialNumber=0796928-7/2.5.4.15=V1.0, Clause 5.(b)<br>   i:/C=US/ST=Arizona/L=Scottsdale/O=GoDaddy.com, Inc.<br>     /OU=<a href="http://certificates.godaddy.com/repository" target="_blank" rel="noopener">http://certificates.godaddy.com/repository</a><br>     /CN=Go Daddy Secure Certification Authority<br>     /serialNumber=07969287<br> 1 s:/C=US/ST=Arizona/L=Scottsdale/O=GoDaddy.com, Inc.<br>     /OU=<a href="http://certificates.godaddy.com/repository" target="_blank" rel="noopener">http://certificates.godaddy.com/repository</a><br>     /CN=Go Daddy Secure Certification Authority<br>     /serialNumber=07969287<br>   i:/C=US/O=The Go Daddy Group, Inc.<br>     /OU=Go Daddy Class 2 Certification Authority<br> 2 s:/C=US/O=The Go Daddy Group, Inc.<br>     /OU=Go Daddy Class 2 Certification Authority<br>   i:/L=ValiCert Validation Network/O= <b>ValiCert, Inc.</b><br>     /OU=ValiCert Class 2 Policy Validation Authority<br>     /CN=<a href="http://www.valicert.com//emailAddress=info@valicert.com" target="_blank" rel="noopener">http://www.valicert.com//emailAddress=info@valicert.com</a><br>…<br></pre></blockquote><p></p><blockquote class="note">  在使用<a hhref="#sni">SNI</a>测试配置时，指定<code class="notranslate">-servername</code>选项很重要，因为默认情况下<code class="notranslate">openssl</code>不使用SNI。 </blockquote><p>  在该示例中， <code class="notranslate">www.GoDaddy.com</code>服务器证书＃0的主题（“ <i>s</i> ”）由发行者（“ <i>i</i> ”）签名，发行者本身是证书＃1的主题，其由发行者本身签署。是证书＃2的主题，由知名发行人<i>ValiCert，Inc。签署，</i>其证书存储在浏览器的内置证书库（位于Jack建造的房屋中）中。 </p><p>  如果尚未添加证书包，则仅显示服务器证书＃0。 </p><a name="single_http_https_server"></a><center><h4>  单个HTTP / HTTPS服务器 </h4></center><p>  可以配置处理HTTP和HTTPS请求的单个服务器： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen              80;<br>    listen              443 ssl;<br>    server_name         www.example.com;<br>    ssl_certificate     www.example.com.crt;<br>    ssl_certificate_key www.example.com.key;<br>    …<br>}<br></pre></blockquote><p></p><blockquote class="note">  在0.7.14之前，无法为个别侦听套接字选择性地启用SSL，如上所示。  只能使用<a hhref="ngx_http_ssl_module.html#ssl">ssl</a>指令为整个服务器启用<a hhref="ngx_http_ssl_module.html#ssl">SSL</a> ，从而无法设置单个HTTP / HTTPS服务器。  添加了<a hhref="ngx_http_core_module.html#listen">listen</a>指令的<code class="notranslate">ssl</code>参数来解决此问题。  因此不鼓励在现代版本中使用<a hhref="ngx_http_ssl_module.html#ssl">ssl</a>指令。 </blockquote><p></p><a name="name_based_https_servers"></a><center><h4>  基于名称的HTTPS服务器 </h4></center><p>  配置两个或多个侦听单个IP地址的HTTPS服务器时会出现一个常见问题： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen          443 ssl;<br>    server_name     www.example.com;<br>    ssl_certificate www.example.com.crt;<br>    …<br>}<p></p>
<p>server {<br>    listen          443 ssl;<br>    server_name     www.example.org;<br>    ssl_certificate www.example.org.crt;<br>    …<br>}<br></p></pre></blockquote><p>  使用此配置，浏览器接收默认服务器的证书，即<code class="notranslate">www.example.com</code>无论请求的服务器名称如何。  这是由SSL协议行为引起的。  在浏览器发送HTTP请求之前建立SSL连接，并且nginx不知道所请求服务器的名称。  因此，它可能只提供默认服务器的证书。 </p><p>  解决此问题的最古老，最强大的方法是为每个HTTPS服务器分配一个单独的IP地址： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen          192.168.1.1:443 ssl;<br>    server_name     www.example.com;<br>    ssl_certificate www.example.com.crt;<br>    …<br>}<p></p>
<p>server {<br>    listen          192.168.1.2:443 ssl;<br>    server_name     www.example.org;<br>    ssl_certificate www.example.org.crt;<br>    …<br>}<br></p></pre></blockquote><p></p><a name="certificate_with_several_names"></a><center><h4>  具有多个名称的SSL证书 </h4></center><p>  还有其他方法允许在多个HTTPS服务器之间共享单个IP地址。  但是，所有这些都有它们的缺点。  一种方法是在SubjectAltName证书字段中使用具有多个名称的证书，例如<code class="notranslate">www.example.com</code>和<code class="notranslate">www.example.org</code> 。  但是，SubjectAltName字段长度是有限的。 </p><p>  另一种方法是使用带有通配符名称的证书，例如<code class="notranslate"><em>.example.org</em></code> 。  通配符证书可保护指定域的所有子域，但仅限于一个级别。  此证书与<code class="notranslate">www.example.org</code>匹配，但与<code class="notranslate">example.org</code>和<code class="notranslate">www.sub.example.org</code>不匹配。  这两种方法也可以组合使用。  证书可以在SubjectAltName字段中包含完全和通配符名称，例如<code class="notranslate">example.org</code>和<code class="notranslate">.example.org</code> 。 </p><p>  最好将具有多个名称的证书文件及其私钥文件放在配置的<i>http</i>级别，以在所有服务器中继承其单个内存副本： </p><blockquote class="example"><pre class="notranslate">ssl_certificate     common.crt;<br>ssl_certificate_key common.key;<p></p>
<p>server {<br>    listen          443 ssl;<br>    server_name     www.example.com;<br>    …<br>}</p>
<p>server {<br>    listen          443 ssl;<br>    server_name     www.example.org;<br>    …<br>}<br></p></pre></blockquote><p></p><a name="sni"></a><center><h4>  服务器名称指示 </h4></center><p>  在单个IP地址上运行多个HTTPS服务器的更通用的解决方案是<a hhref="http://en.wikipedia.org/wiki/Server_Name_Indication">TLS服务器名称指示扩展</a> （SNI，RFC 6066），它允许浏览器在SSL握手期间传递请求的服务器名称，因此服务器将知道哪个它应该用于连接的证书。  目前大多数现代浏览器都<a hhref="http://en.wikipedia.org/wiki/Server_Name_Indication#Support">支持</a> SNI，但某些老客户或特殊客户可能无法使用。 </p><blockquote class="note">  只有域名可以在SNI中传递，但是如果请求包含文字IP地址，某些浏览器可能会错误地传递服务器的IP地址作为其名称。  人们不应该依赖于此。 </blockquote><p></p><p>  为了在nginx中使用SNI，必须在构建nginx二进制文件的OpenSSL库以及在运行时动态链接到的库中支持它。  如果使用配置选项<nobr>“–enable-tlsext”</nobr>构建，OpenSSL支持自0.9.8f版本以来的SNI <nobr>。</nobr>  自OpenSSL 0.9.8j以来，默认情况下启用此选项。  如果nginx是使用SNI支持构建的，那么nginx将在使用“-V”开关运行时显示： </p><blockquote class="example"><pre class="notranslate">$ nginx -V<br>…<br>TLS SNI support enabled<br>…<br></pre></blockquote><p>  但是，如果启用SNI的nginx动态链接到没有SNI支持的OpenSSL库，nginx会显示警告： </p><blockquote class="example"><pre class="notranslate">nginx was built with SNI support, however, now it is linked<br>dynamically to an OpenSSL library which has no tlsext support,<br>therefore SNI is not available<br></pre></blockquote><p></p><a name="compatibility"></a><center><h4>  兼容性 </h4></center><p></p><ul class="compact"><li>  自0.8.21和0.7.62以来，“-V”开关显示SNI支持状态。 </li><li>  自0.7.14起，支持<a hhref="ngx_http_core_module.html#listen">listen</a>指令的<code class="notranslate">ssl</code>参数。  在0.8.21之前，它只能与<code class="notranslate">default</code>参数一起指定。 </li><li>  自0.5.23以来，SNI一直受到支持。 </li><li>  自0.5.6以来一直支持共享SSL会话缓存。 </li></ul><p></p><p></p><ul class="compact"><li>  版本1.9.1及更高版本：默认的SSL协议是TLSv1，TLSv1.1和TLSv1.2（如果OpenSSL库支持）。 </li><li>  版本0.7.65,0.8.19及更高版本：默认的SSL协议是SSLv3，TLSv1，TLSv1.1和TLSv1.2（如果受OpenSSL库支持）。 </li><li>  版本0.7.64,0.8.18及更早版本：默认的SSL协议是SSLv2，SSLv3和TLSv1。 </li></ul><p></p><p></p><ul class="compact"><li>  版本1.0.5及更高版本：默认的SSL密码为“ <code class="notranslate">HIGH:!aNULL:!MD5</code> ”。 </li><li>  版本0.7.65,0.8.20及更高版本：默认SSL密码为“ <code class="notranslate">HIGH:!ADH:!MD5</code> ”。 </li><li>  版本0.8.19：默认SSL密码为“ <code class="notranslate">ALL:!ADH:RC4+RSA:+HIGH:+MEDIUM</code> ”。 </li><li>  版本0.7.64,0.8.18及更早版本：默认的SSL密码是 <br>   “ <code class="notranslate">ALL:!ADH:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP</code> ”。 </li></ul><p></p><table width="100%"><tbody><tr><td align="right" class="notranslate">written by Igor Sysoev<br>edited by Brian Mercer<br></td></tr></tbody></table><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/dev/development_guide.html</url>
      <content type="html"><![CDATA[<p></p><h2>  开发指南 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#introduction">Introduction</a> <br>     <a hhref="#code_layout">Code layout</a> <br>     <a hhref="#include_files">Include files</a> <br>     <a hhref="#integers">Integers</a> <br>     <a hhref="#common_return_codes">Common return codes</a> <br>     <a hhref="#error_handling">Error handling</a> <br> <a hhref="#strings">Strings</a> <br>     <a hhref="#overview">Overview</a> <br>     <a hhref="#formatting">Formatting</a> <br>     <a hhref="#numeric_conversion">Numeric conversion</a> <br>     <a hhref="#regex">Regular expressions</a> <br> <a hhref="#time">Time</a> <br> <a hhref="#containers">Containers</a> <br>     <a hhref="#array">Array</a> <br>     <a hhref="#list">List</a> <br>     <a hhref="#queue">Queue</a> <br>     <a hhref="#red_black_tree">Red-Black tree</a> <br>     <a hhref="#hash">Hash</a> <br> <a hhref="#memory_management">Memory management</a> <br>     <a hhref="#heap">Heap</a> <br>     <a hhref="#pool">Pool</a> <br>     <a hhref="#shared_memory">Shared memory</a> <br> <a hhref="#logging">Logging</a> <br> <a hhref="#cycle">Cycle</a> <br> <a hhref="#buffer">Buffer</a> <br> <a hhref="#networking">Networking</a> <br>     <a hhref="#connection">Connection</a> <br> <a hhref="#events">Events</a> <br>     <a hhref="#event">Event</a> <br>     <a hhref="#i_o_events">I/O events</a> <br>     <a hhref="#timer_events">Timer events</a> <br>     <a hhref="#posted_events">Posted events</a> <br>     <a hhref="#event_loop">Event loop</a> <br> <a hhref="#processes">Processes</a> <br> <a hhref="#threads">Threads</a> <br> <a hhref="#Modules">Modules</a> <br>     <a hhref="#adding_new_modules">Adding new modules</a> <br>     <a hhref="#core_modules">Core Modules</a> <br>     <a hhref="#config_directives">Configuration Directives</a> <br> <a hhref="#http">HTTP</a> <br>     <a hhref="#http_connection">Connection</a> <br>     <a hhref="#http_request">Request</a> <br>     <a hhref="#http_conf">Configuration</a> <br>     <a hhref="#http_phases">Phases</a> <br>     <a hhref="#http_variables">Variables</a> <br>     <a hhref="#http_complex_values">Complex values</a> <br>     <a hhref="#http_request_redirection">Request redirection</a> <br>     <a hhref="#http_subrequests">Subrequests</a> <br>     <a hhref="#http_request_finalization">Request finalization</a> <br>     <a hhref="#http_request_body">Request body</a> <br>     <a hhref="#http_response">Response</a> <br>     <a hhref="#http_response_body">Response body</a> <br>     <a hhref="#http_body_filters">Body filters</a> <br>     <a hhref="#http_building_filter_modules">Building filter modules</a> <br>     <a hhref="#http_body_buffers_reuse">Buffer reuse</a> <br>     <a hhref="#http_load_balancing">Load balancing</a> <br> <a hhref="#examples">Examples</a> <br> <a hhref="#code_style">Code style</a> <br>     <a hhref="#code_style_general_rules">General rules</a> <br>     <a hhref="#code_style_files">Files</a> <br>     <a hhref="#code_style_comments">Comments</a> <br>     <a hhref="#code_style_preprocessor">Preprocessor</a> <br>     <a hhref="#code_style_types">Types</a> <br>     <a hhref="#code_style_variables">Variables</a> <br>     <a hhref="#code_style_functions">Functions</a> <br>     <a hhref="#code_style_expressions">Expressions</a> <br>     <a hhref="#code_style_conditionals_and_loops">Conditionals and Loops</a> <br>     <a hhref="#code_style_labels">Labels</a> <br></td></tr></tbody></table><a name="introduction"></a><center><h4>  介绍 </h4></center><a name="code_layout"></a><center><h4>  代码布局 </h4></center><ul class="compact"><li>   <code class="notranslate">auto</code> - 构建脚本 </li><li> <code class="notranslate">src</code> <ul class="compact"> <li>   <code class="notranslate">core</code> - 基本类型和函数 - 字符串，数组，日志，池等。 </li><li>   <code class="notranslate">event</code> - 事件核心 <ul class="compact"><li>   <code class="notranslate">modules</code> - 事件通知模块： <code class="notranslate">epoll</code> ， <code class="notranslate">kqueue</code> ， <code class="notranslate">select</code>等。 </li></ul></li><li>   <code class="notranslate">http</code> - 核心HTTP模块和通用代码 <ul class="compact"><li>   <code class="notranslate">modules</code> - 其他HTTP模块 </li><li>   <code class="notranslate">v2</code> -  HTTP / 2 </li></ul></li><li>   <code class="notranslate">mail</code> - 邮件模块 </li><li>   <code class="notranslate">os</code> - 特定于平台的代码 <ul class="compact"><li> <code class="notranslate">unix</code> </li> <li> <code class="notranslate">win32</code> </li> </ul></li><li>   <code class="notranslate">stream</code> - 流模块 </li></ul></li></ul><a name="include_files"></a><center><h4>  包含文件 </h4></center><p>  以下两个<code class="notranslate">#include</code>语句必须出现在每个nginx文件的开头： </p><blockquote class="example"><pre class="notranslate">#include &lt;ngx_config.h&gt;<p></p>
<p>#include &lt;ngx_core.h&gt;<br></p></pre></blockquote><p>  除此之外，HTTP代码应包括 </p><blockquote class="example"><pre class="notranslate">#include &lt;ngx_http.h&gt;<br></pre></blockquote><p>  邮件代码应包括 </p><blockquote class="example"><pre class="notranslate">#include &lt;ngx_mail.h&gt;<br></pre></blockquote><p>  流代码应包括 </p><blockquote class="example"><pre class="notranslate">#include &lt;ngx_stream.h&gt;<br></pre></blockquote><a name="integers"></a><center><h4>  整型 </h4></center><p>  出于一般目的，nginx代码使用两种整数类型， <code class="notranslate">ngx_int_t</code>和<code class="notranslate">ngx_uint_t</code> ，它们分别是<code class="notranslate">intptr_t</code>和<code class="notranslate">uintptr_t</code> typedef。 </p><a name="common_return_codes"></a><center><h4>  常见的返回码 </h4></center><p>   nginx中的大多数函数返回以下代码： </p><ul class="compact"><li>   <code class="notranslate">NGX_OK</code> - 操作成功。 </li><li>   <code class="notranslate">NGX_ERROR</code> - 操作失败。 </li><li>   <code class="notranslate">NGX_AGAIN</code> - 操作不完整;  再次调用该函数。 </li><li>   <code class="notranslate">NGX_DECLINED</code> - 例如，操作被拒绝，因为它在配置中被禁用。  这绝不是一个错误。 </li><li>   <code class="notranslate">NGX_BUSY</code> - 资源不可用。 </li><li>   <code class="notranslate">NGX_DONE</code> - 操作完成或在其他地方继续。  也用作替代成功代码。 </li><li>   <code class="notranslate">NGX_ABORT</code> - 功能已中止。  也用作替代错误代码。 </li></ul><a name="error_handling"></a><center><h4>  错误处理 </h4></center><p>   <code class="notranslate">ngx_errno</code>宏返回上一个系统错误代码。  它映射到POSIX平台上的<code class="notranslate">errno</code>和Windows中的<code class="notranslate">GetLastError()</code>调用。   <code class="notranslate">ngx_socket_errno</code>宏返回最后一个套接字错误号。  与<code class="notranslate">ngx_errno</code>宏一样，它映射到POSIX平台上的<code class="notranslate">errno</code> 。  它映射到Windows上的<code class="notranslate">WSAGetLastError()</code>调用。   <code class="notranslate">ngx_socket_errno</code>多次访问<code class="notranslate">ngx_errno</code>或<code class="notranslate">ngx_socket_errno</code>的值可能会导致性能问题。  如果可能多次使用错误值，请将其存储在<code class="notranslate">ngx_err_t</code>类型的本地变量中。  要设置错误，请使用<code class="notranslate">ngx_set_errno(errno)</code>和<code class="notranslate">ngx_set_socket_errno(errno)</code>宏。 </p><p>   <code class="notranslate">ngx_errno</code>和<code class="notranslate">ngx_socket_errno</code>的值可以传递给日志函数<code class="notranslate">ngx_log_error()</code>和<code class="notranslate">ngx_log_debugX()</code> ，在这种情况下，系统错误文本将添加到日志消息中。 </p><p>  使用<code class="notranslate">ngx_errno</code>示例： </p><blockquote class="example"><pre class="notranslate">void<br>ngx_my_kill(ngx_pid_t pid, ngx_log_t *log, int signo)<br>{<br>    ngx_err_t  err;<p></p>
<pre><code>if (kill(pid, signo) == -1) {
    err = ngx_errno;

    ngx_log_error(NGX_LOG_ALERT, log, err, &quot;kill(%P, %d) failed&quot;, pid, signo);

    if (err == NGX_ESRCH) {
        return 2;
    }

    return 1;
}

return 0;
</code></pre><p>}<br></p></pre></blockquote><a name="strings"></a><center><h4>  字符串 </h4></center><a name="overview"></a><center><h4>  概观 </h4></center><p>  对于C字符串，nginx使用无符号字符类型指针<code class="notranslate">u_char <em></em></code> 。 </p><p>   nginx字符串类型<code class="notranslate">ngx_str_t</code>定义如下： </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    size_t      len;<br>    u_char     data;<br>} ngx_str_t;<br></pre></blockquote><p>   <code class="notranslate">len</code>字段保存字符串长度， <code class="notranslate">data</code>保存字符串数据。  保存在<code class="notranslate">ngx_str_t</code>中的<code class="notranslate">ngx_str_t</code>在<code class="notranslate">len</code>字节之后可能会或可能不会以空值终止。  在大多数情况下，事实并非如此。  但是，在代码的某些部分（例如，在解析配置时），已知<code class="notranslate">ngx_str_t</code>对象以空值终止，这简化了字符串比较并使字符串更容易传递给系统调用。 </p><p>   nginx中的字符串操作在<code class="notranslate">src/core/ngx_string.h</code>中声明。其中一些是围绕标准C函数的包装器： </p><p></p><ul class="compact"><li> <code class="notranslate">ngx_strcmp()</code> </li> <li> <code class="notranslate">ngx_strncmp()</code> </li> <li> <code class="notranslate">ngx_strstr()</code> </li> <li> <code class="notranslate">ngx_strlen()</code> </li> <li> <code class="notranslate">ngx_strchr()</code> </li> <li> <code class="notranslate">ngx_memcmp()</code> </li> <li> <code class="notranslate">ngx_memset()</code> </li> <li> <code class="notranslate">ngx_memcpy()</code> </li> <li> <code class="notranslate">ngx_memmove()</code> </li> </ul><p></p><p>  其他字符串函数是特定于nginx的 </p><p></p><ul class="compact"><li>   <code class="notranslate">ngx_memzero()</code> - 用零填充内存。 </li><li>   <code class="notranslate">ngx_explicit_memzero()</code> - 与<code class="notranslate">ngx_memzero()</code>相同，但编译器的死存储消除优化永远不会删除此调用。  此功能可用于清除密码和密钥等敏感数据。 </li><li>   <code class="notranslate">ngx_cpymem()</code> - 与<code class="notranslate">ngx_memcpy()</code>相同，但返回最终目标地址这个可以方便地连续添加多个字符串。 </li><li>   <code class="notranslate">ngx_movemem()</code> - 与<code class="notranslate">ngx_memmove()</code>相同，但返回最终目标地址。 </li><li>   <code class="notranslate">ngx_strlchr()</code> - 搜索字符串中的字符，由两个指针分隔。 </li></ul><p></p><p>  以下函数执行大小写转换和比较： </p><p></p><ul class="compact"><li> <code class="notranslate">ngx_tolower()</code> </li> <li> <code class="notranslate">ngx_toupper()</code> </li> <li> <code class="notranslate">ngx_strlow()</code> </li> <li> <code class="notranslate">ngx_strcasecmp()</code> </li> <li> <code class="notranslate">ngx_strncasecmp()</code> </li> </ul><p></p><p>  以下宏简化了字符串初始化： </p><ul class="compact"><li>   <code class="notranslate">ngx_string(text)</code> - 来自C字符串文字<code class="notranslate">text</code>的<code class="notranslate">ngx_str_t</code>类型的静态初始值设定项 </li><li>   <code class="notranslate">ngx_null_string</code> - <code class="notranslate">ngx_str_t</code>类型的静态空字符串初始值设定项 </li><li>   <code class="notranslate">ngx_str_set(str, text)</code> - 使用C字符串文字<code class="notranslate">text</code>初始化<code class="notranslate">ngx_str_t <em></em></code> type的字符串<code class="notranslate">str</code> </li><li>   <code class="notranslate">ngx_str_null(str)</code> - 使用空字符串初始化<code class="notranslate">ngx_str_t </code> type的字符串<code class="notranslate">str</code> </li></ul><a name="formatting"></a><center><h4>  格式化 </h4></center><p>  以下格式化函数支持特定于nginx的类型： </p><p></p><ul class="compact"><li> <code class="notranslate">ngx_sprintf(buf, fmt, …)</code> </li> <li> <code class="notranslate">ngx_snprintf(buf, max, fmt, …)</code> </li> <li> <code class="notranslate">ngx_slprintf(buf, last, fmt, …)</code> </li> <li> <code class="notranslate">ngx_vslprintf(buf, last, fmt, args)</code> </li> <li> <code class="notranslate">ngx_vsnprintf(buf, max, fmt, args)</code> </li> </ul><p></p><p>  这些函数支持的格式化选项的完整列表位于<code class="notranslate">src/core/ngx_string.c</code> 。  他们之中有一些是： </p><ul class="compact"><li>   <code class="notranslate">%O</code> - <code class="notranslate">off_t</code> </li><li>   <code class="notranslate">%T</code> - <code class="notranslate">time_t</code> </li><li>   <code class="notranslate">%z</code> - <code class="notranslate">ssize_t</code> </li><li>   <code class="notranslate">%i</code> - <code class="notranslate">ngx_int_t</code> </li><li>   <code class="notranslate">%p</code> - <code class="notranslate">void <em></em></code> </li><li>   <code class="notranslate">%V</code> - <code class="notranslate">ngx_str_t </code> </li><li>   <code class="notranslate">%s</code> - <code class="notranslate">u_char <em></em></code> （以null结尾） </li><li>   <code class="notranslate">%s</code> - <code class="notranslate">size_t + u_char *</code> </li></ul><p>  您可以在大多数类型上添加前缀以使其无符号。  要将输出转换为十六进制，请使用<code class="notranslate">X</code>或<code class="notranslate">x</code> 。 </p><p>  例如： </p><blockquote class="example"><pre class="notranslate">u_char      buf[NGX_INT_T_LEN];<br>size_t      len;<br>ngx_uint_t  n;<p></p>
<p>/<em> set n here </em>/</p>
<p>len = ngx_sprintf(buf, “%ui”, n) — buf;<br></p></pre></blockquote><p></p><a name="numeric_conversion"></a><center><h4>  数字转换 </h4></center><p>  在nginx中实现了几个用于数值转换的函数。  前四个每个都将给定长度的字符串转换为指定类型的正整数。  它们在出错时返回<code class="notranslate">NGX_ERROR</code> 。 </p><ul class="compact"><li>   <code class="notranslate">ngx_atoi(line, n)</code> - <code class="notranslate">ngx_int_t</code> </li><li>   <code class="notranslate">ngx_atosz(line, n)</code> - <code class="notranslate">ssize_t</code> </li><li>   <code class="notranslate">ngx_atoof(line, n)</code> - <code class="notranslate">off_t</code> </li><li>   <code class="notranslate">ngx_atotm(line, n)</code> - <code class="notranslate">time_t</code> </li></ul><p></p><p>  还有两个额外的数字转换函数。  与前四个一样，他们在出错时返回<code class="notranslate">NGX_ERROR</code> 。 </p><ul class="compact"><li>   <code class="notranslate">ngx_atofp(line, n, point)</code> - 将给定长度的固定点浮点数转换为<code class="notranslate">ngx_int_t</code>类型的正整数。  结果左移小数点位置。  数字的字符串表示形式预计不会超过小数位数。  例如， <code class="notranslate">ngx_atofp(“10.5”, 4, 2)</code>返回<code class="notranslate">1050</code> 。 </li><li>   <code class="notranslate">ngx_hextoi(line, n)</code> - 将正整数的十六进制表示形式转换为<code class="notranslate">ngx_int_t</code> 。 </li></ul><p></p><a name="regex"></a><center><h4>  常用表达 </h4></center><p>   nginx中的正则表达式接口是<a hhref="http://www.pcre.org">PCRE</a>库的包装器。  相应的头文件是<code class="notranslate">src/core/ngx_regex.h</code> 。 </p><p>  要使用正则表达式进行字符串匹配，首先需要编译它，这通常在配置阶段完成。  请注意，由于PCRE支持是可选的，因此使用该接口的所有代码都必须受到周围<code class="notranslate">NGX_PCRE</code>宏的保护： </p><blockquote class="example"><pre class="notranslate">#if (NGX_PCRE)<br>ngx_regex_t          *re;<br>ngx_regex_compile_t   rc;<p></p>
<p>u_char                errstr[NGX_MAX_CONF_ERRSTR];</p>
<p>ngx_str_t  value = ngx_string(“message (\d\d\d).*Codeword is ‘(?&lt;cw&gt;\w+)’”);</p>
<p>ngx_memzero(&amp;rc, sizeof(ngx_regex_compile_t));</p>
<p>rc.pattern = value;<br>rc.pool = cf-&gt;pool;<br>rc.err.len = NGX_MAX_CONF_ERRSTR;<br>rc.err.data = errstr;<br>/<em> rc.options are passed as is to pcre_compile() </em>/</p>
<p>if (ngx_regex_compile(&amp;rc) != NGX_OK) {<br>    ngx_conf_log_error(NGX_LOG_EMERG, cf, 0, “%V”, &amp;rc.err);<br>    return NGX_CONF_ERROR;<br>}</p>
<p>re = rc.regex;</p>
<p>#endif<br></p></pre></blockquote><p>  编译成功后， <code class="notranslate">ngx_regex_compile_t</code>结构中的<code class="notranslate">ngx_regex_compile_t</code>和<code class="notranslate">named_captures</code>字段<code class="notranslate">ngx_regex_compile_t</code>包含正则表达式中的所有捕获和命名捕获的计数。 </p><p>  然后可以使用编译的正则表达式来匹配字符串： </p><blockquote class="example"><pre class="notranslate">ngx_int_t  n;<br>int        captures[(1 + rc.captures) * 3];<p></p>
<p>ngx_str_t input = ngx_string(“This is message 123. Codeword is ‘foobar’.”);</p>
<p>n = ngx_regex_exec(re, &amp;input, captures, (1 + rc.captures) <em> 3);<br>if (n &gt;= 0) {<br>    /</em> string matches expression */</p>
<p>} else if (n == NGX_REGEX_NO_MATCHED) {<br>    /<em> no match was found </em>/</p>
<p>} else {<br>    /<em> some error </em>/<br>    ngx_log_error(NGX_LOG_ALERT, log, 0, ngx_regex_exec_n “ failed: %i”, n);<br>}<br></p></pre></blockquote><p>   <code class="notranslate">ngx_regex_exec()</code>的参数是编译的正则表达式<code class="notranslate">re</code> ，匹配<code class="notranslate">s</code>的字符串，用于保存找到的任何<code class="notranslate">captures</code>的可选整数数组以及数组的<code class="notranslate">size</code> 。  根据<a hhref="http://www.pcre.org/original/doc/html/pcreapi.html">PCRE API的</a>要求， <code class="notranslate">captures</code>数组的大小必须是三的倍数。  在该示例中，大小是根据匹配的字符串本身的总捕获数加<code class="notranslate">1</code> 。 </p><p>  如果有匹配，则可以按如下方式访问捕获： </p><blockquote class="example"><pre class="notranslate">u_char     *p;<br>size_t      size;<br>ngx_str_t   name, value;<p></p>
<p>/<em> all captures </em>/<br>for (i = 0; i &lt; n * 2; i += 2) {<br>    value.data = input.data + captures[i];<br>    value.len = captures[i + 1] — captures[i];<br>}</p>
<p>/<em> accessing named captures </em>/</p>
<p>size = rc.name_size;<br>p = rc.names;</p>
<p>for (i = 0; i &lt; rc.named_captures; i++, p += size) {</p>
<pre><code>/* capture name */
name.data = &amp;amp;p[2];
name.len = ngx_strlen(name.data);

n = 2 * ((p[0] &amp;lt;&amp;lt; 8) + p[1]);

/* captured value */
value.data = &amp;amp;input.data[captures[n]];
value.len = captures[n + 1] — captures[n];
</code></pre><p>}<br></p></pre></blockquote><p></p><p>   <code class="notranslate">ngx_regex_exec_array()</code>函数接受<code class="notranslate">ngx_regex_elt_t</code>元素的数组（它们只是具有关联名称的已编译正则表达式），要匹配的字符串和日志。  该函数将表达式从数组应用到字符串，直到找到匹配或不再有表达式为止。  当匹配时返回值为<code class="notranslate">NGX_OK</code> ，否则<code class="notranslate">NGX_ERROR</code> ，如果出错则返回值为<code class="notranslate">NGX_OK</code> 。 </p><a name="time"></a><center><h4>  时间 </h4></center><p>   <code class="notranslate">ngx_time_t</code>结构表示具有三种不同类型的时间，包括秒，毫秒和GMT偏移量： </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    time_t      sec;<br>    ngx_uint_t  msec;<br>    ngx_int_t   gmtoff;<br>} ngx_time_t;<br></pre></blockquote><p>   <code class="notranslate">ngx_tm_t</code>结构是UNIX平台上的<code class="notranslate">struct tm</code>和Windows上的<code class="notranslate">SYSTEMTIME</code>的别名。 </p><p>  要获得当前时间，通常可以访问其中一个可用的全局变量，表示所需格式的缓存时间值。 </p><p>  可用的字符串表示形式为： </p><ul class="compact"><li>   <code class="notranslate">ngx_cached_err_log_time</code> - 用于错误日志条目： <code class="notranslate">“1970/09/28 12:00:00”</code> </li><li>   <code class="notranslate">ngx_cached_http_log_time</code> - 用于HTTP访问日志条目： <code class="notranslate">“28/Sep/1970:12:00:00 +0600”</code> </li><li>   <code class="notranslate">ngx_cached_syslog_time</code> - 用于syslog条目： <code class="notranslate">“Sep 28 12:00:00”</code> </li><li>   <code class="notranslate">ngx_cached_http_time</code> - 用于HTTP标头： <code class="notranslate">“Mon, 28 Sep 1970 06:00:00 GMT”</code> </li><li>   <code class="notranslate">ngx_cached_http_log_iso8601</code> -  ISO 8601标准格式： <code class="notranslate">“1970-09-28T12:00:00+06:00”</code> </li></ul><p></p><p>   <code class="notranslate">ngx_time()</code>和<code class="notranslate">ngx_timeofday()</code>宏以秒为单位返回当前时间值，是访问缓存时间值的首选方法。 </p><p>  要显式获取时间，请使用<code class="notranslate">ngx_gettimeofday()</code> ，它更新其参数（指向<code class="notranslate">struct timeval</code>指针）。  当nginx从系统调用返回到事件循环时，时间总是更新。  要立即更新时间，请在信号处理程序上下文中更新时间时调用<code class="notranslate">ngx_time_update()</code>或<code class="notranslate">ngx_time_sigsafe_update()</code> 。 </p><p>  以下函数将<code class="notranslate">time_t</code>转换为指示的细分时间表示。  每对中的第一个函数将<code class="notranslate">time_t</code>转换为<code class="notranslate">ngx_tm_t</code> ，将第二个函数（使用<code class="notranslate"><em>libc</em></code> infix）转换为<code class="notranslate">struct tm</code> ： </p><ul class="compact"><li>   <code class="notranslate">ngx_gmtime(), ngx_libc_gmtime()</code> - 以UTC表示的时间 </li><li>   <code class="notranslate">ngx_localtime(), ngx_libc_localtime()</code> - 相对于本地时区表示的时间 </li></ul><p>   <code class="notranslate">ngx_http_time(buf, time)</code>函数返回适合在HTTP头中使用的字符串表示（例如， <code class="notranslate">“Mon, 28 Sep 1970 06:00:00 GMT”</code> ）。   <code class="notranslate">ngx_http_cookie_time(buf, time)</code>返回一个字符串表示函数，返回一个适合HTTP cookie的字符串表示（ <code class="notranslate">“Thu, 31-Dec-37 23:55:55 GMT”</code> ）。 </p><a name="containers"></a><center><h4>  集装箱 </h4></center><a name="array"></a><center><h4>  排列 </h4></center><p>   nginx数组类型<code class="notranslate">ngx_array_t</code>定义如下 </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    void        <em>elts;<br>    ngx_uint_t   nelts;<br>    size_t       size;<br>    ngx_uint_t   nalloc;<br>    ngx_pool_t  </em>pool;<br>} ngx_array_t;<br></pre></blockquote><p>   <code class="notranslate">elts</code>字段中提供了数组的元素。   <code class="notranslate">nelts</code>字段包含元素的数量。   <code class="notranslate">size</code>字段保存单个元素的大小，并在初始化数组时设置。 </p><p>  使用<code class="notranslate">ngx_array_create(pool, n, size)</code>调用在池中创建数组，并使用<code class="notranslate">ngx_array_init(array, pool, n, size)</code>调用来初始化已分配的数组对象。 </p><blockquote class="example"><pre class="notranslate">ngx_array_t  *a, b;<p></p>
<p>/<em> create an array of strings with preallocated memory for 10 elements </em>/<br>a = ngx_array_create(pool, 10, sizeof(ngx_str_t));</p>
<p>/<em> initialize string array for 10 elements </em>/<br>ngx_array_init(&amp;b, pool, 10, sizeof(ngx_str_t));<br></p></pre></blockquote><p>  使用以下函数将元素添加到数组： </p><p></p><ul class="compact"><li>   <code class="notranslate">ngx_array_push(a)</code>添加一个尾部元素并返回指向它的指针 </li><li>   <code class="notranslate">ngx_array_push_n(a, n)</code>添加<code class="notranslate">n</code>尾部元素并返回指向第一个元素的指针 </li></ul><p></p><p>  如果当前分配的内存量不足以容纳新元素，则分配新的内存块并将现有元素复制到其中。  新内存块通常是现有内存块的两倍。 </p><blockquote class="example"><pre class="notranslate">s = ngx_array_push(a);<br>ss = ngx_array_push_n(&amp;b, 3);<br></pre></blockquote><a name="list"></a><center><h4>  名单 </h4></center><p>  在nginx中，列表是一系列数组，针对插入可能大量的项进行了优化。   <code class="notranslate">ngx_list_t</code>列表类型定义如下： </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    ngx_list_part_t  <em>last;<br>    ngx_list_part_t   part;<br>    size_t            size;<br>    ngx_uint_t        nalloc;<br>    ngx_pool_t       </em>pool;<br>} ngx_list_t;<br></pre></blockquote><p>  实际项目存储在列表部分中，其定义如下： </p><blockquote class="example"><pre class="notranslate">typedef struct ngx_list_part_s  ngx_list_part_t;<p></p>
<p>struct ngx_list_part_s {<br>    void             <em>elts;<br>    ngx_uint_t        nelts;<br>    ngx_list_part_t  </em>next;<br>};<br></p></pre></blockquote><p>  在使用之前，必须通过调用<code class="notranslate">ngx_list_init(list, pool, n, size)</code>或通过调用<code class="notranslate">ngx_list_create(pool, n, size)</code>创建列表来初始化<code class="notranslate">ngx_list_init(list, pool, n, size)</code> 。  这两个函数都将单个项的大小和每个列表部分的项数作为参数。  要将项添加到列表，请使用<code class="notranslate">ngx_list_push(list)</code>函数。  要迭代这些项，请直接访问列表字段，如示例所示： </p><blockquote class="example"><pre class="notranslate">ngx_str_t        <em>v;<br>ngx_uint_t        i;<br>ngx_list_t       </em>list;<br>ngx_list_part_t  *part;<p></p>
<p>list = ngx_list_create(pool, 100, sizeof(ngx_str_t));<br>if (list == NULL) { /<em> error </em>/ }</p>
<p>/<em> add items to the list </em>/</p>
<p>v = ngx_list_push(list);<br>if (v == NULL) { /<em> error </em>/ }<br>ngx_str_set(v, “foo”);</p>
<p>v = ngx_list_push(list);<br>if (v == NULL) { /<em> error </em>/ }<br>ngx_str_set(v, “bar”);</p>
<p>/<em> iterate over the list </em>/</p>
<p>part = &amp;list-&gt;part;<br>v = part-&gt;elts;</p>
<p>for (i = 0; /<em> void </em>/; i++) {</p>
<pre><code>if (i &amp;gt;= part-&amp;gt;nelts) {
    if (part-&amp;gt;next == NULL) {
        break;
    }

    part = part-&amp;gt;next;
    v = part-&amp;gt;elts;
    i = 0;
}

ngx_do_smth(&amp;amp;v[i]);
</code></pre><p>}<br></p></pre></blockquote><p>  列表主要用于HTTP输入和输出标头。 </p><p>  列表不支持删除项目。  但是，在需要时，项目可以在内部被标记为缺失，而不会实际从列表中删除。  例如，要将HTTP输出标头（存储为<code class="notranslate">ngx_table_elt_t</code>对象）标记为缺失，请将<code class="notranslate">ngx_table_elt_t</code>的<code class="notranslate">hash</code>字段设置为零。  迭代标题时，显式跳过以这种方式标记的项目。 </p><a name="queue"></a><center><h4>  队列 </h4></center><p>  在nginx中，队列是一个侵入式双向链表，每个节点定义如下： </p><blockquote class="example"><pre class="notranslate">typedef struct ngx_queue_s  ngx_queue_t;<p></p>
<p>struct ngx_queue_s {<br>    ngx_queue_t  <em>prev;<br>    ngx_queue_t  </em>next;<br>};<br></p></pre></blockquote><p>  头队列节点未与任何数据链接。  使用前，请使用<code class="notranslate">ngx_queue_init(q)</code>调用初始化列表头。  队列支持以下操作： </p><p></p><ul class="compact"><li>   <code class="notranslate">ngx_queue_insert_head(h, x)</code> ， <code class="notranslate">ngx_queue_insert_tail(h, x)</code> - 插入新节点 </li><li>   <code class="notranslate">ngx_queue_remove(x)</code> - 删除队列节点 </li><li>   <code class="notranslate">ngx_queue_split(h, q, n)</code> - 在一个节点上拆分队列，将队列尾部返回到一个单独的队列中 </li><li>   <code class="notranslate">ngx_queue_add(h, n)</code> - 将第二个队列添加到第一个队列 </li><li>   <code class="notranslate">ngx_queue_head(h)</code> ， <code class="notranslate">ngx_queue_last(h)</code> - 获取第一个或最后一个队列节点 </li><li>   <code class="notranslate">ngx_queue_sentinel(h)</code> - 获取队列sentinel对象以结束迭代 </li><li>   <code class="notranslate">ngx_queue_data(q, type, link)</code> - 获取对队列节点数据结构开头的引用，考虑其中的队列字段偏移量 </li></ul><p></p><p>  一个例子： </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    ngx_str_t    value;<br>    ngx_queue_t  queue;<br>} ngx_foo_t;<p></p>
<p>ngx_foo_t    <em>f;<br>ngx_queue_t   values, </em>q;</p>
<p>ngx_queue_init(&amp;values);</p>
<p>f = ngx_palloc(pool, sizeof(ngx_foo_t));<br>if (f == NULL) { /<em> error </em>/ }<br>ngx_str_set(&amp;f-&gt;value, “foo”);</p>
<p>ngx_queue_insert_tail(&amp;values, &amp;f-&gt;queue);</p>
<p>/<em> insert more nodes here </em>/</p>
<p>for (q = ngx_queue_head(&amp;values);<br>     q != ngx_queue_sentinel(&amp;values);<br>     q = ngx_queue_next(q))<br>{<br>    f = ngx_queue_data(q, ngx_foo_t, queue);</p>
<pre><code>ngx_do_smth(&amp;amp;f-&amp;gt;value);
</code></pre><p>}<br></p></pre></blockquote><a name="red_black_tree"></a><center><h4>  红黑树 </h4></center><p>   <code class="notranslate">src/core/ngx_rbtree.h</code>头文件提供了对红黑树的有效实现的访问。 </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    ngx_rbtree_t       rbtree;<br>    ngx_rbtree_node_t  sentinel;<p></p>
<pre><code>/* custom per-tree data here */
</code></pre><p>} my_tree_t;</p>
<p>typedef struct {<br>    ngx_rbtree_node_t  rbnode;</p>
<pre><code>/* custom per-node data */
foo_t              val;
</code></pre><p>} my_node_t;<br></p></pre></blockquote><p>  要处理整个树，需要两个节点：root和sentinel。  通常，它们会添加到自定义结构中，允许您将数据组织到树中，其中树叶包含指向或嵌入数据的链接。 </p><p>  要初始化树： </p><blockquote class="example"><pre class="notranslate">my_tree_t  root;<p></p>
<p>ngx_rbtree_init(&amp;root.rbtree, &amp;root.sentinel, insert_value_function);<br></p></pre></blockquote><p>  要遍历树并插入新值，请使用“ <code class="notranslate">insert_value</code> ”函数。  例如， <code class="notranslate">ngx_str_rbtree_insert_value</code>函数处理<code class="notranslate">ngx_str_t</code>类型。  它的参数是指向插入的根节点，要添加的新创建的节点以及树的标记的指针。 </p><blockquote class="example"><pre class="notranslate">void ngx_str_rbtree_insert_value(ngx_rbtree_node_t <em>temp,<br>                                 ngx_rbtree_node_t </em>node,<br>                                 ngx_rbtree_node_t <em>sentinel)<br></em></pre></blockquote><p>  遍历非常简单，可以使用以下查找函数模式进行演示： </p><blockquote class="example"><pre class="notranslate">my_node_t <br>my_rbtree_lookup(ngx_rbtree_t <em>rbtree, foo_t </em>val, uint32_t hash)<br>{<br>    ngx_int_t           rc;<br>    my_node_t          <em>n;<br>    ngx_rbtree_node_t  </em>node, *sentinel;<p></p>
<pre><code>node = rbtree-&amp;gt;root;
sentinel = rbtree-&amp;gt;sentinel;

while (node != sentinel) {

    n = (my_node_t *) node;

    if (hash != node-&amp;gt;key) {
        node = (hash &amp;lt; node-&amp;gt;key) ? node-&amp;gt;left : node-&amp;gt;right;
        continue;
    }

    rc = compare(val, node-&amp;gt;val);

    if (rc &amp;lt; 0) {
        node = node-&amp;gt;left;
        continue;
    }

    if (rc &amp;gt; 0) {
        node = node-&amp;gt;right;
        continue;
    }

    return n;
}

return NULL;
</code></pre><p>}<br></p></pre></blockquote><p>   <code class="notranslate">compare()</code>函数是一个经典的比较器函数，它返回一个小于，等于或大于零的值。  为了加速查找并避免比较可能很大的用户对象，使用整数哈希字段。 </p><p>  要将节点添加到树，请分配新节点，对其进行初始化并调用<code class="notranslate">ngx_rbtree_insert()</code> ： </p><blockquote class="example"><pre class="notranslate">    my_node_t          <em>my_node;<br>    ngx_rbtree_node_t  </em>node;<p></p>
<pre><code>my_node = ngx_palloc(...);
init_custom_data(&amp;amp;my_node-&amp;gt;val);

node = &amp;amp;my_node-&amp;gt;rbnode;
node-&amp;gt;key = create_key(my_node-&amp;gt;val);

ngx_rbtree_insert(&amp;amp;root-&amp;gt;rbtree, node);
</code></pre><p></p></pre></blockquote><p>  要删除节点，请调用<code class="notranslate">ngx_rbtree_delete()</code>函数： </p><blockquote class="example"><pre class="notranslate">ngx_rbtree_delete(&amp;root-&gt;rbtree, node);<br></pre></blockquote><a name="hash"></a><center><h4>  哈希 </h4></center><p>  散列表函数在<code class="notranslate">src/core/ngx_hash.h</code> 。  支持精确匹配和通配符匹配。  后者需要额外的设置，并在下面的单独部分中描述。 </p><p>  在初始化哈希之前，您需要知道它将保留的元素数量，以便nginx可以最佳地构建它。  需要配置的两个参数是<code class="notranslate">max_size</code>和<code class="notranslate">bucket_size</code> ，详见单独的<a hhref="hash.html">文档</a> 。  它们通常可由用户配置。  散列初始化设置与<code class="notranslate">ngx_hash_init_t</code>类型一起存储，散列本身为<code class="notranslate">ngx_hash_t</code> ： </p><blockquote class="example"><pre class="notranslate">ngx_hash_t       foo_hash;<br>ngx_hash_init_t  hash;<p></p>
<p>hash.hash = &amp;foo_hash;<br>hash.key = ngx_hash_key;<br>hash.max_size = 512;<br>hash.bucket_size = ngx_align(64, ngx_cacheline_size);<br>hash.name = “foo_hash”;<br>hash.pool = cf-&gt;pool;<br>hash.temp_pool = cf-&gt;temp_pool;<br></p></pre></blockquote><p>   <code class="notranslate">key</code>是指向函数的指针，该函数从字符串创建哈希整数键。  有两个通用的密钥创建函数： <code class="notranslate">ngx_hash_key(data, len)</code>和<code class="notranslate">ngx_hash_key_lc(data, len)</code> 。  后者将字符串转换为全部小写字符，因此传递的字符串必须是可写的。  如果不是这样，将<code class="notranslate">NGX_HASH_READONLY_KEY</code>标志传递给函数，初始化密钥数组（见下文）。 </p><p>  散列键存储在<code class="notranslate">ngx_hash_keys_arrays_t</code> ，并使用<code class="notranslate">ngx_hash_keys_array_init(arr, type)</code>初始化：第二个参数（ <code class="notranslate">type</code> ）控制为散列预分配的资源量，可以是<code class="notranslate">NGX_HASH_SMALL</code>或<code class="notranslate">NGX_HASH_LARGE</code> 。  如果您希望散列包含数千个元素，则后者是合适的。 </p><blockquote class="example"><pre class="notranslate">ngx_hash_keys_arrays_t  foo_keys;<p></p>
<p>foo_keys.pool = cf-&gt;pool;<br>foo_keys.temp_pool = cf-&gt;temp_pool;</p>
<p>ngx_hash_keys_array_init(&amp;foo_keys, NGX_HASH_SMALL);<br></p></pre></blockquote><p></p><p>  要将键插入哈希键数组，请使用<code class="notranslate">ngx_hash_add_key(keys_array, key, value, flags)</code>函数： </p><blockquote class="example"><pre class="notranslate">ngx_str_t k1 = ngx_string(“key1”);<br>ngx_str_t k2 = ngx_string(“key2”);<p></p>
<p>ngx_hash_add_key(&amp;foo_keys, &amp;k1, &amp;my_data_ptr_1, NGX_HASH_READONLY_KEY);<br>ngx_hash_add_key(&amp;foo_keys, &amp;k2, &amp;my_data_ptr_2, NGX_HASH_READONLY_KEY);<br></p></pre></blockquote><p></p><p>  要构建哈希表，请调用<code class="notranslate">ngx_hash_init(hinit, key_names, nelts)</code>函数： </p><blockquote class="example"><pre class="notranslate">ngx_hash_init(&amp;hash, foo_keys.keys.elts, foo_keys.keys.nelts);<br></pre></blockquote><p>  如果<code class="notranslate">max_size</code>或<code class="notranslate">bucket_size</code>参数不够大，则该函数失败。 </p><p>  构建哈希时，使用<code class="notranslate">ngx_hash_find(hash, key, name, len)</code>函数查找元素： </p><blockquote class="example"><pre class="notranslate">my_data_t   *data;<br>ngx_uint_t   key;<p></p>
<p>key = ngx_hash_key(k1.data, k1.len);</p>
<p>data = ngx_hash_find(&amp;foo_hash, key, k1.data, k1.len);<br>if (data == NULL) {<br>    /<em> key not found </em>/<br>}<br></p></pre></blockquote><p></p><a name="wildcard_matching"></a><center><h4>  通配符匹配 </h4></center><p>  要创建使用通配符的哈希，请使用<code class="notranslate">ngx_hash_combined_t</code>类型。  它包括上面描述的散列类型，并有两个额外的键数组： <code class="notranslate">dns_wc_head</code>和<code class="notranslate">dns_wc_tail</code> 。  基本属性的初始化类似于常规哈希： </p><blockquote class="example"><pre class="notranslate">ngx_hash_init_t      hash<br>ngx_hash_combined_t  foo_hash;<p></p>
<p>hash.hash = &amp;foo_hash.hash;<br>hash.key = …;<br></p></pre></blockquote><p></p><p>  可以使用<code class="notranslate">NGX_HASH_WILDCARD_KEY</code>标志添加通配符键： </p><blockquote class="example"><pre class="notranslate">/<em> k1 = “.example.org”; </em>/<br>/<em> k2 = “foo.</em>“;        */<br>ngx_hash_add_key(&amp;foo_keys, &amp;k1, &amp;data1, NGX_HASH_WILDCARD_KEY);<br>ngx_hash_add_key(&amp;foo_keys, &amp;k2, &amp;data2, NGX_HASH_WILDCARD_KEY);<br></pre></blockquote><p>  该函数识别通配符并将键添加到相应的数组中。  有关通配符语法和匹配算法的说明，请参阅<a hhref="http/ngx_http_map_module.html#map">映射</a>模块文档。 </p><p>  根据添加的键的内容，您可能需要初始化最多三个键阵列：一个用于精确匹配（如上所述），另外两个用于从字符串的头部或尾部开始匹配： </p><blockquote class="example"><pre class="notranslate">if (foo_keys.dns_wc_head.nelts) {<p></p>
<pre><code>ngx_qsort(foo_keys.dns_wc_head.elts,
          (size_t) foo_keys.dns_wc_head.nelts,
          sizeof(ngx_hash_key_t),
          cmp_dns_wildcards);

hash.hash = NULL;
hash.temp_pool = pool;

if (ngx_hash_wildcard_init(&amp;amp;hash, foo_keys.dns_wc_head.elts,
                           foo_keys.dns_wc_head.nelts)
    != NGX_OK)
{
    return NGX_ERROR;
}

foo_hash.wc_head = (ngx_hash_wildcard_t *) hash.hash;
</code></pre><p>}<br></p></pre></blockquote><p>  需要对keys数组进行排序，并且必须将初始化结果添加到组合哈希中。   <code class="notranslate">dns_wc_tail</code>数组的初始化类似地完成。 </p><p>  组合哈希中的查找由<code class="notranslate">ngx_hash_find_combined(chash, key, name, len)</code> ： </p><blockquote class="example"><pre class="notranslate">/<em> key = “bar.example.org”; — will match “.example.org” </em>/<br>/<em> key = “foo.example.com”; — will match “foo.</em>“        */<p></p>
<p>hkey = ngx_hash_key(key.data, key.len);<br>res = ngx_hash_find_combined(&amp;foo_hash, hkey, key.data, key.len);<br></p></pre></blockquote><p></p><a name="memory_management"></a><center><h4>  内存管理 </h4></center><a name="heap"></a><center><h4>  堆 </h4></center><p>  要从系统堆分配内存，请使用以下函数： </p><p></p><ul class="compact"><li>   <code class="notranslate">ngx_alloc(size, log)</code> - 从系统堆分配内存。  这是<code class="notranslate">malloc()</code>的包装，具有日志记录支持。  分配错误和调试信息将记录到<code class="notranslate">log</code> 。 </li><li>   <code class="notranslate">ngx_calloc(size, log)</code> - 从系统堆分配内存，如<code class="notranslate">ngx_alloc()</code> ，但在分配后用零填充内存。 </li><li>   <code class="notranslate">ngx_memalign(alignment, size, log)</code> - 从系统堆中分配对齐的内存。  这是提供该功能的那些平台上<code class="notranslate">posix_memalign()</code>的包装器。  否则，实现将回<code class="notranslate">ngx_alloc()</code> ，它提供了最大的对齐。 </li><li>   <code class="notranslate">ngx_free(p)</code> - 免费分配的内存。  这是<code class="notranslate">free()</code>的包装器 </li></ul><p></p><a name="pool"></a><center><h4>  池 </h4></center><p>  大多数nginx分配都是在池中完成的。  当池被销毁时，nginx池中分配的内存将自动释放。  这提供了良好的分配性能并使内存控制变得容易。 </p><p>  池内部在连续的内存块中分配对象。  块已满后，将分配一个新块并将其添加到池内存块列表中。  当请求的分配太大而无法容纳到块中时，请求将被转发到系统分配器，并且返回的指针将存储在池中以进一步解除分配。 </p><p>   nginx池的类型是<code class="notranslate">ngx_pool_t</code> 。  支持以下操作： </p><p></p><ul class="compact"><li>   <code class="notranslate">ngx_create_pool(size, log)</code> - 创建具有指定块大小的池。  返回的池对象也在池中分配。   <code class="notranslate">size</code>至少应为<code class="notranslate">NGX_MIN_POOL_SIZE</code>和<code class="notranslate">NGX_MIN_POOL_SIZE</code>的倍数。 </li><li>   <code class="notranslate">ngx_destroy_pool(pool)</code> - 释放所有池内存，包括池对象本身。 </li><li>   <code class="notranslate">ngx_palloc(pool, size)</code> - 从指定的池中分配对齐的内存。 </li><li>   <code class="notranslate">ngx_pcalloc(pool, size)</code> - 从指定的池中分配对齐的内存并用零填充它。 </li><li>   <code class="notranslate">ngx_pnalloc(pool, size)</code> - 从指定的池中分配未对齐的内存。  主要用于分配字符串。 </li><li>   <code class="notranslate">ngx_pfree(pool, p)</code> - 以前在指定池中分配的<code class="notranslate">ngx_pfree(pool, p)</code>内存。  只能释放由转发到系统分配器的请求产生的分配。 </li></ul><p></p><blockquote class="example"><pre class="notranslate">u_char      <em>p;<br>ngx_str_t   </em>s;<br>ngx_pool_t  *pool;<p></p>
<p>pool = ngx_create_pool(1024, log);<br>if (pool == NULL) { /<em> error </em>/ }</p>
<p>s = ngx_palloc(pool, sizeof(ngx_str_t));<br>if (s == NULL) { /<em> error </em>/ }<br>ngx_str_set(s, “foo”);</p>
<p>p = ngx_pnalloc(pool, 3);<br>if (p == NULL) { /<em> error </em>/ }<br>ngx_memcpy(p, “foo”, 3);<br></p></pre></blockquote><p>  链接（ <code class="notranslate">ngx_chain_t</code> ）在nginx中被主动使用，因此nginx池实现提供了重用它们的方法。   <code class="notranslate">ngx_pool_t</code>的<code class="notranslate">chain</code>字段保留了先前分配的链接列表，可以重用。  要在池中有效分配链路链接，请使用<code class="notranslate">ngx_alloc_chain_link(pool)</code>功能。  此函数在池列表中查找自由链链接，并在池列表为空时分配新的链链接。  要释放链接，请调用<code class="notranslate">ngx_free_chain(pool, cl)</code>函数。 </p><p>  清理处理程序可以在池中注册。  清理处理程序是一个带有参数的回调函数，该函数在销毁池时调用。  池通常绑定到特定的nginx对象（如HTTP请求），并在对象到达其生命周期结束时被销毁。  注册池清理是释放资源，关闭文件描述符或对与主对象关联的共享数据进行最终调整的便捷方式。 </p><p>  要注册池清理，请调用<code class="notranslate">ngx_pool_cleanup_add(pool, size)</code> ，它返回一个要由调用者填写的<code class="notranslate">ngx_pool_cleanup_t</code>指针。  使用<code class="notranslate">size</code>参数为清理处理程序分配上下文。 </p><blockquote class="example"><pre class="notranslate">ngx_pool_cleanup_t  *cln;<p></p>
<p>cln = ngx_pool_cleanup_add(pool, 0);<br>if (cln == NULL) { /<em> error </em>/ }</p>
<p>cln-&gt;handler = ngx_my_cleanup;<br>cln-&gt;data = “foo”;</p>
<p>…</p>
<p>static void<br>ngx_my_cleanup(void <em>data)<br>{<br>    u_char  </em>msg = data;</p>
<pre><code>ngx_do_smth(msg);
</code></pre><p>}<br></p></pre></blockquote><a name="shared_memory"></a><center><h4>  共享内存 </h4></center><p>   nginx使用共享内存在进程之间共享公共数据。   <code class="notranslate">ngx_shared_memory_add(cf, name, size, tag)</code>函数将新的共享内存条目<code class="notranslate">ngx_shm_zone_t</code>到循环中。  该函数接收区域的<code class="notranslate">name</code>和<code class="notranslate">size</code> 。  每个共享区域必须具有唯一名称。  如果已存在具有提供的<code class="notranslate">name</code>和<code class="notranslate">tag</code>的共享区域条目，则重用现有区域条目。  如果具有相同名称的现有条目具有不同的标记，则该函数将失败并显示错误。  通常，模块结构的地址作为<code class="notranslate">tag</code>传递，从而可以在一个nginx模块中按名称重用共享区域。 </p><p>  共享内存条目结构<code class="notranslate">ngx_shm_zone_t</code>具有以下字段： </p><p></p><ul class="compact"><li>   <code class="notranslate">init</code> - 初始化回调，在共享区域映射到实际内存后调用 </li><li>   <code class="notranslate">data</code> - 数据上下文，用于将任意数据传递给<code class="notranslate">init</code>回调 </li><li>   <code class="notranslate">noreuse</code> - 禁用旧循环重用共享区域的标志 </li><li>   <code class="notranslate">tag</code> - 共享区域标记 </li><li>   <code class="notranslate">shm</code> - 类型为<code class="notranslate">ngx_shm_t</code>的特定于平台的对象，至少包含以下字段： <ul class="compact"><li>   <code class="notranslate">addr</code> - 映射共享内存地址，最初为NULL </li><li>   <code class="notranslate">size</code> - 共享内存大小 </li><li>   <code class="notranslate">name</code> - 共享内存名称 </li><li>   <code class="notranslate">log</code> - 共享内存日志 </li><li>   <code class="notranslate">exists</code> - 表示共享内存的标志是从主进程继承的（特定于Windows） </li></ul></li></ul><p></p><p>  解析配置后，共享区域条目将映射到<code class="notranslate">ngx_init_cycle()</code>实际内存。  在POSIX系统上， <code class="notranslate">mmap()</code> syscall用于创建共享匿名映射。  在Windows上，使用<code class="notranslate">CreateFileMapping()</code> / <code class="notranslate">MapViewOfFileEx()</code>对。 </p><p>  对于在共享内存中分配，nginx提供slab池<code class="notranslate">ngx_slab_pool_t</code>类型。  在每个nginx共享区域中自动创建用于分配内存的slab池。  该池位于共享区域的开头，可以通过表达式<code class="notranslate">(ngx_slab_pool_t <em>) shm_zone-&gt;shm.addr</em></code> 。  要在共享区域中分配内存，请调用<code class="notranslate">ngx_slab_alloc(pool, size)</code>或<code class="notranslate">ngx_slab_calloc(pool, size)</code> 。  要释放内存，请调用<code class="notranslate">ngx_slab_free(pool, p)</code> 。 </p><p>   Slab池将所有共享区域划分为页面。  每个页面用于分配相同大小的对象。  指定的大小必须是2的幂，并且大于8字节的最小大小。  不合格的值被四舍五入。  每个页面的位掩码跟踪正在使用哪些块以及哪些块可以自由分配。  对于大于半页（通常为2048字节）的大小，一次分配整个页面 </p><p>  要保护共享内存中的数据不受并发访问影响，请使用<code class="notranslate">ngx_slab_pool_t</code>的<code class="notranslate">mutex</code>字段中提供的<code class="notranslate">mutex</code> 。  在分配和释放内存时，板块池最常使用互斥锁，但它可用于保护共享区域中分配的任何其他用户数据结构。  要锁定或解锁互斥锁，请分别调用<code class="notranslate">ngx_shmtx_lock(&amp;shpool-&gt;mutex)</code>或<code class="notranslate">ngx_shmtx_unlock(&amp;shpool-&gt;mutex)</code> 。 </p><blockquote class="example"><pre class="notranslate">ngx_str_t        name;<br>ngx_foo_ctx_t   ctx;<br>ngx_shm_zone_t  *shm_zone;<p></p>
<p>ngx_str_set(&amp;name, “foo”);</p>
<p>/<em> allocate shared zone context </em>/<br>ctx = ngx_pcalloc(cf-&gt;pool, sizeof(ngx_foo_ctx_t));<br>if (ctx == NULL) {<br>    /<em> error </em>/<br>}</p>
<p>/<em> add an entry for 64k shared zone </em>/<br>shm_zone = ngx_shared_memory_add(cf, &amp;name, 65536, &amp;ngx_foo_module);<br>if (shm_zone == NULL) {<br>    /<em> error </em>/<br>}</p>
<p>/<em> register init callback and context </em>/<br>shm_zone-&gt;init = ngx_foo_init_zone;<br>shm_zone-&gt;data = ctx;</p>
<p>…</p>
<p>static ngx_int_t<br>ngx_foo_init_zone(ngx_shm_zone_t <em>shm_zone, void </em>data)<br>{<br>    ngx_foo_ctx_t  *octx = data;</p>
<pre><code>size_t            len;
ngx_foo_ctx_t    *ctx;
ngx_slab_pool_t  *shpool;

value = shm_zone-&amp;gt;data;

if (octx) {
    /* reusing a shared zone from old cycle */
    ctx-&amp;gt;value = octx-&amp;gt;value;
    return NGX_OK;
}

shpool = (ngx_slab_pool_t *) shm_zone-&amp;gt;shm.addr;

if (shm_zone-&amp;gt;shm.exists) {
    /* initialize shared zone context in Windows nginx worker */
    ctx-&amp;gt;value = shpool-&amp;gt;data;
    return NGX_OK;
}

/* initialize shared zone */

ctx-&amp;gt;value = ngx_slab_alloc(shpool, sizeof(ngx_uint_t));
if (ctx-&amp;gt;value == NULL) {
    return NGX_ERROR;
}

shpool-&amp;gt;data = ctx-&amp;gt;value;

return NGX_OK;
</code></pre><p>}<br></p></pre></blockquote><a name="logging"></a><center><h4>  记录 </h4></center><p>  对于日志记录，nginx使用<code class="notranslate">ngx_log_t</code>对象。   nginx记录器支持几种类型的输出： </p><ul class="compact"><li>   stderr  - 记录到标准错误（stderr） </li><li>   file  - 记录到文件 </li><li>   syslog  - 记录到syslog </li><li>   memory  - 记录到内部存储器以用于开发目的;  稍后可以使用调试器访问内存 </li></ul><p></p><p>  记录器实例可以是记录器链，使用<code class="notranslate">next</code>字段相互链接。  在这种情况下，每条消息都写入链中的所有记录器。 </p><p>  对于每个记录器，严重性级别控制将哪些消息写入日志（仅记录分配了该级别或更高级别的事件）。  支持以下严重性级别： </p><p></p><ul class="compact"><li> <code class="notranslate">NGX_LOG_EMERG</code> </li> <li> <code class="notranslate">NGX_LOG_ALERT</code> </li> <li> <code class="notranslate">NGX_LOG_CRIT</code> </li> <li> <code class="notranslate">NGX_LOG_ERR</code> </li> <li> <code class="notranslate">NGX_LOG_WARN</code> </li> <li> <code class="notranslate">NGX_LOG_NOTICE</code> </li> <li> <code class="notranslate">NGX_LOG_INFO</code> </li> <li> <code class="notranslate">NGX_LOG_DEBUG</code> </li> </ul><p></p><p>  对于调试日志记录，还会检查调试掩码。  调试掩码是： </p><p></p><ul class="compact"><li> <code class="notranslate">NGX_LOG_DEBUG_CORE</code> </li> <li> <code class="notranslate">NGX_LOG_DEBUG_ALLOC</code> </li> <li> <code class="notranslate">NGX_LOG_DEBUG_MUTEX</code> </li> <li> <code class="notranslate">NGX_LOG_DEBUG_EVENT</code> </li> <li> <code class="notranslate">NGX_LOG_DEBUG_HTTP</code> </li> <li> <code class="notranslate">NGX_LOG_DEBUG_MAIL</code> </li> <li> <code class="notranslate">NGX_LOG_DEBUG_STREAM</code> </li> </ul><p></p><p>  通常，记录器是由<code class="notranslate">error_log</code>指令中的现有nginx代码创建的，几乎在循环，配置，客户端连接和其他对象的每个处理阶段都可用。 </p><p>   Nginx提供以下日志记录宏： </p><p></p><ul class="compact"><li>   <code class="notranslate">ngx_log_error(level, log, err, fmt, …)</code> - 错误记录 </li><li>   <code class="notranslate">ngx_log_debug0(level, log, err, fmt)</code> ， <code class="notranslate">ngx_log_debug1(level, log, err, fmt, arg1)</code>等 - 使用最多八个支持的格式化参数调试日志记录 </li></ul><p></p><p>  日志消息在堆栈中的大小为<code class="notranslate">NGX_MAX_ERROR_STR</code> （当前为2048字节）的缓冲区中格式化。  该消息前面附有严重性级别，进程ID（PID），连接ID（存储在<code class="notranslate">log-&gt;connection</code> ）和系统错误文本。  对于非调试消息，还调用<code class="notranslate">log-&gt;handler</code>以将更多特定信息添加到日志消息中。   HTTP模块将<code class="notranslate">ngx_http_log_error()</code>函数设置为日志处理程序，以记录客户端和服务器地址，当前操作（存储在<code class="notranslate">log-&gt;action</code> ），客户端请求行，服务器名称等。 </p><blockquote class="example"><pre class="notranslate">/<em> specify what is currently done </em>/<br>log-&gt;action = “sending mp4 to client”;<p></p>
<p>/<em> error and debug log </em>/<br>ngx_log_error(NGX_LOG_INFO, c-&gt;log, 0, “client prematurely<br>              closed connection”);</p>
<p>ngx_log_debug2(NGX_LOG_DEBUG_HTTP, mp4-&gt;file.log, 0,<br>               “mp4 start:%ui, length:%ui”, mp4-&gt;start, mp4-&gt;length);<br></p></pre></blockquote><p>  上面的示例导致日志条目如下： </p><blockquote class="example"><pre class="notranslate">2016/09/16 22:08:52 [info] 17445#0: <em>1 client prematurely closed connection while<br>sending mp4 to client, client: 127.0.0.1, server: , request: “GET /file.mp4 HTTP/1.1”<br>2016/09/16 23:28:33 [debug] 22140#0: </em>1 mp4 start:0, length:10000<br></pre></blockquote><a name="cycle"></a><center><h4>  周期 </h4></center><p>  循环对象存储从特定配置创建的nginx运行时上下文。  它的类型是<code class="notranslate">ngx_cycle_t</code> 。  当前循环由<code class="notranslate">ngx_cycle</code>全局变量引用，并在nginx worker启动时继承。  每次重新加载nginx配置时，都会从新的nginx配置创建一个新的循环;  成功创建新循环后，通常会删除旧循环。 </p><p>  循环由<code class="notranslate">ngx_init_cycle()</code>函数创建，该函数将前一个循环作为其参数。  该函数定位上一个循环的配置文件，并从前一个循环继承尽可能多的资源。  称为“初始循环”的占位符循环创建为nginx启动，然后由从配置构建的实际循环替换。 </p><p>  该周期的成员包括： </p><p></p><ul class="compact"><li>   <code class="notranslate">pool</code> - 自行车游泳池  为每个新周期创建。 </li><li>   <code class="notranslate">log</code> - 循环日志。  最初从旧循环继承，在读取配置后将其设置为指向<code class="notranslate">new_log</code> 。 </li><li>   <code class="notranslate">new_log</code> - 由配置创建的循环日志。  它受根范围<code class="notranslate">error_log</code>指令的影响。 </li><li>   <code class="notranslate">connections</code> ， <code class="notranslate">connection_n</code> - 类型为<code class="notranslate">ngx_connection_t</code>的连接数组，由事件模块在初始化每个nginx worker时创建。   nginx配置中的<code class="notranslate">worker_connections</code>指令设置连接数<code class="notranslate">connection_n</code> 。 </li><li>   <code class="notranslate">free_connections</code> ， <code class="notranslate">free_connection_n</code> - 当前可用连接的列表和数量。  如果没有可用的连接，则nginx工作程序拒绝接受新客户端或连接到上游服务器。 </li><li>   <code class="notranslate">files</code> ， <code class="notranslate">files_n</code> - 用于将文件描述符映射到nginx连接的数组。  该映射由具有<code class="notranslate">NGX_USE_FD_EVENT</code>标志的事件模块使用（当前，它是<code class="notranslate">poll</code>和<code class="notranslate">devpoll</code> ）。 </li><li>   <code class="notranslate">conf_ctx</code> - 核心模块配置数组。  在读取nginx配置文件期间创建并填充配置。 </li><li>   <code class="notranslate">modules</code> ， <code class="notranslate">modules_n</code> - 由当前配置加载的<code class="notranslate">ngx_module_t</code>类型的模块数组，包括静态和动态模块。 </li><li>   <code class="notranslate">listening</code> - <code class="notranslate">ngx_listening_t</code>类型的侦听对象数组。  通常通过调用<code class="notranslate">ngx_create_listening()</code>函数的不同模块的<code class="notranslate">listen</code>指令添加侦听对象。  侦听套接字是基于侦听对象创建的。 </li><li>   <code class="notranslate">paths</code> - <code class="notranslate">ngx_path_t</code>类型的路径数组。  通过从将在某些目录上运行的模块调用函数<code class="notranslate">ngx_add_path()</code>来添加路径。  这些目录是在读取配置后由nginx创建的，如果缺少的话。  此外，可以为每个路径添加两个处理程序： <ul class="compact"><li>   path loader  - 在启动或重新加载nginx后，仅在60秒内执行一次。  通常，加载程序读取目录并将数据存储在nginx共享内存中。  从专用的nginx进程“nginx缓存加载器”调用该处理程序。 </li><li>  路径管理器 - 定期执行。  通常，管理器从目录中删除旧文件并更新nginx内存以反映更改。  处理程序从专用的“nginx缓存管理器”进程调用。 </li></ul></li><li>   <code class="notranslate">open_files</code> - 类型为<code class="notranslate">ngx_open_file_t</code>的打开文件对象列表，通过调用函数<code class="notranslate">ngx_conf_open_file()</code> 。  目前，nginx使用这种打开的文件进行日志记录。  读取配置后，nginx将打开<code class="notranslate">open_files</code>列表中的所有文件，并将每个文件描述符存储在对象的<code class="notranslate">fd</code>字段中。  文件以附加模式打开，如果缺少则创建。  列表中的文件在收到重新打开信号（最常见的是<code class="notranslate">USR1</code> ）后由nginx worker重新打开。  在这种情况下， <code class="notranslate">fd</code>字段中的描述符将更改为新值。 </li><li>   <code class="notranslate">shared_memory</code> - 共享内存区域列表，每个区域都通过调用<code class="notranslate">ngx_shared_memory_add()</code>函数添加。  共享区域映射到所有nginx进程中的相同地址范围，并用于共享公共数据，例如HTTP缓存内存树。 </li></ul><p></p><a name="buffer"></a><center><h4>  缓冲 </h4></center><p>  对于输入/输出操作，nginx提供缓冲区类型<code class="notranslate">ngx_buf_t</code> 。  通常，它用于保存要写入目标或从源读取的数据。  缓冲区可以引用内存或文件中的数据，从技术上讲，缓冲区可以同时引用这两个数据。  缓冲区的内存是单独分配的，与缓冲区结构<code class="notranslate">ngx_buf_t</code> 。 </p><p>   <code class="notranslate">ngx_buf_t</code>结构包含以下字段： </p><p></p><ul class="compact"><li>   <code class="notranslate">start</code> ， <code class="notranslate">end</code> - 为缓冲区分配的内存块的边界。 </li><li>   <code class="notranslate">pos</code> ， <code class="notranslate">last</code> - 内存缓冲区的边界;  通常是一个<code class="notranslate">start</code>的子范围.. <code class="notranslate">end</code> 。 </li><li>   <code class="notranslate">file_pos</code> ， <code class="notranslate">file_last</code> - 文件缓冲区的边界，表示为从文件开头的偏移量。 </li><li>   <code class="notranslate">tag</code> - 用于区分缓冲区的唯一值;  由不同的nginx模块创建，通常用于缓冲区重用。 </li><li>   <code class="notranslate">file</code> - 文件对象。 </li><li>   <code class="notranslate">temporary</code> - 指示缓冲区引用可写内存的标志。 </li><li>   <code class="notranslate">memory</code> - 指示缓冲区引用只读<code class="notranslate">memory</code>标志。 </li><li>   <code class="notranslate">in_file</code> - 指示缓冲区引用文件中数据的标志。 </li><li>   <code class="notranslate">flush</code> - 表示需要刷新缓冲区之前的所有数据的标志。 </li><li>   <code class="notranslate">recycled</code> - 表示缓冲区可以重用并需要尽快使用的标志。 </li><li>   <code class="notranslate">sync</code> - 表示缓冲区不携带数据或<code class="notranslate">flush</code>或<code class="notranslate">last_buf</code>等特殊信号的<code class="notranslate">last_buf</code> 。  默认情况下，nginx认为这样的缓冲区是一个错误条件，但是这个标志告诉nginx跳过错误检查。 </li><li>   <code class="notranslate">last_buf</code> - 表示缓冲区是输出中的最后一个的标志。 </li><li>   <code class="notranslate">last_in_chain</code> - 表示请求或子请求中不再有数据缓冲区的标志。 </li><li>   <code class="notranslate">shadow</code> - 引用与当前缓冲区相关的另一个（“shadow”）缓冲区，通常是缓冲区使用阴影中的数据。  消耗缓冲区时，通常还将阴影缓冲区标记为已消耗。 </li><li>   <code class="notranslate">last_shadow</code> - 指示缓冲区是引用特定影子缓冲区的最后一个缓冲区的标志。 </li><li>   <code class="notranslate">temp_file</code> - 指示缓冲区位于临时文件中的标志。 </li></ul><p></p><p>  对于输入和输出操作，缓冲区链接在一起。  链是<code class="notranslate">ngx_chain_t</code>类型的链序列，定义如下： </p><blockquote class="example"><pre class="notranslate">typedef struct ngx_chain_s  ngx_chain_t;<p></p>
<p>struct ngx_chain_s {<br>    ngx_buf_t    <em>buf;<br>    ngx_chain_t  </em>next;<br>};<br></p></pre></blockquote><p>  每个链节都保持对其缓冲区的引用和对下一个链节的引用。 </p><p>  使用缓冲区和链的示例： </p><blockquote class="example"><pre class="notranslate">ngx_chain_t <em><br>ngx_get_my_chain(ngx_pool_t </em>pool)<br>{<br>    ngx_buf_t    <em>b;<br>    ngx_chain_t  </em>out, <em>cl, *</em>ll;<p></p>
<pre><code>/* first buf */
cl = ngx_alloc_chain_link(pool);
if (cl == NULL) { /* error */ }

b = ngx_calloc_buf(pool);
if (b == NULL) { /* error */ }

b-&amp;gt;start = (u_char *) &quot;foo&quot;;
b-&amp;gt;pos = b-&amp;gt;start;
b-&amp;gt;end = b-&amp;gt;start + 3;
b-&amp;gt;last = b-&amp;gt;end;
b-&amp;gt;memory = 1; /* read-only memory */

cl-&amp;gt;buf = b;
out = cl;
ll = &amp;amp;cl-&amp;gt;next;

/* second buf */
cl = ngx_alloc_chain_link(pool);
if (cl == NULL) { /* error */ }

b = ngx_create_temp_buf(pool, 3);
if (b == NULL) { /* error */ }

b-&amp;gt;last = ngx_cpymem(b-&amp;gt;last, &quot;foo&quot;, 3);

cl-&amp;gt;buf = b;
cl-&amp;gt;next = NULL;
*ll = cl;

return out;
</code></pre><p>}<br></p></pre></blockquote><a name="networking"></a><center><h4>  联网 </h4></center><a name="connection"></a><center><h4>  连接 </h4></center><p>  连接类型<code class="notranslate">ngx_connection_t</code>是套接字描述符的包装器。  它包括以下字段： </p><p></p><ul class="compact"><li>   <code class="notranslate">fd</code> - 套接字描述符 </li><li>   <code class="notranslate">data</code> - 任意连接上下文。  通常，它是指向在连接之上构建的更高级别对象的指针，例如HTTP请求或Stream会话。 </li><li>   <code class="notranslate">read</code> ， <code class="notranslate">write</code> - 读取和写入连接事件。 </li><li>   <code class="notranslate">recv</code> ， <code class="notranslate">send</code> ， <code class="notranslate">recv_chain</code> ， <code class="notranslate">send_chain</code> - 连接的I / O操作。 </li><li>   <code class="notranslate">pool</code> - 连接池。 </li><li>   <code class="notranslate">log</code> - 连接日志。 </li><li>   <code class="notranslate">sockaddr</code> ， <code class="notranslate">socklen</code> ， <code class="notranslate">addr_text</code> - 二进制和文本形式的远程套接字地址。 </li><li>   <code class="notranslate">local_sockaddr</code> ， <code class="notranslate">local_socklen</code> - 二进制形式的本地套接字地址。  最初，这些字段为空。  使用<code class="notranslate">ngx_connection_local_sockaddr()</code>函数获取本地套接字地址。 </li><li>   <code class="notranslate">proxy_protocol_addr</code> ， <code class="notranslate">proxy_protocol_port</code> -  PROXY协议客户端地址和端口，如果为连接启用了PROXY协议。 </li><li>   <code class="notranslate">ssl</code> - 连接的SSL上下文。 </li><li>   <code class="notranslate">reusable</code> - 指示连接处于允许重用的状态的标志。 </li><li>   <code class="notranslate">close</code> - 表示正在重用连接并需要<code class="notranslate">close</code>标志。 </li></ul><p></p><p>   nginx连接可以透明地封装SSL层。  在这种情况下，连接的<code class="notranslate">ssl</code>字段包含指向<code class="notranslate">ngx_ssl_connection_t</code>结构的指针，保留连接的所有SSL相关数据，包括<code class="notranslate">SSL_CTX</code>和<code class="notranslate">SSL</code> 。   <code class="notranslate">recv</code> ， <code class="notranslate">send</code> ， <code class="notranslate">recv_chain</code>和<code class="notranslate">send_chain</code>处理程序也设置为启用SSL的函数。 </p><p>   nginx配置中的<code class="notranslate">worker_connections</code>指令限制了每个nginx worker的连接数。  当工人启动并存储在循环对象的<code class="notranslate">connections</code>字段中时，所有连接结构都是预先创建的。  要检索连接结构，请使用<code class="notranslate">ngx_get_connection(s, log)</code>函数。  它需要一个套接字描述符作为其参数，它需要包装在一个连接结构中。 </p><p> Because the number of connections per worker is limited, nginx provides a way to grab connections that are currently in use. To enable or disable reuse of a connection, call the <code class="notranslate">ngx_reusable_connection(c, reusable)</code> function. Calling <code class="notranslate">ngx_reusable_connection(c, 1)</code> sets the <code class="notranslate">reuse</code> flag in the connection structure and inserts the connection into the <code class="notranslate">reusable_connections_queue</code> of the cycle. Whenever <code class="notranslate">ngx_get_connection()</code> finds out there are no available connections in the cycle’s <code class="notranslate">free_connections</code> list, it calls <code class="notranslate">ngx_drain_connections()</code> to release a specific number of reusable connections. For each such connection, the <code class="notranslate">close</code> flag is set and its read handler is called which is supposed to free the connection by calling <code class="notranslate">ngx_close_connection(c)</code> and make it available for reuse. To exit the state when a connection can be reused <code class="notranslate">ngx_reusable_connection(c, 0)</code> is called. HTTP client connections are an example of reusable connections in nginx; they are marked as reusable until the first request byte is received from the client. </p><a name="events"></a><center><h4>  活动 </h4></center><a name="event"></a><center><h4>  事件 </h4></center><p> Event object <code class="notranslate">ngx_event_t</code> in nginx provides a mechanism for notification that a specific event has occurred. </p><p> Fields in <code class="notranslate">ngx_event_t</code> include: </p><p></p><ul class="compact"><li> <code class="notranslate">data</code> — Arbitrary event context used in event handlers, usually as pointer to a connection related to the event. </li><li> <code class="notranslate">handler</code> — Callback function to be invoked when the event happens. </li><li> <code class="notranslate">write</code> — Flag indicating a write event. Absence of the flag indicates a read event. </li><li> <code class="notranslate">active</code> — Flag indicating that the event is registered for receiving I/O notifications, normally from notification mechanisms like <code class="notranslate">epoll</code> , <code class="notranslate">kqueue</code> , <code class="notranslate">poll</code> . </li><li> <code class="notranslate">ready</code> — Flag indicating that the event has received an I/O notification. </li><li> <code class="notranslate">delayed</code> — Flag indicating that I/O is delayed due to rate limiting. </li><li> <code class="notranslate">timer</code> — Red-black tree node for inserting the event into the timer tree. </li><li> <code class="notranslate">timer_set</code> — Flag indicating that the event timer is set and not yet expired. </li><li> <code class="notranslate">timedout</code> — Flag indicating that the event timer has expired. </li><li> <code class="notranslate">eof</code> — Flag indicating that EOF occurred while reading data. </li><li> <code class="notranslate">pending_eof</code> — Flag indicating that EOF is pending on the socket, even though there may be some data available before it. The flag is delivered via the <code class="notranslate">EPOLLRDHUP</code> <code class="notranslate">epoll</code> event or <code class="notranslate">EV_EOF</code> <code class="notranslate">kqueue</code> flag. </li><li> <code class="notranslate">error</code> — Flag indicating that an error occurred during reading (for a read event) or writing (for a write event). </li><li> <code class="notranslate">cancelable</code> — Timer event flag indicating that the event should be ignored while shutting down the worker. Graceful worker shutdown is delayed until there are no non-cancelable timer events scheduled. </li><li> <code class="notranslate">posted</code> — Flag indicating that the event is posted to a queue. </li><li> <code class="notranslate">queue</code> — Queue node for posting the event to a queue. </li></ul><p></p><a name="i_o_events"></a><center><h4> I/O events </h4></center><p> Each connection obtained by calling the <code class="notranslate">ngx_get_connection()</code> function has two attached events, <code class="notranslate">c-&gt;read</code> and <code class="notranslate">c-&gt;write</code> , which are used for receiving notification that the socket is ready for reading or writing. All such events operate in Edge-Triggered mode, meaning that they only trigger notifications when the state of the socket changes. For example, doing a partial read on a socket does not make nginx deliver a repeated read notification until more data arrives on the socket. Even when the underlying I/O notification mechanism is essentially Level-Triggered ( <code class="notranslate">poll</code> , <code class="notranslate">select</code> etc), nginx converts the notifications to Edge-Triggered. To make nginx event notifications consistent across all notifications systems on different platforms, the functions <code class="notranslate">ngx_handle_read_event(rev, flags)</code> and <code class="notranslate">ngx_handle_write_event(wev, lowat)</code> must be called after handling an I/O socket notification or calling any I/O functions on that socket. Normally, the functions are called once at the end of each read or write event handler. </p><a name="timer_events"></a><center><h4> Timer events </h4></center><p> An event can be set to send a notification when a timeout expires. The timer used by events counts milliseconds since some unspecified point in the past truncated to <code class="notranslate">ngx_msec_t</code> type. Its current value can be obtained from the <code class="notranslate">ngx_current_msec</code> variable. </p><p> The function <code class="notranslate">ngx_add_timer(ev, timer)</code> sets a timeout for an event, <code class="notranslate">ngx_del_timer(ev)</code> deletes a previously set timeout. The global timeout red-black tree <code class="notranslate">ngx_event_timer_rbtree</code> stores all timeouts currently set. The key in the tree is of type <code class="notranslate">ngx_msec_t</code> and is the time when the event occurs. The tree structure enables fast insertion and deletion operations, as well as access to the nearest timeouts, which nginx uses to find out how long to wait for I/O events and for expiring timeout events. </p><a name="posted_events"></a><center><h4> Posted events </h4></center><p> An event can be posted which means that its handler will be called at some point later within the current event loop iteration. Posting events is a good practice for simplifying code and escaping stack overflows. Posted events are held in a post queue. The <code class="notranslate">ngx_post_event(ev, q)</code> mscro posts the event <code class="notranslate">ev</code> to the post queue <code class="notranslate">q</code> . The <code class="notranslate">ngx_delete_posted_event(ev)</code> macro deletes the event <code class="notranslate">ev</code> from the queue it’s currently posted in. Normally, events are posted to the <code class="notranslate">ngx_posted_events</code> queue, which is processed late in the event loop — after all I/O and timer events are already handled. The function <code class="notranslate">ngx_event_process_posted()</code> is called to process an event queue. It calls event handlers until the queue is not empty. This means that a posted event handler can post more events to be processed within the current event loop iteration. </p><p>  一个例子： </p><blockquote class="example"><pre class="notranslate">void<br>ngx_my_connection_read(ngx_connection_t <em>c)<br>{<br>    ngx_event_t  </em>rev;<p></p>
<pre><code>rev = c-&amp;gt;read;

ngx_add_timer(rev, 1000);

rev-&amp;gt;handler = ngx_my_read_handler;

ngx_my_read(rev);
</code></pre><p>}</p>
<p>void<br>ngx_my_read_handler(ngx_event_t <em>rev)<br>{<br>    ssize_t            n;<br>    ngx_connection_t  </em>c;<br>    u_char             buf[256];</p>
<pre><code>if (rev-&amp;gt;timedout) { /* timeout expired */ }

c = rev-&amp;gt;data;

while (rev-&amp;gt;ready) {
    n = c-&amp;gt;recv(c, buf, sizeof(buf));

    if (n == NGX_AGAIN) {
        break;
    }

    if (n == NGX_ERROR) { /* error */ }

    /* process buf */
}

if (ngx_handle_read_event(rev, 0) != NGX_OK) { /* error */ }
</code></pre><p>}<br></p></pre></blockquote><a name="event_loop"></a><center><h4> Event loop </h4></center><p> Except for the nginx master process, all nginx processes do I/O and so have an event loop. (The nginx master process instead spends most of its time in the <code class="notranslate">sigsuspend()</code> call waiting for signals to arrive.) The nginx event loop is implemented in the <code class="notranslate">ngx_process_events_and_timers()</code> function, which is called repeatedly until the process exits. </p><p> The event loop has the following stages: </p><ul class="compact"><li> Find the timeout that is closest to expiring, by calling <code class="notranslate">ngx_event_find_timer()</code> . This function finds the leftmost node in the timer tree and returns the number of milliseconds until the node expires. </li><li> Process I/O events by calling a handler, specific to the event notification mechanism, chosen by nginx configuration. This handler waits for at least one I/O event to happen, but only until the next timeout expires. When a read or write event occurs, the <code class="notranslate">ready</code> flag is set and the event’s handler is called. For Linux, the <code class="notranslate">ngx_epoll_process_events()</code> handler is normally used, which calls <code class="notranslate">epoll_wait()</code> to wait for I/O events. </li><li> Expire timers by calling <code class="notranslate">ngx_event_expire_timers()</code> . The timer tree is iterated from the leftmost element to the right until an unexpired timeout is found. For each expired node the <code class="notranslate">timedout</code> event flag is set, the <code class="notranslate">timer_set</code> flag is reset, and the event handler is called </li><li> Process posted events by calling <code class="notranslate">ngx_event_process_posted()</code> . The function repeatedly removes the first element from the posted events queue and calls the element’s handler, until the queue is empty. </li></ul><p></p><p> All nginx processes handle signals as well. Signal handlers only set global variables which are checked after the <code class="notranslate">ngx_process_events_and_timers()</code> call. </p><a name="processes"></a><center><h4>  流程 </h4></center><p> There are several types of processes in nginx. The type of a process is kept in the <code class="notranslate">ngx_process</code> global variable, and is one of the following: </p><ul class="compact"><li><p> <code class="notranslate">NGX_PROCESS_MASTER</code> — The master process, which reads the NGINX configuration, creates cycles, and starts and controls child processes. It does not perform any I/O and responds only to signals. Its cycle function is <code class="notranslate">ngx_master_process_cycle()</code> . </p></li><li><p> <code class="notranslate">NGX_PROCESS_WORKER</code> — The worker process, which handles client connections. It is started by the master process and responds to its signals and channel commands as well. Its cycle function is <code class="notranslate">ngx_worker_process_cycle()</code> . There can be multiple worker processes, as configured by the <code class="notranslate">worker_processes</code> directive. </p></li><li><p> <code class="notranslate">NGX_PROCESS_SINGLE</code> — The single process, which exists only in <code class="notranslate">master_process off</code> mode, and is the only process running in that mode. It creates cycles (like the master process does) and handles client connections (like the worker process does). Its cycle function is <code class="notranslate">ngx_single_process_cycle()</code> . </p></li><li><p> <code class="notranslate">NGX_PROCESS_HELPER</code> — The helper process, of which currently there are two types: cache manager and cache loader. The cycle function for both is <code class="notranslate">ngx_cache_manager_process_cycle()</code> . </p></li></ul><p> The nginx processes handle the following signals: </p><ul class="compact"><li><p> <code class="notranslate">NGX_SHUTDOWN_SIGNAL</code> ( <code class="notranslate">SIGQUIT</code> on most systems) — Gracefully shutdown. Upon receiving this signal, the master process sends a shutdown signal to all child processes. When no child processes are left, the master destroys the cycle pool and exits. When a worker process receives this signal, it closes all listening sockets and waits until there are no non-cancelable events scheduled, then destroys the cycle pool and exits. When the cache manager or the cache loader process receives this signal, it exits immediately. The <code class="notranslate">ngx_quit</code> variable is set to <code class="notranslate">1</code> when a process receives this signal, and is immediately reset after being processed. The <code class="notranslate">ngx_exiting</code> variable is set to <code class="notranslate">1</code> while a worker process is in the shutdown state. </p></li><li><p> <code class="notranslate">NGX_TERMINATE_SIGNAL</code> ( <code class="notranslate">SIGTERM</code> on most systems) — Terminate. Upon receiving this signal, the master process sends a terminate signal to all child processes. If a child process does not exit within 1 second, the master process sends the <code class="notranslate">SIGKILL</code> signal to kill it. When no child processes are left, the master process destroys the cycle pool and exits. When a worker process, the cache manager process or the cache loader process receives this signal, it destroys the cycle pool and exits. The variable <code class="notranslate">ngx_terminate</code> is set to <code class="notranslate">1</code> when this signal is received. </p></li><li><p> <code class="notranslate">NGX_NOACCEPT_SIGNAL</code> ( <code class="notranslate">SIGWINCH</code> on most systems) - Shut down all worker and helper processes. Upon receiving this signal, the master process shuts down its child processes. If a previously started new nginx binary exits, the child processes of the old master are started again. When a worker process receives this signal, it shuts down in debug mode set by the <code class="notranslate">debug_points</code> directive. </p></li><li><p> <code class="notranslate">NGX_RECONFIGURE_SIGNAL</code> ( <code class="notranslate">SIGHUP</code> on most systems) - Reconfigure. Upon receiving this signal, the master process re-reads the configuration and creates a new cycle based on it. If the new cycle is created successfully, the old cycle is deleted and new child processes are started. Meanwhile, the old child processes receive the <code class="notranslate">NGX_SHUTDOWN_SIGNAL</code> signal. In single-process mode, nginx creates a new cycle, but keeps the old one until there are no longer clients with active connections tied to it. The worker and helper processes ignore this signal. </p></li><li><p> <code class="notranslate">NGX_REOPEN_SIGNAL</code> ( <code class="notranslate">SIGUSR1</code> on most systems) — Reopen files. The master process sends this signal to workers, which reopen all <code class="notranslate">open_files</code> related to the cycle. </p></li><li><p> <code class="notranslate">NGX_CHANGEBIN_SIGNAL</code> ( <code class="notranslate">SIGUSR2</code> on most systems) — Change the nginx binary. The master process starts a new nginx binary and passes in a list of all listen sockets. The text-format list, passed in the <code class="notranslate">“NGINX”</code> environment variable, consists of descriptor numbers separated with semicolons. The new nginx binary reads the <code class="notranslate">“NGINX”</code> variable and adds the sockets to its init cycle. Other processes ignore this signal. </p></li></ul><p> While all nginx worker processes are able to receive and properly handle POSIX signals, the master process does not use the standard <code class="notranslate">kill()</code> syscall to pass signals to workers and helpers. Instead, nginx uses inter-process socket pairs which allow sending messages between all nginx processes. Currently, however, messages are only sent from the master to its children. The messages carry the standard signals. </p><a name="threads"></a><center><h4>  主题 </h4></center><p> It is possible to offload into a separate thread tasks that would otherwise block the nginx worker process. For example, nginx can be configured to use threads to perform <a hhref="http/ngx_http_core_module.html#aio">file I/O</a> . Another use case is a library that doesn’t have asynchronous interface and thus cannot be normally used with nginx. Keep in mind that the threads interface is a helper for the existing asynchronous approach to processing client connections, and by no means intended as a replacement. </p><p> To deal with synchronization, the following wrappers over <code class="notranslate">pthreads</code> primitives are available: </p><ul class="compact"><li> <code class="notranslate">typedef pthread_mutex_t ngx_thread_mutex_t;</code> <ul class="compact"> <li> <code class="notranslate">ngx_int_t ngx_thread_mutex_create(ngx_thread_mutex_t <em>mtx, ngx_log_t </em>log);</code> </li> <li> <code class="notranslate">ngx_int_t ngx_thread_mutex_destroy(ngx_thread_mutex_t <em>mtx, ngx_log_t </em>log);</code> </li> <li> <code class="notranslate">ngx_int_t ngx_thread_mutex_lock(ngx_thread_mutex_t <em>mtx, ngx_log_t </em>log);</code> </li> <li> <code class="notranslate">ngx_int_t ngx_thread_mutex_unlock(ngx_thread_mutex_t <em>mtx, ngx_log_t </em>log);</code> </li> </ul></li><li> <code class="notranslate">typedef pthread_cond_t ngx_thread_cond_t;</code> <ul class="compact"> <li> <code class="notranslate">ngx_int_t ngx_thread_cond_create(ngx_thread_cond_t <em>cond, ngx_log_t </em>log);</code> </li> <li> <code class="notranslate">ngx_int_t ngx_thread_cond_destroy(ngx_thread_cond_t <em>cond, ngx_log_t </em>log);</code> </li> <li> <code class="notranslate">ngx_int_t ngx_thread_cond_signal(ngx_thread_cond_t <em>cond, ngx_log_t </em>log);</code> </li> <li> <code class="notranslate">ngx_int_t ngx_thread_cond_wait(ngx_thread_cond_t <em>cond, ngx_thread_mutex_t </em>mtx, ngx_log_t <em>log);</em></code> </li> </ul></li></ul><p></p><p> Instead of creating a new thread for each task, nginx implements a <a hhref="ngx_core_module.html#thread_pool">thread_pool</a> strategy. Multiple thread pools may be configured for different purposes (for example, performing I/O on different sets of disks). Each thread pool is created at startup and contains a limited number of threads that process a queue of tasks. When a task is completed, a predefined completion handler is called. </p><p> The <code class="notranslate">src/core/ngx_thread_pool.h</code> header file contains relevant definitions: </p><blockquote class="example"><pre class="notranslate">struct ngx_thread_task_s {<br>    ngx_thread_task_t   next;<br>    ngx_uint_t           id;<br>    void                <em>ctx;<br>    void               (</em>handler)(void <em>data, ngx_log_t </em>log);<br>    ngx_event_t          event;<br>};<p></p>
<p>typedef struct ngx_thread_pool_s  ngx_thread_pool_t;</p>
<p>ngx_thread_pool_t <em>ngx_thread_pool_add(ngx_conf_t </em>cf, ngx_str_t <em>name);<br>ngx_thread_pool_t </em>ngx_thread_pool_get(ngx_cycle_t <em>cycle, ngx_str_t </em>name);</p>
<p>ngx_thread_task_t <em>ngx_thread_task_alloc(ngx_pool_t </em>pool, size_t size);<br>ngx_int_t ngx_thread_task_post(ngx_thread_pool_t <em>tp, ngx_thread_task_t </em>task);</p>
<p></p></pre></blockquote><p> At configuration time, a module willing to use threads has to obtain a reference to a thread pool by calling <code class="notranslate">ngx_thread_pool_add(cf, name)</code> , which either creates a new thread pool with the given <code class="notranslate">name</code> or returns a reference to the pool with that name if it already exists. </p><p> To add a <code class="notranslate">task</code> into a queue of a specified thread pool <code class="notranslate">tp</code> at runtime, use the <code class="notranslate">ngx_thread_task_post(tp, task)</code> function. To execute a function in a thread, pass parameters and setup a completion handler using the <code class="notranslate">ngx_thread_task_t</code> structure: </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    int    foo;<br>} my_thread_ctx_t;<p></p>
<p>static void<br>my_thread_func(void <em>data, ngx_log_t </em>log)<br>{<br>    my_thread_ctx_t *ctx = data;</p>
<pre><code>/* this function is executed in a separate thread */
</code></pre><p>}</p>
<p>static void<br>my_thread_completion(ngx_event_t <em>ev)<br>{<br>    my_thread_ctx_t </em>ctx = ev-&gt;data;</p>
<pre><code>/* executed in nginx event loop */
</code></pre><p>}</p>
<p>ngx_int_t<br>my_task_offload(my_conf_t <em>conf)<br>{<br>    my_thread_ctx_t    </em>ctx;<br>    ngx_thread_task_t  *task;</p>
<pre><code>task = ngx_thread_task_alloc(conf-&amp;gt;pool, sizeof(my_thread_ctx_t));
if (task == NULL) {
    return NGX_ERROR;
}

ctx = task-&amp;gt;ctx;

ctx-&amp;gt;foo = 42;

task-&amp;gt;handler = my_thread_func;
task-&amp;gt;event.handler = my_thread_completion;
task-&amp;gt;event.data = ctx;

if (ngx_thread_task_post(conf-&amp;gt;thread_pool, task) != NGX_OK) {
    return NGX_ERROR;
}

return NGX_OK;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="Modules"></a><center><h4> Modules </h4></center><a name="adding_new_modules"></a><center><h4> Adding new modules </h4></center><p> Each standalone nginx module resides in a separate directory that contains at least two files: <code class="notranslate">config</code> and a file with the module source code. The <code class="notranslate">config</code> file contains all information needed for nginx to integrate the module, for example: </p><blockquote class="example"><pre class="notranslate">ngx_module_type=CORE<br>ngx_module_name=ngx_foo_module<br>ngx_module_srcs=”$ngx_addon_dir/ngx_foo_module.c”<p></p>
<p>. auto/module</p>
<p>ngx_addon_name=$ngx_module_name<br></p></pre></blockquote><p> The <code class="notranslate">config</code> file is a POSIX shell script that can set and access the following variables: </p><ul class="compact"><li> <code class="notranslate">ngx_module_type</code> — Type of module to build. Possible values are <code class="notranslate">CORE</code> , <code class="notranslate">HTTP</code> , <code class="notranslate">HTTP_FILTER</code> , <code class="notranslate">HTTP_INIT_FILTER</code> , <code class="notranslate">HTTP_AUX_FILTER</code> , <code class="notranslate">MAIL</code> , <code class="notranslate">STREAM</code> , or <code class="notranslate">MISC</code> . </li><li> <code class="notranslate">ngx_module_name</code> — Module names. To build multiple modules from a set of source files, specify a whitespace-separated list of names. The first name indicates the name of the output binary for the dynamic module. The names in the list must match the names used in the source code. </li><li> <code class="notranslate">ngx_addon_name</code> — Name of the module as it appears in output on the console from the configure script. </li><li> <code class="notranslate">ngx_module_srcs</code> — Whitespace-separated list of source files used to compile the module. The <code class="notranslate">$ngx_addon_dir</code> variable can be used to represent the path to the module directory. </li><li> <code class="notranslate">ngx_module_incs</code> — Include paths required to build the module </li><li> <code class="notranslate">ngx_module_deps</code> — Whitespace-separated list of the module’s dependencies. Usually, it is the list of header files. </li><li> <code class="notranslate">ngx_module_libs</code> — Whitespace-separated list of libraries to link with the module. For example, use <code class="notranslate">ngx_module_libs=-lpthread</code> to link <code class="notranslate">libpthread</code> library. The following macros can be used to link against the same libraries as nginx: <code class="notranslate">LIBXSLT</code> , <code class="notranslate">LIBGD</code> , <code class="notranslate">GEOIP</code> , <code class="notranslate">PCRE</code> , <code class="notranslate">OPENSSL</code> , <code class="notranslate">MD5</code> , <code class="notranslate">SHA1</code> , <code class="notranslate">ZLIB</code> , and <code class="notranslate">PERL</code> . </li><li> <code class="notranslate">ngx_module_link</code> — Variable set by the build system to <code class="notranslate">DYNAMIC</code> for a dynamic module or <code class="notranslate">ADDON</code> for a static module and used to determine different actions to perform depending on linking type. </li><li> <code class="notranslate">ngx_module_order</code> — Load order for the module; useful for the <code class="notranslate">HTTP_FILTER</code> and <code class="notranslate">HTTP_AUX_FILTER</code> module types. The format for this option is a whitespace-separated list of modules. All modules in the list following the current module’s name end up after it in the global list of modules, which sets up the order for modules initialization. For filter modules later initialization means earlier execution. <p> The following modules are typically used as references. The <code class="notranslate">ngx_http_copy_filter_module</code> reads the data for other filter modules and is placed near the bottom of the list so that it is one of the first to be executed. The <code class="notranslate">ngx_http_write_filter_module</code> writes the data to the client socket and is placed near the top of the list, and is the last to be executed. </p><p> By default, filter modules are placed before the <code class="notranslate">ngx_http_copy_filter</code> in the module list so that the filter handler is executed after the copy filter handler. For other module types the default is the empty string. </p></li></ul><p> To compile a module into nginx statically, use the <code class="notranslate">–add-module=/path/to/module</code> argument to the configure script. To compile a module for later dynamic loading into nginx, use the <code class="notranslate">–add-dynamic-module=/path/to/module</code> argument. </p><a name="core_modules"></a><center><h4> Core Modules </h4></center><p> Modules are the building blocks of nginx, and most of its functionality is implemented as modules. The module source file must contain a global variable of type <code class="notranslate">ngx_module_t</code> , which is defined as follows: </p><blockquote class="example"><pre class="notranslate">struct ngx_module_s {<p></p>
<pre><code>/* private part is omitted */

void                 *ctx;
ngx_command_t        *commands;
ngx_uint_t            type;

ngx_int_t           (*init_master)(ngx_log_t *log);

ngx_int_t           (*init_module)(ngx_cycle_t *cycle);

ngx_int_t           (*init_process)(ngx_cycle_t *cycle);
ngx_int_t           (*init_thread)(ngx_cycle_t *cycle);
void                (*exit_thread)(ngx_cycle_t *cycle);
void                (*exit_process)(ngx_cycle_t *cycle);

void                (*exit_master)(ngx_cycle_t *cycle);

/* stubs for future extensions are omitted */
</code></pre><p>};<br></p></pre></blockquote><p> The omitted private part includes the module version and a signature and is filled using the predefined macro <code class="notranslate">NGX_MODULE_V1</code> . </p><p> Each module keeps its private data in the <code class="notranslate">ctx</code> field, recognizes the configuration directives, specified in the <code class="notranslate">commands</code> array, and can be invoked at certain stages of nginx lifecycle. The module lifecycle consists of the following events: </p><ul class="compact"><li> Configuration directive handlers are called as they appear in configuration files in the context of the master process. </li><li> After the configuration is parsed successfully, <code class="notranslate">init_module</code> handler is called in the context of the master process. The <code class="notranslate">init_module</code> handler is called in the master process each time a configuration is loaded. </li><li> The master process creates one or more worker processes and the <code class="notranslate">init_process</code> handler is called in each of them. </li><li> When a worker process receives the shutdown or terminate command from the master, it invokes the <code class="notranslate">exit_process</code> handler. </li><li> The master process calls the <code class="notranslate">exit_master</code> handler before exiting. </li></ul><p> Because threads are used in nginx only as a supplementary I/O facility with its own API, <code class="notranslate">init_thread</code> and <code class="notranslate">exit_thread</code> handlers are not currently called. There is also no <code class="notranslate">init_master</code> handler, because it would be unnecessary overhead. </p><p> The module <code class="notranslate">type</code> defines exactly what is stored in the <code class="notranslate">ctx</code> field. Its value is one of the following types: </p><ul class="compact"><li> <code class="notranslate">NGX_CORE_MODULE</code> </li> <li> <code class="notranslate">NGX_EVENT_MODULE</code> </li> <li> <code class="notranslate">NGX_HTTP_MODULE</code> </li> <li> <code class="notranslate">NGX_MAIL_MODULE</code> </li> <li> <code class="notranslate">NGX_STREAM_MODULE</code> </li> </ul><p> The <code class="notranslate">NGX_CORE_MODULE</code> is the most basic and thus the most generic and most low-level type of module. The other module types are implemented on top of it and provide a more convenient way to deal with corresponding domains, like handling events or HTTP requests. </p><p> The set of core modules includes <code class="notranslate">ngx_core_module</code> , <code class="notranslate">ngx_errlog_module</code> , <code class="notranslate">ngx_regex_module</code> , <code class="notranslate">ngx_thread_pool_module</code> and <code class="notranslate">ngx_openssl_module</code> modules. The HTTP module, the stream module, the mail module and event modules are core modules too. The context of a core module is defined as: </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    ngx_str_t             name;<br>    void               <em>(</em>create_conf)(ngx_cycle_t <em>cycle);<br>    char               </em>(<em>init_conf)(ngx_cycle_t </em>cycle, void <em>conf);<br>} ngx_core_module_t;<br></em></pre></blockquote><p> where the <code class="notranslate">name</code> is a module name string, <code class="notranslate">create_conf</code> and <code class="notranslate">init_conf</code> are pointers to functions that create and initialize module configuration respectively. For core modules, nginx calls <code class="notranslate">create_conf</code> before parsing a new configuration and <code class="notranslate">init_conf</code> after all configuration is parsed successfully. The typical <code class="notranslate">create_conf</code> function allocates memory for the configuration and sets default values. </p><p> For example, a simplistic module called <code class="notranslate">ngx_foo_module</code> might look like this: </p><blockquote class="example"><pre class="notranslate">/<p></p>
<ul>
<li>Copyright (C) Author.<br>*/</li>
</ul>
<p>#include &lt;ngx_config.h&gt;</p>
<p>#include &lt;ngx_core.h&gt;</p>
<p>typedef struct {<br>    ngx_flag_t  enable;<br>} ngx_foo_conf_t;</p>
<p>static void <em>ngx_foo_create_conf(ngx_cycle_t </em>cycle);<br>static char <em>ngx_foo_init_conf(ngx_cycle_t </em>cycle, void *conf);</p>
<p>static char <em>ngx_foo_enable(ngx_conf_t </em>cf, void <em>post, void </em>data);<br>static ngx_conf_post_t  ngx_foo_enable_post = { ngx_foo_enable };</p>
<p>static ngx_command_t  ngx_foo_commands[] = {</p>
<pre><code>{ ngx_string(&quot;foo_enabled&quot;),
  NGX_MAIN_CONF|NGX_DIRECT_CONF|NGX_CONF_FLAG,
  ngx_conf_set_flag_slot,
  0,
  offsetof(ngx_foo_conf_t, enable),
  &amp;amp;ngx_foo_enable_post },

  ngx_null_command
</code></pre><p>};</p>
<p>static ngx_core_module_t  ngx_foo_module_ctx = {<br>    ngx_string(“foo”),<br>    ngx_foo_create_conf,<br>    ngx_foo_init_conf<br>};</p>
<p>ngx_module_t  ngx_foo_module = {<br>    NGX_MODULE_V1,<br>    &amp;ngx_foo_module_ctx,                   /<em> module context </em>/<br>    ngx_foo_commands,                      /<em> module directives </em>/<br>    NGX_CORE_MODULE,                       /<em> module type </em>/<br>    NULL,                                  /<em> init master </em>/<br>    NULL,                                  /<em> init module </em>/<br>    NULL,                                  /<em> init process </em>/<br>    NULL,                                  /<em> init thread </em>/<br>    NULL,                                  /<em> exit thread </em>/<br>    NULL,                                  /<em> exit process </em>/<br>    NULL,                                  /<em> exit master </em>/<br>    NGX_MODULE_V1_PADDING<br>};</p>
<p>static void <em><br>ngx_foo_create_conf(ngx_cycle_t </em>cycle)<br>{<br>    ngx_foo_conf_t  *fcf;</p>
<pre><code>fcf = ngx_pcalloc(cycle-&amp;gt;pool, sizeof(ngx_foo_conf_t));
if (fcf == NULL) {
    return NULL;
}

fcf-&amp;gt;enable = NGX_CONF_UNSET;

return fcf;
</code></pre><p>}</p>
<p>static char <em><br>ngx_foo_init_conf(ngx_cycle_t </em>cycle, void <em>conf)<br>{<br>    ngx_foo_conf_t </em>fcf = conf;</p>
<pre><code>ngx_conf_init_value(fcf-&amp;gt;enable, 0);

return NGX_CONF_OK;
</code></pre><p>}</p>
<p>static char <em><br>ngx_foo_enable(ngx_conf_t </em>cf, void <em>post, void </em>data)<br>{<br>    ngx_flag_t  *fp = data;</p>
<pre><code>if (*fp == 0) {
    return NGX_CONF_OK;
}

ngx_log_error(NGX_LOG_NOTICE, cf-&amp;gt;log, 0, &quot;Foo Module is enabled&quot;);

return NGX_CONF_OK;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="config_directives"></a><center><h4> Configuration Directives </h4></center><p> The <code class="notranslate">ngx_command_t</code> type defines a single configuration directive. Each module that supports configuration provides an array of such structures that describe how to process arguments and what handlers to call: </p><blockquote class="example"><pre class="notranslate">typedef struct ngx_command_s  ngx_command_t;<p></p>
<p>struct ngx_command_s {<br>    ngx_str_t             name;<br>    ngx_uint_t            type;<br>    char               <em>(</em>set)(ngx_conf_t <em>cf, ngx_command_t </em>cmd, void <em>conf);<br>    ngx_uint_t            conf;<br>    ngx_uint_t            offset;<br>    void                 </em>post;<br>};<br></p></pre></blockquote><p> Terminate the array with the special value <code class="notranslate">ngx_null_command</code> . The <code class="notranslate">name</code> is the name of a directive as it appears in the configuration file, for example “worker_processes” or “listen”. The <code class="notranslate">type</code> is a bit-field of flags that specify the number of arguments the directive takes, its type, and the context in which it appears. The flags are: </p><ul class="compact"><li> <code class="notranslate">NGX_CONF_NOARGS</code> — Directive takes no arguments. </li><li> <code class="notranslate">NGX_CONF_1MORE</code> — Directive takes one or more arguments. </li><li> <code class="notranslate">NGX_CONF_2MORE</code> — Directive takes two or more arguments. </li><li> <code class="notranslate">NGX_CONF_TAKE1</code> .. <code class="notranslate">NGX_CONF_TAKE7</code> — Directive takes exactly the indicated number of arguments. </li><li> <code class="notranslate">NGX_CONF_TAKE12</code> , <code class="notranslate">NGX_CONF_TAKE13</code> , <code class="notranslate">NGX_CONF_TAKE23</code> , <code class="notranslate">NGX_CONF_TAKE123</code> , <code class="notranslate">NGX_CONF_TAKE1234</code> — Directive may take different number of arguments. Options are limited to the given numbers. For example, <code class="notranslate">NGX_CONF_TAKE12</code> means it takes one or two arguments. </li></ul><p> The flags for directive types are: </p><ul class="compact"><li> <code class="notranslate">NGX_CONF_BLOCK</code> — Directive is a block, that is, it can contain other directives within its opening and closing braces, or even implement its own parser to handle contents inside. </li><li> <code class="notranslate">NGX_CONF_FLAG</code> — Directive takes a boolean value, either <code class="notranslate">on</code> or <code class="notranslate">off</code> . </li></ul><p> A directive’s context defines where it may appear in the configuration: </p><ul class="compact"><li> <code class="notranslate">NGX_MAIN_CONF</code> — In the top level context. </li><li> <code class="notranslate">NGX_HTTP_MAIN_CONF</code> — In the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_HTTP_SRV_CONF</code> — In a <code class="notranslate">server</code> block within the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_HTTP_LOC_CONF</code> — In a <code class="notranslate">location</code> block within the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_HTTP_UPS_CONF</code> — In an <code class="notranslate">upstream</code> block within the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_HTTP_SIF_CONF</code> — In an <code class="notranslate">if</code> block within a <code class="notranslate">server</code> block in the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_HTTP_LIF_CONF</code> — In an <code class="notranslate">if</code> block within a <code class="notranslate">location</code> block in the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_HTTP_LMT_CONF</code> — In a <code class="notranslate">limit_except</code> block within the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_STREAM_MAIN_CONF</code> — In the <code class="notranslate">stream</code> block. </li><li> <code class="notranslate">NGX_STREAM_SRV_CONF</code> — In a <code class="notranslate">server</code> block within the <code class="notranslate">stream</code> block. </li><li> <code class="notranslate">NGX_STREAM_UPS_CONF</code> — In an <code class="notranslate">upstream</code> block within the <code class="notranslate">stream</code> block. </li><li> <code class="notranslate">NGX_MAIL_MAIN_CONF</code> — In the <code class="notranslate">mail</code> block. </li><li> <code class="notranslate">NGX_MAIL_SRV_CONF</code> — In a <code class="notranslate">server</code> block within the <code class="notranslate">mail</code> block. </li><li> <code class="notranslate">NGX_EVENT_CONF</code> — In the <code class="notranslate">event</code> block. </li><li> <code class="notranslate">NGX_DIRECT_CONF</code> — Used by modules that don’t create a hierarchy of contexts and only have one global configuration. This configuration is passed to the handler as the <code class="notranslate">conf</code> argument. </li></ul><p> The configuration parser uses these flags to throw an error in case of a misplaced directive and calls directive handlers supplied with a proper configuration pointer, so that the same directives in different locations can store their values in distinct places. </p><p> The <code class="notranslate">set</code> field defines a handler that processes a directive and stores parsed values into the corresponding configuration. There’s a number of functions that perform common conversions: </p><ul class="compact"><li> <code class="notranslate">ngx_conf_set_flag_slot</code> — Converts the literal strings <code class="notranslate">on</code> and <code class="notranslate">off</code> into an <code class="notranslate">ngx_flag_t</code> value with values 1 or 0, respectively. </li><li> <code class="notranslate">ngx_conf_set_str_slot</code> — Stores a string as a value of the <code class="notranslate">ngx_str_t</code> type. </li><li> <code class="notranslate">ngx_conf_set_str_array_slot</code> — Appends a value to an array <code class="notranslate">ngx_array_t</code> of strings <code class="notranslate">ngx_str_t</code> . The array is created if does not already exist. </li><li> <code class="notranslate">ngx_conf_set_keyval_slot</code> — Appends a key-value pair to an array <code class="notranslate">ngx_array_t</code> of key-value pairs <code class="notranslate">ngx_keyval_t</code> . The first string becomes the key and the second the value. The array is created if it does not already exist. </li><li> <code class="notranslate">ngx_conf_set_num_slot</code> — Converts a directive’s argument to an <code class="notranslate">ngx_int_t</code> value. </li><li> <code class="notranslate">ngx_conf_set_size_slot</code> — Converts a <a hhref="syntax.html">size</a> to a <code class="notranslate">size_t</code> value expressed in bytes. </li><li> <code class="notranslate">ngx_conf_set_off_slot</code> — Converts an <a hhref="syntax.html">offset</a> to an <code class="notranslate">off_t</code> value expressed in bytes. </li><li> <code class="notranslate">ngx_conf_set_msec_slot</code> — Converts a <a hhref="syntax.html">time</a> to an <code class="notranslate">ngx_msec_t</code> value expressed in milliseconds. </li><li> <code class="notranslate">ngx_conf_set_sec_slot</code> — Converts a <a hhref="syntax.html">time</a> to a <code class="notranslate">time_t</code> value expressed in in seconds. </li><li> <code class="notranslate">ngx_conf_set_bufs_slot</code> — Converts the two supplied arguments into an <code class="notranslate">ngx_bufs_t</code> object that holds the number and <a hhref="syntax.html">size</a> of buffers. </li><li> <code class="notranslate">ngx_conf_set_enum_slot</code> — Converts the supplied argument into an <code class="notranslate">ngx_uint_t</code> value. The null-terminated array of <code class="notranslate">ngx_conf_enum_t</code> passed in the <code class="notranslate">post</code> field defines the acceptable strings and corresponding integer values. </li><li> <code class="notranslate">ngx_conf_set_bitmask_slot</code> — Converts the supplied arguments into an <code class="notranslate">ngx_uint_t</code> value. The mask values for each argument are ORed producing the result. The null-terminated array of <code class="notranslate">ngx_conf_bitmask_t</code> passed in the <code class="notranslate">post</code> field defines the acceptable strings and corresponding mask values. </li><li> <code class="notranslate">set_path_slot</code> — Converts the supplied arguments to an <code class="notranslate">ngx_path_t</code> value and performs all required initializations. For details, see the documentation for the <a hhref="http/ngx_http_proxy_module.html#proxy_temp_path">proxy_temp_path</a> directive. </li><li> <code class="notranslate">set_access_slot</code> — Converts the supplied arguments to a file permissions mask. For details, see the documentation for the <a hhref="http/ngx_http_proxy_module.html#proxy_store_access">proxy_store_access</a> directive. </li></ul><p></p><p> The <code class="notranslate">conf</code> field defines which configuration structure is passed to the directory handler. Core modules only have the global configuration and set <code class="notranslate">NGX_DIRECT_CONF</code> flag to access it. Modules like HTTP, Stream or Mail create hierarchies of configurations. For example, a module’s configuration is created for <code class="notranslate">server</code> , <code class="notranslate">location</code> and <code class="notranslate">if</code> scopes. </p><ul class="compact"><li> <code class="notranslate">NGX_HTTP_MAIN_CONF_OFFSET</code> — Configuration for the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_HTTP_SRV_CONF_OFFSET</code> — Configuration for a <code class="notranslate">server</code> block within the <code class="notranslate">http</code> block. </li><li> <code class="notranslate">NGX_HTTP_LOC_CONF_OFFSET</code> — Configuration for a <code class="notranslate">location</code> block within the <code class="notranslate">http</code> . </li><li> <code class="notranslate">NGX_STREAM_MAIN_CONF_OFFSET</code> — Configuration for the <code class="notranslate">stream</code> block. </li><li> <code class="notranslate">NGX_STREAM_SRV_CONF_OFFSET</code> — Configuration for a <code class="notranslate">server</code> block within the <code class="notranslate">stream</code> block. </li><li> <code class="notranslate">NGX_MAIL_MAIN_CONF_OFFSET</code> — Configuration for the <code class="notranslate">mail</code> block. </li><li> <code class="notranslate">NGX_MAIL_SRV_CONF_OFFSET</code> — Configuration for a <code class="notranslate">server</code> block within the <code class="notranslate">mail</code> block. </li></ul><p></p><p> The <code class="notranslate">offset</code> defines the offset of a field in a module configuration structure that holds values for this particular directive. The typical use is to employ the <code class="notranslate">offsetof()</code> macro. </p><p> The <code class="notranslate">post</code> field has two purposes: it may be used to define a handler to be called after the main handler has completed, or to pass additional data to the main handler. In the first case, the <code class="notranslate">ngx_conf_post_t</code> structure needs to be initialized with a pointer to the handler, for example: </p><blockquote class="example"><pre class="notranslate">static char <em>ngx_do_foo(ngx_conf_t </em>cf, void <em>post, void </em>data);<br>static ngx_conf_post_t  ngx_foo_post = { ngx_do_foo };<br></pre></blockquote><p> The <code class="notranslate">post</code> argument is the <code class="notranslate">ngx_conf_post_t</code> object itself, and the <code class="notranslate">data</code> is a pointer to the value, converted from arguments by the main handler with the appropriate type. </p><a name="http"></a><center><h4>   HTTP </h4></center><a name="http_connection"></a><center><h4>  连接 </h4></center><p> Each HTTP client connection runs through the following stages: </p><ul class="compact"><li> <code class="notranslate">ngx_event_accept()</code> accepts a client TCP connection. This handler is called in response to a read notification on a listen socket. A new <code class="notranslate">ngx_connecton_t</code> object is created at this stage to wrap the newly accepted client socket. Each nginx listener provides a handler to pass the new connection object to. For HTTP connections it’s <code class="notranslate">ngx_http_init_connection(c)</code> . </li><li> <code class="notranslate">ngx_http_init_connection()</code> performs early initialization of the HTTP connection. At this stage an <code class="notranslate">ngx_http_connection_t</code> object is created for the connection and its reference is stored in the connection’s <code class="notranslate">data</code> field. Later it will be replaced by an HTTP request object. A PROXY protocol parser and the SSL handshake are started at this stage as well. </li><li> <code class="notranslate">ngx_http_wait_request_handler()</code> read event handler is called when data is available on the client socket. At this stage an HTTP request object <code class="notranslate">ngx_http_request_t</code> is created and set to the connection’s <code class="notranslate">data</code> field. </li><li> <code class="notranslate">ngx_http_process_request_line()</code> read event handler reads client request line. The handler is set by <code class="notranslate">ngx_http_wait_request_handler()</code> . The data is read into connection’s <code class="notranslate">buffer</code> . The size of the buffer is initially set by the directive <a hhref="http/ngx_http_core_module.html#client_header_buffer_size">client_header_buffer_size</a> . The entire client header is supposed to fit in the buffer. If the initial size is not sufficient, a bigger buffer is allocated, with the capacity set by the <code class="notranslate">large_client_header_buffers</code> directive. </li><li> <code class="notranslate">ngx_http_process_request_headers()</code> read event handler, is set after <code class="notranslate">ngx_http_process_request_line()</code> to read the client request header. </li><li> <code class="notranslate">ngx_http_core_run_phases()</code> is called when the request header is completely read and parsed. This function runs request phases from <code class="notranslate">NGX_HTTP_POST_READ_PHASE</code> to <code class="notranslate">NGX_HTTP_CONTENT_PHASE</code> . The last phase is intended to generate a response and pass it along the filter chain. The response is not necessarily sent to the client at this phase. It might remain buffered and be sent at the finalization stage. </li><li> <code class="notranslate">ngx_http_finalize_request()</code> is usually called when the request has generated all the output or produced an error. In the latter case an appropriate error page is looked up and used as the response. If the response is not completely sent to the client by this point, an HTTP writer <code class="notranslate">ngx_http_writer()</code> is activated to finish sending outstanding data. </li><li> <code class="notranslate">ngx_http_finalize_connection()</code> is called when the complete response has been sent to the client and the request can be destroyed. If the client connection keepalive feature is enabled, <code class="notranslate">ngx_http_set_keepalive()</code> is called, which destroys the current request and waits for the next request on the connection. Otherwise, <code class="notranslate">ngx_http_close_request()</code> destroys both the request and the connection. </li></ul><a name="http_request"></a><center><h4>  请求 </h4></center><p> For each client HTTP request the <code class="notranslate">ngx_http_request_t</code> object is created. Some of the fields of this object are: </p><ul class="compact"><li><p> <code class="notranslate">connection</code> — Pointer to a <code class="notranslate">ngx_connection_t</code> client connection object. Several requests can reference the same connection object at the same time - one main request and its subrequests. After a request is deleted, a new request can be created on the same connection. </p><p> Note that for HTTP connections <code class="notranslate">ngx_connection_t</code> ‘s <code class="notranslate">data</code> field points back to the request. Such requests are called active, as opposed to the other requests tied to the connection. An active request is used to handle client connection events and is allowed to output its response to the client. Normally, each request becomes active at some point so that it can send its output. </p></li><li><p> <code class="notranslate">ctx</code> — Array of HTTP module contexts. Each module of type <code class="notranslate">NGX_HTTP_MODULE</code> can store any value (normally, a pointer to a structure) in the request. The value is stored in the <code class="notranslate">ctx</code> array at the module’s <code class="notranslate">ctx_index</code> position. The following macros provide a convenient way to get and set request contexts: </p><ul class="compact"><li> <code class="notranslate">ngx_http_get_module_ctx(r, module)</code> — Returns the <code class="notranslate">module</code> ‘s context </li><li> <code class="notranslate">ngx_http_set_ctx(r, c, module)</code> — Sets <code class="notranslate">c</code> as the <code class="notranslate">module</code> ‘s context </li></ul></li><li> <code class="notranslate">main_conf</code> , <code class="notranslate">srv_conf</code> , <code class="notranslate">loc_conf</code> — Arrays of current request configurations. Configurations are stored at the module’s <code class="notranslate">ctx_index</code> positions. </li><li> <code class="notranslate">read_event_handler</code> , <code class="notranslate">write_event_handler</code> - Read and write event handlers for the request. Normally, both the read and write event handlers for an HTTP connection are set to <code class="notranslate">ngx_http_request_handler()</code> . This function calls the <code class="notranslate">read_event_handler</code> and <code class="notranslate">write_event_handler</code> handlers for the currently active request. </li><li> <code class="notranslate">cache</code> — Request cache object for caching the upstream response. </li><li> <code class="notranslate">upstream</code> — Request upstream object for proxying. </li><li> <code class="notranslate">pool</code> — Request pool. The request object itself is allocated in this pool, which is destroyed when the request is deleted. For allocations that need to be available throughout the client connection’s lifetime, use <code class="notranslate">ngx_connection_t</code> ‘s pool instead. </li><li> <code class="notranslate">header_in</code> — Buffer into which the client HTTP request header is read. </li><li> <code class="notranslate">headers_in</code> , <code class="notranslate">headers_out</code> — Input and output HTTP headers objects. Both objects contain the <code class="notranslate">headers</code> field of type <code class="notranslate">ngx_list_t</code> for keeping the raw list of headers. In addition to that, specific headers are available for getting and setting as separate fields, for example <code class="notranslate">content_length_n</code> , <code class="notranslate">status</code> etc. </li><li> <code class="notranslate">request_body</code> — Client request body object. </li><li> <code class="notranslate">start_sec</code> , <code class="notranslate">start_msec</code> — Time point when the request was created, used for tracking request duration. </li><li> <code class="notranslate">method</code> , <code class="notranslate">method_name</code> — Numeric and text representation of the client HTTP request method. Numeric values for methods are defined in <code class="notranslate">src/http/ngx_http_request.h</code> with the macros <code class="notranslate">NGX_HTTP_GET</code> , <code class="notranslate">NGX_HTTP_HEAD</code> , <code class="notranslate">NGX_HTTP_POST</code> , etc. </li><li> <code class="notranslate">http_protocol</code> — Client HTTP protocol version in its original text form (“HTTP/1.0”, “HTTP/1.1” etc). </li><li> <code class="notranslate">http_version</code> — Client HTTP protocol version in numeric form ( <code class="notranslate">NGX_HTTP_VERSION_10</code> , <code class="notranslate">NGX_HTTP_VERSION_11</code> , etc.). </li><li> <code class="notranslate">http_major</code> , <code class="notranslate">http_minor</code> — Client HTTP protocol version in numeric form split into major and minor parts. </li><li> <code class="notranslate">request_line</code> , <code class="notranslate">unparsed_uri</code> — Request line and URI in the original client request. </li><li> <code class="notranslate">uri</code> , <code class="notranslate">args</code> , <code class="notranslate">exten</code> — URI, arguments and file extension for the current request. The URI value here might differ from the original URI sent by the client due to normalization. Throughout request processing, these values can change as internal redirects are performed. </li><li> <code class="notranslate">main</code> — Pointer to a main request object. This object is created to process a client HTTP request, as opposed to subrequests, which are created to perform a specific subtask within the main request. </li><li> <code class="notranslate">parent</code> — Pointer to the parent request of a subrequest. </li><li> <code class="notranslate">postponed</code> — List of output buffers and subrequests, in the order in which they are sent and created. The list is used by the postpone filter to provide consistent request output when parts of it are created by subrequests. </li><li> <code class="notranslate">post_subrequest</code> — Pointer to a handler with the context to be called when a subrequest gets finalized. Unused for main requests. </li><li><p> <code class="notranslate">posted_requests</code> — List of requests to be started or resumed, which is done by calling the request’s <code class="notranslate">write_event_handler</code> . Normally, this handler holds the request main function, which at first runs request phases and then produces the output. </p><p> A request is usually posted by the <code class="notranslate">ngx_http_post_request(r, NULL)</code> call. It is always posted to the main request <code class="notranslate">posted_requests</code> list. The function <code class="notranslate">ngx_http_run_posted_requests(c)</code> runs all requests that are posted in the main request of the passed connection’s active request. All event handlers call <code class="notranslate">ngx_http_run_posted_requests</code> , which can lead to new posted requests. Normally, it is called after invoking a request’s read or write handler. </p></li><li> <code class="notranslate">phase_handler</code> — Index of current request phase. </li><li> <code class="notranslate">ncaptures</code> , <code class="notranslate">captures</code> , <code class="notranslate">captures_data</code> — Regex captures produced by the last regex match of the request. A regex match can occur at a number of places during request processing: map lookup, server lookup by SNI or HTTP Host, rewrite, proxy_redirect, etc. Captures produced by a lookup are stored in the above mentioned fields. The field <code class="notranslate">ncaptures</code> holds the number of captures, <code class="notranslate">captures</code> holds captures boundaries and <code class="notranslate">captures_data</code> holds the string against which the regex was matched and which is used to extract captures. After each new regex match, request captures are reset to hold new values. </li><li> <code class="notranslate">count</code> — Request reference counter. The field only makes sense for the main request. Increasing the counter is done by simple <code class="notranslate">r-&gt;main-&gt;count++</code> . To decrease the counter, call <code class="notranslate">ngx_http_finalize_request(r, rc)</code> . Creating of a subrequest and running the request body read process both increment the counter. </li><li> <code class="notranslate">subrequests</code> — Current subrequest nesting level. Each subrequest inherits its parent’s nesting level, decreased by one. An error is generated if the value reaches zero. The value for the main request is defined by the <code class="notranslate">NGX_HTTP_MAX_SUBREQUESTS</code> constant. </li><li> <code class="notranslate">uri_changes</code> — Number of URI changes remaining for the request. The total number of times a request can change its URI is limited by the <code class="notranslate">NGX_HTTP_MAX_URI_CHANGES</code> constant. With each change the value is decremented until it reaches zero, at which time an error is generated. Rewrites and internal redirects to normal or named locations are considered URI changes. </li><li> <code class="notranslate">blocked</code> — Counter of blocks held on the request. While this value is non-zero, the request cannot be terminated. Currently, this value is increased by pending AIO operations (POSIX AIO and thread operations) and active cache lock. </li><li> <code class="notranslate">buffered</code> — Bitmask showing which modules have buffered the output produced by the request. A number of filters can buffer output; for example, sub_filter can buffer data because of a partial string match, copy filter can buffer data because of the lack of free output buffers etc. As long as this value is non-zero, the request is not finalized pending the flush. </li><li> <code class="notranslate">header_only</code> — Flag indicating that the output does not require a body. For example, this flag is used by HTTP HEAD requests. </li><li><p> <code class="notranslate">keepalive</code> — Flag indicating whether client connection keepalive is supported. The value is inferred from the HTTP version and the value of the “Connection” header. </p></li><li> <code class="notranslate">header_sent</code> — Flag indicating that the output header has already been sent by the request. </li><li> <code class="notranslate">internal</code> — Flag indicating that the current request is internal. To enter the internal state, a request must pass through an internal redirect or be a subrequest. Internal requests are allowed to enter internal locations. </li><li> <code class="notranslate">allow_ranges</code> — Flag indicating that a partial response can be sent to the client, as requested by the HTTP Range header. </li><li> <code class="notranslate">subrequest_ranges</code> — Flag indicating that a partial response can be sent while a subrequest is being processed. </li><li> <code class="notranslate">single_range</code> — Flag indicating that only a single continuous range of output data can be sent to the client. This flag is usually set when sending a stream of data, for example from a proxied server, and the entire response is not available in one buffer. </li><li> <code class="notranslate">main_filter_need_in_memory</code> , <code class="notranslate">filter_need_in_memory</code> — Flags requesting that the output produced in memory buffers rather than files. This is a signal to the copy filter to read data from file buffers even if sendfile is enabled. The difference between the two flags is the location of the filter modules that set them. Filters called before the postpone filter in the filter chain set <code class="notranslate">filter_need_in_memory</code> , requesting that only the current request output come in memory buffers. Filters called later in the filter chain set <code class="notranslate">main_filter_need_in_memory</code> , requesting that both the main request and all subrequests read files in memory while sending output. </li><li> <code class="notranslate">filter_need_temporary</code> — Flag requesting that the request output be produced in temporary buffers, but not in readonly memory buffers or file buffers. This is used by filters which may change output directly in the buffers where it’s sent. </li></ul><a name="http_conf"></a><center><h4>  组态 </h4></center><p> Each HTTP module can have three types of configuration: </p><ul class="compact"><li> Main configuration — Applies to the entire <code class="notranslate">http</code> block. Functions as global settings for a module. </li><li> Server configuration — Applies to a single <code class="notranslate">server</code> block. Functions as server-specific settings for a module. </li><li> Location configuration — Applies to a single <code class="notranslate">location</code> , <code class="notranslate">if</code> or <code class="notranslate">limit_except</code> block. Functions as location-specific settings for a module. </li></ul><p> Configuration structures are created at the nginx configuration stage by calling functions, which allocate the structures, initialize them and merge them. The following example shows how to create a simple location configuration for a module. The configuration has one setting, <code class="notranslate">foo</code> , of type unsigned integer. </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    ngx_uint_t  foo;<br>} ngx_http_foo_loc_conf_t;<p></p>
<p>static ngx_http_module_t  ngx_http_foo_module_ctx = {<br>    NULL,                                  /<em> preconfiguration </em>/<br>    NULL,                                  /<em> postconfiguration </em>/</p>
<pre><code>NULL,                                  /* create main configuration */
NULL,                                  /* init main configuration */

NULL,                                  /* create server configuration */
NULL,                                  /* merge server configuration */

ngx_http_foo_create_loc_conf,          /* create location configuration */
ngx_http_foo_merge_loc_conf            /* merge location configuration */
</code></pre><p>};</p>
<p>static void <em><br>ngx_http_foo_create_loc_conf(ngx_conf_t </em>cf)<br>{<br>    ngx_http_foo_loc_conf_t  *conf;</p>
<pre><code>conf = ngx_pcalloc(cf-&amp;gt;pool, sizeof(ngx_http_foo_loc_conf_t));
if (conf == NULL) {
    return NULL;
}

conf-&amp;gt;foo = NGX_CONF_UNSET_UINT;

return conf;
</code></pre><p>}</p>
<p>static char <em><br>ngx_http_foo_merge_loc_conf(ngx_conf_t </em>cf, void <em>parent, void </em>child)<br>{<br>    ngx_http_foo_loc_conf_t <em>prev = parent;<br>    ngx_http_foo_loc_conf_t </em>conf = child;</p>
<pre><code>ngx_conf_merge_uint_value(conf-&amp;gt;foo, prev-&amp;gt;foo, 1);
</code></pre><p>}<br></p></pre></blockquote><p> As seen in the example, the <code class="notranslate">ngx_http_foo_create_loc_conf()</code> function creates a new configuration structure, and <code class="notranslate">ngx_http_foo_merge_loc_conf()</code> merges a configuration with configuration from a higher level. In fact, server and location configuration do not exist only at the server and location levels, but are also created for all levels above them. Specifically, a server configuration is also created at the main level and location configurations are created at the main, server, and location levels. These configurations make it possible to specify server- and location-specific settings at any level of an nginx configuration file. Eventually configurations are merged down. A number of macros like <code class="notranslate">NGX_CONF_UNSET</code> and <code class="notranslate">NGX_CONF_UNSET_UINT</code> are provided for indicating a missing setting and ignoring it while merging. Standard nginx merge macros like <code class="notranslate">ngx_conf_merge_value()</code> and <code class="notranslate">ngx_conf_merge_uint_value()</code> provide a convenient way to merge a setting and set the default value if none of the configurations provided an explicit value. For complete list of macros for different types, see <code class="notranslate">src/core/ngx_conf_file.h</code> . </p><p> The following macros are available. for accessing configuration for HTTP modules at configuration time. They all take <code class="notranslate">ngx_conf_t</code> reference as the first argument. </p><ul class="compact"><li> <code class="notranslate">ngx_http_conf_get_module_main_conf(cf, module)</code> </li> <li> <code class="notranslate">ngx_http_conf_get_module_srv_conf(cf, module)</code> </li> <li> <code class="notranslate">ngx_http_conf_get_module_loc_conf(cf, module)</code> </li> </ul><p> The following example gets a pointer to a location configuration of standard nginx core module <a hhref="http/ngx_http_core_module.html">ngx_http_core_module</a> and replaces the location content handler kept in the <code class="notranslate">handler</code> field of the structure. </p><blockquote class="example"><pre class="notranslate">static ngx_int_t ngx_http_foo_handler(ngx_http_request_t *r);<p></p>
<p>static ngx_command_t  ngx_http_foo_commands[] = {</p>
<pre><code>{ ngx_string(&quot;foo&quot;),
  NGX_HTTP_LOC_CONF|NGX_CONF_NOARGS,
  ngx_http_foo,
  0,
  0,
  NULL },

  ngx_null_command
</code></pre><p>};</p>
<p>static char <em><br>ngx_http_foo(ngx_conf_t </em>cf, ngx_command_t <em>cmd, void </em>conf)<br>{<br>    ngx_http_core_loc_conf_t  *clcf;</p>
<pre><code>clcf = ngx_http_conf_get_module_loc_conf(cf, ngx_http_core_module);
clcf-&amp;gt;handler = ngx_http_bar_handler;

return NGX_CONF_OK;
</code></pre><p>}<br></p></pre></blockquote><p> The following macros are available for accessing configuration for HTTP modules at runtime. </p><ul class="compact"><li> <code class="notranslate">ngx_http_get_module_main_conf(r, module)</code> </li> <li> <code class="notranslate">ngx_http_get_module_srv_conf(r, module)</code> </li> <li> <code class="notranslate">ngx_http_get_module_loc_conf(r, module)</code> </li> </ul><p> These macros receive a reference to an HTTP request <code class="notranslate">ngx_http_request_t</code> . The main configuration of a request never changes. Server configuration can change from the default after the virtual server for the request is chosen. Location configuration selected for processing a request can change multiple times as a result of a rewrite operation or internal redirect. The following example shows how to access a module’s HTTP configuration at runtime. </p><blockquote class="example"><pre class="notranslate">static ngx_int_t<br>ngx_http_foo_handler(ngx_http_request_t <em>r)<br>{<br>    ngx_http_foo_loc_conf_t  </em>flcf;<p></p>
<pre><code>flcf = ngx_http_get_module_loc_conf(r, ngx_http_foo_module);

...
</code></pre><p>}<br></p></pre></blockquote><a name="http_phases"></a><center><h4>  相 </h4></center><p> Each HTTP request passes through a sequence of phases. In each phase a distinct type of processing is performed on the request. Module-specific handlers can be registered in most phases, and many standard nginx modules register their phase handlers as a way to get called at a specific stage of request processing. Phases are processed successively and the phase handlers are called once the request reaches the phase. Following is the list of nginx HTTP phases. </p><ul class="compact"><li> <code class="notranslate">NGX_HTTP_POST_READ_PHASE</code> — First phase. The <a hhref="http/ngx_http_realip_module.html">ngx_http_realip_module</a> registers its handler at this phase to enable substitution of client addresses before any other module is invoked. </li><li> <code class="notranslate">NGX_HTTP_SERVER_REWRITE_PHASE</code> — Phase where rewrite directives defined in a <code class="notranslate">server</code> block (but outside a <code class="notranslate">location</code> block) are processed. The <a hhref="http/ngx_http_rewrite_module.html">ngx_http_rewrite_module</a> installs its handler at this phase. </li><li> <code class="notranslate">NGX_HTTP_FIND_CONFIG_PHASE</code> — Special phase where a location is chosen based on the request URI. Before this phase, the default location for the relevant virtual server is assigned to the request, and any module requesting a location configuration receives the configuration for the default server location. This phase a assigns a new location to the request. No additional handlers can be registered at this phase. </li><li> <code class="notranslate">NGX_HTTP_REWRITE_PHASE</code> — Same as <code class="notranslate">NGX_HTTP_SERVER_REWRITE_PHASE</code> , but for rewrite rules defined in the location, chosen in the previous phase. </li><li> <code class="notranslate">NGX_HTTP_POST_REWRITE_PHASE</code> — Special phase where the request is redirected to a new location if its URI changed during a rewrite. This is implemented by the request going through the <code class="notranslate">NGX_HTTP_FIND_CONFIG_PHASE</code> again. No additional handlers can be registered at this phase. </li><li> <code class="notranslate">NGX_HTTP_PREACCESS_PHASE</code> — A common phase for different types of handlers, not associated with access control. The standard nginx modules <a hhref="http/ngx_http_limit_conn_module.html">ngx_http_limit_conn_module</a> and <a hhref="http/ngx_http_limit_req_module.html">ngx_http_limit_req_module</a> register their handlers at this phase. </li><li> <code class="notranslate">NGX_HTTP_ACCESS_PHASE</code> — Phase where it is verified that the client is authorized to make the request. Standard nginx modules such as <a hhref="http/ngx_http_access_module.html">ngx_http_access_module</a> and <a hhref="http/ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a> register their handlers at this phase. By default the client must pass the authorization check of all handlers registered at this phase for the request to continue to the next phase. The <a hhref="http/ngx_http_core_module.html#satisfy">satisfy</a> directive, can be used to permit processing to continue if any of the phase handlers authorizes the client. </li><li> <code class="notranslate">NGX_HTTP_POST_ACCESS_PHASE</code> — Special phase where the <a hhref="http/ngx_http_core_module.html#satisfy">satisfy any</a> directive is processed. If some access phase handlers denied access and none explicitly allowed it, the request is finalized. No additional handlers can be registered at this phase. </li><li> <code class="notranslate">NGX_HTTP_PRECONTENT_PHASE</code> — Phase for handlers to be called prior to generating content. Standard modules such as <a hhref="http/ngx_http_core_module.html#try_files">ngx_http_try_files_module</a> and <a hhref="http/ngx_http_mirror_module.html">ngx_http_mirror_module</a> register their handlers at this phase. </li><li> <code class="notranslate">NGX_HTTP_CONTENT_PHASE</code> — Phase where the response is normally generated. Multiple nginx standard modules register their handlers at this phase, including <a hhref="http/ngx_http_index_module.html">ngx_http_index_module</a> or <code class="notranslate">ngx_http_static_module</code> . They are called sequentially until one of them produces the output. It’s also possible to set content handlers on a per-location basis. If the <a hhref="http/ngx_http_core_module.html">ngx_http_core_module</a> ‘s location configuration has <code class="notranslate">handler</code> set, it is called as the content handler and the handlers installed at this phase are ignored. </li><li> <code class="notranslate">NGX_HTTP_LOG_PHASE</code> — Phase where request logging is performed. Currently, only the <a hhref="http/ngx_http_log_module.html">ngx_http_log_module</a> registers its handler at this stage for access logging. Log phase handlers are called at the very end of request processing, right before freeing the request. </li></ul><p> Following is the example of a preaccess phase handler. </p><blockquote class="example"><pre class="notranslate">static ngx_http_module_t  ngx_http_foo_module_ctx = {<br>    NULL,                                  /<em> preconfiguration </em>/<br>    ngx_http_foo_init,                     /<em> postconfiguration </em>/<p></p>
<pre><code>NULL,                                  /* create main configuration */
NULL,                                  /* init main configuration */

NULL,                                  /* create server configuration */
NULL,                                  /* merge server configuration */

NULL,                                  /* create location configuration */
NULL                                   /* merge location configuration */
</code></pre><p>};</p>
<p>static ngx_int_t<br>ngx_http_foo_handler(ngx_http_request_t <em>r)<br>{<br>    ngx_str_t  </em>ua;</p>
<pre><code>ua = r-&amp;gt;headers_in-&amp;gt;user_agent;

if (ua == NULL) {
    return NGX_DECLINED;
}

/* reject requests with &quot;User-Agent: foo&quot; */
if (ua-&amp;gt;value.len == 3 &amp;amp;&amp;amp; ngx_strncmp(ua-&amp;gt;value.data, &quot;foo&quot;, 3) == 0) {
    return NGX_HTTP_FORBIDDEN;
}

return NGX_DECLINED;
</code></pre><p>}</p>
<p>static ngx_int_t<br>ngx_http_foo_init(ngx_conf_t <em>cf)<br>{<br>    ngx_http_handler_pt        </em>h;<br>    ngx_http_core_main_conf_t  *cmcf;</p>
<pre><code>cmcf = ngx_http_conf_get_module_main_conf(cf, ngx_http_core_module);

h = ngx_array_push(&amp;amp;cmcf-&amp;gt;phases[NGX_HTTP_PREACCESS_PHASE].handlers);
if (h == NULL) {
    return NGX_ERROR;
}

*h = ngx_http_foo_handler;

return NGX_OK;
</code></pre><p>}<br></p></pre></blockquote><p> Phase handlers are expected to return specific codes: </p><ul class="compact"><li> <code class="notranslate">NGX_OK</code> — Proceed to the next phase. </li><li> <code class="notranslate">NGX_DECLINED</code> — Proceed to the next handler of the current phase. If the current handler is the last in the current phase, move to the next phase. </li><li> <code class="notranslate">NGX_AGAIN</code> , <code class="notranslate">NGX_DONE</code> — Suspend phase handling until some future event which can be an asynchronous I/O operation or just a delay, for example. It is assumed, that phase handling will be resumed later by calling <code class="notranslate">ngx_http_core_run_phases()</code> . </li><li> Any other value returned by the phase handler is treated as a request finalization code, in particular, an HTTP response code. The request is finalized with the code provided. </li></ul><p> For some phases, return codes are treated in a slightly different way. At the content phase, any return code other that <code class="notranslate">NGX_DECLINED</code> is considered a finalization code. Any return code from the location content handlers is considered a finalization code. At the access phase, in <a hhref="http/ngx_http_core_module.html#satisfy">satisfy any</a> mode, any return code other than <code class="notranslate">NGX_OK</code> , <code class="notranslate">NGX_DECLINED</code> , <code class="notranslate">NGX_AGAIN</code> , <code class="notranslate">NGX_DONE</code> is considered a denial. If no subsequent access handlers allow or deny access with a different code, the denial code will become the finalization code. </p><a name="http_variables"></a><center><h4>  变量 </h4></center><a name="http_existing_variables"></a><center><h4> Accessing existing variables </h4></center><p> Variables can be referenced by index (this is the most common method) or name (see <a hhref="#http_creating_variables">below</a> ). The index is created at configuration stage, when a variable is added to the configuration. To obtain the variable index, use <code class="notranslate">ngx_http_get_variable_index()</code> : </p><blockquote class="example"><pre class="notranslate">ngx_str_t  name;  /<em> ngx_string(“foo”) </em>/<br>ngx_int_t  index;<p></p>
<p>index = ngx_http_get_variable_index(cf, &amp;name);<br></p></pre></blockquote><p> Here, <code class="notranslate">cf</code> is a pointer to nginx configuration and <code class="notranslate">name</code> points to a string containing the variable name. The function returns <code class="notranslate">NGX_ERROR</code> on error or a valid index otherwise, which is typically stored somewhere in the module’s configuration for future use. </p><p> All HTTP variables are evaluated in the context of a given HTTP request, and results are specific to and cached in that HTTP request. All functions that evaluate variables return the <code class="notranslate">ngx_http_variable_value_t</code> type, representing the variable value: </p><blockquote class="example"><pre class="notranslate">typedef ngx_variable_value_t  ngx_http_variable_value_t;<p></p>
<p>typedef struct {<br>    unsigned    len:28;</p>
<pre><code>unsigned    valid:1;
unsigned    no_cacheable:1;
unsigned    not_found:1;
unsigned    escape:1;

u_char     *data;
</code></pre><p>} ngx_variable_value_t;<br></p></pre></blockquote><p>  哪里： </p><ul class="compact"><li> <code class="notranslate">len</code> — The length of the value </li><li> <code class="notranslate">data</code> — The value itself </li><li> <code class="notranslate">valid</code> — The value is valid </li><li> <code class="notranslate">not_found</code> — The variable was not found and thus the <code class="notranslate">data</code> and <code class="notranslate">len</code> fields are irrelevant; this can happen, for example, with variables like <code class="notranslate">$arg_foo</code> when a corresponding argument was not passed in a request </li><li> <code class="notranslate">no_cacheable</code> — Do not cache result </li><li> <code class="notranslate">escape</code> — Used internally by the logging module to mark values that require escaping on output. </li></ul><p></p><p> The <code class="notranslate">ngx_http_get_flushed_variable()</code> and <code class="notranslate">ngx_http_get_indexed_variable()</code> functions are used to obtain the value of a variable. They have the same interface - accepting an HTTP request <code class="notranslate">r</code> as a context for evaluating the variable and an <code class="notranslate">index</code> that identifies it. An example of typical usage: </p><blockquote class="example"><pre class="notranslate">ngx_http_variable_value_t  *v;<p></p>
<p>v = ngx_http_get_flushed_variable(r, index);</p>
<p>if (v == NULL || v-&gt;not_found) {<br>    /<em> we failed to get value or there is no such variable, handle it </em>/<br>    return NGX_ERROR;<br>}</p>
<p>/<em> some meaningful value is found </em>/<br></p></pre></blockquote><p> The difference between functions is that the <code class="notranslate">ngx_http_get_indexed_variable()</code> returns a cached value and <code class="notranslate">ngx_http_get_flushed_variable()</code> flushes the cache for non-cacheable variables. </p><p> Some modules, such as SSI and Perl, need to deal with variables for which the name is not known at configuration time. An index therefore cannot be used to access them, but the <code class="notranslate">ngx_http_get_variable(r, name, key)</code> function is available. It searches for a variable with a given <code class="notranslate">name</code> and its hash <code class="notranslate">key</code> derived from the name. </p><a name="http_creating_variables"></a><center><h4> Creating variables </h4></center><p> To create a variable, use the <code class="notranslate">ngx_http_add_variable()</code> function. It takes as arguments a configuration (where the variable is registered), the variable name and flags that control the function’s behaviour: </p><ul class="compact"><li> <code class="notranslate">NGX_HTTP_VAR_CHANGEABLE</code> — Enables redefinition of the variable: there is no conflict if another module defines a variable with the same name. This allows the <a hhref="http/ngx_http_rewrite_module.html#set">set</a> directive to override variables. </li><li> <code class="notranslate">NGX_HTTP_VAR_NOCACHEABLE</code> — Disables caching, which is useful for variables such as <code class="notranslate">$time_local</code> . </li><li> <code class="notranslate">NGX_HTTP_VAR_NOHASH</code> — Indicates that this variable is only accessible by index, not by name. This is a small optimization for use when it is known that the variable is not needed in modules like SSI or Perl. </li><li> <code class="notranslate">NGX_HTTP_VAR<em>PREFIX</em></code> — The name of the variable is a prefix. In this case, a handler must implement additional logic to obtain the value of a specific variable. For example, all “ <code class="notranslate">arg</code> ” variables are processed by the same handler, which performs lookup in request arguments and returns the value of a specific argument. </li></ul><p> The function returns NULL in case of error or a pointer to <code class="notranslate">ngx_http_variable_t</code> otherwise: </p><blockquote class="example"><pre class="notranslate">struct ngx_http_variable_s {<br>    ngx_str_t                     name;<br>    ngx_http_set_variable_pt      set_handler;<br>    ngx_http_get_variable_pt      get_handler;<br>    uintptr_t                     data;<br>    ngx_uint_t                    flags;<br>    ngx_uint_t                    index;<br>};<br></pre></blockquote><p> The <code class="notranslate">get</code> and <code class="notranslate">set</code> handlers are called to obtain or set the variable value, <code class="notranslate">data</code> is passed to variable handlers, and <code class="notranslate">index</code> holds assigned variable index used to reference the variable. </p><p> Usually, a null-terminated static array of <code class="notranslate">ngx_http_variable_t</code> structures is created by a module and processed at the preconfiguration stage to add variables into the configuration, for example: </p><blockquote class="example"><pre class="notranslate">static ngx_http_variable_t  ngx_http_foo_vars[] = {<p></p>
<pre><code>{ ngx_string(&quot;foo_v1&quot;), NULL, ngx_http_foo_v1_variable, 0, 0, 0 },

  ngx_http_null_variable
</code></pre><p>};</p>
<p>static ngx_int_t<br>ngx_http_foo_add_variables(ngx_conf_t <em>cf)<br>{<br>    ngx_http_variable_t  </em>var, *v;</p>
<pre><code>for (v = ngx_http_foo_vars; v-&amp;gt;name.len; v++) {
    var = ngx_http_add_variable(cf, &amp;amp;v-&amp;gt;name, v-&amp;gt;flags);
    if (var == NULL) {
        return NGX_ERROR;
    }

    var-&amp;gt;get_handler = v-&amp;gt;get_handler;
    var-&amp;gt;data = v-&amp;gt;data;
}

return NGX_OK;
</code></pre><p>}<br></p></pre></blockquote><p> This function in the example is used to initialize the <code class="notranslate">preconfiguration</code> field of the HTTP module context and is called before the parsing of HTTP configuration, so that the parser can refer to these variables. </p><p> The <code class="notranslate">get</code> handler is responsible for evaluating a variable in the context of a specific request, for example: </p><blockquote class="example"><pre class="notranslate">static ngx_int_t<br>ngx_http_variable_connection(ngx_http_request_t <em>r,<br>    ngx_http_variable_value_t </em>v, uintptr_t data)<br>{<br>    u_char  *p;<p></p>
<pre><code>p = ngx_pnalloc(r-&amp;gt;pool, NGX_ATOMIC_T_LEN);
if (p == NULL) {
    return NGX_ERROR;
}

v-&amp;gt;len = ngx_sprintf(p, &quot;%uA&quot;, r-&amp;gt;connection-&amp;gt;number) - p;
v-&amp;gt;valid = 1;
v-&amp;gt;no_cacheable = 0;
v-&amp;gt;not_found = 0;
v-&amp;gt;data = p;

return NGX_OK;
</code></pre><p>}<br></p></pre></blockquote><p> It returns <code class="notranslate">NGX_ERROR</code> in case of internal error (for example, failed memory allocation) or <code class="notranslate">NGX_OK</code> otherwise. To learn the status of variable evaluation, inspect the flags in <code class="notranslate">ngx_http_variable_value_t</code> (see the description <a hhref="#http_existing_variables">above</a> ). </p><p> The <code class="notranslate">set</code> handler allows setting the property referenced by the variable. For example, the set handler of the <code class="notranslate">$limit_rate</code> variable modifies the request’s <code class="notranslate">limit_rate</code> field: </p><blockquote class="example"><pre class="notranslate">…<br>{ ngx_string(“limit_rate”), ngx_http_variable_request_set_size,<br>  ngx_http_variable_request_get_size,<br>  offsetof(ngx_http_request_t, limit_rate),<br>  NGX_HTTP_VAR_CHANGEABLE|NGX_HTTP_VAR_NOCACHEABLE, 0 },<br>…<p></p>
<p>static void<br>ngx_http_variable_request_set_size(ngx_http_request_t <em>r,<br>    ngx_http_variable_value_t </em>v, uintptr_t data)<br>{<br>    ssize_t    s, *sp;<br>    ngx_str_t  val;</p>
<pre><code>val.len = v-&amp;gt;len;
val.data = v-&amp;gt;data;

s = ngx_parse_size(&amp;amp;val);

if (s == NGX_ERROR) {
    ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,
                  &quot;invalid size \&quot;%V\&quot;&quot;, &amp;amp;val);
    return;
}

sp = (ssize_t *) ((char *) r + data);

*sp = s;

return;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="http_complex_values"></a><center><h4> Complex values </h4></center><p> A complex value, despite its name, provides an easy way to evaluate expressions which can contain text, variables, and their combination. </p><p> The complex value description in <code class="notranslate">ngx_http_compile_complex_value</code> is compiled at the configuration stage into <code class="notranslate">ngx_http_complex_value_t</code> which is used at runtime to obtain results of expression evaluation. </p><blockquote class="example"><pre class="notranslate">ngx_str_t                         *value;<br>ngx_http_complex_value_t           cv;<br>ngx_http_compile_complex_value_t   ccv;<p></p>
<p>value = cf-&gt;args-&gt;elts; /<em> directive arguments </em>/</p>
<p>ngx_memzero(&amp;ccv, sizeof(ngx_http_compile_complex_value_t));</p>
<p>ccv.cf = cf;<br>ccv.value = &amp;value[1];<br>ccv.complex_value = &amp;cv;<br>ccv.zero = 1;<br>ccv.conf_prefix = 1;</p>
<p>if (ngx_http_compile_complex_value(&amp;ccv) != NGX_OK) {<br>    return NGX_CONF_ERROR;<br>}<br></p></pre></blockquote><p> Here, <code class="notranslate">ccv</code> holds all parameters that are required to initialize the complex value <code class="notranslate">cv</code> : </p><ul class="compact"><li> <code class="notranslate">cf</code> — Configuration pointer </li><li> <code class="notranslate">value</code> — String to be parsed (input) </li><li> <code class="notranslate">complex_value</code> — Compiled value (output) </li><li> <code class="notranslate">zero</code> — Flag that enables zero-terminating value </li><li> <code class="notranslate">conf_prefix</code> — Prefixes the result with the configuration prefix (the directory where nginx is currently looking for configuration) </li><li> <code class="notranslate">root_prefix</code> — Prefixes the result with the root prefix (the normal nginx installation prefix) </li></ul><p> The <code class="notranslate">zero</code> flag is useful when results are to be passed to libraries that require zero-terminated strings, and prefixes are handy when dealing with filenames. </p><p> Upon successful compilation, <code class="notranslate">cv.lengths</code> contains information about the presence of variables in the expression. The NULL value means that the expression contained static text only, and so can be stored in a simple string rather than as a complex value. </p><p> The <code class="notranslate">ngx_http_set_complex_value_slot()</code> is a convenient function used to initialize a complex value completely in the directive declaration itself. </p><p> At runtime, a complex value can be calculated using the <code class="notranslate">ngx_http_complex_value()</code> function: </p><blockquote class="example"><pre class="notranslate">ngx_str_t  res;<p></p>
<p>if (ngx_http_complex_value(r, &amp;cv, &amp;res) != NGX_OK) {<br>    return NGX_ERROR;<br>}<br></p></pre></blockquote><p> Given the request <code class="notranslate">r</code> and previously compiled value <code class="notranslate">cv</code> , the function evaluates the expression and writes the result to <code class="notranslate">res</code> . </p><a name="http_request_redirection"></a><center><h4> Request redirection </h4></center><p> An HTTP request is always connected to a location via the <code class="notranslate">loc_conf</code> field of the <code class="notranslate">ngx_http_request_t</code> structure. This means that at any point the location configuration of any module can be retrieved from the request by calling <code class="notranslate">ngx_http_get_module_loc_conf(r, module)</code> . Request location can change several times during the request’s lifetime. Initially, a default server location of the default server is assigned to a request. If the request switches to a different server (chosen by the HTTP “Host” header or SSL SNI extension), the request switches to the default location of that server as well. The next change of the location takes place at the <code class="notranslate">NGX_HTTP_FIND_CONFIG_PHASE</code> request phase. At this phase a location is chosen by request URI among all non-named locations configured for the server. The <a hhref="http/ngx_http_rewrite_module.html">ngx_http_rewrite_module</a> can change the request URI at the <code class="notranslate">NGX_HTTP_REWRITE_PHASE</code> request phase as a result of the <a hhref="http/ngx_http_rewrite_module.html#rewrite">rewrite</a> directive and send the request back to the <code class="notranslate">NGX_HTTP_FIND_CONFIG_PHASE</code> phase for selection of a new location based on the new URI. </p><p> It is also possible to redirect a request to a new location at any point by calling one of <code class="notranslate">ngx_http_internal_redirect(r, uri, args)</code> or <code class="notranslate">ngx_http_named_location(r, name)</code> . </p><p> The <code class="notranslate">ngx_http_internal_redirect(r, uri, args)</code> function changes the request URI and returns the request to the <code class="notranslate">NGX_HTTP_SERVER_REWRITE_PHASE</code> phase. The request proceeds with a server default location. Later at <code class="notranslate">NGX_HTTP_FIND_CONFIG_PHASE</code> a new location is chosen based on the new request URI. </p><p> The following example performs an internal redirect with the new request arguments. </p><blockquote class="example"><pre class="notranslate">ngx_int_t<br>ngx_http_foo_redirect(ngx_http_request_t *r)<br>{<br>    ngx_str_t  uri, args;<p></p>
<pre><code>ngx_str_set(&amp;amp;uri, &quot;/foo&quot;);
ngx_str_set(&amp;amp;args, &quot;bar=1&quot;);

return ngx_http_internal_redirect(r, &amp;amp;uri, &amp;amp;args);
</code></pre><p>}<br></p></pre></blockquote><p> The function <code class="notranslate">ngx_http_named_location(r, name)</code> redirects a request to a named location. The name of the location is passed as the argument. The location is looked up among all named locations of the current server, after which the requests switches to the <code class="notranslate">NGX_HTTP_REWRITE_PHASE</code> phase. </p><p> The following example performs a redirect to a named location @foo. </p><blockquote class="example"><pre class="notranslate">ngx_int_t<br>ngx_http_foo_named_redirect(ngx_http_request_t *r)<br>{<br>    ngx_str_t  name;<p></p>
<pre><code>ngx_str_set(&amp;amp;name, &quot;foo&quot;);

return ngx_http_named_location(r, &amp;amp;name);
</code></pre><p>}<br></p></pre></blockquote><p> Both functions - <code class="notranslate">ngx_http_internal_redirect(r, uri, args)</code> and <code class="notranslate">ngx_http_named_location(r, name)</code> can be called when nginx modules have already stored some contexts in a request’s <code class="notranslate">ctx</code> field. It’s possible for these contexts to become inconsistent with the new location configuration. To prevent inconsistency, all request contexts are erased by both redirect functions. </p><p> Calling <code class="notranslate">ngx_http_internal_redirect(r, uri, args)</code> or <code class="notranslate">ngx_http_named_location(r, name)</code> increases the request <code class="notranslate">count</code> . For consistent request reference counting, call <code class="notranslate">ngx_http_finalize_request(r, NGX_DONE)</code> after redirecting the request. This will finalize current request code path and decrease the counter. </p><p> Redirected and rewritten requests become internal and can access the <a hhref="http/ngx_http_core_module.html#internal">internal</a> locations. Internal requests have the <code class="notranslate">internal</code> flag set. </p><a name="http_subrequests"></a><center><h4> Subrequests </h4></center><p> Subrequests are primarily used to insert output of one request into another, possibly mixed with other data. A subrequest looks like a normal request, but shares some data with its parent. In particular, all fields related to client input are shared because a subrequest does not receive any other input from the client. The request field <code class="notranslate">parent</code> for a subrequest contains a link to its parent request and is NULL for the main request. The field <code class="notranslate">main</code> contains a link to the main request in a group of requests. </p><p> A subrequest starts in the <code class="notranslate">NGX_HTTP_SERVER_REWRITE_PHASE</code> phase. It passes through the same subsequent phases as a normal request and is assigned a location based on its own URI. </p><p> The output header in a subrequest is always ignored. The <code class="notranslate">ngx_http_postpone_filter</code> places the subrequest’s output body in the right position relative to other data produced by the parent request. </p><p> Subrequests are related to the concept of active requests. A request <code class="notranslate">r</code> is considered active if <code class="notranslate">c-&gt;data == r</code> , where <code class="notranslate">c</code> is the client connection object. At any given point, only the active request in a request group is allowed to output its buffers to the client. An inactive request can still send its output to the filter chain, but it does not pass beyond the <code class="notranslate">ngx_http_postpone_filter</code> and remains buffered by that filter until the request becomes active. Here are some rules of request activation: </p><ul class="compact"><li> Initially, the main request is active. </li><li> The first subrequest of an active request becomes active right after creation. </li><li> The <code class="notranslate">ngx_http_postpone_filter</code> activates the next request in the active request’s subrequest list, once all data prior to that request are sent. </li><li> When a request is finalized, its parent is activated. </li></ul><p> Create a subrequest by calling the function <code class="notranslate">ngx_http_subrequest(r, uri, args, psr, ps, flags)</code> , where <code class="notranslate">r</code> is the parent request, <code class="notranslate">uri</code> and <code class="notranslate">args</code> are the URI and arguments of the subrequest, <code class="notranslate">psr</code> is the output parameter, which receives the newly created subrequest reference, <code class="notranslate">ps</code> is a callback object for notifying the parent request that the subrequest is being finalized, and <code class="notranslate">flags</code> is bitmask of flags. The following flags are available: </p><ul class="compact"><li> <code class="notranslate">NGX_HTTP_SUBREQUEST_IN_MEMORY</code> - Output is not sent to the client, but rather stored in memory. The flag only affects subrequests which are processed by one of the proxying modules. After a subrequest is finalized its output is available in a <code class="notranslate">r-&gt;upstream-&gt;buffer</code> of type <code class="notranslate">ngx_buf_t</code> . </li><li> <code class="notranslate">NGX_HTTP_SUBREQUEST_WAITED</code> - The subrequest’s <code class="notranslate">done</code> flag is set even if the subrequest is not active when it is finalized. This subrequest flag is used by the SSI filter. </li><li> <code class="notranslate">NGX_HTTP_SUBREQUEST_CLONE</code> - The subrequest is created as a clone of its parent. It is started at the same location and proceeds from the same phase as the parent request. </li></ul><p> The following example creates a subrequest with the URI of <code class="notranslate">/foo</code> . </p><blockquote class="example"><pre class="notranslate">ngx_int_t            rc;<br>ngx_str_t            uri;<br>ngx_http_request_t  *sr;<p></p>
<p>…</p>
<p>ngx_str_set(&amp;uri, “/foo”);</p>
<p>rc = ngx_http_subrequest(r, &amp;uri, NULL, &amp;sr, NULL, 0);<br>if (rc == NGX_ERROR) {<br>    /<em> error </em>/<br>}<br></p></pre></blockquote><p> This example clones the current request and sets a finalization callback for the subrequest. </p><blockquote class="example"><pre class="notranslate">ngx_int_t<br>ngx_http_foo_clone(ngx_http_request_t <em>r)<br>{<br>    ngx_http_request_t          </em>sr;<br>    ngx_http_post_subrequest_t  *ps;<p></p>
<pre><code>ps = ngx_palloc(r-&amp;gt;pool, sizeof(ngx_http_post_subrequest_t));
if (ps == NULL) {
    return NGX_ERROR;
}

ps-&amp;gt;handler = ngx_http_foo_subrequest_done;
ps-&amp;gt;data = &quot;foo&quot;;

return ngx_http_subrequest(r, &amp;amp;r-&amp;gt;uri, &amp;amp;r-&amp;gt;args, &amp;amp;sr, ps,
                           NGX_HTTP_SUBREQUEST_CLONE);
</code></pre><p>}</p>
<p>ngx_int_t<br>ngx_http_foo_subrequest_done(ngx_http_request_t <em>r, void </em>data, ngx_int_t rc)<br>{<br>    char  <em>msg = (char </em>) data;</p>
<pre><code>ngx_log_error(NGX_LOG_INFO, r-&amp;gt;connection-&amp;gt;log, 0,
              &quot;done subrequest r:%p msg:%s rc:%i&quot;, r, msg, rc);

return rc;
</code></pre><p>}<br></p></pre></blockquote><p> Subrequests are normally created in a body filter, in which case their output can be treated like the output from any explicit request. This means that eventually the output of a subrequest is sent to the client, after all explicit buffers that are passed before subrequest creation and before any buffers that are passed after creation. This ordering is preserved even for large hierarchies of subrequests. The following example inserts output from a subrequest after all request data buffers, but before the final buffer with the <code class="notranslate">last_buf</code> flag. </p><blockquote class="example"><pre class="notranslate">ngx_int_t<br>ngx_http_foo_body_filter(ngx_http_request_t <em>r, ngx_chain_t </em>in)<br>{<br>    ngx_int_t                   rc;<br>    ngx_buf_t                  <em>b;<br>    ngx_uint_t                  last;<br>    ngx_chain_t                </em>cl, out;<br>    ngx_http_request_t         <em>sr;<br>    ngx_http_foo_filter_ctx_t  </em>ctx;<p></p>
<pre><code>ctx = ngx_http_get_module_ctx(r, ngx_http_foo_filter_module);
if (ctx == NULL) {
    return ngx_http_next_body_filter(r, in);
}

last = 0;

for (cl = in; cl; cl = cl-&amp;gt;next) {
    if (cl-&amp;gt;buf-&amp;gt;last_buf) {
        cl-&amp;gt;buf-&amp;gt;last_buf = 0;
        cl-&amp;gt;buf-&amp;gt;last_in_chain = 1;
        cl-&amp;gt;buf-&amp;gt;sync = 1;
        last = 1;
    }
}

/* Output explicit output buffers */

rc = ngx_http_next_body_filter(r, in);

if (rc == NGX_ERROR || !last) {
    return rc;
}

/*
 * Create the subrequest.  The output of the subrequest
 * will automatically be sent after all preceding buffers,
 * but before the last_buf buffer passed later in this function.
 */

if (ngx_http_subrequest(r, ctx-&amp;gt;uri, NULL, &amp;amp;sr, NULL, 0) != NGX_OK) {
    return NGX_ERROR;
}

ngx_http_set_ctx(r, NULL, ngx_http_foo_filter_module);

/* Output the final buffer with the last_buf flag */

b = ngx_calloc_buf(r-&amp;gt;pool);
if (b == NULL) {
    return NGX_ERROR;
}

b-&amp;gt;last_buf = 1;

out.buf = b;
out.next = NULL;

return ngx_http_output_filter(r, &amp;amp;out);
</code></pre><p>}<br></p></pre></blockquote><p> A subrequest can also be created for other purposes than data output. For example, the <a hhref="http/ngx_http_auth_request_module.html">ngx_http_auth_request_module</a> module creates a subrequest at the <code class="notranslate">NGX_HTTP_ACCESS_PHASE</code> phase. To disable output at this point, the <code class="notranslate">header_only</code> flag is set on the subrequest. This prevents the subrequest body from being sent to the client. Note that the subrequest’s header is never sent to the client. The result of the subrequest can be analyzed in the callback handler. </p><a name="http_request_finalization"></a><center><h4> Request finalization </h4></center><p> An HTTP request is finalized by calling the function <code class="notranslate">ngx_http_finalize_request(r, rc)</code> . It is usually finalized by the content handler after all output buffers are sent to the filter chain. At this point all of the output might not be sent to the client, with some of it remaining buffered somewhere along the filter chain. If it is, the <code class="notranslate">ngx_http_finalize_request(r, rc)</code> function automatically installs a special handler <code class="notranslate">ngx_http_writer(r)</code> to finish sending the output. A request is also finalized in case of an error or if a standard HTTP response code needs to be returned to the client. </p><p> The function <code class="notranslate">ngx_http_finalize_request(r, rc)</code> expects the following <code class="notranslate">rc</code> values: </p><ul class="compact"><li> <code class="notranslate">NGX_DONE</code> - Fast finalization. Decrement the request <code class="notranslate">count</code> and destroy the request if it reaches zero. The client connection can be used for more requests after the current request is destroyed. </li><li> <code class="notranslate">NGX_ERROR</code> , <code class="notranslate">NGX_HTTP_REQUEST_TIME_OUT</code> ( <code class="notranslate">408</code> ), <code class="notranslate">NGX_HTTP_CLIENT_CLOSED_REQUEST</code> ( <code class="notranslate">499</code> ) - Error finalization. Terminate the request as soon as possible and close the client connection. </li><li> <code class="notranslate">NGX_HTTP_CREATED</code> ( <code class="notranslate">201</code> ), <code class="notranslate">NGX_HTTP_NO_CONTENT</code> ( <code class="notranslate">204</code> ), codes greater than or equal to <code class="notranslate">NGX_HTTP_SPECIAL_RESPONSE</code> ( <code class="notranslate">300</code> ) - Special response finalization. For these values nginx either sends to the client a default response page for the code or performs the internal redirect to an <a hhref="http/ngx_http_core_module.html#error_page">error_page</a> location if that is configured for the code. </li><li> Other codes are considered successful finalization codes and might activate the request writer to finish sending the response body. Once the body is completely sent, the request <code class="notranslate">count</code> is decremented. If it reaches zero, the request is destroyed, but the client connection can still be used for other requests. If <code class="notranslate">count</code> is positive, there are unfinished activities within the request, which will be finalized at a later point. </li></ul><a name="http_request_body"></a><center><h4> Request body </h4></center><p> For dealing with the body of a client request, nginx provides the <code class="notranslate">ngx_http_read_client_request_body(r, post_handler)</code> and <code class="notranslate">ngx_http_discard_request_body(r)</code> functions. The first function reads the request body and makes it available via the <code class="notranslate">request_body</code> request field. The second function instructs nginx to discard (read and ignore) the request body. One of these functions must be called for every request. Normally, the content handler makes the call. </p><p> Reading or discarding the client request body from a subrequest is not allowed. It must always be done in the main request. When a subrequest is created, it inherits the parent’s <code class="notranslate">request_body</code> object which can be used by the subrequest if the main request has previously read the request body. </p><p> The function <code class="notranslate">ngx_http_read_client_request_body(r, post_handler)</code> starts the process of reading the request body. When the body is completely read, the <code class="notranslate">post_handler</code> callback is called to continue processing the request. If the request body is missing or has already been read, the callback is called immediately. The function <code class="notranslate">ngx_http_read_client_request_body(r, post_handler)</code> allocates the <code class="notranslate">request_body</code> request field of type <code class="notranslate">ngx_http_request_body_t</code> . The field <code class="notranslate">bufs</code> of this object keeps the result as a buffer chain. The body can be saved in memory buffers or file buffers, if the capacity specified by the <a hhref="http/ngx_http_core_module.html#client_body_buffer_size">client_body_buffer_size</a> directive is not enough to fit the entire body in memory. </p><p> The following example reads a client request body and returns its size. </p><blockquote class="example"><pre class="notranslate">ngx_int_t<br>ngx_http_foo_content_handler(ngx_http_request_t *r)<br>{<br>    ngx_int_t  rc;<p></p>
<pre><code>rc = ngx_http_read_client_request_body(r, ngx_http_foo_init);

if (rc &amp;gt;= NGX_HTTP_SPECIAL_RESPONSE) {
    /* error */
    return rc;
}

return NGX_DONE;
</code></pre><p>}</p>
<p>void<br>ngx_http_foo_init(ngx_http_request_t <em>r)<br>{<br>    off_t         len;<br>    ngx_buf_t    </em>b;<br>    ngx_int_t     rc;<br>    ngx_chain_t  *in, out;</p>
<pre><code>if (r-&amp;gt;request_body == NULL) {
    ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);
    return;
}

len = 0;

for (in = r-&amp;gt;request_body-&amp;gt;bufs; in; in = in-&amp;gt;next) {
    len += ngx_buf_size(in-&amp;gt;buf);
}

b = ngx_create_temp_buf(r-&amp;gt;pool, NGX_OFF_T_LEN);
if (b == NULL) {
    ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);
    return;
}

b-&amp;gt;last = ngx_sprintf(b-&amp;gt;pos, &quot;%O&quot;, len);
b-&amp;gt;last_buf = (r == r-&amp;gt;main) ? 1: 0;
b-&amp;gt;last_in_chain = 1;

r-&amp;gt;headers_out.status = NGX_HTTP_OK;
r-&amp;gt;headers_out.content_length_n = b-&amp;gt;last - b-&amp;gt;pos;

rc = ngx_http_send_header(r);

if (rc == NGX_ERROR || rc &amp;gt; NGX_OK || r-&amp;gt;header_only) {
    ngx_http_finalize_request(r, rc);
    return;
}

out.buf = b;
out.next = NULL;

rc = ngx_http_output_filter(r, &amp;amp;out);

ngx_http_finalize_request(r, rc);
</code></pre><p>}<br></p></pre></blockquote><p> The following fields of the request determine how the request body is read: </p><ul class="compact"><li> <code class="notranslate">request_body_in_single_buf</code> - Read the body to a single memory buffer. </li><li> <code class="notranslate">request_body_in_file_only</code> - Always read the body to a file, even if fits in the memory buffer. </li><li> <code class="notranslate">request_body_in_persistent_file</code> - Do not unlink the file immediately after creation. A file with this flag can be moved to another directory. </li><li> <code class="notranslate">request_body_in_clean_file</code> - Unlink the file when the request is finalized. This can be useful when a file was supposed to be moved to another directory but was not moved for some reason. </li><li> <code class="notranslate">request_body_file_group_access</code> - Enable group access to the file by replacing the default 0600 access mask with 0660. </li><li> <code class="notranslate">request_body_file_log_level</code> - Severity level at which to log file errors. </li><li> <code class="notranslate">request_body_no_buffering</code> - Read the request body without buffering. </li></ul><p> The <code class="notranslate">request_body_no_buffering</code> flag enables the unbuffered mode of reading a request body. In this mode, after calling <code class="notranslate">ngx_http_read_client_request_body()</code> , the <code class="notranslate">bufs</code> chain might keep only a part of the body. To read the next part, call the <code class="notranslate">ngx_http_read_unbuffered_request_body(r)</code> function. The return value <code class="notranslate">NGX_AGAIN</code> and the request flag <code class="notranslate">reading_body</code> indicate that more data is available. If <code class="notranslate">bufs</code> is NULL after calling this function, there is nothing to read at the moment. The request callback <code class="notranslate">read_event_handler</code> will be called when the next part of request body is available. </p><a name="http_response"></a><center><h4>  响应 </h4></center><p> In nginx an HTTP response is produced by sending the response header followed by the optional response body. Both header and body are passed through a chain of filters and eventually get written to the client socket. An nginx module can install its handler into the header or body filter chain and process the output coming from the previous handler. </p><a name="http_response_header"></a><center><h4> Response header </h4></center><p> The <code class="notranslate">ngx_http_send_header(r)</code> function sends the output header. Do not call this function until <code class="notranslate">r-&gt;headers_out</code> contains all of the data required to produce the HTTP response header. The <code class="notranslate">status</code> field in <code class="notranslate">r-&gt;headers_out</code> must always be set. If the response status indicates that a response body follows the header, <code class="notranslate">content_length_n</code> can be set as well. The default value for this field is <code class="notranslate">-1</code> , which means that the body size is unknown. In this case, chunked transfer encoding is used. To output an arbitrary header, append the <code class="notranslate">headers</code> list. </p><blockquote class="example"><pre class="notranslate">static ngx_int_t<br>ngx_http_foo_content_handler(ngx_http_request_t <em>r)<br>{<br>    ngx_int_t         rc;<br>    ngx_table_elt_t  </em>h;<p></p>
<pre><code>/* send header */

r-&amp;gt;headers_out.status = NGX_HTTP_OK;
r-&amp;gt;headers_out.content_length_n = 3;

/* X-Foo: foo */

h = ngx_list_push(&amp;amp;r-&amp;gt;headers_out.headers);
if (h == NULL) {
    return NGX_ERROR;
}

h-&amp;gt;hash = 1;
ngx_str_set(&amp;amp;h-&amp;gt;key, &quot;X-Foo&quot;);
ngx_str_set(&amp;amp;h-&amp;gt;value, &quot;foo&quot;);

rc = ngx_http_send_header(r);

if (rc == NGX_ERROR || rc &amp;gt; NGX_OK || r-&amp;gt;header_only) {
    return rc;
}

/* send body */

...
</code></pre><p>}<br></p></pre></blockquote><a name="http_header_filters"></a><center><h4> Header filters </h4></center><p> The <code class="notranslate">ngx_http_send_header(r)</code> function invokes the header filter chain by calling the first header filter handler stored in the <code class="notranslate">ngx_http_top_header_filter</code> variable. It’s assumed that every header handler calls the next handler in the chain until the final handler <code class="notranslate">ngx_http_header_filter(r)</code> is called. The final header handler constructs the HTTP response based on <code class="notranslate">r-&gt;headers_out</code> and passes it to the <code class="notranslate">ngx_http_writer_filter</code> for output. </p><p> To add a handler to the header filter chain, store its address in the global variable <code class="notranslate">ngx_http_top_header_filter</code> at configuration time. The previous handler address is normally stored in a static variable in a module and is called by the newly added handler before exiting. </p><p> The following example of a header filter module adds the HTTP header “ <code class="notranslate">X-Foo: foo</code> “ to every response with status <code class="notranslate">200</code> . </p><blockquote class="example"><pre class="notranslate">#include &lt;ngx_config.h&gt;<p></p>
<p>#include &lt;ngx_core.h&gt;</p>
<p>#include &lt;ngx_http.h&gt;</p>
<p>static ngx_int_t ngx_http_foo_header_filter(ngx_http_request_t <em>r);<br>static ngx_int_t ngx_http_foo_header_filter_init(ngx_conf_t </em>cf);</p>
<p>static ngx_http_module_t  ngx_http_foo_header_filter_module_ctx = {<br>    NULL,                                   /<em> preconfiguration </em>/<br>    ngx_http_foo_header_filter_init,        /<em> postconfiguration </em>/</p>
<pre><code>NULL,                                   /* create main configuration */
NULL,                                   /* init main configuration */

NULL,                                   /* create server configuration */
NULL,                                   /* merge server configuration */

NULL,                                   /* create location configuration */
NULL                                    /* merge location configuration */
</code></pre><p>};</p>
<p>ngx_module_t  ngx_http_foo_header_filter_module = {<br>    NGX_MODULE_V1,<br>    &amp;ngx_http_foo_header_filter_module_ctx, /<em> module context </em>/<br>    NULL,                                   /<em> module directives </em>/<br>    NGX_HTTP_MODULE,                        /<em> module type </em>/<br>    NULL,                                   /<em> init master </em>/<br>    NULL,                                   /<em> init module </em>/<br>    NULL,                                   /<em> init process </em>/<br>    NULL,                                   /<em> init thread </em>/<br>    NULL,                                   /<em> exit thread </em>/<br>    NULL,                                   /<em> exit process </em>/<br>    NULL,                                   /<em> exit master </em>/<br>    NGX_MODULE_V1_PADDING<br>};</p>
<p>static ngx_http_output_header_filter_pt  ngx_http_next_header_filter;</p>
<p>static ngx_int_t<br>ngx_http_foo_header_filter(ngx_http_request_t <em>r)<br>{<br>    ngx_table_elt_t  </em>h;</p>
<pre><code>/*
 * The filter handler adds &quot;X-Foo: foo&quot; header
 * to every HTTP 200 response
 */

if (r-&amp;gt;headers_out.status != NGX_HTTP_OK) {
    return ngx_http_next_header_filter(r);
}

h = ngx_list_push(&amp;amp;r-&amp;gt;headers_out.headers);
if (h == NULL) {
    return NGX_ERROR;
}

h-&amp;gt;hash = 1;
ngx_str_set(&amp;amp;h-&amp;gt;key, &quot;X-Foo&quot;);
ngx_str_set(&amp;amp;h-&amp;gt;value, &quot;foo&quot;);

return ngx_http_next_header_filter(r);
</code></pre><p>}</p>
<p>static ngx_int_t<br>ngx_http_foo_header_filter_init(ngx_conf_t *cf)<br>{<br>    ngx_http_next_header_filter = ngx_http_top_header_filter;<br>    ngx_http_top_header_filter = ngx_http_foo_header_filter;</p>
<pre><code>return NGX_OK;
</code></pre><p>}<br></p></pre></blockquote><a name="http_response_body"></a><center><h4> Response body </h4></center><p> To send the response body, call the <code class="notranslate">ngx_http_output_filter(r, cl)</code> function. The function can be called multiple times. Each time, it sends a part of the response body in the form of a buffer chain. Set the <code class="notranslate">last_buf</code> flag in the last body buffer. </p><p> The following example produces a complete HTTP response with “foo” as its body. For the example to work as subrequest as well as a main request, the <code class="notranslate">last_in_chain</code> flag is set in the last buffer of the output. The <code class="notranslate">last_buf</code> flag is set only for the main request because the last buffer for a subrequest does not end the entire output. </p><blockquote class="example"><pre class="notranslate">static ngx_int_t<br>ngx_http_bar_content_handler(ngx_http_request_t <em>r)<br>{<br>    ngx_int_t     rc;<br>    ngx_buf_t    </em>b;<br>    ngx_chain_t   out;<p></p>
<pre><code>/* send header */

r-&amp;gt;headers_out.status = NGX_HTTP_OK;
r-&amp;gt;headers_out.content_length_n = 3;

rc = ngx_http_send_header(r);

if (rc == NGX_ERROR || rc &amp;gt; NGX_OK || r-&amp;gt;header_only) {
    return rc;
}

/* send body */

b = ngx_calloc_buf(r-&amp;gt;pool);
if (b == NULL) {
    return NGX_ERROR;
}

b-&amp;gt;last_buf = (r == r-&amp;gt;main) ? 1: 0;
b-&amp;gt;last_in_chain = 1;

b-&amp;gt;memory = 1;

b-&amp;gt;pos = (u_char *) &quot;foo&quot;;
b-&amp;gt;last = b-&amp;gt;pos + 3;

out.buf = b;
out.next = NULL;

return ngx_http_output_filter(r, &amp;amp;out);
</code></pre><p>}<br></p></pre></blockquote><a name="http_body_filters"></a><center><h4> Body filters </h4></center><p> The function <code class="notranslate">ngx_http_output_filter(r, cl)</code> invokes the body filter chain by calling the first body filter handler stored in the <code class="notranslate">ngx_http_top_body_filter</code> variable. It’s assumed that every body handler calls the next handler in the chain until the final handler <code class="notranslate">ngx_http_write_filter(r, cl)</code> is called. </p><p> A body filter handler receives a chain of buffers. The handler is supposed to process the buffers and pass a possibly new chain to the next handler. It’s worth noting that the chain links <code class="notranslate">ngx_chain_t</code> of the incoming chain belong to the caller, and must not be reused or changed. Right after the handler completes, the caller can use its output chain links to keep track of the buffers it has sent. To save the buffer chain or to substitute some buffers before passing to the next filter, a handler needs to allocate its own chain links. </p><p> Following is an example of a simple body filter that counts the number of bytes in the body. The result is available as the <code class="notranslate">$counter</code> variable which can be used in the access log. </p><blockquote class="example"><pre class="notranslate">#include &lt;ngx_config.h&gt;<p></p>
<p>#include &lt;ngx_core.h&gt;</p>
<p>#include &lt;ngx_http.h&gt;</p>
<p>typedef struct {<br>    off_t  count;<br>} ngx_http_counter_filter_ctx_t;</p>
<p>static ngx_int_t ngx_http_counter_body_filter(ngx_http_request_t <em>r,<br>    ngx_chain_t </em>in);<br>static ngx_int_t ngx_http_counter_variable(ngx_http_request_t <em>r,<br>    ngx_http_variable_value_t </em>v, uintptr_t data);<br>static ngx_int_t ngx_http_counter_add_variables(ngx_conf_t <em>cf);<br>static ngx_int_t ngx_http_counter_filter_init(ngx_conf_t </em>cf);</p>
<p>static ngx_http_module_t  ngx_http_counter_filter_module_ctx = {<br>    ngx_http_counter_add_variables,        /<em> preconfiguration </em>/<br>    ngx_http_counter_filter_init,          /<em> postconfiguration </em>/</p>
<pre><code>NULL,                                  /* create main configuration */
NULL,                                  /* init main configuration */

NULL,                                  /* create server configuration */
NULL,                                  /* merge server configuration */

NULL,                                  /* create location configuration */
NULL                                   /* merge location configuration */
</code></pre><p>};</p>
<p>ngx_module_t  ngx_http_counter_filter_module = {<br>    NGX_MODULE_V1,<br>    &amp;ngx_http_counter_filter_module_ctx,   /<em> module context </em>/<br>    NULL,                                  /<em> module directives </em>/<br>    NGX_HTTP_MODULE,                       /<em> module type </em>/<br>    NULL,                                  /<em> init master </em>/<br>    NULL,                                  /<em> init module </em>/<br>    NULL,                                  /<em> init process </em>/<br>    NULL,                                  /<em> init thread </em>/<br>    NULL,                                  /<em> exit thread </em>/<br>    NULL,                                  /<em> exit process </em>/<br>    NULL,                                  /<em> exit master </em>/<br>    NGX_MODULE_V1_PADDING<br>};</p>
<p>static ngx_http_output_body_filter_pt  ngx_http_next_body_filter;</p>
<p>static ngx_str_t  ngx_http_counter_name = ngx_string(“counter”);</p>
<p>static ngx_int_t<br>ngx_http_counter_body_filter(ngx_http_request_t <em>r, ngx_chain_t </em>in)<br>{<br>    ngx_chain_t                    <em>cl;<br>    ngx_http_counter_filter_ctx_t  </em>ctx;</p>
<pre><code>ctx = ngx_http_get_module_ctx(r, ngx_http_counter_filter_module);
if (ctx == NULL) {
    ctx = ngx_pcalloc(r-&amp;gt;pool, sizeof(ngx_http_counter_filter_ctx_t));
    if (ctx == NULL) {
        return NGX_ERROR;
    }

    ngx_http_set_ctx(r, ctx, ngx_http_counter_filter_module);
}

for (cl = in; cl; cl = cl-&amp;gt;next) {
    ctx-&amp;gt;count += ngx_buf_size(cl-&amp;gt;buf);
}

return ngx_http_next_body_filter(r, in);
</code></pre><p>}</p>
<p>static ngx_int_t<br>ngx_http_counter_variable(ngx_http_request_t <em>r, ngx_http_variable_value_t </em>v,<br>    uintptr_t data)<br>{<br>    u_char                         <em>p;<br>    ngx_http_counter_filter_ctx_t  </em>ctx;</p>
<pre><code>ctx = ngx_http_get_module_ctx(r, ngx_http_counter_filter_module);
if (ctx == NULL) {
    v-&amp;gt;not_found = 1;
    return NGX_OK;
}

p = ngx_pnalloc(r-&amp;gt;pool, NGX_OFF_T_LEN);
if (p == NULL) {
    return NGX_ERROR;
}

v-&amp;gt;data = p;
v-&amp;gt;len = ngx_sprintf(p, &quot;%O&quot;, ctx-&amp;gt;count) - p;
v-&amp;gt;valid = 1;
v-&amp;gt;no_cacheable = 0;
v-&amp;gt;not_found = 0;

return NGX_OK;
</code></pre><p>}</p>
<p>static ngx_int_t<br>ngx_http_counter_add_variables(ngx_conf_t <em>cf)<br>{<br>    ngx_http_variable_t  </em>var;</p>
<pre><code>var = ngx_http_add_variable(cf, &amp;amp;ngx_http_counter_name, 0);
if (var == NULL) {
    return NGX_ERROR;
}

var-&amp;gt;get_handler = ngx_http_counter_variable;

return NGX_OK;
</code></pre><p>}</p>
<p>static ngx_int_t<br>ngx_http_counter_filter_init(ngx_conf_t *cf)<br>{<br>    ngx_http_next_body_filter = ngx_http_top_body_filter;<br>    ngx_http_top_body_filter = ngx_http_counter_body_filter;</p>
<pre><code>return NGX_OK;
</code></pre><p>}<br></p></pre></blockquote><a name="http_building_filter_modules"></a><center><h4> Building filter modules </h4></center><p> When writing a body or header filter, pay special attention to the filter’s position in the filter order. There’s a number of header and body filters registered by nginx standard modules. The nginx standard modules register a number of head and body filters and it’s important to register a new filter module in the right place with respect to them. Normally, modules register filters in their postconfiguration handlers. The order in which filters are called during processing is obviously the reverse of the order in which they are registered. </p><p> For third-party filter modules nginx provides a special slot <code class="notranslate">HTTP_AUX_FILTER_MODULES</code> . To register a filter module in this slot, set the <code class="notranslate">ngx_module_type</code> variable to <code class="notranslate">HTTP_AUX_FILTER</code> in the module’s configuration. </p><p> The following example shows a filter module config file assuming for a module with just one source file, <code class="notranslate">ngx_http_foo_filter_module.c</code> . </p><blockquote class="example"><pre class="notranslate">ngx_module_type=HTTP_AUX_FILTER<br>ngx_module_name=ngx_http_foo_filter_module<br>ngx_module_srcs=”$ngx_addon_dir/ngx_http_foo_filter_module.c”<p></p>
<p>. auto/module<br></p></pre></blockquote><a name="http_body_buffers_reuse"></a><center><h4> Buffer reuse </h4></center><p> When issuing or altering a stream of buffers, it’s often desirable to reuse the allocated buffers. A standard and widely adopted approach in nginx code is to keep two buffer chains for this purpose: <code class="notranslate">free</code> and <code class="notranslate">busy</code> . The <code class="notranslate">free</code> chain keeps all free buffers, which can be reused. The <code class="notranslate">busy</code> chain keeps all buffers sent by the current module that are still in use by some other filter handler. A buffer is considered in use if its size is greater than zero. Normally, when a buffer is consumed by a filter, its <code class="notranslate">pos</code> (or <code class="notranslate">file_pos</code> for a file buffer) is moved towards <code class="notranslate">last</code> ( <code class="notranslate">file_last</code> for a file buffer). Once a buffer is completely consumed, it’s ready to be reused. To add newly freed buffers to the <code class="notranslate">free</code> chain it’s enough to iterate over the <code class="notranslate">busy</code> chain and move the zero size buffers at the head of it to <code class="notranslate">free</code> . This operation is so common that there is a special function for it, <code class="notranslate">ngx_chain_update_chains(free, busy, out, tag)</code> . The function appends the output chain <code class="notranslate">out</code> to <code class="notranslate">busy</code> and moves free buffers from the top of <code class="notranslate">busy</code> to <code class="notranslate">free</code> . Only the buffers with the specified <code class="notranslate">tag</code> are reused. This lets a module reuse only the buffers that it allocated itself. </p><p> The following example is a body filter that inserts the string “foo” before each incoming buffer. The new buffers allocated by the module are reused if possible. Note that for this example to work properly, setting up a <a hhref="#http_header_filters">header filter</a> and resetting <code class="notranslate">content_length_n</code> to <code class="notranslate">-1</code> is also required, but the relevant code is not provided here. </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    ngx_chain_t  <em>free;<br>    ngx_chain_t  </em>busy;<br>}  ngx_http_foo_filter_ctx_t;<p></p>
<p>ngx_int_t<br>ngx_http_foo_body_filter(ngx_http_request_t <em>r, ngx_chain_t </em>in)<br>{<br>    ngx_int_t                   rc;<br>    ngx_buf_t                  <em>b;<br>    ngx_chain_t                </em>cl, <em>tl, </em>out, <em>*ll;<br>    ngx_http_foo_filter_ctx_t  </em>ctx;</p>
<pre><code>ctx = ngx_http_get_module_ctx(r, ngx_http_foo_filter_module);
if (ctx == NULL) {
    ctx = ngx_pcalloc(r-&amp;gt;pool, sizeof(ngx_http_foo_filter_ctx_t));
    if (ctx == NULL) {
        return NGX_ERROR;
    }

    ngx_http_set_ctx(r, ctx, ngx_http_foo_filter_module);
}

/* create a new chain &quot;out&quot; from &quot;in&quot; with all the changes */

ll = &amp;amp;out;

for (cl = in; cl; cl = cl-&amp;gt;next) {

    /* append &quot;foo&quot; in a reused buffer if possible */

    tl = ngx_chain_get_free_buf(r-&amp;gt;pool, &amp;amp;ctx-&amp;gt;free);
    if (tl == NULL) {
        return NGX_ERROR;
    }

    b = tl-&amp;gt;buf;
    b-&amp;gt;tag = (ngx_buf_tag_t) &amp;amp;ngx_http_foo_filter_module;
    b-&amp;gt;memory = 1;
    b-&amp;gt;pos = (u_char *) &quot;foo&quot;;
    b-&amp;gt;last = b-&amp;gt;pos + 3;

    *ll = tl;
    ll = &amp;amp;tl-&amp;gt;next;

    /* append the next incoming buffer */

    tl = ngx_alloc_chain_link(r-&amp;gt;pool);
    if (tl == NULL) {
        return NGX_ERROR;
    }

    tl-&amp;gt;buf = cl-&amp;gt;buf;
    *ll = tl;
    ll = &amp;amp;tl-&amp;gt;next;
}

*ll = NULL;

/* send the new chain */

rc = ngx_http_next_body_filter(r, out);

/* update &quot;busy&quot; and &quot;free&quot; chains for reuse */

ngx_chain_update_chains(r-&amp;gt;pool, &amp;amp;ctx-&amp;gt;free, &amp;amp;ctx-&amp;gt;busy, &amp;amp;out,
                        (ngx_buf_tag_t) &amp;amp;ngx_http_foo_filter_module);

return rc;
</code></pre><p>}<br></p></pre></blockquote><a name="http_load_balancing"></a><center><h4>  负载均衡 </h4></center><p> The <a hhref="http/ngx_http_upstream_module.html">ngx_http_upstream_module</a> provides the basic functionality needed to pass requests to remote servers. Modules that implement specific protocols, such as HTTP or FastCGI, use this functionality. The module also provides an interface for creating custom load-balancing modules and implements a default round-robin method. </p><p> The <a hhref="http/ngx_http_upstream_module.html#least_conn">least_conn</a> and <a hhref="http/ngx_http_upstream_module.html#hash">hash</a> modules implement alternative load-balancing methods, but are actually implemented as extensions of the upstream round-robin module and share a lot of code with it, such as the representation of a server group. The <a hhref="http/ngx_http_upstream_module.html#keepalive">keepalive</a> module is an independent module that extends upstream functionality. </p><p> The <a hhref="http/ngx_http_upstream_module.html">ngx_http_upstream_module</a> can be configured explicitly by placing the corresponding <a hhref="http/ngx_http_upstream_module.html#upstream">upstream</a> block into the configuration file, or implicitly by using directives such as <a hhref="http/ngx_http_proxy_module.html#proxy_pass">proxy_pass</a> that accept a URL that gets evaluated at some point into a list of servers. The alternative load-balancing methods are available only with an explicit upstream configuration. The upstream module configuration has its own directive context <code class="notranslate">NGX_HTTP_UPS_CONF</code> . The structure is defined as follows: </p><blockquote class="example"><pre class="notranslate">struct ngx_http_upstream_srv_conf_s {<br>    ngx_http_upstream_peer_t         peer;<br>    void                           **srv_conf;<p></p>
<pre><code>ngx_array_t                     *servers;  /* ngx_http_upstream_server_t */

ngx_uint_t                       flags;
ngx_str_t                        host;
u_char                          *file_name;
ngx_uint_t                       line;
in_port_t                        port;
ngx_uint_t                       no_port;  /* unsigned no_port:1 */
</code></pre><p>#if (NGX_HTTP_UPSTREAM_ZONE)<br>    ngx_shm_zone_t                  *shm_zone;</p>
<p>#endif<br>};<br></p></pre></blockquote><p></p><ul class="compact"><li> <code class="notranslate">srv_conf</code> — Configuration context of upstream modules. </li><li> <code class="notranslate">servers</code> — Array of <code class="notranslate">ngx_http_upstream_server_t</code> , the result of parsing a set of <a hhref="http/ngx_http_upstream_module.html#server">server</a> directives in the <code class="notranslate">upstream</code> block. </li><li> <code class="notranslate">flags</code> — Flags that mostly mark which features are supported by the load-balancing method. The features are configured as parameters of the <a hhref="http/ngx_http_upstream_module.html#server">server</a> directive: <ul class="compact"><li> <code class="notranslate">NGX_HTTP_UPSTREAM_CREATE</code> — Distinguishes explicitly defined upstreams from those that are automatically created by the <a hhref="http/ngx_http_proxy_module.html#proxy_pass">proxy_pass</a> directive and “friends” (FastCGI, SCGI, etc.) </li><li> <code class="notranslate">NGX_HTTP_UPSTREAM_WEIGHT</code> — The “ <code class="notranslate">weight</code> ” parameter is supported </li><li> <code class="notranslate">NGX_HTTP_UPSTREAM_MAX_FAILS</code> — The “ <code class="notranslate">max_fails</code> ” parameter is supported </li><li> <code class="notranslate">NGX_HTTP_UPSTREAM_FAIL_TIMEOUT</code> — The “ <code class="notranslate">fail_timeout</code> ” parameter is supported </li><li> <code class="notranslate">NGX_HTTP_UPSTREAM_DOWN</code> — The “ <code class="notranslate">down</code> ” parameter is supported </li><li> <code class="notranslate">NGX_HTTP_UPSTREAM_BACKUP</code> — The “ <code class="notranslate">backup</code> ” parameter is supported </li><li> <code class="notranslate">NGX_HTTP_UPSTREAM_MAX_CONNS</code> — The “ <code class="notranslate">max_conns</code> ” parameter is supported </li></ul></li><li> <code class="notranslate">host</code> — Name of the upstream. </li><li> <code class="notranslate">file_name, line</code> — Name of the configuration file and the line where the <code class="notranslate">upstream</code> block is located. </li><li> <code class="notranslate">port</code> and <code class="notranslate">no_port</code> — Not used for explicitly defined upstream groups. </li><li> <code class="notranslate">shm_zone</code> — Shared memory zone used by this upstream group, if any. </li><li> <code class="notranslate">peer</code> — object that holds generic methods for initializing upstream configuration: <blockquote class="example"><pre class="notranslate">typedef struct {<br>    ngx_http_upstream_init_pt        init_upstream;<br>    ngx_http_upstream_init_peer_pt   init;<br>    void                            *data;<br>} ngx_http_upstream_peer_t;<br></pre></blockquote> A module that implements a load-balancing algorithm must set these methods and initialize private <code class="notranslate">data</code> . If <code class="notranslate">init_upstream</code> was not initialized during configuration parsing, <code class="notranslate">ngx_http_upstream_module</code> sets it to the default <code class="notranslate">ngx_http_upstream_init_round_robin</code> algorithm. <ul class="compact"><li> <code class="notranslate">init_upstream(cf, us)</code> — Configuration-time method responsible for initializing a group of servers and initializing the <code class="notranslate">init()</code> method in case of success. A typical load-balancing module uses a list of servers in the <code class="notranslate">upstream</code> block to create an efficient data structure that it uses and saves its own configuration to the <code class="notranslate">data</code> field. </li><li> <code class="notranslate">init(r, us)</code> — Initializes a per-request <code class="notranslate">ngx_http_upstream_peer_t.peer</code> structure that is used for load balancing (not to be confused with the <code class="notranslate">ngx_http_upstream_srv_conf_t.peer</code> described above which is per-upstream). It is passed as the <code class="notranslate">data</code> argument to all callbacks that deal with server selection. </li></ul></li></ul><p></p><p> When nginx has to pass a request to another host for processing, it uses the configured load-balancing method to obtain an address to connect to. The method is obtained from the <code class="notranslate">ngx_http_upstream_t.peer</code> object of type <code class="notranslate">ngx_peer_connection_t</code> : </p><blockquote class="example"><pre class="notranslate">struct ngx_peer_connection_s {<br>    …<p></p>
<pre><code>struct sockaddr                 *sockaddr;
socklen_t                        socklen;
ngx_str_t                       *name;

ngx_uint_t                       tries;

ngx_event_get_peer_pt            get;
ngx_event_free_peer_pt           free;
ngx_event_notify_peer_pt         notify;
void                            *data;
</code></pre><p>#if (NGX_SSL || NGX_COMPAT)<br>    ngx_event_set_peer_session_pt    set_session;<br>    ngx_event_save_peer_session_pt   save_session;</p>
<p>#endif</p>
<pre><code>...
</code></pre><p>};<br></p></pre></blockquote><p> The structure has the following fields: </p><ul class="compact"><li> <code class="notranslate">sockaddr</code> , <code class="notranslate">socklen</code> , <code class="notranslate">name</code> — Address of the upstream server to connect to; this is the output parameter of a load-balancing method. </li><li> <code class="notranslate">data</code> — The per-request data of a load-balancing method; keeps the state of the selection algorithm and usually includes the link to the upstream configuration. It is passed as an argument to all methods that deal with server selection (see <a hhref="#lb_method_get">below</a> ). </li><li> <code class="notranslate">tries</code> — Allowed <a hhref="http/ngx_http_proxy_module.html#proxy_next_upstream_tries">number</a> of attempts to connect to an upstream server. </li><li> <code class="notranslate">get</code> , <code class="notranslate">free</code> , <code class="notranslate">notify</code> , <code class="notranslate">set_session</code> , and <code class="notranslate">save_session</code> - Methods of the load-balancing module, described below. </li></ul><p></p><p> All methods accept at least two arguments: a peer connection object <code class="notranslate">pc</code> and the <code class="notranslate">data</code> created by <code class="notranslate">ngx_http_upstream_srv_conf_t.peer.init()</code> . Note that it might differ from <code class="notranslate">pc.data</code> due to “chaining” of load-balancing modules. </p><p></p><ul class="compact"><li id="lb_method_get"> <code class="notranslate">get(pc, data)</code> — The method called when the upstream module is ready to pass a request to an upstream server and needs to know its address. The method has to fill the <code class="notranslate">sockaddr</code> , <code class="notranslate">socklen</code> , and <code class="notranslate">name</code> fields of <code class="notranslate">ngx_peer_connection_t</code> structure. The return is one of: <ul class="compact"><li> <code class="notranslate">NGX_OK</code> — Server was selected. </li><li> <code class="notranslate">NGX_ERROR</code> — Internal error occurred. </li><li> <code class="notranslate">NGX_BUSY</code> — no servers are currently available. This can happen due to many reasons, including: the dynamic server group is empty, all servers in the group are in the failed state, or all servers in the group are already handling the maximum number of connections. </li><li> <code class="notranslate">NGX_DONE</code> — the underlying connection was reused and there is no need to create a new connection to the upstream server. This value is set by the <code class="notranslate">keepalive</code> module. </li></ul></li><li> <code class="notranslate">free(pc, data, state)</code> — The method called when an upstream module has finished work with a particular server. The <code class="notranslate">state</code> argument is the completion status of the upstream connection, a bitmask with the following possible values: <ul class="compact"><li> <code class="notranslate">NGX_PEER_FAILED</code> — Attempt was <a hhref="http/ngx_http_upstream_module.html#max_fails">unsuccessful</a> </li><li> <code class="notranslate">NGX_PEER_NEXT</code> — A special case when upstream server returns codes <code class="notranslate">403</code> or <code class="notranslate">404</code> , which are not considered a <a hhref="http/ngx_http_upstream_module.html#max_fails">failure</a> . </li><li> <code class="notranslate">NGX_PEER_KEEPALIVE</code> — Currently unused </li></ul> This method also decrements the <code class="notranslate">tries</code> counter. </li><li> <code class="notranslate">notify(pc, data, type)</code> — Currently unused in the OSS version. </li><li> <code class="notranslate">set_session(pc, data)</code> and <code class="notranslate">save_session(pc, data)</code> — SSL-specific methods that enable caching sessions to upstream servers. The implementation is provided by the round-robin balancing method. </li></ul><p></p><a name="examples"></a><center><h4>  例子 </h4></center><p> The <a hhref="http://hg.nginx.org/nginx-dev-examples">nginx-dev-examples</a> repository provides nginx module examples. </p><a name="code_style"></a><center><h4> Code style </h4></center><a name="code_style_general_rules"></a><center><h4> General rules </h4></center><p></p><ul class="compact"><li> maximum text width is 80 characters </li><li> indentation is 4 spaces </li><li> no tabs, no trailing spaces </li><li> list elements on the same line are separated with spaces </li><li> hexadecimal literals are lowercase </li><li> file names, function and type names, and global variables have the <code class="notranslate">ngx_</code> or more specific prefix such as <code class="notranslate">ngx<em>http</em></code> and <code class="notranslate">ngx<em>mail</em></code> </li></ul><p></p><blockquote class="example"><pre class="notranslate">size_t<br>ngx_utf8_length(u_char <em>p, size_t n)<br>{<br>    u_char  c, </em>last;<br>    size_t  len;<p></p>
<pre><code>last = p + n;

for (len = 0; p &amp;lt; last; len++) {

    c = *p;

    if (c &amp;lt; 0x80) {
        p++;
        continue;
    }

    if (ngx_utf8_decode(&amp;amp;p, n) &amp;gt; 0x10ffff) {
        /* invalid UTF-8 */
        return n;
    }
}

return len;
</code></pre><p>}<br></p></pre></blockquote><p></p><a name="code_style_files"></a><center><h4>  档 </h4></center><p> A typical source file may contain the following sections separated by two empty lines: </p><ul class="compact"><li> copyright statements </li><li>  包括 </li><li> preprocessor definitions </li><li> type definitions </li><li> function prototypes </li><li> variable definitions </li><li> function definitions </li></ul><p></p><p> Copyright statements look like this: </p><blockquote class="example"><pre class="notranslate">/*<p></p>
<ul>
<li>Copyright (C) Author Name</li>
<li>Copyright (C) Organization, Inc.<br>*/<br></li></ul></pre></blockquote><p> If the file is modified significantly, the list of authors should be updated, the new author is added to the top. </p><p> The <code class="notranslate">ngx_config.h</code> and <code class="notranslate">ngx_core.h</code> files are always included first, followed by one of <code class="notranslate">ngx_http.h</code> , <code class="notranslate">ngx_stream.h</code> , or <code class="notranslate">ngx_mail.h</code> . Then follow optional external header files: </p><blockquote class="example"><pre class="notranslate">#include &lt;ngx_config.h&gt;<br>#include &lt;ngx_core.h&gt;<br>#include &lt;ngx_http.h&gt;

<p>#include &lt;libxml/parser.h&gt;</p>
<p>#include &lt;libxml/tree.h&gt;</p>
<p>#include &lt;libxslt/xslt.h&gt;</p>
<p>#if (NGX_HAVE_EXSLT)</p>
<p>#include &lt;libexslt/exslt.h&gt;</p>
<p>#endif<br></p></pre></blockquote><p></p><p> Header files should include the so called “header protection”: </p><blockquote class="example"><pre class="notranslate">#ifndef _NGX_PROCESS_CYCLE_H<em>INCLUDED</em><p></p>
<p>#define _NGX_PROCESS_CYCLE_H<em>INCLUDED</em><br>…</p>
<p>#endif /<em> _NGX_PROCESS_CYCLE_H<em>INCLUDED</em> </em>/<br></p></pre></blockquote><p></p><a name="code_style_comments"></a><center><h4>  评论 </h4></center><p></p><ul class="compact"><li> “ <code class="notranslate">//</code> ” comments are not used </li><li> text is written in English, American spelling is preferred </li><li> multi-line comments are formatted like this: <blockquote class="example"><pre class="notranslate">/*<p></p>
<ul>
<li>The red-black tree code is based on the algorithm described in</li>
<li>the “Introduction to Algorithms” by Cormen, Leiserson and Rivest.<br><em>/<br></em></li></ul></pre></blockquote><blockquote class="example"><pre class="notranslate">/ find the server configuration for the address:port */<br></pre></blockquote></li></ul><p></p><a name="code_style_preprocessor"></a><center><h4>  预处理器 </h4></center><p> Macro names start from <code class="notranslate">ngx<em></em></code> or <code class="notranslate">NGX</code> (or more specific) prefix. Macro names for constants are uppercase. Parameterized macros and macros for initializers are lowercase. The macro name and value are separated by at least two spaces: </p><blockquote class="example"><pre class="notranslate">#define NGX_CONF_BUFFER  4096

<p>#define ngx_buf_in_memory(b)  (b-&gt;temporary || b-&gt;memory || b-&gt;mmap)</p>
<p>#define ngx_buf_size(b)                                                      \<br>    (ngx_buf_in_memory(b) ? (off_t) (b-&gt;last - b-&gt;pos):                      \<br>                            (b-&gt;file_last - b-&gt;file_pos))</p>
<p>#define ngx_null_string  { 0, NULL }<br></p></pre></blockquote><p> Conditions are inside parentheses, negation is outside: </p><blockquote class="example"><pre class="notranslate">#if (NGX_HAVE_KQUEUE)<br>…<p></p>
<p>#elif ((NGX_HAVE_DEVPOLL &amp;&amp; !(NGX_TEST_BUILD_DEVPOLL)) \<br>       || (NGX_HAVE_EVENTPORT &amp;&amp; !(NGX_TEST_BUILD_EVENTPORT)))<br>…</p>
<p>#elif (NGX_HAVE_EPOLL &amp;&amp; !(NGX_TEST_BUILD_EPOLL))<br>…</p>
<p>#elif (NGX_HAVE_POLL)<br>…</p>
<p>#else /<em> select </em>/<br>…</p>
<p>#endif /<em> NGX_HAVE_KQUEUE </em>/<br></p></pre></blockquote><p></p><a name="code_style_types"></a><center><h4>  类型 </h4></center><p> Type names end with the “ <code class="notranslate">_t</code> ” suffix. A defined type name is separated by at least two spaces: </p><blockquote class="example"><pre class="notranslate">typedef ngx_uint_t  ngx_rbtree_key_t;<br></pre></blockquote><p></p><p> Structure types are defined using <code class="notranslate">typedef</code> . Inside structures, member types and names are aligned: </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    size_t      len;<br>    u_char     *data;<br>} ngx_str_t;<br></pre></blockquote><p> Keep alignment identical among different structures in the file. A structure that points to itself has the name, ending with “ <code class="notranslate">_s</code> ”. Adjacent structure definitions are separated with two empty lines: </p><blockquote class="example"><pre class="notranslate">typedef struct ngx_list_part_s  ngx_list_part_t;<p></p>
<p>struct ngx_list_part_s {<br>    void             <em>elts;<br>    ngx_uint_t        nelts;<br>    ngx_list_part_t  </em>next;<br>};</p>
<p>typedef struct {<br>    ngx_list_part_t  <em>last;<br>    ngx_list_part_t   part;<br>    size_t            size;<br>    ngx_uint_t        nalloc;<br>    ngx_pool_t       </em>pool;<br>} ngx_list_t;<br></p></pre></blockquote><p> Each structure member is declared on its own line: </p><blockquote class="example"><pre class="notranslate">typedef struct {<br>    ngx_uint_t        hash;<br>    ngx_str_t         key;<br>    ngx_str_t         value;<br>    u_char           <em>lowcase_key;<br>} ngx_table_elt_t;<br></em></pre></blockquote><p></p><p> Function pointers inside structures have defined types ending with “ <code class="notranslate">_pt</code> ”: </p><blockquote class="example"><pre class="notranslate">typedef ssize_t (ngx_recv_pt)(ngx_connection_t <em>c, u_char </em>buf, size_t size);<br>typedef ssize_t (<em>ngx_recv_chain_pt)(ngx_connection_t </em>c, ngx_chain_t <em>in,<br>    off_t limit);<br>typedef ssize_t (</em>ngx_send_pt)(ngx_connection_t <em>c, u_char </em>buf, size_t size);<br>typedef ngx_chain_t <em>(</em>ngx_send_chain_pt)(ngx_connection_t <em>c, ngx_chain_t </em>in,<br>    off_t limit);<p></p>
<p>typedef struct {<br>    ngx_recv_pt        recv;<br>    ngx_recv_chain_pt  recv_chain;<br>    ngx_recv_pt        udp_recv;<br>    ngx_send_pt        send;<br>    ngx_send_pt        udp_send;<br>    ngx_send_chain_pt  udp_send_chain;<br>    ngx_send_chain_pt  send_chain;<br>    ngx_uint_t         flags;<br>} ngx_os_io_t;<br></p></pre></blockquote><p></p><p> Enumerations have types ending with “ <code class="notranslate">_e</code> ”: </p><blockquote class="example"><pre class="notranslate">typedef enum {<br>    ngx_http_fastcgi_st_version = 0,<br>    ngx_http_fastcgi_st_type,<br>    …<br>    ngx_http_fastcgi_st_padding<br>} ngx_http_fastcgi_state_e;<br></pre></blockquote><p></p><a name="code_style_variables"></a><center><h4>  变量 </h4></center><p> Variables are declared sorted by length of a base type, then alphabetically. Type names and variable names are aligned. The type and name “columns” are separated with two spaces. Large arrays are put at the end of a declaration block: </p><blockquote class="example"><pre class="notranslate">u_char                      |  | <em>rv, </em>p;<br>ngx_conf_t                  |  | <em>cf;<br>ngx_uint_t                  |  |  i, j, k;<br>unsigned int                |  |  len;<br>struct sockaddr             |  | </em>sa;<br>const unsigned char         |  | <em>data;<br>ngx_peer_connection_t       |  | </em>pc;<br>ngx_http_core_srv_conf_t    |  |<em>*cscfp;<br>ngx_http_upstream_srv_conf_t|  | </em>us, <em>uscf;<br>u_char                      |  |  text[NGX_SOCKADDR_STRLEN];<br></em></pre></blockquote><p></p><p> Static and global variables may be initialized on declaration: </p><blockquote class="example"><pre class="notranslate">static ngx_str_t  ngx_http_memcached_key = ngx_string(“memcached_key”);<br></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate">static ngx_uint_t  mday[] = { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };<br></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate">static uint32_t  ngx_crc32_table16[] = {<br>    0x00000000, 0x1db71064, 0x3b6e20c8, 0x26d930ac,<br>    …<br>    0x9b64c2b0, 0x86d3d2d4, 0xa00ae278, 0xbdbdf21c<br>};<br></pre></blockquote><p></p><p> There is a bunch of commonly used type/name combinations: </p><blockquote class="example"><pre class="notranslate">u_char                        rv;<br>ngx_int_t                      rc;<br>ngx_conf_t                    <em>cf;<br>ngx_connection_t              </em>c;<br>ngx_http_request_t            <em>r;<br>ngx_peer_connection_t         </em>pc;<br>ngx_http_upstream_srv_conf_t  <em>us, </em>uscf;<br></pre></blockquote><p></p><a name="code_style_functions"></a><center><h4>  功能 </h4></center><p> All functions (even static ones) should have prototypes. Prototypes include argument names. Long prototypes are wrapped with a single indentation on continuation lines: </p><blockquote class="example"><pre class="notranslate">static char <em>ngx_http_block(ngx_conf_t </em>cf, ngx_command_t <em>cmd, void </em>conf);<br>static ngx_int_t ngx_http_init_phases(ngx_conf_t <em>cf,<br>    ngx_http_core_main_conf_t </em>cmcf);<p></p>
<p>static char <em>ngx_http_merge_servers(ngx_conf_t </em>cf,<br>    ngx_http_core_main_conf_t <em>cmcf, ngx_http_module_t </em>module,<br>    ngx_uint_t ctx_index);<br></p></pre></blockquote><p> The function name in a definition starts with a new line. The function body opening and closing braces are on separate lines. The body of a function is indented. There are two empty lines between functions: </p><blockquote class="example"><pre class="notranslate">static ngx_int_t<br>ngx_http_find_virtual_server(ngx_http_request_t <em>r, u_char </em>host, size_t len)<br>{<br>    …<br>}<p></p>
<p>static ngx_int_t<br>ngx_http_add_addresses(ngx_conf_t <em>cf, ngx_http_core_srv_conf_t </em>cscf,<br>    ngx_http_conf_port_t <em>port, ngx_http_listen_opt_t </em>lsopt)<br>{<br>    …<br>}<br></p></pre></blockquote><p> There is no space after the function name and opening parenthesis. Long function calls are wrapped such that continuation lines start from the position of the first function argument. If this is impossible, format the first continuation line such that it ends at position 79: </p><blockquote class="example"><pre class="notranslate">ngx_log_debug2(NGX_LOG_DEBUG_HTTP, r-&gt;connection-&gt;log, 0,<br>               “http header: \”%V: %V\””,<br>               &amp;h-&gt;key, &amp;h-&gt;value);<p></p>
<p>hc-&gt;busy = ngx_palloc(r-&gt;connection-&gt;pool,<br>                  cscf-&gt;large_client_header_buffers.num <em> sizeof(ngx_buf_t </em>));<br></p></pre></blockquote><p> The <code class="notranslate">ngx_inline</code> macro should be used instead of <code class="notranslate">inline</code> : </p><blockquote class="example"><pre class="notranslate">static ngx_inline void ngx_cpuid(uint32_t i, uint32_t <em>buf);<br></em></pre></blockquote><p></p><a name="code_style_expressions"></a><center><h4>  表达式 </h4></center><p> Binary operators except “ <code class="notranslate">.</code> ” and “ <code class="notranslate">−&gt;</code> ” should be separated from their operands by one space. Unary operators and subscripts are not separated from their operands by spaces: </p><blockquote class="example"><pre class="notranslate">width = width  10 + (<em>fmt++ - ‘0’);<br></em></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate">ch = (u_char) ((decoded &lt;&lt; 4) + (ch - ‘0’));<br></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate">r-&gt;exten.data = &amp;r-&gt;uri.data[i + 1];<br></pre></blockquote><p></p><p> Type casts are separated by one space from casted expressions. An asterisk inside type cast is separated with space from type name: </p><blockquote class="example"><pre class="notranslate">len = ngx_sock_ntop((struct sockaddr ) sin6, p, len, 1);<br></pre></blockquote><p></p><p> If an expression does not fit into single line, it is wrapped. The preferred point to break a line is a binary operator. The continuation line is lined up with the start of expression: </p><blockquote class="example"><pre class="notranslate">if (status == NGX_HTTP_MOVED_PERMANENTLY<br>    || status == NGX_HTTP_MOVED_TEMPORARILY<br>    || status == NGX_HTTP_SEE_OTHER<br>    || status == NGX_HTTP_TEMPORARY_REDIRECT<br>    || status == NGX_HTTP_PERMANENT_REDIRECT)<br>{<br>    …<br>}<br></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate">p-&gt;temp_file-&gt;warn = “an upstream response is buffered “<br>                     “to a temporary file”;<br></pre></blockquote><p> As a last resort, it is possible to wrap an expression so that the continuation line ends at position 79: </p><blockquote class="example"><pre class="notranslate">hinit-&gt;hash = ngx_pcalloc(hinit-&gt;pool, sizeof(ngx_hash_wildcard_t)<p></p>
<pre><code>+ size * sizeof(ngx_hash_elt_t *));
</code></pre><p></p></pre></blockquote><p> The above rules also apply to sub-expressions, where each sub-expression has its own indentation level: </p><blockquote class="example"><pre class="notranslate">if (((u-&gt;conf-&gt;cache_use_stale &amp; NGX_HTTP_UPSTREAM_FT_UPDATING)<br>     || c-&gt;stale_updating) &amp;&amp; !r-&gt;background<br>    &amp;&amp; u-&gt;conf-&gt;cache_background_update)<br>{<br>    …<br>}<br></pre></blockquote><p> Sometimes, it is convenient to wrap an expression after a cast. In this case, the continuation line is indented: </p><blockquote class="example"><pre class="notranslate">node = (ngx_rbtree_node_t <em>)<br>           ((u_char </em>) lr - offsetof(ngx_rbtree_node_t, color));<br></pre></blockquote><p></p><p> Pointers are explicitly compared to <code class="notranslate">NULL</code> (not <code class="notranslate">0</code> ): </p><blockquote class="example"><pre class="notranslate">if (ptr != NULL) {<br>    …<br>}<br></pre></blockquote><p></p><a name="code_style_conditionals_and_loops"></a><center><h4> Conditionals and Loops </h4></center><p> The “ <code class="notranslate">if</code> ” keyword is separated from the condition by one space. Opening brace is located on the same line, or on a dedicated line if the condition takes several lines. Closing brace is located on a dedicated line, optionally followed by “ <code class="notranslate">else if</code> / <code class="notranslate">else</code> ”. Usually, there is an empty line before the “ <code class="notranslate">else if</code> / <code class="notranslate">else</code> ” part: </p><blockquote class="example"><pre class="notranslate">if (node-&gt;left == sentinel) {<br>    temp = node-&gt;right;<br>    subst = node;<p></p>
<p>} else if (node-&gt;right == sentinel) {<br>    temp = node-&gt;left;<br>    subst = node;</p>
<p>} else {<br>    subst = ngx_rbtree_min(node-&gt;right, sentinel);</p>
<pre><code>if (subst-&amp;gt;left != sentinel) {
    temp = subst-&amp;gt;left;

} else {
    temp = subst-&amp;gt;right;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p> Similar formatting rules are applied to “ <code class="notranslate">do</code> ” and “ <code class="notranslate">while</code> ” loops: </p><blockquote class="example"><pre class="notranslate">while (p &lt; last &amp;&amp; *p == ‘ ‘) {<br>    p++;<br>}<br></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate">do {<br>    ctx-&gt;node = rn;<br>    ctx = ctx-&gt;next;<br>} while (ctx);<br></pre></blockquote><p></p><p> The “ <code class="notranslate">switch</code> ” keyword is separated from the condition by one space. Opening brace is located on the same line. Closing brace is located on a dedicated line. The “ <code class="notranslate">case</code> ” keywords are lined up with “ <code class="notranslate">switch</code> ”: </p><blockquote class="example"><pre class="notranslate">switch (ch) {<br>case ‘!’:<br>    looked = 2;<br>    state = ssi_comment0_state;<br>    break;<p></p>
<p>case ‘&lt;’:<br>    copy_end = p;<br>    break;</p>
<p>default:<br>    copy_end = p;<br>    looked = 0;<br>    state = ssi_start_state;<br>    break;<br>}<br></p></pre></blockquote><p></p><p> Most “ <code class="notranslate">for</code> ” loops are formatted like this: </p><blockquote class="example"><pre class="notranslate">for (i = 0; i &lt; ccf-&gt;env.nelts; i++) {<br>    …<br>}<br></pre></blockquote><p></p><blockquote class="example"><pre class="notranslate">for (q = ngx_queue_head(locations);<br>     q != ngx_queue_sentinel(locations);<br>     q = ngx_queue_next(q))<br>{<br>    …<br>}<br></pre></blockquote><p> If some part of the “ <code class="notranslate">for</code> ” statement is omitted, this is indicated by the “ <code class="notranslate">/<em> void </em>/</code> ” comment: </p><blockquote class="example"><pre class="notranslate">for (i = 0; /<em> void </em>/ ; i++) {<br>    …<br>}<br></pre></blockquote><p> A loop with an empty body is also indicated by the “ <code class="notranslate">/<em> void </em>/</code> ” comment which may be put on the same line: </p><blockquote class="example"><pre class="notranslate">for (cl = <em>busy; cl-&gt;next; cl = cl-&gt;next) { /</em> void */ }<br></pre></blockquote><p> An endless loop looks like this: </p><blockquote class="example"><pre class="notranslate">for ( ;; ) {<br>    …<br>}<br></pre></blockquote><p></p><a name="code_style_labels"></a><center><h4>  标签 </h4></center><p> Labels are surrounded with empty lines and are indented at the previous level: </p><blockquote class="example"><pre class="notranslate">    if (i == 0) {<br>        u-&gt;err = “host not found”;<br>        goto failed;<br>    }<p></p>
<pre><code>u-&amp;gt;addrs = ngx_pcalloc(pool, i * sizeof(ngx_addr_t));
if (u-&amp;gt;addrs == NULL) {
    goto failed;
}

u-&amp;gt;naddrs = i;

...

return NGX_OK;
</code></pre><p>failed:</p>
<pre><code>freeaddrinfo(res);
return NGX_ERROR;
</code></pre><p></p></pre></blockquote><p></p> <p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/windows.html</url>
      <content type="html"><![CDATA[<p></p><h2>  适用于Windows的nginx </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#known_issues">Known issues</a> <br> <a hhref="#possible_future_enhancements">Possible future enhancements</a> <br></td></tr></tbody></table><p>  适用于Windows的nginx版本使用本机Win32 API（而不是Cygwin仿真层）。  目前仅使用<code class="notranslate">select()</code>连接处理方法，因此不应期望高性能和可伸缩性。  由于这个以及一些其他已知问题，nginx for Windows的版本被认为是<i>测试</i>版。  目前，除了XSLT过滤器，图像过滤器，GeoIP模块和嵌入式Perl语言之外，它提供的功能几乎与UNIX版本的nginx相同。 </p><p>  要安装nginx / Windows，请<a hhref="download.html">下载</a>最新的主线版本发行版（1.15.7），因为nginx的主线分支包含所有已知的修复程序。  然后解压缩发行版，转到nginx-1.15.7目录，然后运行<code class="notranslate">nginx</code> 。  以下是驱动器C：根目录的示例： </p><blockquote class="example"><pre class="notranslate">cd c:\<br>unzip nginx-1.15.7.zip<br>cd nginx-1.15.7<br>start nginx<br></pre></blockquote><p>  运行<code class="notranslate">tasklist</code>命令行实用程序以查看nginx进程： </p><blockquote class="example"><pre class="notranslate">C:\nginx-1.15.7&gt;tasklist /fi “imagename eq nginx.exe”<p></p>
<p>Image Name           PID Session Name     Session#    Mem Usage<br>=============== ======== ============== ========== ============<br>nginx.exe            652 Console                 0      2 780 K<br>nginx.exe           1332 Console                 0      3 112 K<br></p></pre></blockquote><p>  其中一个进程是主进程，另一个进程是工作进程。  如果nginx未启动，请在错误日志文件<code class="notranslate">logs\error.log</code>查找原因。  如果尚未创建日志文件，则应在Windows事件日志中报告其原因。  如果显示错误页面而不是预期页面，还要在<code class="notranslate">logs\error.log</code>文件中查找原因。 </p><p>   nginx / Windows使用运行它的目录作为配置中相对路径的前缀。  在上面的示例中，前缀为<code class="notranslate">C:\nginx-1.15.7\</code> 。  必须使用正斜杠以UNIX样式指定配置文件中的路径： </p><blockquote class="example"><pre class="notranslate">access_log   logs/site.log;<br>root         C:/web/html;<br></pre></blockquote><p></p><p>   nginx / Windows作为标准控制台应用程序（而非服务）运行，可以使用以下命令进行管理： </p><blockquote><table width="100%"><tbody><tr><td width="20%" class="notranslate">nginx -s stop</td><td class="notranslate">fast shutdown</td></tr><tr><td class="notranslate">nginx -s quit</td><td class="notranslate">graceful shutdown</td></tr><tr><td class="notranslate">nginx -s reload</td><td class="notranslate"><br>changing configuration,<br>starting new worker processes with a new configuration,<br>graceful shutdown of old worker processes<br></td></tr><tr><td class="notranslate">nginx -s reopen</td><td class="notranslate">re-opening log files</td></tr></tbody></table></blockquote><p></p><a name="known_issues"></a><center><h4>  已知的问题 </h4></center><ul class="compact"><li>  虽然可以启动几个工作人员，但实际上只有一个工作。 </li><li>  一个worker可以处理不超过1024个并发连接。 </li><li>  不支持UDP代理功能。 </li></ul><a name="possible_future_enhancements"></a><center><h4>  可能的未来增强功能 </h4></center><ul class="compact"><li>  作为服务运行。 </li><li>  使用I / O完成端口作为连接处理方法。 </li><li>  在单个工作进程中使用多个工作线程。 </li></ul><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/varindex.html</url>
      <content type="html"><![CDATA[<p></p><h2>  按字母顺序排列的变量索引 </h2><p>   <a hhref="http/ngx_http_browser_module.html#var_ancient_browser">$ ancient_browser</a> <br>   <a hhref="http/ngx_http_core_module.html#var_arg_">$ arg_</a> <br>   <a hhref="http/ngx_http_core_module.html#var_args">的$ args</a> <br>   <a hhref="http/ngx_http_core_module.html#var_binary_remote_addr">$ binary_remote_addr</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_binary_remote_addr">$ binary_remote_addr</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_body_bytes_sent">$ body_bytes_sent</a> <br>   <a hhref="stream/ngx_stream_core_module.html#var_bytes_received">$ bytes_received</a> <br>   <a hhref="http/ngx_http_core_module.html#var_bytes_sent">$ bytes_sent</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_bytes_sent">$ bytes_sent</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_bytes_sent">$ bytes_sent</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_connection">$ connection</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_connection">$ connection</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_connection">$ connection</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_connection_requests">$ connection_requests</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_connection_requests">$ connection_requests</a> （ngx_http_log_module） <br>   <a hhref="http/ngx_http_stub_status_module.html#var_connections_active">$ connections_active</a> <br>   <a hhref="http/ngx_http_stub_status_module.html#var_connections_reading">$ connections_reading</a> <br>   <a hhref="http/ngx_http_stub_status_module.html#var_connections_waiting">$ connections_waiting</a> <br>   <a hhref="http/ngx_http_stub_status_module.html#var_connections_writing">$ connections_writing</a> <br>   <a hhref="http/ngx_http_core_module.html#var_content_length">$ CONTENT_LENGTH</a> <br>   <a hhref="http/ngx_http_core_module.html#var_content_type">$ CONTENT_TYPE</a> <br>   <a hhref="http/ngx_http_core_module.html#var_cookie_">$ cookie_</a> <br>   <a hhref="http/ngx_http_ssi_module.html#var_date_gmt">$ date_gmt</a> <br>   <a hhref="http/ngx_http_ssi_module.html#var_date_local">$ DATE_LOCAL</a> <br>   <a hhref="http/ngx_http_core_module.html#var_document_root">$ DOCUMENT_ROOT</a> <br>   <a hhref="http/ngx_http_core_module.html#var_document_uri">$ DOCUMENT_URI</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#var_fastcgi_path_info">$ fastcgi_path_info</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#var_fastcgi_script_name">$ fastcgi_script_name</a> <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_area_code">$ geoip_area_code</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_area_code">$ geoip_area_code</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_city">$ geoip_city</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_city">$ geoip_city</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_city_continent_code">$ geoip_city_continent_code</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_city_continent_code">$ geoip_city_continent_code</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_city_country_code">$ geoip_city_country_code</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_city_country_code">$ geoip_city_country_code</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_city_country_code3">$ geoip_city_country_code3</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_city_country_code3">$ geoip_city_country_code3</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_city_country_name">$ geoip_city_country_name</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_city_country_name">$ geoip_city_country_name</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_country_code">$ geoip_country_code</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_country_code">$ geoip_country_code</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_country_code3">$ geoip_country_code3</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_country_code3">$ geoip_country_code3</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_country_name">$ geoip_country_name</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_country_name">$ geoip_country_name</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_dma_code">$ geoip_dma_code</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_dma_code">$ geoip_dma_code</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_latitude">$ geoip_latitude</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_latitude">$ geoip_latitude</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_longitude">$ geoip_longitude</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_longitude">$ geoip_longitude</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_org">$ geoip_org</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_org">$ geoip_org</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_postal_code">$ geoip_postal_code</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_postal_code">$ geoip_postal_code</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_region">$ geoip_region</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_region">$ geoip_region</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#var_geoip_region_name">$ geoip_region_name</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#var_geoip_region_name">$ geoip_region_name</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_gzip_module.html#var_gzip_ratio">$ gzip_ratio</a> <br>   <a hhref="http/ngx_http_core_module.html#var_host">$主机</a> <br>   <a hhref="http/ngx_http_core_module.html#var_hostname">$ hostname</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_hostname">$ hostname</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_v2_module.html#var_http2">$ http2</a> <br>   <a hhref="http/ngx_http_core_module.html#var_http_">$ HTTP</a> <br>   <a hhref="http/ngx_http_core_module.html#var_https">$ HTTPS</a> <br>   <a hhref="http/ngx_http_referer_module.html#var_invalid_referer">$ invalid_referer</a> <br>   <a hhref="http/ngx_http_core_module.html#var_is_args">$ is_args</a> <br>   <a hhref="http/ngx_http_auth_jwt_module.html#var_jwt_claim_">$ jwt<em>claim</em></a> <br>   <a hhref="http/ngx_http_auth_jwt_module.html#var_jwt_header_">$ jwt<em>header</em></a> <br>   <a hhref="http/ngx_http_core_module.html#var_limit_rate">$ limit_rate</a> <br>   <a hhref="http/ngx_http_memcached_module.html#var_memcached_key">$ memcached_key</a> <br>   <a hhref="http/ngx_http_browser_module.html#var_modern_browser">$ modern_browser</a> <br>   <a hhref="http/ngx_http_core_module.html#var_msec">$ msec</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_msec">$ msec</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_msec">$ msec</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_browser_module.html#var_msie">$ MSIE</a> <br>   <a hhref="http/ngx_http_core_module.html#var_nginx_version">$ nginx_version</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_nginx_version">$ nginx_version</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_pid">$ pid</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_pid">$ pid</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_pipe">$ pipe</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_pipe">$ pipe</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_protocol">$协议</a> <br>   <a hhref="http/ngx_http_proxy_module.html#var_proxy_add_x_forwarded_for">$ proxy_add_x_forwarded_for</a> <br>   <a hhref="http/ngx_http_proxy_module.html#var_proxy_host">$ proxy_host使用</a> <br>   <a hhref="http/ngx_http_proxy_module.html#var_proxy_port">话$ proxy_port</a> <br>   <a hhref="http/ngx_http_core_module.html#var_proxy_protocol_addr">$ proxy_protocol_addr</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_proxy_protocol_addr">$ proxy_protocol_addr</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_proxy_protocol_port">$ proxy_protocol_port</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_proxy_protocol_port">$ proxy_protocol_port</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_query_string">$ QUERY_STRING</a> <br>   <a hhref="http/ngx_http_realip_module.html#var_realip_remote_addr">$ realip_remote_addr</a> （ngx_http_realip_module） <br>   <a hhref="stream/ngx_stream_realip_module.html#var_realip_remote_addr">$ realip_remote_addr</a> （ngx_stream_realip_module） <br>   <a hhref="http/ngx_http_realip_module.html#var_realip_remote_port">$ realip_remote_port</a> （ngx_http_realip_module） <br>   <a hhref="stream/ngx_stream_realip_module.html#var_realip_remote_port">$ realip_remote_port</a> （ngx_stream_realip_module） <br>   <a hhref="http/ngx_http_core_module.html#var_realpath_root">$ realpath_root</a> <br>   <a hhref="http/ngx_http_core_module.html#var_remote_addr">$ remote_addr</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_remote_addr">$ remote_addr</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_remote_port">$ remote_port</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_remote_port">$ remote_port</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_remote_user">$ REMOTE_USER</a> <br>   <a hhref="http/ngx_http_core_module.html#var_request">$请求</a> <br>   <a hhref="http/ngx_http_core_module.html#var_request_body">$ request_body</a> <br>   <a hhref="http/ngx_http_core_module.html#var_request_body_file">$ REQUEST_BODY_FILE</a> <br>   <a hhref="http/ngx_http_core_module.html#var_request_completion">$ request_completion</a> <br>   <a hhref="http/ngx_http_core_module.html#var_request_filename">$ REQUEST_FILENAME</a> <br>   <a hhref="http/ngx_http_core_module.html#var_request_id">$ REQUEST_ID</a> <br>   <a hhref="http/ngx_http_core_module.html#var_request_length">$ request_length</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_request_length">$ request_length</a> （ngx_http_log_module） <br>   <a hhref="http/ngx_http_core_module.html#var_request_method">$ REQUEST_METHOD</a> <br>   <a hhref="http/ngx_http_core_module.html#var_request_time">$ request_time</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_request_time">$ request_time</a> （ngx_http_log_module） <br>   <a hhref="http/ngx_http_core_module.html#var_request_uri">$ REQUEST_URI</a> <br>   <a hhref="http/ngx_http_core_module.html#var_scheme">$方案</a> <br>   <a hhref="http/ngx_http_secure_link_module.html#var_secure_link">$ secure_link</a> <br>   <a hhref="http/ngx_http_secure_link_module.html#var_secure_link_expires">$ secure_link_expires</a> <br>   <a hhref="http/ngx_http_core_module.html#var_sent_http_">$ sent<em>http</em></a> <br>   <a hhref="http/ngx_http_core_module.html#var_sent_trailer_">$ sent<em>trailer</em></a> <br>   <a hhref="http/ngx_http_core_module.html#var_server_addr">$ server_addr</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_server_addr">$ server_addr</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_server_name">$ SERVER_NAME</a> <br>   <a hhref="http/ngx_http_core_module.html#var_server_port">$ server_port</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_server_port">$ server_port</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_server_protocol">$ SERVER_PROTOCOL</a> <br>   <a hhref="http/ngx_http_session_log_module.html#var_session_log_binary_id">$ session_log_binary_id</a> <br>   <a hhref="http/ngx_http_session_log_module.html#var_session_log_id">$ session_log_id</a> <br>   <a hhref="stream/ngx_stream_core_module.html#var_session_time">$ session_time</a> <br>   <a hhref="http/ngx_http_slice_module.html#var_slice_range">$ slice_range</a> <br>   <a hhref="http/ngx_http_spdy_module.html#var_spdy">$ SPDY</a> <br>   <a hhref="http/ngx_http_spdy_module.html#var_spdy_request_priority">$ spdy_request_priority</a> <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_cipher">$ ssl_cipher</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_cipher">$ ssl_cipher</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_ciphers">$ ssl_ciphers</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_ciphers">$ ssl_ciphers</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_cert">$ ssl_client_cert</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_cert">$ ssl_client_cert</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_escaped_cert">$ ssl_client_escaped_cert</a> <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_fingerprint">$ ssl_client_fingerprint</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_fingerprint">$ ssl_client_fingerprint</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_i_dn">$ ssl_client_i_dn</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_i_dn">$ ssl_client_i_dn</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_i_dn_legacy">$ ssl_client_i_dn_legacy</a> <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_raw_cert">$ ssl_client_raw_cert</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_raw_cert">$ ssl_client_raw_cert</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_s_dn">$ ssl_client_s_dn</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_s_dn">$ ssl_client_s_dn</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_s_dn_legacy">$ ssl_client_s_dn_legacy</a> <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_serial">$ ssl_client_serial</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_serial">$ ssl_client_serial</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_v_end">$ ssl_client_v_end</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_v_end">$ ssl_client_v_end</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_v_remain">$ ssl_client_v_remain</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_v_remain">$ ssl_client_v_remain</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_v_start">$ ssl_client_v_start</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_v_start">$ ssl_client_v_start</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_client_verify">$ ssl_client_verify</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_client_verify">$ ssl_client_verify</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_curves">$ ssl_curves</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_curves">$ ssl_curves</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_early_data">$ ssl_early_data</a> <br>   <a hhref="stream/ngx_stream_ssl_preread_module.html#var_ssl_preread_alpn_protocols">$ ssl_preread_alpn_protocols</a> <br>   <a hhref="stream/ngx_stream_ssl_preread_module.html#var_ssl_preread_protocol">$ ssl_preread_protocol</a> <br>   <a hhref="stream/ngx_stream_ssl_preread_module.html#var_ssl_preread_server_name">$ ssl_preread_server_name</a> <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_protocol">$ ssl_protocol</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_protocol">$ ssl_protocol</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_server_name">$ ssl_server_name</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_server_name">$ ssl_server_name</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_session_id">$ ssl_session_id</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_session_id">$ ssl_session_id</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#var_ssl_session_reused">$ ssl_session_reused</a> （ngx_http_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#var_ssl_session_reused">$ ssl_session_reused</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_core_module.html#var_status">$ status</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_status">$ status</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_status">$ status</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_tcpinfo_">$ tcpinfo_rtt</a> <br>   <a hhref="http/ngx_http_core_module.html#var_tcpinfo_">$ tcpinfo_rttvar</a> <br>   <a hhref="http/ngx_http_core_module.html#var_tcpinfo_">$ tcpinfo_snd_cwnd</a> <br>   <a hhref="http/ngx_http_core_module.html#var_tcpinfo_">$ tcpinfo_rcv_space</a> <br>   <a hhref="http/ngx_http_core_module.html#var_time_iso8601">$ time_iso8601</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_time_iso8601">$ time_iso8601</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_time_iso8601">$ time_iso8601</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#var_time_local">$ time_local</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_log_module.html#var_time_local">$ time_local</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_core_module.html#var_time_local">$ time_local</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_userid_module.html#var_uid_got">$ uid_got</a> <br>   <a hhref="http/ngx_http_userid_module.html#var_uid_reset">$ uid_reset</a> <br>   <a hhref="http/ngx_http_userid_module.html#var_uid_set">$ uid_set</a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_addr">$ upstream_addr</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#var_upstream_addr">$ upstream_addr</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_bytes_received">$ upstream_bytes_received</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#var_upstream_bytes_received">$ upstream_bytes_received</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_bytes_sent">$ upstream_bytes_sent</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#var_upstream_bytes_sent">$ upstream_bytes_sent</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_cache_status">$ upstream_cache_status</a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_connect_time">$ upstream_connect_time</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#var_upstream_connect_time">$ upstream_connect_time</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_cookie_">$ upstream<em>cookie</em></a> <br>   <a hhref="stream/ngx_stream_upstream_module.html#var_upstream_first_byte_time">$ upstream_first_byte_time</a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_header_time">$ upstream_header_time</a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_http_">$ upstream<em>http</em></a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_queue_time">$ upstream_queue_time</a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_response_length">$ upstream_response_length</a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_response_time">$ upstream_response_time</a> <br>   <a hhref="stream/ngx_stream_upstream_module.html#var_upstream_session_time">$ upstream_session_time</a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_status">$ upstream_status</a> <br>   <a hhref="http/ngx_http_upstream_module.html#var_upstream_trailer_">$ upstream<em>trailer</em></a> <br>   <a hhref="http/ngx_http_core_module.html#var_uri">$ URI</a> <br></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/syslog.html</url>
      <content type="html"><![CDATA[<p></p><h2>  记录到syslog </h2><p>   <a hhref="ngx_core_module.html#error_log">error_log</a>和<a hhref="http/ngx_http_log_module.html#access_log">access_log</a>指令支持记录到syslog。  以下参数配置到syslog的日志记录： </p><dl class="compact"><dt>   <code class="notranslate">server=</code> <code class="notranslate"><i>address</i></code> </dt><dd>  定义syslog服务器的地址。  可以将地址指定为域名或IP地址，带有可选端口，或者指定为“ <code class="notranslate">unix:</code> ”前缀后指定的UNIX域套接字路径。  如果未指定端口，则使用UDP端口514。  如果域名解析为多个IP地址，则使用第一个解析的地址。 </dd><dt>   <code class="notranslate">facility=</code> <code class="notranslate"><i>string</i></code> </dt><dd>  设置syslog消息的工具，如<a hhref="https://tools.ietf.org/html/rfc3164#section-4.1.1">RFC 3164中</a>所定义。  设施可以是“ <code class="notranslate">kern</code> ”，“ <code class="notranslate">user</code> ”，“ <code class="notranslate">mail</code> ”，“ <code class="notranslate">daemon</code> ”，“ <code class="notranslate">auth</code> ”，“ <code class="notranslate">intern</code> ”，“ <code class="notranslate">lpr</code> ”，“ <code class="notranslate">news</code> ”，“ <code class="notranslate">uucp</code> ”，“ <code class="notranslate">clock</code> ”，“ <code class="notranslate">authpriv</code> ”，“ <code class="notranslate">ftp</code> “，” <code class="notranslate">ntp</code> “，” <code class="notranslate">audit</code> “，” <code class="notranslate">alert</code> “，” <code class="notranslate">cron</code> “，” <code class="notranslate">local0</code> “..” <code class="notranslate">local7</code> “。  默认为“ <code class="notranslate">local7</code> ”。 </dd><dt>   <code class="notranslate">severity=</code> <code class="notranslate"><i>string</i></code> </dt><dd>  设置<a hhref="http/ngx_http_log_module.html#access_log">access_log</a>的syslog消息的严重性，如<a hhref="https://tools.ietf.org/html/rfc3164#section-4.1.1">RFC 3164中</a>所定义。  可能的值与<a hhref="ngx_core_module.html#error_log">error_log</a>指令的第二个参数（级别）相同。  默认为“ <code class="notranslate">info</code> ”。 <blockquote class="note">  错误消息的严重性由nginx确定，因此在<code class="notranslate">error_log</code>指令中忽略该参数。 </blockquote></dd><dt>   <code class="notranslate">tag=</code> <code class="notranslate"><i>string</i></code> </dt><dd>  设置syslog消息的标记。  默认为“ <code class="notranslate">nginx</code> ”。 </dd><dt> <code class="notranslate">nohostname</code> </dt> <dd>  禁用将“hostname”字段添加到syslog消息头（1.9.7）中。 </dd></dl><p>   syslog配置示例： </p><blockquote class="example"><pre class="notranslate">error_log syslog:server=192.168.1.1 debug;<p></p>
<p>access_log syslog:server=unix:/var/log/nginx.sock,nohostname;<br>access_log syslog:server=[2001:db8::1]:12345,facility=local7,tag=nginx,severity=info combined;<br></p></pre></blockquote><p></p><p></p><blockquote class="note">  从版本1.7.1开始，可以登录到syslog。  作为我们<a hhref="http://nginx.com/products/">商业订阅的</a>一部分，从1.5.3版开始，可以使用日志记录到syslog。 </blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/syntax.html</url>
      <content type="html"><![CDATA[<p></p><h2>  配置文件测量单位 </h2><p>  大小可以以字节，千字节（后缀<code class="notranslate">k</code>和<code class="notranslate">K</code> ）或兆字节（后缀<code class="notranslate">m</code>和<code class="notranslate">M</code> ）来指定，例如，“ <code class="notranslate">1024</code> ”，“ <code class="notranslate">8k</code> ”，“ <code class="notranslate">1m</code> ”。 </p><p>  也可以使用<code class="notranslate">g</code>或<code class="notranslate">G</code>后缀以千兆字节为<code class="notranslate">g</code>指定偏移量。 </p><p>  可以使用以下后缀以毫秒，秒，分钟，小时，天等指定时间间隔： </p><table width="30%"><tbody><tr><td width="20%" class="notranslate">ms</td><td class="notranslate">milliseconds</td></tr><tr><td width="20%" class="notranslate">s</td><td class="notranslate">seconds</td></tr><tr><td width="20%" class="notranslate">m</td><td class="notranslate">minutes</td></tr><tr><td width="20%" class="notranslate">h</td><td class="notranslate">hours</td></tr><tr><td width="20%" class="notranslate">d</td><td class="notranslate">days</td></tr><tr><td width="20%" class="notranslate">w</td><td class="notranslate">weeks</td></tr><tr><td width="20%" class="notranslate">M</td><td class="notranslate">months, 30 days</td></tr><tr><td width="20%" class="notranslate">y</td><td class="notranslate">years, 365 days</td></tr></tbody></table><p></p><p>  通过按从最高有效到最低有序的顺序指定多个单元，可以将多个单元组合成单个值，并且可选地由空格分隔。  例如，“ <code class="notranslate">1h 30m</code> ”指定与“ <code class="notranslate">90m</code> ”或“ <code class="notranslate">5400s</code> ”相同的时间。  没有后缀的值表示秒。  建议始终指定后缀。 </p><p>  某些时间间隔只能以秒分辨率指定。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/switches.html</url>
      <content type="html"><![CDATA[<p></p><h2>  命令行参数 </h2><p>   nginx支持以下命令行参数： </p><ul class="compact"><li> <code class="notranslate">-?</code>   |   <code class="notranslate">-h</code> - 打印命令行参数的帮助。 </li><li>   <code class="notranslate">-c <code class="notranslate"><i>file</i></code></code> - 使用备用配置<code class="notranslate"><i>file</i></code>而不是默认文件。 </li><li>   <code class="notranslate">-g <code class="notranslate"><i>directives</i></code></code> - 设置<a hhref="ngx_core_module.html">全局配置指令</a> ，例如， <blockquote class="example"><pre class="notranslate">nginx -g “pid /var/run/nginx.pid; worker_processes <code>sysctl -n hw.ncpu</code>;”<br></pre></blockquote></li><li>   <code class="notranslate">-p <code class="notranslate"><i>prefix</i></code></code> - 设置nginx路径前缀，即保留服务器文件的目录（默认值为<code class="notranslate"><i>/usr/local/nginx</i></code> ）。 </li><li>   <code class="notranslate">-q</code> - 在配置测试期间禁止出现非错误消息。 </li><li>   <code class="notranslate">-s <code class="notranslate"><i>signal</i></code></code> - 向主进程发送<i>信号</i> 。  参数<i>信号</i>可以是以下之一： <ul class="compact"><li>   <code class="notranslate">stop</code> - 快速关闭 </li><li>   <code class="notranslate">quit</code> - 优雅地关闭 </li><li>   <code class="notranslate">reload</code> - 重新加载配置，使用新配置启动新的工作进程，正常关闭旧的工作进程。 </li><li>   <code class="notranslate">reopen</code> - 重新打开日志文件 </li></ul></li><li>   <code class="notranslate">-t</code> - 测试配置文件：nginx检查配置是否有正确的语法，然后尝试打开配置中引用的文件。 </li><li>   <code class="notranslate">-T</code> - 与<code class="notranslate">-t</code>相同，但另外将配置文件转储到标准输出（1.9.2）。 </li><li>   <code class="notranslate">-v</code> - 打印nginx版本。 </li><li>   <code class="notranslate">-V</code> - 打印nginx版本，编译器版本和配置参数。 </li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/reference.html</url>
      <content type="html"><![CDATA[<p></p><h2>  参考 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#http_stream">nginx objects</a> <br>     <a hhref="#http">HTTP Request</a> <br>     <a hhref="#stream">Stream Session</a> <br> <a hhref="#core">Core</a> <br>     <a hhref="#string">String</a> <br>     <a hhref="#core_json">JSON</a> <br>     <a hhref="#crypto">Crypto</a> <br>     <a hhref="#njs_api_timers">Timers</a> <br>     <a hhref="#njs_api_fs">File System</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <a hhref="index.html">njs</a>提供了扩展nginx功能的对象，方法和属性。 </p><a name="http_stream"></a><center><h4>   nginx对象 </h4></center><a name="http"></a><center><h4>   HTTP请求 </h4></center><p>   HTTP请求对象仅在<a hhref="http/ngx_http_js_module.html">ngx_http_js_module</a>模块中可用。  对象的所有字符串属性都是<a hhref="#string">字节字符串</a> 。 </p><dl class="compact"><dt> <code class="notranslate">r.args{}</code> </dt> <dd>  请求参数对象，只读 </dd><dt> <code class="notranslate">r.error( <code class="notranslate"><i>string</i></code> )</code> </dt> <dd>  在记录的<code class="notranslate">error</code>级别上将<code class="notranslate">string</code>写入错误日志 </dd><dt> <code class="notranslate">r.finish()</code> </dt> <dd>  完成向客户发送回复 </dd><dt> <code class="notranslate">r.headersIn{}</code> </dt> <dd>  传入头对象，只读。 <p>  例如，可以使用语法<code class="notranslate">headersIn.foo</code>或<code class="notranslate">headersIn[‘Foo’]</code>访问<code class="notranslate">Foo</code>标头 </p></dd><dt> <code class="notranslate">r.headersOut{}</code> </dt> <dd>  传出头对象，可写。 <p>  例如，可以使用语法<code class="notranslate">headersOut.foo</code>或<code class="notranslate">headersOut[‘Foo’]</code>访问<code class="notranslate">Foo</code>标头 </p></dd><dt> <code class="notranslate">r.httpVersion</code> </dt> <dd>   HTTP版本，只读 </dd><dt> <code class="notranslate">r.log( <code class="notranslate"><i>string</i></code> )</code> </dt> <dd>  将<code class="notranslate">string</code>写入日志<code class="notranslate">info</code>级别的错误日志 </dd><dt id="r_internal_redirect"> <code class="notranslate">r.internalRedirect( <code class="notranslate"><i>uri</i></code> )</code> </dt> <dd>  执行内部重定向到指定的<code class="notranslate">uri</code> 。  如果uri以“ <code class="notranslate">@</code> ”前缀开头，则将其视为命名位置。 </dd><dt> <code class="notranslate">r.method</code> </dt> <dd>   HTTP方法，只读 </dd><dt> <code class="notranslate">r.parent</code> </dt> <dd>  引用父请求对象 </dd><dt> <code class="notranslate">r.remoteAddress</code> </dt> <dd>  客户端地址，只读 </dd><dt id="r_request_body"> <code class="notranslate">r.requestBody</code> </dt> <dd>  如果客户端请求正文尚未写入临时文件，则返回该请求正文。  要确保客户端请求正文在内存中，其大小应受<a hhref="http/ngx_http_core_module.html#client_max_body_size">client_max_body_size</a>限制，并且应使用<a hhref="http/ngx_http_core_module.html#client_body_buffer_size">client_body_buffer_size</a>设置足够的缓冲区大小。 </dd><dt> <code class="notranslate">r.responseBody</code> </dt> <dd>  拥有<a hhref="#subrequest">子请求</a>响应主体，只读。   <code class="notranslate">r.responseBody</code>的大小受<code class="notranslate">r.responseBody</code>指令的限制。 </dd><dt> <code class="notranslate">r.return(status[, string])</code> </dt> <dd>  将具有指定<code class="notranslate">status</code>的整个响应发送到客户端 <p>  可以指定重定向URL（对于代码301,302,303,307和308）或响应正文文本（对于其他代码）作为第二个参数 </p></dd><dt> <code class="notranslate">r.send( <code class="notranslate"><i>string</i></code> )</code> </dt> <dd>  将响应主体的一部分发送给客户端 </dd><dt> <code class="notranslate">r.sendHeader()</code> </dt> <dd>  将HTTP标头发送到客户端 </dd><dt> <code class="notranslate">r.status</code> </dt> <dd>  地位，可写 </dd><dt> <code class="notranslate">r.variables{}</code> </dt> <dd>   nginx变量对象，只读 </dd><dt> <code class="notranslate">r.warn( <code class="notranslate"><i>string</i></code> )</code> </dt> <dd>  在记录的<code class="notranslate">warning</code>级别上将<code class="notranslate">string</code>写入错误日志 </dd><dt> <code class="notranslate">r.uri</code> </dt> <dd>  当前URI，只读 </dd><dt id="subrequest"> <code class="notranslate">r.subrequest( <code class="notranslate"><i>uri</i></code> [, <code class="notranslate"><i>options</i></code> [, <code class="notranslate"><i>callback</i></code> ]])</code> </dt> <dd>  使用给定的<code class="notranslate">uri</code>和<code class="notranslate">options</code>创建子请求，并安装可选的完成<code class="notranslate">callback</code> 。 <p>  如果<code class="notranslate">options</code>是一个字符串，那么它包含子请求参数字符串。  否则， <code class="notranslate">options</code>应该是具有以下键的对象： </p><dl class="compact"><dt> <code class="notranslate">args</code> </dt> <dd>  参数字符串 </dd><dt> <code class="notranslate">body</code> </dt> <dd>  请求机构 </dd><dt> <code class="notranslate">method</code> </dt> <dd>   HTTP方法 </dd></dl><p></p><p>  完成<code class="notranslate">callback</code>接收子请求响应对象，其方法和属性与父请求对象相同。 </p></dd></dl><p></p><a name="stream"></a><center><h4>  流会话 </h4></center><p>  流会话对象仅在<a hhref="stream/ngx_stream_js_module.html">ngx_stream_js_module</a>模块中可用。  对象的所有字符串属性都是<a hhref="#string">字节字符串</a> 。 </p><p></p><blockquote class="note">  在njs <a hhref="njs/changes.html#njs0.2.4">0.2.4</a>之前，流会话对象具有一些当前<a hhref="#stream_obsolete">被删除的</a>属性。 </blockquote><p></p><p></p><dl class="compact"><dt id="s_allow"> <code class="notranslate">s.allow()</code> </dt> <dd>  成功完成阶段处理程序（ <a hhref="njs/changes.html#njs0.2.4">0.2.4</a> ） </dd><dt id="s_decline"> <code class="notranslate">s.decline()</code> </dt> <dd>  完成阶段处理程序并将控制权传递给下一个处理程序（ <a hhref="njs/changes.html#njs0.2.4">0.2.4</a> ） </dd><dt id="s_deny"> <code class="notranslate">s.deny()</code> </dt> <dd>  使用访问错误代码（ <a hhref="njs/changes.html#njs0.2.4">0.2.4</a> ）完成阶段处理程序 </dd><dt id="s_done">   <code class="notranslate">s.done</code> （ <code class="notranslate"><i>[code]</i></code> ） </dt><dd>  成功完成当前阶段处理程序或使用指定的数字代码（ <a hhref="njs/changes.html#njs0.2.4">0.2.4</a> ）完成它。 </dd><dt> <code class="notranslate">s.error( <code class="notranslate"><i>string</i></code> )</code> </dt> <dd>  在发送的<code class="notranslate">error</code>级别上将发送的<code class="notranslate">string</code>写入错误日志 </dd><dt> <code class="notranslate">s.log( <code class="notranslate"><i>string</i></code> )</code> </dt> <dd>  将发送的<code class="notranslate"><i>string</i></code>写入日志记录<code class="notranslate">info</code>级别的错误日志 </dd><dt id="s_off"> <code class="notranslate">s.off( <code class="notranslate"><i>eventName</i></code> )</code> </dt> <dd>  取消注册<a hhref="#s_on">s.on（）</a>方法设置的回调（ <a hhref="njs/changes.html#njs0.2.4">0.2.4</a> ） </dd><dt id="s_on"> <code class="notranslate">s.on( <code class="notranslate"><i>event</i></code> , <code class="notranslate"><i>callback</i></code> )</code> </dt> <dd>  为指定<code class="notranslate">event</code>注册<code class="notranslate">callback</code> （ <a hhref="njs/changes.html#njs0.2.4">0.2.4</a> ）。 <p>   <code class="notranslate">event</code>可以是以下字符串之一： </p><dl class="compact"><dt> <code class="notranslate">upload</code> </dt> <dd>  来自客户的新数据 </dd><dt> <code class="notranslate">download</code> </dt> <dd>  给客户的新数据 </dd></dl><p></p><p>  完成回调具有以下原型： <code class="notranslate">callback(data, flags)</code> ，其中<code class="notranslate">data</code>是字符串， <code class="notranslate">flags</code>是具有以下属性的对象： </p><dl class="compact"><dt id="s_on_callback_last"> <code class="notranslate">last</code> </dt> <dd>  布尔值，如果数据是最后一个缓冲区，则为true。 </dd></dl><p></p></dd><dt> <code class="notranslate">s.remoteAddress</code> </dt> <dd>  客户端地址，只读 </dd><dt id="s_send"> <code class="notranslate">s.send( <code class="notranslate"><i>data</i></code> [, <code class="notranslate"><i>options</i></code> ])</code> </dt> <dd>  将数据发送到客户端（ <a hhref="njs/changes.html#njs0.2.4">0.2.4</a> ）。   <code class="notranslate">options</code>是一个对象，用于覆盖从传入数据块缓冲区派生的nginx缓冲区标志。  可以使用以下标志覆盖标志： <p></p><dl class="compact"><dt> <code class="notranslate">last</code> </dt> <dd>   boolean，如果缓冲区是最后一个缓冲区，则为true </dd><dt> <code class="notranslate">flush</code> </dt> <dd>   boolean，如果缓冲区应该具有<code class="notranslate">flush</code>标志，则为true </dd></dl><p></p>  每次回调调用可以多次调用该方法。 </dd><dt> <code class="notranslate">s.variables{}</code> </dt> <dd>   nginx变量对象，只读 </dd><dt> <code class="notranslate">s.warn( <code class="notranslate"><i>string</i></code> )</code> </dt> <dd>  在日志记录的<code class="notranslate">warning</code>级别将发送的<code class="notranslate">string</code>写入错误日志 </dd></dl><p></p><a name="stream_obsolete"></a><center><h4>  过时的属性 </h4></center><p>  这些属性已在njs <a hhref="njs/changes.html#njs0.2.4">0.2.4中</a>删除，并且与现有的njs代码不向后兼容。 </p><p></p><dl class="compact"><dt id="s_abort"> <code class="notranslate">s.ABORT</code> </dt> <dd>   <code class="notranslate">ABORT</code>返回码 <blockquote class="note">  从njs <a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，应该使用<a hhref="#s_deny">s.deny（）</a>方法。 </blockquote></dd><dt> <code class="notranslate">s.AGAIN</code> </dt> <dd>   <code class="notranslate">AGAIN</code>返回代码 <blockquote class="note">  从njs <a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，如果没有<a hhref="#s_allow">调用s.allow（）</a> ， <a hhref="#s_deny">s.deny（）</a> ， <a hhref="#s_decline">s.decline（）</a> ， <a hhref="#s_done">s.done（）</a>并且注册了回调， <a hhref="#s_deny">则会</a>实现相应的行为。 </blockquote></dd><dt id="s_buffer"> <code class="notranslate">s.buffer</code> </dt> <dd>  当前缓冲区，可写 <blockquote class="note">  从<a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，应该使用<a hhref="#s_send">s.send（）</a>方法进行编写。  对于读取，当前缓冲区可用作<code class="notranslate">event</code>回调的第一个参数。 </blockquote></dd><dt> <code class="notranslate">s.DECLINED</code> </dt> <dd>   <code class="notranslate">DECLINED</code>返回码 <blockquote class="note">  从njs <a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，应该使用<a hhref="#s_decline">s.decline（）</a>方法。 </blockquote></dd><dt> <code class="notranslate">s.eof</code> </dt> <dd>  布尔值只读属性，如果当前缓冲区是最后一个缓冲区，则为true <blockquote class="note">  从<a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，应该使用<a hhref="#s_on_callback_last">flags.last</a>属性。 </blockquote></dd><dt> <code class="notranslate">s.ERROR</code> </dt> <dd>   <code class="notranslate">ERROR</code>返回码 <blockquote class="note">  从njs <a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，可以抛出适当的异常来报告错误。 </blockquote></dd><dt> <code class="notranslate">s.fromUpstream</code> </dt> <dd>  布尔值只读属性，如果当前缓冲区是从上游服务器到客户端，则为true <blockquote class="note">  从<a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，应使用相应的<a hhref="#s_on">事件</a> （ <code class="notranslate">upload</code>或<code class="notranslate">download</code> ）来处理来自客户端的数据。 </blockquote></dd><dt id="s_ok"> <code class="notranslate">s.OK</code> </dt> <dd>   <code class="notranslate">OK</code>返回码 <blockquote class="note">  从njs <a hhref="njs/changes.html#njs0.2.4">0.2.4</a>开始，应该使用<a hhref="#s_allow">s.allow（）</a>方法。 </blockquote></dd></dl><p></p><a name="core"></a><center><h4>  核心 </h4></center><a name="string"></a><center><h4>  串 </h4></center><p>  有两种类型的字符串： <code class="notranslate">Unicode string</code> （默认）和<code class="notranslate">byte string</code> 。 </p><p>   <code class="notranslate">Unicode string</code>对应于包含Unicode字符的ECMAScript字符串。 </p><p>   <code class="notranslate">Byte strings</code>包含一系列字节。  它们用于将Unicode字符串序列化为外部数据，并从外部源反序列化。  例如， <a hhref="#string_toutf8">toUTF8（）</a>方法使用UTF8编码将Unicode字符串序列化为字节字符串： </p><blockquote class="example"><pre class="notranslate">&gt;&gt; ‘£’.toUTF8().toString(‘hex’)<br>‘c2a3’  /<em> C2 A3 is the UTF8 representation of 00A3 (‘£’) code point </em>/<br></pre></blockquote><p>   <a hhref="#string_tobytes">toBytes（）</a>方法将代码点最多为255的Unicode字符串序列化为字节字符串，否则返回<code class="notranslate">null</code> ： </p><blockquote class="example"><pre class="notranslate">&gt;&gt; ‘£’.toBytes().toString(‘hex’)<br>‘a3’  /<em> a3 is a byte equal to 00A3 (‘£’) code point  </em>/<br></pre></blockquote><p>  只有字节字符串可以转换为不同的编码。  例如，字符串不能直接编码为<code class="notranslate">hex</code> ： </p><blockquote class="example"><pre class="notranslate">&gt;&gt; ‘αβγδ’.toString(‘base64’)<br>TypeError: argument must be a byte string<br>    at String.prototype.toString (native)<br>    at main (native)<br></pre></blockquote><p>  要将Unicode字符串转换为十六进制，首先应将其转换为字节字符串，然后转换为十六进制： </p><blockquote class="example"><pre class="notranslate">&gt;&gt; ‘αβγδ’.toUTF8().toString(‘base64’)<br>‘zrHOss6zzrQ=’<br></pre></blockquote><p></p><dl class="compact"><dt id="string_bytesfrom"> <code class="notranslate">String.bytesFrom( <code class="notranslate"><i>array</i></code> | <code class="notranslate"><i>string</i></code> , <code class="notranslate"><i>encoding</i></code> )</code> </dt> <dd>   （njs specific）从包含八位字节的数组或从编码字符串（0.2.3）创建字节字符串。  编码可以是<code class="notranslate">hex</code> ， <code class="notranslate">base64</code>和<code class="notranslate">base64url</code> 。 <blockquote class="example"><pre class="notranslate">&gt;&gt; String.bytesFrom([0x62, 0x75, 0x66, 0x66, 0x65, 0x72])<br>‘buffer’<p></p>
<p>&gt;&gt; String.bytesFrom(‘YnVmZmVy’, ‘base64’)<br>‘buffer’<br></p></pre></blockquote></dd><dt id="string_fromcharcode"> <code class="notranslate">String.fromCharCode( <code class="notranslate"><i>CharCode1</i></code> [, …[, <code class="notranslate"><i>CharCodeN</i></code> ]])</code> </dt> <dd>  从一个或多个Unicode代码点返回一个字符串。 <blockquote class="example"><pre class="notranslate">&gt;&gt; String.fromCharCode(97, 98, 99, 100)<br>‘abcd’<br></pre></blockquote></dd><dt id="string_fromcodepoint"> <code class="notranslate">String.fromCodePoint( <code class="notranslate"><i>codePoint1</i></code> [, …[, <code class="notranslate"><i>codePoint2</i></code> ]])</code> </dt> <dd>  从一个或多个Unicode代码点返回一个字符串。 <blockquote class="example"><pre class="notranslate">&gt;&gt; String.fromCodePoint(97, 98, 99, 100)<br>‘abcd’<br></pre></blockquote></dd><dt id="string_charat"> <code class="notranslate">String.prototype.charAt( <code class="notranslate"><i>index</i></code> )</code> </dt> <dd>  返回表示指定<code class="notranslate">index</code>处的一个Unicode代码单元的字符串;  如果索引超出范围，则为空字符串。   <code class="notranslate">index</code>可以是0到1之间的整数 - 小于字符串的长度。  如果未提供索引，则默认值为<code class="notranslate">0</code> ，因此将返回字符串中的第一个字符。 </dd><dt id="string_codepointat"> <code class="notranslate">String.prototype.CodePointAt( <code class="notranslate"><i>position</i></code> )</code> </dt> <dd>  返回一个数字，表示给定索引处字符的代码点值;  如果位置没有元素，则为<code class="notranslate">undefined</code> 。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘ABCD’.codePointAt(3);<br>68<br></pre></blockquote></dd><dt id="string_concat"> <code class="notranslate">String.prototype.concat( <code class="notranslate"><i>string1</i></code> [, …, <code class="notranslate"><i>stringN</i></code> ])</code> </dt> <dd>  返回包含指定<code class="notranslate">strings</code>串联的<code class="notranslate">strings</code> 。 <blockquote class="example"><pre class="notranslate">&gt;&gt; “a”.concat(“b”, “c”)<br>‘abc’<br></pre></blockquote></dd><dt id="string_endswith"> <code class="notranslate">String.prototype.endsWith( <code class="notranslate"><i>searchString</i></code> [, <code class="notranslate"><i>length</i></code> ])</code> </dt> <dd>  如果字符串以指定字符串的字符结尾，则返回<code class="notranslate">true</code> ，否则返回<code class="notranslate">false</code> 。  可选的<code class="notranslate">length</code>参数是字符串的长度。  如果省略，则默认值为字符串的长度。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abc’.endsWith(‘abc’)<br>true<br>&gt;&gt; ‘abca’.endsWith(‘abc’)<br>false<br></pre></blockquote></dd><dt id="string_frombytes"> <code class="notranslate">String.prototype.fromBytes( <code class="notranslate"><i>start</i></code> [, <code class="notranslate"><i>end</i></code> ])</code> </dt> <dd>   （njs specific）从字节字符串返回一个新的Unicode字符串，其中每个字节都替换为相应的Unicode代码点。 </dd><dt id="string_fromutf8"> <code class="notranslate">String.prototype.fromUTF8( <code class="notranslate"><i>start</i></code> [, <code class="notranslate"><i>end</i></code> ])</code> </dt> <dd>   （特定于njs）将包含有效UTF8字符串的字节字符串转换为Unicode字符串，否则返回<code class="notranslate">null</code> 。 </dd><dt id="string_includes"> <code class="notranslate">String.prototype.includes( <code class="notranslate"><i>searchString</i></code> [, <code class="notranslate"><i>position</i></code> ]))</code> </dt> <dd>  如果在另一个字符串中找到字符串，则返回<code class="notranslate">true</code> ，否则返回<code class="notranslate">false</code> 。  可选的<code class="notranslate">position</code>参数是字符串中开始搜索<code class="notranslate">searchString</code> 。  默认值为0。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abc’.includes(‘bc’)<br>true<br></pre></blockquote></dd><dt id="string_indexof"> <code class="notranslate">String.prototype.indexOf( <code class="notranslate"><i>searchString</i></code> [, <code class="notranslate"><i>fromIndex</i></code> ])</code> </dt> <dd>  返回<code class="notranslate">searchString</code>第一次出现的位置搜索从<code class="notranslate">fromIndex</code>开始。  如果未找到该值，则返回<code class="notranslate"><i>-1</i></code> 。   <code class="notranslate">fromIndex</code>是一个整数，默认值为0.如果<code class="notranslate">fromIndex</code>小于0或大于<a hhref="#string_length">String.prototype.length</a> <code class="notranslate"><i></i></code>   ，搜索从索引<code class="notranslate"><i>0</i></code>和<code class="notranslate"><i>String.prototype.length</i></code> 。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abcdef’.indexOf(‘de’, 2)<br>3<br></pre></blockquote></dd><dt id="string_lastindexof"> <code class="notranslate">String.prototype.lastIndexOf( <code class="notranslate"><i>searchString</i></code> [, <code class="notranslate"><i>fromIndex</i></code> ])</code> </dt> <dd>  返回<code class="notranslate">searchString</code>最后一次出现的位置，从<code class="notranslate">fromIndex</code>向后搜索。  如果未找到该值，则返回<code class="notranslate"><i>-1</i></code> 。  如果<code class="notranslate">searchString</code>为空，则返回<code class="notranslate">fromIndex</code> 。 <blockquote class="example"><pre class="notranslate">&gt;&gt; “nginx”.lastIndexOf(“gi”)<br>1<br></pre></blockquote></dd><dt id="string_length"> <code class="notranslate">String.prototype.length</code> </dt> <dd>  返回字符串的长度。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘αβγδ’.length<br>4<br></pre></blockquote></dd><dt id="string_match"> <code class="notranslate">String.prototype.match([ <code class="notranslate"><i>regexp</i></code> ])</code> </dt> <dd>  匹配正则<code class="notranslate">regexp</code>的字符串。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘nginx’.match( /ng/i )<br>‘ng’<br></pre></blockquote></dd><dt id="string_padend"> <code class="notranslate">String.prototype.padEnd( <code class="notranslate"><i>length</i></code> [, <code class="notranslate"><i>string</i></code> ])</code> </dt> <dd>  返回指定<code class="notranslate">length</code>的<code class="notranslate">string</code> ，其中pad <code class="notranslate">string</code>应用于指定字符串的末尾（0.2.3）。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘1234’.padEnd(8, ‘abcd’)<br>‘1234abcd’<br></pre></blockquote></dd><dt id="string_padstart"> <code class="notranslate">String.prototype.padStart( <code class="notranslate"><i>length</i></code> [, <code class="notranslate"><i>string</i></code> ])</code> </dt> <dd>  返回指定<code class="notranslate">length</code>的<code class="notranslate">string</code> ，其中pad <code class="notranslate">string</code>应用于指定字符串的开头（0.2.3）。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘1234’.padStart(8, ‘abcd’)<br>‘abcd1234’<br></pre></blockquote></dd><dt id="string_repeat"> <code class="notranslate">String.prototype.repeat( <code class="notranslate"><i>number</i></code> )</code> </dt> <dd>  返回具有指定字符串副本数的字符串。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abc’.repeat(3)<br>‘abcabcabc’<br></pre></blockquote></dd><dt id="string_replace"> <code class="notranslate">String.prototype.replace([ <code class="notranslate"><i>regexp</i></code> | <code class="notranslate"><i>string</i></code> [, <code class="notranslate"><i>string</i></code> | <code class="notranslate"><i>function</i></code> ]])</code> </dt> <dd>  返回一个新字符串，其中包含由<code class="notranslate">string</code>或<code class="notranslate">function</code>替换的模式（ <code class="notranslate">string</code>或正则<code class="notranslate">regexp</code> ）的<code class="notranslate">string</code> 。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abcdefgh’.replace(‘d’, 1)<br>‘abc1efgh’<br></pre></blockquote></dd><dt id="string_search"> <code class="notranslate">String.prototype.search([ <code class="notranslate"><i>regexp</i></code> ])</code> </dt> <dd>  使用正则<code class="notranslate">regexp</code>搜索字符串 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abcdefgh’.search(‘def’)<br>3<br></pre></blockquote></dd><dt id="string_slice"> <code class="notranslate">String.prototype.slice( <code class="notranslate"><i>start</i></code> [, <code class="notranslate"><i>end</i></code> ])</code> </dt> <dd>  返回一个新字符串，其中包含<code class="notranslate">start</code>和<code class="notranslate">end</code>之间或从字符串<code class="notranslate">start</code>到<code class="notranslate">end</code>之间的原始字符串的一部分。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abcdefghijklmno’.slice(NaN, 5)<br>‘abcde’<br></pre></blockquote></dd><dt id="string_split"> <code class="notranslate">String.prototype.split(([ <code class="notranslate"><i>string</i></code> | <code class="notranslate"><i>regexp</i></code> [, <code class="notranslate"><i>limit</i></code> ]]))</code> </dt> <dd>  返回字符串与正则<code class="notranslate">regexp</code>匹配。  可选的<code class="notranslate">limit</code>参数是一个整数，指定要查找的拆分数限制。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abc’.split(‘’)<br>[<br> ‘a’,<br> ‘b’,<br> ‘c’<br>]<br></pre></blockquote></dd><dt id="string_startswith"> <code class="notranslate">String.prototype.startsWith( <code class="notranslate"><i>searchString</i></code> [, <code class="notranslate"><i>position</i></code> ])</code> </dt> <dd>  如果字符串以指定字符串的字符开头，则返回<code class="notranslate">true</code> ，否则返回<code class="notranslate">false</code> 。  可选的<code class="notranslate">position</code>参数是此字符串中开始搜索<code class="notranslate">searchString</code> 。  默认值为0。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abc’.startsWith(‘abc’)<br>true<br>&gt; ‘aabc’.startsWith(‘abc’)<br>false<br></pre></blockquote></dd><dt id="string_substr"> <code class="notranslate">String.prototype.substr( <code class="notranslate"><i>start</i></code> [, <code class="notranslate"><i>length</i></code> ])</code> </dt> <dd>  返回从字符串的<code class="notranslate">start</code>或<code class="notranslate">start</code>到结尾的指定<code class="notranslate">length</code>的字符串部分。 <blockquote class="example"><pre class="notranslate">&gt;&gt;  ‘abcdefghijklmno’.substr(3, 5)<br>‘defgh’<br></pre></blockquote></dd><dt id="string_substring"> <code class="notranslate">String.prototype.substring( <code class="notranslate"><i>start</i></code> [, <code class="notranslate"><i>end</i></code> ])</code> </dt> <dd>  返回字符串中字符串的<code class="notranslate">start</code>和<code class="notranslate">end</code>之间或从<code class="notranslate">start</code>到结尾的部分。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘abcdefghijklmno’.substring(3, 5)<br>‘de’<br></pre></blockquote></dd><dt id="string_tobytes"> <code class="notranslate">String.prototype.toBytes(start[, end])</code> </dt> <dd>   （特定于njs）将Unicode字符串序列化为字节字符串。  如果在字符串中找到大于255的字符，则返回<code class="notranslate">null</code> 。 </dd><dt id="string_tolowercase"> <code class="notranslate">String.prototype.toLowerCase()</code> </dt> <dd>  将字符串转换为小写。  该方法仅支持简单的Unicode折叠。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘ΑΒΓΔ’.toLowerCase()<br>‘αβγδ’<br></pre></blockquote></dd><dt> <code class="notranslate">String.prototype.toString([ <code class="notranslate"><i>encoding</i></code> ])</code> </dt> <dd><p>  如果未指定<code class="notranslate">encoding</code> ，则返回ECMAScript中指定的Unicode字符串或字节字符串。 </p><p>   （特定于njs）如果指定了<code class="notranslate">encoding</code> ，则将<a hhref="#string_tobytes">字节字符串</a>编码为<code class="notranslate">hex</code> ， <code class="notranslate">base64</code>或<code class="notranslate">base64url</code> 。 </p><blockquote class="example"><pre class="notranslate">&gt;&gt;  ‘αβγδ’.toUTF8().toString(‘base64url’)<br>‘zrHOss6zzrQ’<br></pre></blockquote></dd><dt id="string_touppercase"> <code class="notranslate">String.prototype.toUpperCase()</code> </dt> <dd>  将字符串转换为大写。  该方法仅支持简单的Unicode折叠。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘αβγδ’.toUpperCase()<br>‘ΑΒΓΔ’<br></pre></blockquote></dd><dt id="string_toutf8"> <code class="notranslate">String.prototype.toUTF8( <code class="notranslate"><i>start</i></code> [, <code class="notranslate"><i>end</i></code> ])</code> </dt> <dd>   （特定于njs）使用UTF8编码将Unicode字符串序列化为字节字符串。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘αβγδ’.toUTF8().length<br>8<br>&gt;&gt; ‘αβγδ’.length<br>4<br></pre></blockquote></dd><dt id="string_trim"> <code class="notranslate">String.prototype.trim()</code> </dt> <dd>  从字符串的两端删除空格。 <blockquote class="example"><pre class="notranslate">&gt;&gt; ‘   abc  ‘.trim()<br>‘abc’<br></pre></blockquote></dd><dt id="encodeuri"> <code class="notranslate">encodeURI( <code class="notranslate"><i>URI</i></code> )</code> </dt> <dd>  通过将某些字符的每个实例替换为表示字符的UTF-8编码的一个，两个，三个或四个转义序列来对URI进行编码 <blockquote class="example"><pre class="notranslate">&gt;&gt; encodeURI(‘012αβγδ’)<br>‘012%CE%B1%CE%B2%CE%B3%CE%B4’<br></pre></blockquote></dd><dt id="encodeuricomponent"> <code class="notranslate">encodeURIComponent( <code class="notranslate"><i>encodedURIString</i></code> )</code> </dt> <dd>  通过将某些字符的每个实例替换为表示字符的UTF-8编码的一个，两个，三个或四个转义序列来对URI进行编码。 <blockquote class="example"><pre class="notranslate">&gt;&gt; encodeURIComponent(‘[@?=’)<br>‘%5B%40%3F%3D’<br></pre></blockquote></dd><dt id="decodeuri"> <code class="notranslate">decodeURI( <code class="notranslate"><i>encodedURI</i></code> )</code> </dt> <dd>  解码先前<a hhref="#encodeuri">编码的</a> URI。 <blockquote class="example"><pre class="notranslate">&gt;&gt; decodeURI(‘012%CE%B1%CE%B2%CE%B3%CE%B4’)<br>‘012αβγδ’<br></pre></blockquote></dd><dt id="decodeuricomponent"> <code class="notranslate">decodeURIComponent( <code class="notranslate"><i>decodedURIString</i></code> )</code> </dt> <dd>  解码先前编码的URI的编码组件。 <blockquote class="example"><pre class="notranslate">&gt;&gt; decodeURIComponent(‘%5B%40%3F%3D’)<br>‘[@?=’<br></pre></blockquote></dd></dl><p></p><a name="core_json"></a><center><h4>   JSON </h4></center><p>   <code class="notranslate">JSON</code>对象（ES 5.1）提供了将njs值转换为JSON格式和从JSON格式转换的函数。 </p><dl class="compact"><dt> <code class="notranslate">JSON.parse( <code class="notranslate"><i>string</i></code> [, <code class="notranslate"><i>reviver</i></code> ])</code> </dt> <dd>  将表示JSON数据的<code class="notranslate">string</code>转换为njs对象（ <code class="notranslate">{…}</code> ）或数组（ <code class="notranslate">[…]</code> ）。  可选的<code class="notranslate">reviver</code>参数是一个函数（键，值），它将为每个（键，值）对调用，并可以转换该值。 </dd><dt> <code class="notranslate">JSON.stringify( <code class="notranslate"><i>value</i></code> [, <code class="notranslate"><i>replacer</i></code> ] [, <code class="notranslate"><i>space</i></code> ])</code> </dt> <dd>  将njs对象转换回JSON。  必需<code class="notranslate">value</code>参数通常是要转换的JSON <code class="notranslate">object</code>或<code class="notranslate">array</code> 。  如果值具有<code class="notranslate">toJSON()</code>方法，则它定义对象的序列化方式。  可选的<code class="notranslate">replacer</code>参数是转换结果的<code class="notranslate">function</code>或<code class="notranslate">array</code> 。  可选的<code class="notranslate">space</code>参数是<code class="notranslate">string</code>或<code class="notranslate">number</code> 。  如果是<code class="notranslate">number</code> ，则表示结果前的空白数（不超过10）。  如果是<code class="notranslate">string</code> ，则将其用作空格（或前10个字符）。  如果省略或为<code class="notranslate">null</code> ，则不使用空格。 </dd></dl><p></p><p></p><blockquote class="example"><pre class="notranslate">&gt;&gt; var json = JSON.parse(‘{“a”:1, “b”:true}’)<br>&gt;&gt; json.a<br>1<p></p>
<p>&gt;&gt; JSON.stringify(json)<br>‘{“a”:1,”b”:true}’</p>
<p>&gt;&gt; JSON.stringify(json, undefined, 1)<br>‘{\n “a”: 1,\n “b”: true\n}’</p>
<p>&gt;&gt; JSON.stringify({ x: [10, undefined, function(){}] })<br>‘{“x”:[10,null,null]}’</p>
<p>&gt;&gt; JSON.stringify({“a”:1, “toJSON”: function() {return “xxx”}})<br>‘“xxx”‘</p>
<h1 id="Example-with-function-replacer"><a href="#Example-with-function-replacer" class="headerlink" title="Example with function replacer"></a>Example with function replacer</h1><p>&gt;&gt; function replacer(key, value) {return (typeof value === ‘string’) ? undefined : value}<br>&gt;&gt;JSON.stringify({a:1, b:”b”, c:true}, replacer)<br>‘{“a”:1,”c”:true}’<br></p></pre></blockquote><p></p><a name="crypto"></a><center><h4>  加密 </h4></center><p>   Crypto模块提供加密功能支持。   <code class="notranslate">require(‘crypto’)</code>返回Crypto模块对象。 </p><p></p><dl class="compact"><dt id="crypto_createhash"> <code class="notranslate">crypto.createHash( <code class="notranslate"><i>algorithm</i></code> )</code> </dt> <dd>  创建并返回一个<a hhref="#crypto_hash">Hash</a>对象，该对象可用于使用给定<code class="notranslate"><i>algorithm</i></code>生成散列摘要。  算法可以是<code class="notranslate">md5</code> ， <code class="notranslate">sha1</code>和<code class="notranslate">sha256</code> 。 </dd><dt id="crypto_createhmac"> <code class="notranslate">crypto.createHmac( <code class="notranslate"><i>algorithm</i></code> , <code class="notranslate"><i>secret key</i></code> )</code> </dt> <dd>  创建并返回使用给定<code class="notranslate"><i>algorithm</i></code>和<code class="notranslate"><i>secret key</i></code>的<a hhref="#crypto_hmac">HMAC</a>对象。  算法可以是<code class="notranslate">md5</code> ， <code class="notranslate">sha1</code>和<code class="notranslate">sha256</code> 。 </dd></dl><p></p><a name="crypto_hash"></a><center><h4>  哈希 </h4></center><p></p><dl class="compact"><dt> <code class="notranslate">hash.update( <code class="notranslate"><i>data</i></code> )</code> </dt> <dd>  使用给定<code class="notranslate"><i>data</i></code>更新哈希内容。 </dd><dt> <code class="notranslate">hash.digest([ <code class="notranslate"><i>encoding</i></code> ])</code> </dt> <dd>  计算使用<code class="notranslate">hash.update()</code>传递的所有数据的摘要。  编码可以是<code class="notranslate">hex</code> ， <code class="notranslate">base64</code>和<code class="notranslate">base64url</code> 。  如果未提供编码，则返回字节字符串。 </dd></dl><p></p><p></p><blockquote class="example"><pre class="notranslate">&gt;&gt; var cr = require(‘crypto’)<br>undefined<p></p>
<p>&gt;&gt; cr.createHash(‘sha1’).update(‘A’).update(‘B’).digest(‘base64url’)<br>‘BtlFlCqiamG-GMPiK_GbvKjdK10’<br></p></pre></blockquote><p></p><a name="crypto_hmac"></a><center><h4>   HMAC </h4></center><p></p><dl class="compact"><dt> <code class="notranslate">hmac.update( <code class="notranslate"><i>data</i></code> )</code> </dt> <dd>  使用给定<code class="notranslate"><i>data</i></code>更新HMAC内容。 </dd><dt> <code class="notranslate">hmac.digest([ <code class="notranslate"><i>encoding</i></code> ])</code> </dt> <dd>  计算使用<code class="notranslate">hmac.update()</code>传递的所有数据的HMAC摘要。  编码可以是<code class="notranslate">hex</code> ， <code class="notranslate">base64</code>和<code class="notranslate">base64url</code> 。  如果未提供编码，则返回字节字符串。 </dd></dl><p></p><p></p><blockquote class="example"><pre class="notranslate">&gt;&gt; var cr = require(‘crypto’)<br>undefined<p></p>
<p>&gt;&gt; cr.createHmac(‘sha1’, ‘secret.key’).update(‘AB’).digest(‘base64url’)<br>‘Oglm93xn23_MkiaEq_e9u8zk374’<br></p></pre></blockquote><p></p><a name="njs_api_timers"></a><center><h4>  计时器 </h4></center><p></p><dl class="compact"><dt id="cleartimeout"> <code class="notranslate">clearTimeout( <code class="notranslate"><i>timeout</i></code> )</code> </dt> <dd>  取消由<a hhref="#settimeout">setTimeout（）</a>创建的<code class="notranslate">timeout</code>对象。 </dd><dt id="settimeout"> <code class="notranslate">setTimeout( <code class="notranslate"><i>function</i></code> , <code class="notranslate"><i>ms</i></code> [, <code class="notranslate"><i>arg1</i></code> , <code class="notranslate"><i>argN</i></code> ])</code> </dt> <dd>  在指定的<code class="notranslate">milliseconds</code>数后调用<code class="notranslate">function</code> 。  可以将一个或多个可选<code class="notranslate">arguments</code>传递给指定的函数。  返回<code class="notranslate">timeout</code>对象。 <blockquote class="example"><pre class="notranslate">function handler(v)<br>{<br>    // …<br>}<p></p>
<p>t = setTimeout(handler, 12);</p>
<p>// …</p>
<p>clearTimeout(t);<br></p></pre></blockquote></dd></dl><p></p><a name="njs_api_fs"></a><center><h4>  文件系统 </h4></center><p>  文件系统模块提供文件操作。   <code class="notranslate">require(‘fs’)</code>返回模块对象。 </p><dl class="compact"><dt id="appendfilesync"> <code class="notranslate">appendFileSync( <code class="notranslate"><i>filename</i></code> , <code class="notranslate"><i>data</i></code> [, <code class="notranslate"><i>options</i></code> ])</code> </dt> <dd>  同步将指定<code class="notranslate">data</code>附加到具有提供的<code class="notranslate">filename</code> 。  如果该文件不存在，则将创建该文件。   <code class="notranslate">options</code>参数应该是具有以下键的对象： <dl class="compact"><dt> <code class="notranslate">mode</code> </dt> <dd>   mode选项，默认为<code class="notranslate">0o666</code> </dd><dt> <code class="notranslate">flag</code> </dt> <dd>  文件系统<a hhref="#njs_api_fs_flags">标志</a> ，默认为 </dd></dl></dd><dt id="readfilesync"> <code class="notranslate">readFileSync( <code class="notranslate"><i>filename</i></code> [, <code class="notranslate"><i>options</i></code> ])</code> </dt> <dd>  使用提供的<code class="notranslate">filename</code>同步返回文件的内容。   <code class="notranslate">options</code>参数包含指定编码的<code class="notranslate">string</code> 。  如果未指定，则返回<a hhref="#string_tobytes">字节字符串</a> 。  如果指定了<code class="notranslate">utf8</code>编码，则返回Unicode字符串。  否则， <code class="notranslate">options</code>应该是具有以下键的对象： <dl class="compact"><dt> <code class="notranslate">encoding</code> </dt> <dd>  默认情况下，未指定编码。  编码可以是<code class="notranslate">utf8</code> </dd><dt> <code class="notranslate">flag</code> </dt> <dd>  文件系统<a hhref="#njs_api_fs_flags">标志</a> ，默认为<code class="notranslate">r</code> </dd></dl><blockquote class="example"><pre class="notranslate">&gt;&gt; var fs = require(‘fs’)<br>undefined<br>&gt;&gt; var file = fs.readFileSync(‘/file/path.tar.gz’)<br>undefined<br>&gt;&gt; var gzipped = /^\x1f\x8b/.test(file); gzipped<br>true<br></pre></blockquote></dd><dt id="writefilesync"> <code class="notranslate">writeFileSync( <code class="notranslate"><i>filename</i></code> , <code class="notranslate"><i>data</i></code> [, <code class="notranslate"><i>options</i></code> ])</code> </dt> <dd>  同步将<code class="notranslate">data</code>写入具有提供的<code class="notranslate">filename</code> 。  如果该文件不存在，则将创建该文件，如果该文件存在，则将替换该文件。   <code class="notranslate">options</code>参数应该是具有以下键的对象： <dl class="compact"><dt> <code class="notranslate">mode</code> </dt> <dd>   mode选项，默认为<code class="notranslate">0o666</code> </dd><dt> <code class="notranslate">flag</code> </dt> <dd>  文件系统<a hhref="#njs_api_fs_flags">标志</a> ，默认为<code class="notranslate">w</code> </dd></dl><blockquote class="example"><pre class="notranslate">&gt;&gt; var fs = require(‘fs’)<br>undefined<br>&gt;&gt; var file = fs.writeFileSync(‘hello.txt’, ‘Hello world’)<br>undefined<br></pre></blockquote></dd></dl><p></p><a name="njs_api_fs_flags"></a><center><h4>  文件系统标志 </h4></center><p>   <code class="notranslate">flag</code>选项可以接受以下值： </p><ul><li>   <code class="notranslate">a</code> - 打开要追加的文件。  如果文件不存在，则创建该文件 </li><li>   <code class="notranslate">ax</code> - 与<code class="notranslate">a</code>相同但如果文件已存在则失败 </li><li>   <code class="notranslate">a+</code> - 打开一个文件进行阅读和追加。  如果该文件不存在，则将创建该文件 </li><li>   <code class="notranslate">ax+</code> - 与<code class="notranslate">a+</code>相同但如果文件已经存在则失败 </li><li>   <code class="notranslate">as</code> - 打开一个文件以便以同步模式追加。  如果该文件不存在，则将创建该文件 </li><li>   <code class="notranslate">as+</code> - 打开一个文件以便以同步模式读取和追加。  如果该文件不存在，则将创建该文件 </li><li>   <code class="notranslate">r</code> - 打开文件进行阅读。  如果文件不存在，则会发生异常 </li><li>   <code class="notranslate">r+</code> - 打开一个文件进行读写。  如果文件不存在，则会发生异常 </li><li>   <code class="notranslate">rs+</code> - 打开一个文件，以同步模式读写。  指示操作系统绕过本地文件系统缓存 </li><li>   <code class="notranslate">w</code> - 打开文件进行写作。  如果该文件不存在，则将创建该文件。  如果文件存在，则将替换它 </li><li>   <code class="notranslate">wx</code> - 与<code class="notranslate">w</code>相同但如果文件已存在则失败 </li><li>   <code class="notranslate">w+</code> - 打开一个文件进行读写。  如果该文件不存在，则将创建该文件。  如果文件存在，则将替换它 </li><li>   <code class="notranslate">wx+</code> - 与<code class="notranslate">w+</code>相同但如果文件已存在则失败 </li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/ngx_google_perftools_module.html</url>
      <content type="html"><![CDATA[<p></p><h2 class="notranslate">Module ngx_google_perftools_module</h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#google_perftools_profiles">google_perftools_profiles</a> <br></td></tr></tbody></table><a name="summary"></a><p>   <code class="notranslate">ngx_google_perftoos_module</code>模块（0.6.29）支持使用<a hhref="https://github.com/gperftools/gperftools">Google Performance Tools</a>分析nginx工作进程。  该模块适用于nginx开发人员。 </p><p>  默认情况下不会构建此模块，应使用<code class="notranslate">–with-google_perftools_module</code>配置参数启用它。 </p><blockquote class="note">  该模块需要<a hhref="https://github.com/gperftools/gperftools">gperftools</a>库。 </blockquote><p></p><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">google_perftools_profiles /path/to/profile;<br></pre></blockquote><p>  配置文件将存储为<code class="notranslate">/path/to/profile.&lt;worker_pid&gt;</code> 。 </p><a name="directives"></a><center><h4>  指令 </h4></center><a name="google_perftools_profiles"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>google_perftools_profiles</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置一个文件名，用于保存nginx工作进程的分析信息。  工作进程的ID始终是文件名的一部分，并在点后面附加到文件名的末尾。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/ngx_core_module.html</url>
      <content type="html"><![CDATA[<p></p><h2>  核心功能 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#example">Example Configuration</a> <br> <a hhref="#directives">Directives</a> <br>     <a hhref="#accept_mutex">accept_mutex</a> <br>     <a hhref="#accept_mutex_delay">accept_mutex_delay</a> <br>     <a hhref="#daemon">daemon</a> <br>     <a hhref="#debug_connection">debug_connection</a> <br>     <a hhref="#debug_points">debug_points</a> <br>     <a hhref="#env">env</a> <br>     <a hhref="#error_log">error_log</a> <br>     <a hhref="#events">events</a> <br>     <a hhref="#include">include</a> <br>     <a hhref="#load_module">load_module</a> <br>     <a hhref="#lock_file">lock_file</a> <br>     <a hhref="#master_process">master_process</a> <br>     <a hhref="#multi_accept">multi_accept</a> <br>     <a hhref="#pcre_jit">pcre_jit</a> <br>     <a hhref="#pid">pid</a> <br>     <a hhref="#ssl_engine">ssl_engine</a> <br>     <a hhref="#thread_pool">thread_pool</a> <br>     <a hhref="#timer_resolution">timer_resolution</a> <br>     <a hhref="#use">use</a> <br>     <a hhref="#user">user</a> <br>     <a hhref="#worker_aio_requests">worker_aio_requests</a> <br>     <a hhref="#worker_connections">worker_connections</a> <br>     <a hhref="#worker_cpu_affinity">worker_cpu_affinity</a> <br>     <a hhref="#worker_priority">worker_priority</a> <br>     <a hhref="#worker_processes">worker_processes</a> <br>     <a hhref="#worker_rlimit_core">worker_rlimit_core</a> <br>     <a hhref="#worker_rlimit_nofile">worker_rlimit_nofile</a> <br>     <a hhref="#worker_shutdown_timeout">worker_shutdown_timeout</a> <br>     <a hhref="#working_directory">working_directory</a> <br></td></tr></tbody></table><a name="example"></a><center><h4>  示例配置 </h4></center><p></p><blockquote class="example"><pre class="notranslate">user www www;<br>worker_processes 2;<p></p>
<p>error_log /var/log/nginx-error.log info;</p>
<p>events {<br>    use kqueue;<br>    worker_connections 2048;<br>}</p>
<p>…<br></p></pre></blockquote><p></p><a name="directives"></a><center><h4>  指令 </h4></center><a name="accept_mutex"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>accept_mutex</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">accept_mutex off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">events</code> <br><br>                </td></tr></tbody></table></div><p>  如果启用了<code class="notranslate">accept_mutex</code> ，则工作进程将依次接受新连接。  否则，将通知所有工作进程有关新连接的信息，如果新连接的数量很少，则某些工作进程可能只是浪费系统资源。 </p><blockquote class="note">  无需在支持<a hhref="events.html#epoll">EPOLLEXCLUSIVE</a>标志（1.11.3）的系统上或使用<a hhref="http/ngx_http_core_module.html#reuseport">reuseport</a>时<a hhref="http/ngx_http_core_module.html#reuseport">启用accept_mutex</a> 。 </blockquote><p></p><blockquote class="note">  在1.11.3版之前，默认值为<code class="notranslate">on</code> 。 </blockquote><p></p><a name="accept_mutex_delay"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>accept_mutex_delay</strong> <code class="notranslate"><i>time</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">accept_mutex_delay 500ms;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">events</code> <br><br>                </td></tr></tbody></table></div><p>  如果启用了<a hhref="#accept_mutex">accept_mutex</a> ，则指定当另一个工作进程当前正在接受新连接时，工作进程将尝试重新启动接受新连接的最长时间。 </p><a name="daemon"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>daemon</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">daemon on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">main</code> <br><br>                </td></tr></tbody></table></div><p>  确定nginx是否应该成为守护进程。  主要用于开发过程中。 </p><a name="debug_connection"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>debug_connection</strong><br>    <code class="notranslate"><i>address</i></code> |<br>    <code class="notranslate"><i>CIDR</i></code> |<br>    <code class="notranslate">unix:</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;events&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  为选定的客户端连接启用调试日志。  其他连接将使用&lt;a hhref=&quot;#error_log&quot;&gt;error_log&lt;/a&gt;指令设置的日志记录级别。  调试连接由IPv4或IPv6（1.3.0,1.2.1）地址或网络指定。  也可以使用主机名指定连接。  对于使用UNIX域套接字（1.3.0,1.2.1）的连接，调试日志由“ &lt;code class=&quot;notranslate&quot;&gt;unix:&lt;/code&gt; ”参数启用。 &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;events {
debug_connection 127.0.0.1;
debug_connection localhost;
debug_connection 192.0.2.0/24;
debug_connection ::1;
debug_connection 2001:0db8::/32;
debug_connection unix:;
...
</code></pre><p>}<br></p><p></p><blockquote class="note">  要使此指令起作用，需要使用<code class="notranslate">–with-debug</code>构建nginx，请参阅“ <a hhref="debugging_log.html">调试日志</a> ”。 </blockquote><p></p><a name="debug_points"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>debug_points</strong> <code class="notranslate">abort</code> | <code class="notranslate">stop</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  该指令用于调试。 &lt;/p&gt;&lt;p&gt;  当检测到内部错误时，例如在重新启动工作进程时套接字泄漏，启用&lt;code class=&quot;notranslate&quot;&gt;debug_points&lt;/code&gt;会导致核心文件创建（ &lt;code class=&quot;notranslate&quot;&gt;abort&lt;/code&gt; ）或停止进程（ &lt;code class=&quot;notranslate&quot;&gt;stop&lt;/code&gt; ）以使用系统调试器进行进一步分析。 &lt;/p&gt;&lt;a name=&quot;env&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;env&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;variable&lt;/i&gt;&lt;/code&gt; [= &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;value&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;env TZ;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  默认情况下，nginx会删除从其父进程继承的所有环境变量，但TZ变量除外。  该指令允许保留一些继承的变量，更改其值或创建新的环境变量。  那么这些变量是： &lt;/p&gt;&lt;ul class=&quot;compact&quot;&gt;&lt;li&gt;  在可执行文件的&lt;a hhref=&quot;control.html#upgrade&quot;&gt;实时升级&lt;/a&gt;期间继承; &lt;/li&gt;&lt;li&gt;  由&lt;a hhref=&quot;http/ngx_http_perl_module.html&quot;&gt;ngx_http_perl_module&lt;/a&gt;模块使用; &lt;/li&gt;&lt;li&gt;  由工作进程使用。  应该记住，以这种方式控制系统库并不总是可行的，因为库只在初始化期间检查变量是常见的，远在它们可以使用该指令设置之前。  一个例外是上面提到的可执行文件的&lt;a hhref=&quot;control.html#upgrade&quot;&gt;实时升级&lt;/a&gt; 。 &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;  除非明确配置，否则TZ变量始终继承并可供&lt;a hhref=&quot;http/ngx_http_perl_module.html&quot;&gt;ngx_http_perl_module&lt;/a&gt;模块使用。 &lt;/p&gt;&lt;p&gt;  用法示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;env MALLOC_OPTIONS;
</code></pre><p>env PERL5LIB=/data/site/modules;<br>env OPENSSL_ALLOW_PROXY_CERTS=1;<br></p><p></p><p></p><blockquote class="note">   NGINX环境变量由nginx在内部使用，不应由用户直接设置。 </blockquote><p></p><a name="error_log"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>error_log</strong> <code class="notranslate"><i>file</i></code> [ <code class="notranslate"><i>level</i></code> ];</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">error_log logs/error.log error;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">main</code> , <code class="notranslate">http</code> , <code class="notranslate">mail</code> , <code class="notranslate">stream</code> , <code class="notranslate">server</code> , <code class="notranslate">location</code> <br><br>                </td></tr></tbody></table></div><p>  配置日志记录。  可以在同一级别指定多个日志（1.5.2）。  如果在<code class="notranslate">main</code>配置级别上未明确定义将日志写入文件，则将使用默认文件。 </p><p>  第一个参数定义将存储日志的<code class="notranslate"><i>file</i></code> 。  特殊值<code class="notranslate">stderr</code>选择标准错误文件。  可以通过指定“ <code class="notranslate">syslog:</code> ”前缀来配置记录到<a hhref="syslog.html">syslog</a> 。  可以通过指定“ <code class="notranslate">memory:</code> ”前缀和缓冲区<code class="notranslate"><i>size</i></code>来配置记录到<a hhref="debugging_log.html#memory">循环内存缓冲区</a> ，通常用于调试（1.7.11）。 </p><p>  第二个参数确定日志记录<code class="notranslate"><i>level</i></code> ，可以是以下之一： <code class="notranslate">debug</code> ， <code class="notranslate">info</code> ， <code class="notranslate">notice</code> ， <code class="notranslate">warn</code> ， <code class="notranslate">error</code> ， <code class="notranslate">crit</code> ， <code class="notranslate">alert</code>或<code class="notranslate">emerg</code> 。  上面的日志级别按严重性增加的顺序列出。  设置某个日志级别将导致记录指定和更严重日志级别的所有消息。  例如，默认级别<code class="notranslate">error</code>将导致记录<code class="notranslate">error</code> ， <code class="notranslate">crit</code> ， <code class="notranslate">alert</code>和<code class="notranslate">emerg</code>消息。  如果省略此参数，则使用<code class="notranslate">error</code> 。 </p><blockquote class="note">  要使<code class="notranslate">debug</code>日志记录正常工作，需要使用<code class="notranslate">–with-debug</code>构建nginx，请参阅“ <a hhref="debugging_log.html">调试日志</a> ”。 </blockquote><p></p><blockquote class="note">  该指令可以在从1.7.11版本开始的<code class="notranslate">stream</code>级别上指定，也可以在从1.9.0版本开始的<code class="notranslate">mail</code>级别上指定。 </blockquote><p></p><a name="events"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>events</strong> { … }</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  提供配置文件上下文，其中指定了影响连接处理的指令。 &lt;/p&gt;&lt;a name=&quot;include&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;include&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt; | &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;mask&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;any&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  包含另一个&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;file&lt;/i&gt;&lt;/code&gt;或与指定&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;mask&lt;/i&gt;&lt;/code&gt;匹配的文件到配置中。  包含的文件应包含语法正确的指令和块。 &lt;/p&gt;&lt;p&gt;  用法示例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;include mime.types;
</code></pre><p>include vhosts/*.conf;<br></p><p></p><a name="load_module"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>load_module</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.9.11版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  加载动态模块。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;load_module modules/ngx_mail_module.so;
</code></pre><p></p><p></p><a name="lock_file"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>lock_file</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">lock_file logs/nginx.lock;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">main</code> <br><br>                </td></tr></tbody></table></div><p>   nginx使用锁定机制来实现<a hhref="#accept_mutex">accept_mutex</a>并序列化对共享内存的访问。  在大多数系统上，锁是使用原子操作实现的，并且忽略该指令。  在其他系统上，使用“锁定文件”机制。  该指令指定锁文件名称的前缀。 </p><a name="master_process"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>master_process</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">master_process on;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">main</code> <br><br>                </td></tr></tbody></table></div><p>  确定是否已启动工作进程。  该指令适用于nginx开发人员。 </p><a name="multi_accept"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>multi_accept</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">multi_accept off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">events</code> <br><br>                </td></tr></tbody></table></div><p>  如果禁用<code class="notranslate">multi_accept</code>则工作进程将一次接受一个新连接。  否则，工作进程将一次接受所有新连接。 </p><blockquote class="note">  如果使用<a hhref="events.html#kqueue">kqueue</a>连接处理方法，则忽略该指令，因为它报告了等待接受的新连接的数量。 </blockquote><p></p><a name="pcre_jit"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>pcre_jit</strong> <code class="notranslate">on</code> | <code class="notranslate">off</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">pcre_jit off;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">main</code> <br><br>                </td></tr></tbody></table><p>  该指令出现在1.1.12版本中。 </p></div><p>  启用或禁用对配置解析时已知的正则表达式使用“即时编译”（PCRE JIT）。 </p><p>   PCRE JIT可以显着加快正则表达式的处理速度。 </p><blockquote class="note">  从使用<code class="notranslate">–enable-jit</code>配置参数构建的8.20版开始，JIT在PCRE库中可用。  当使用nginx（– <code class="notranslate">–with-pcre=</code> ）构建PCRE库时，通过<code class="notranslate">–with-pcre-jit</code>配置参数启用JIT支持。 </blockquote><p></p><a name="pid"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>pid</strong> <code class="notranslate"><i>file</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">pid logs/nginx.pid;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">main</code> <br><br>                </td></tr></tbody></table></div><p>  定义将存储主进程的进程ID的<code class="notranslate"><i>file</i></code> 。 </p><a name="ssl_engine"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>ssl_engine</strong> <code class="notranslate"><i>device</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义硬件SSL加速器的名称。 &lt;/p&gt;&lt;a name=&quot;thread_pool&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;thread_pool&lt;/strong&gt; 
&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;name&lt;/i&gt;&lt;/code&gt;
&lt;code class=&quot;notranslate&quot;&gt;threads&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt;
[ &lt;code class=&quot;notranslate&quot;&gt;max_queue&lt;/code&gt; = &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;pre class=&quot;notranslate&quot;&gt;thread_pool default threads=32 max_queue=65536;&lt;/pre&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.7.11版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  定义用于多线程读取和发送文件&lt;a hhref=&quot;http/ngx_http_core_module.html#aio&quot;&gt;而不阻塞&lt;/a&gt;工作进程的命名线程池。 &lt;/p&gt;&lt;p&gt;   &lt;code class=&quot;notranslate&quot;&gt;threads&lt;/code&gt;参数定义池中的线程数。 &lt;/p&gt;&lt;p&gt;  如果池中的所有线程都忙，则新任务将在队列中等待。   &lt;code class=&quot;notranslate&quot;&gt;max_queue&lt;/code&gt;参数限制允许在队列中等待的任务数。  默认情况下，队列中最多可以等待65536个任务。  当队列溢出时，任务完成并出现错误。 &lt;/p&gt;&lt;a name=&quot;timer_resolution&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Syntax:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;timer_resolution&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;interval&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Default:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

        —

            &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
        Context:
            &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
        &lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
            &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  减少工作进程中的计时器分辨率，从而减少&lt;code class=&quot;notranslate&quot;&gt;gettimeofday()&lt;/code&gt;系统调用的次数。  默认情况下，每次收到内核事件时都会调用&lt;code class=&quot;notranslate&quot;&gt;gettimeofday()&lt;/code&gt; 。  在降低分辨率的情况下， &lt;code class=&quot;notranslate&quot;&gt;gettimeofday()&lt;/code&gt;仅在每个指定的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;interval&lt;/i&gt;&lt;/code&gt;调用一次。 &lt;/p&gt;&lt;p&gt;  例： &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;timer_resolution 100ms;
</code></pre><p></p><p></p><p>  间隔的内部实现取决于使用的方法： </p><ul class="compact"><li>  如果使用<code class="notranslate">kqueue</code> ， <code class="notranslate">EVFILT_TIMER</code>过滤器; </li><li>   <code class="notranslate">timer_create()</code>如果使用了<code class="notranslate">eventport</code> ; </li><li>   <code class="notranslate">setitimer()</code>否则。 </li></ul><p></p><a name="use"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>use</strong> <code class="notranslate"><i>method</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;events&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  指定要使用的&lt;a hhref=&quot;events.html&quot;&gt;连接处理&lt;/a&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;method&lt;/i&gt;&lt;/code&gt; 。  通常不需要明确指定它，因为nginx默认使用最有效的方法。 &lt;/p&gt;&lt;a name=&quot;user&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;user&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;user&lt;/i&gt;&lt;/code&gt; [ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;group&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;user nobody nobody;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义工作进程使用的&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;user&lt;/i&gt;&lt;/code&gt;和&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;group&lt;/i&gt;&lt;/code&gt;凭据。  如果省略group，则使用名称等于&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;user&lt;/i&gt;&lt;/code&gt;的组。 &lt;/p&gt;&lt;a name=&quot;worker_aio_requests&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;worker_aio_requests&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;worker_aio_requests 32;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;events&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.1.4和1.0.7版本中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  将&lt;a hhref=&quot;http/ngx_http_core_module.html#aio&quot;&gt;aio&lt;/a&gt;与&lt;a hhref=&quot;events.html#epoll&quot;&gt;epoll&lt;/a&gt;连接处理方法一起使用时，设置单个工作进程的未完成异步I / O操作的最大&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; 。 &lt;/p&gt;&lt;a name=&quot;worker_connections&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;worker_connections&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;pre class=&quot;notranslate&quot;&gt;worker_connections 512;&lt;/pre&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;events&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  设置工作进程可以打开的最大并发连接数。 &lt;/p&gt;&lt;p&gt;  应该记住，这个数字包括所有连接（例如与代理服务器的连接等），而不仅仅是与客户端的连接。  另一个考虑因素是实际的并发连接数不能超过最大打开文件数的当前限制，可以通过&lt;a hhref=&quot;#worker_rlimit_nofile&quot;&gt;worker_rlimit_nofile&lt;/a&gt;更改。 &lt;/p&gt;&lt;a name=&quot;worker_cpu_affinity&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;worker_cpu_affinity&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;cpumask&lt;/i&gt;&lt;/code&gt; ...;&lt;/code&gt; &lt;br&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;worker_cpu_affinity&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;auto&lt;/code&gt; [ &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;cpumask&lt;/i&gt;&lt;/code&gt; ];&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  将工作进程绑定到CPU组。  每个CPU集由允许的CPU的位掩码表示。  应该为每个工作进程定义一个单独的集合。  默认情况下，工作进程不绑定到任何特定的CPU。 &lt;/p&gt;&lt;p&gt;  例如， &lt;/p&gt;&lt;blockquote class=&quot;example&quot;&gt;&lt;pre class=&quot;notranslate&quot;&gt;worker_processes    4;
</code></pre><p>worker_cpu_affinity 0001 0010 0100 1000;<br></p><p>  将每个工作进程绑定到一个单独的CPU，同时 </p><blockquote class="example"><pre class="notranslate">worker_processes    2;<br>worker_cpu_affinity 0101 1010;<br></pre></blockquote><p>  将第一个工作进程绑定到CPU0 / CPU2，将第二个工作进程绑定到CPU1 / CPU3。  第二个例子适用于超线程。 </p><p>  特殊值<code class="notranslate">auto</code> （1.9.10）允许将工作进程自动绑定到可用的CPU： </p><blockquote class="example"><pre class="notranslate">worker_processes auto;<br>worker_cpu_affinity auto;<br></pre></blockquote><p>  可选的mask参数可用于限制可用于自动绑定的CPU： </p><blockquote class="example"><pre class="notranslate">worker_cpu_affinity auto 01010101;<br></pre></blockquote><p></p><p></p><blockquote class="note">  该指令仅适用于FreeBSD和Linux。 </blockquote><p></p><a name="worker_priority"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>worker_priority</strong> <code class="notranslate"><i>number</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">worker_priority 0;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">main</code> <br><br>                </td></tr></tbody></table></div><p>  定义工作进程的调度优先级，就像使用<code class="notranslate">nice</code>命令一样：负数表示更高的优先级。  允许范围通常在-20到20之间变化。 </p><p>  例： </p><blockquote class="example"><pre class="notranslate">worker_priority -10;<br></pre></blockquote><p></p><a name="worker_processes"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>worker_processes</strong> <code class="notranslate"><i>number</i></code> | <code class="notranslate">auto</code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><br>            <pre class="notranslate">worker_processes 1;</pre><br>                </td></tr><tr><th class="notranslate"><br>            Context:<br>                </th><td class="notranslate"><br>            <code class="notranslate">main</code> <br><br>                </td></tr></tbody></table></div><p>  定义工作进程的数量。 </p><p>  最佳值取决于许多因素，包括（但不限于）CPU核心数，存储数据的硬盘驱动器数和负载模式。  如果有疑问，将其设置为可用CPU核心数将是一个良好的开端（值“ <code class="notranslate">auto</code> ”将尝试自动检测它）。 </p><blockquote class="note">  从版本1.3.8和1.2.5开始支持<code class="notranslate">auto</code>参数。 </blockquote><p></p><a name="worker_rlimit_core"></a><div class="directive"><table cellspacing="0"><tbody><tr><th class="notranslate"><br>            Syntax:<br>                </th><td class="notranslate"><br>            <code class="notranslate"><strong>worker_rlimit_core</strong> <code class="notranslate"><i>size</i></code> ;</code> <br><br>                </td></tr><tr><th class="notranslate"><br>            Default:<br>                </th><td class="notranslate"><p></p>
<pre><code>—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  更改工作进程的核心文件（ &lt;code class=&quot;notranslate&quot;&gt;RLIMIT_CORE&lt;/code&gt; ）的最大大小限制。  用于在不重新启动主进程的情况下增加限制。 &lt;/p&gt;&lt;a name=&quot;worker_rlimit_nofile&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;worker_rlimit_nofile&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;number&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  更改工作进程的最大打开文件数（ &lt;code class=&quot;notranslate&quot;&gt;RLIMIT_NOFILE&lt;/code&gt; ）限制。  用于在不重新启动主进程的情况下增加限制。 &lt;/p&gt;&lt;a name=&quot;worker_shutdown_timeout&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;worker_shutdown_timeout&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;  该指令出现在1.11.11版中。 &lt;/p&gt;&lt;/div&gt;&lt;p&gt;  配置正常关闭工作进程的超时。  当&lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;time&lt;/i&gt;&lt;/code&gt;到期时，nginx将尝试关闭当前打开的所有连接以方便关闭。 &lt;/p&gt;&lt;a name=&quot;working_directory&quot;&gt;&lt;/a&gt;&lt;div class=&quot;directive&quot;&gt;&lt;table cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Syntax:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;&lt;strong&gt;working_directory&lt;/strong&gt; &lt;code class=&quot;notranslate&quot;&gt;&lt;i&gt;directory&lt;/i&gt;&lt;/code&gt; ;&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Default:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;

—

    &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th class=&quot;notranslate&quot;&gt;
Context:
    &lt;/th&gt;&lt;td class=&quot;notranslate&quot;&gt;
&lt;code class=&quot;notranslate&quot;&gt;main&lt;/code&gt; &lt;br&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;  定义工作进程的当前工作目录。  它主要在编写核心文件时使用，在这种情况下，工作进程应具有指定目录的写入权限。 &lt;/p&gt; 
</code></pre><p><span></span><div style="display: none;"></div></p>
</td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div></td></tr></tbody></table></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/nginx_dtrace_pid_provider.html</url>
      <content type="html"><![CDATA[<p></p><h2>  使用DTrace pid提供程序调试nginx </h2><p>  本文假设读者具有nginx内部和<a hhref="#see_also">DTrace</a>的一般知识。 </p><p>  尽管使用<a hhref="debugging_log.html">–with-debug</a>选项构建的nginx已经提供了大量有关请求处理的信息，但有时需要更彻底地跟踪代码路径的特定部分，同时省略其余的调试输出。   DTrace pid提供程序（在Solaris，macOS上提供）是一个用于探索userland程序内部的有用工具，因为它不需要任何代码更改，它可以帮助完成任务。  用于跟踪和打印nginx函数调用的简单DTrace脚本可能如下所示： </p><blockquote class="example"><pre class="notranslate">#pragma D option flowindent<p></p>
<p>pid$target:nginx::entry {<br>}</p>
<p>pid$target:nginx::return {<br>}<br></p></pre></blockquote><p></p><p>  但是，函数调用跟踪的DTrace功能仅提供有限的有用信息。  函数参数的实时检查通常更有趣，但也更复杂一些。  以下示例旨在帮助读者更熟悉DTrace以及使用DTrace分析nginx行为的过程。 </p><p>  将DTrace与nginx一起使用的常见方案之一如下：附加到nginx工作进程以记录请求行和请求开始时间。  要附加的相应函数是<code class="notranslate">ngx_http_process_request()</code> ，所讨论的参数是指向<code class="notranslate">ngx_http_request_t</code>结构的指针。  用于此类请求记录的DTrace脚本可以如下所示： </p><blockquote class="example"><pre class="notranslate">pid$target::<em>ngx_http_process_request:entry<br>{<br>    this-&gt;request = (ngx_http_request_t </em>)copyin(arg0, sizeof(ngx_http_request_t));<br>    this-&gt;request_line = stringof(copyin((uintptr_t)this-&gt;request-&gt;request_line.data,<br>                                         this-&gt;request-&gt;request_line.len));<br>    printf(“request line = %s\n”, this-&gt;request_line);<br>    printf(“request start sec = %d\n”, this-&gt;request-&gt;start_sec);<br>}<br></pre></blockquote><p></p><p>  应该注意的是，在上面的示例中，DTrace需要一些关于<code class="notranslate">ngx_http_process_request</code>结构的知识。  不幸的是，虽然可以在DTrace脚本中使用特定的<code class="notranslate">#include</code>指令，然后将其传递给C预处理器（带有<code class="notranslate">-C</code>标志），但这并不能真正起作用。  由于存在大量的交叉依赖性，因此几乎所有的nginx头文件都必须包含在内。  反过来，基于<code class="notranslate">configure</code>脚本设置，nginx标头将包括PCRE，OpenSSL和各种系统头文件。  虽然理论上所有与特定nginx构建相关的头文件都可能包含在DTrace脚本预处理和编译中，但实际上DTrace脚本很可能由于某些头文件中的语法未知而无法编译。 </p><p>  上述问题可以通过在DTrace脚本中仅包含相关且必要的结构和类型定义来解决。   DTrace必须知道结构，类型和字段偏移的大小。  因此，可以通过手动优化用于DTrace的结构定义来进一步减少依赖性。 </p><p>  让我们使用上面的DTrace脚本示例，看看它需要什么样的结构定义才能正常工作。 </p><p>  首先应该包括configure生成的<code class="notranslate">objs/ngx_auto_config.h</code>文件，因为它定义了一些影响各种<code class="notranslate">#ifdef</code>的常量。  之后， <code class="notranslate">ngx_table_elt_t</code>一些基本类型和定义（如<code class="notranslate">ngx_str_t</code> ， <code class="notranslate">ngx_table_elt_t</code> ， <code class="notranslate">ngx_uint_t</code>等）放在DTrace脚本的开头。  这些定义是紧凑的，常用且不太可能经常改变。 </p><p>  然后是<code class="notranslate">ngx_http_process_request_t</code>结构，其中包含许多指向其他结构的指针。  因为这些指针实际上与此脚本无关，并且因为它们具有相同的大小，所以可以用void指针替换它们。  不是更改定义，最好添加适当的typedef，但是： </p><blockquote class="example"><pre class="notranslate">typedef ngx_http_upstream_t     void;<br>typedef ngx_http_request_body_t void;<br></pre></blockquote><p>  最后但并非最不重要的是，有必要添加两个成员结构的定义（ <code class="notranslate">ngx_http_headers_in_t</code> ， <code class="notranslate">ngx_http_headers_out_t</code> ），回调函数的声明和常量的定义。 </p><p>  最终的DTrace脚本可以从<a hhref="http://nginx.org/download/trace_process_request.d">这里</a>下载。 </p><p>  以下示例显示了运行此脚本的输出： </p><blockquote class="example"><pre class="notranslate"># dtrace -C -I ./objs -s trace_process_request.d -p 4848<br>dtrace: script ‘trace_process_request.d’ matched 1 probe<br>CPU     ID                    FUNCTION:NAME<br>  1      4 .XAbmO.ngx_http_process_request:entry request line = GET / HTTP/1.1<br>request start sec = 1349162898<p></p>
<p>  0      4 .XAbmO.ngx_http_process_request:entry request line = GET /en/docs/nginx_dtrace_pid_provider.html HTTP/1.1<br>request start sec = 1349162899<br></p></pre></blockquote><p></p><p>  使用类似的技术，读者应该能够跟踪其他nginx函数调用。 </p><a name="see_also"></a><center><h4>  也可以看看 </h4></center><p></p><ul class="compact"><li>   <a hhref="http://docs.oracle.com/cd/E19253-01/817-6223/index.html">Solaris动态跟踪指南</a> </li><li>   <a hhref="http://dtrace.org/blogs/brendan/2011/02/09/dtrace-pid-provider/">有关DTrace pid提供程序的简介文章</a> </li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/linux_packages.html</url>
      <content type="html"><![CDATA[<p></p><h2>   nginx：Linux包 </h2><a name="distributions"></a><p>  目前，nginx软件包可用于以下发行版和版本： </p><p>   RHEL / CentOS的： </p><blockquote><table width="100%"><tbody><tr><td width="20%" class="notranslate">Version</td><td class="notranslate">Supported Platforms</td></tr><tr><td width="20%" class="notranslate">6.x</td><td class="notranslate">x86_64, i386</td></tr><tr><td width="20%" class="notranslate">7.4+</td><td class="notranslate">x86_64, ppc64le</td></tr></tbody></table></blockquote><p></p><p>   Debian的： </p><blockquote><table width="100%"><tbody><tr><td width="20%" class="notranslate">Version</td><td width="20%" class="notranslate">Codename</td><td class="notranslate">Supported Platforms</td></tr><tr><td width="20%" class="notranslate">8.x</td><td width="20%" class="notranslate">jessie</td><td class="notranslate">x86_64, i386</td></tr><tr><td width="20%" class="notranslate">9.x</td><td width="20%" class="notranslate">stretch</td><td class="notranslate">x86_64, i386</td></tr></tbody></table></blockquote><p></p><p>   Ubuntu的： </p><blockquote><table width="100%"><tbody><tr><td width="20%" class="notranslate">Version</td><td width="20%" class="notranslate">Codename</td><td class="notranslate">Supported Platforms</td></tr><tr><td width="20%" class="notranslate">14.04</td><td width="20%" class="notranslate">trusty</td><td class="notranslate">x86_64, i386, aarch64/arm64</td></tr><tr><td width="20%" class="notranslate">16.04</td><td width="20%" class="notranslate">xenial</td><td class="notranslate">x86_64, i386, ppc64el, aarch64/arm64</td></tr><tr><td width="20%" class="notranslate">18.04</td><td width="20%" class="notranslate">bionic</td><td class="notranslate">x86_64, aarch64/arm64</td></tr><tr><td width="20%" class="notranslate">18.10</td><td width="20%" class="notranslate">cosmic</td><td class="notranslate">x86_64</td></tr></tbody></table></blockquote><p></p><p>   SLES： </p><blockquote><table width="100%"><tbody><tr><td width="20%" class="notranslate">Version</td><td class="notranslate">Supported Platforms</td></tr><tr><td width="20%" class="notranslate">12</td><td class="notranslate">x86_64</td></tr><tr><td width="20%" class="notranslate">15</td><td class="notranslate">x86_64</td></tr></tbody></table></blockquote><p></p><p>  要启用Linux软件包的自动更新，请为RHEL / CentOS发行版设置yum存储库，为Debian / Ubuntu发行版设置apt存储库，或为SLES设置zypper存储库。 </p><a name="stable"></a><center><h4>  用于稳定版本的预制包 </h4></center><p>  要为RHEL / CentOS设置yum存储库，请使用以下内容创建名为<code class="notranslate">/etc/yum.repos.d/nginx.repo</code>的文件： </p><blockquote class="example"><pre class="notranslate">[nginx]<br>name=nginx repo<br>baseurl=<a href="http://nginx.org/packages/OS/OSRELEASE/$basearch/" target="_blank" rel="noopener">http://nginx.org/packages/OS/OSRELEASE/$basearch/</a><br>gpgcheck=0<br>enabled=1<br></pre></blockquote><p>  对于6.x或7.x版本，将“ <code class="notranslate">OS</code> ”替换为“ <code class="notranslate">rhel</code> ”或“ <code class="notranslate">centos</code> ”，取决于所使用的分布，将“ <code class="notranslate">OSRELEASE</code> ”替换为“ <code class="notranslate">6</code> ”或“ <code class="notranslate">7</code> ”。 </p><p>  对于Debian / Ubuntu，为了验证nginx存储库签名并在安装nginx包期间消除有关丢失PGP密钥的警告，有必要将用于签署nginx包和存储库的密钥添加到<code class="notranslate">apt</code>程序密钥环。  请从我们的网站下载<a hhref="/keys/nginx_signing.key">此密钥</a> ，并使用以下命令将其添加到<code class="notranslate">apt</code>程序密钥环： </p><blockquote class="example"><pre class="notranslate">sudo apt-key add nginx_signing.key<br></pre></blockquote><p></p><p>  对于Debian，用Debian分发<a hhref="#distributions">代号</a>取代<i>代号</i> ，并将以下内容附加到<code class="notranslate">/etc/apt/sources.list</code>文件的末尾： </p><blockquote class="example"><pre class="notranslate">deb <a href="http://nginx.org/packages/debian/" target="_blank" rel="noopener">http://nginx.org/packages/debian/</a> <i>codename</i> nginx<br>deb-src <a href="http://nginx.org/packages/debian/" target="_blank" rel="noopener">http://nginx.org/packages/debian/</a> <i>codename</i> nginx<br></pre></blockquote><p></p><p>  对于Ubuntu，使用Ubuntu分发<a hhref="#distributions">代号来</a>替换<i>代号</i> ，并将以下内容附加到<code class="notranslate">/etc/apt/sources.list</code>文件的末尾： </p><blockquote class="example"><pre class="notranslate">deb <a href="http://nginx.org/packages/ubuntu/" target="_blank" rel="noopener">http://nginx.org/packages/ubuntu/</a> <i>codename</i> nginx<br>deb-src <a href="http://nginx.org/packages/ubuntu/" target="_blank" rel="noopener">http://nginx.org/packages/ubuntu/</a> <i>codename</i> nginx<br></pre></blockquote><p></p><p>  对于Debian / Ubuntu，然后运行以下命令： </p><blockquote class="example"><pre class="notranslate">apt-get update<br>apt-get install nginx<br></pre></blockquote><p></p><p>  对于SLES 12，运行以下命令： </p><blockquote class="example"><pre class="notranslate">zypper addrepo -G -t yum -c ‘<a href="http://nginx.org/packages/sles/12" target="_blank" rel="noopener">http://nginx.org/packages/sles/12</a>‘ nginx<br></pre></blockquote><p></p><p>  对于SLES 15，运行以下命令： </p><blockquote class="example"><pre class="notranslate">zypper addrepo -G -t yum -c ‘<a href="http://nginx.org/packages/sles/15" target="_blank" rel="noopener">http://nginx.org/packages/sles/15</a>‘ nginx<br></pre></blockquote><p></p><a name="mainline"></a><center><h4>   Mainline版本的预构建包 </h4></center><p>  要为RHEL / CentOS设置yum存储库，请使用以下内容创建名为<code class="notranslate">/etc/yum.repos.d/nginx.repo</code>的文件： </p><blockquote class="example"><pre class="notranslate">[nginx]<br>name=nginx repo<br>baseurl=<a href="http://nginx.org/packages/mainline/OS/OSRELEASE/$basearch/" target="_blank" rel="noopener">http://nginx.org/packages/mainline/OS/OSRELEASE/$basearch/</a><br>gpgcheck=0<br>enabled=1<br></pre></blockquote><p>  对于6.x或7.x版本，将“ <code class="notranslate">OS</code> ”替换为“ <code class="notranslate">rhel</code> ”或“ <code class="notranslate">centos</code> ”，取决于所使用的分布，将“ <code class="notranslate">OSRELEASE</code> ”替换为“ <code class="notranslate">6</code> ”或“ <code class="notranslate">7</code> ”。 </p><p>  对于Debian / Ubuntu，为了验证nginx存储库签名并在安装nginx包期间消除有关丢失PGP密钥的警告，有必要将用于签署nginx包和存储库的密钥添加到<code class="notranslate">apt</code>程序密钥环。  请从我们的网站下载<a hhref="/keys/nginx_signing.key">此密钥</a> ，并使用以下命令将其添加到<code class="notranslate">apt</code>程序密钥环： </p><blockquote class="example"><pre class="notranslate">sudo apt-key add nginx_signing.key<br></pre></blockquote><p></p><p>  对于Debian，用Debian分发<a hhref="#distributions">代号</a>取代<i>代号</i> ，并将以下内容附加到<code class="notranslate">/etc/apt/sources.list</code>文件的末尾： </p><blockquote class="example"><pre class="notranslate">deb <a href="http://nginx.org/packages/mainline/debian/" target="_blank" rel="noopener">http://nginx.org/packages/mainline/debian/</a> <i>codename</i> nginx<br>deb-src <a href="http://nginx.org/packages/mainline/debian/" target="_blank" rel="noopener">http://nginx.org/packages/mainline/debian/</a> <i>codename</i> nginx<br></pre></blockquote><p></p><p>  对于Ubuntu，使用Ubuntu分发<a hhref="#distributions">代号来</a>替换<i>代号</i> ，并将以下内容附加到<code class="notranslate">/etc/apt/sources.list</code>文件的末尾： </p><blockquote class="example"><pre class="notranslate">deb <a href="http://nginx.org/packages/mainline/ubuntu/" target="_blank" rel="noopener">http://nginx.org/packages/mainline/ubuntu/</a> <i>codename</i> nginx<br>deb-src <a href="http://nginx.org/packages/mainline/ubuntu/" target="_blank" rel="noopener">http://nginx.org/packages/mainline/ubuntu/</a> <i>codename</i> nginx<br></pre></blockquote><p></p><p>  对于Debian / Ubuntu，然后运行以下命令： </p><blockquote class="example"><pre class="notranslate">apt-get update<br>apt-get install nginx<br></pre></blockquote><p></p><p>  对于SLES 12，运行以下命令： </p><blockquote class="example"><pre class="notranslate">zypper addrepo -G -t yum -c ‘<a href="http://nginx.org/packages/mainline/sles/12" target="_blank" rel="noopener">http://nginx.org/packages/mainline/sles/12</a>‘ nginx<br></pre></blockquote><p></p><p>  对于SLES 15，运行以下命令： </p><blockquote class="example"><pre class="notranslate">zypper addrepo -G -t yum -c ‘<a href="http://nginx.org/packages/mainline/sles/15" target="_blank" rel="noopener">http://nginx.org/packages/mainline/sles/15</a>‘ nginx<br></pre></blockquote><p></p><a name="sourcepackages"></a><center><h4>  源包 </h4></center><p>  包装源可以在<a hhref="http://hg.nginx.org/pkg-oss">包装源库中找到</a> 。 </p><p>   <code class="notranslate">default</code>分支包含当前主线版本的打包源，而<code class="notranslate">stable-*</code>分支包含稳定版本的最新源。  要构建二进制包，请在Debian / Ubuntu上的<code class="notranslate">debian/</code>目录中运行<code class="notranslate">make</code> ，或在RHEL / CentOS / SLES上的<code class="notranslate">rpm/SPECS/</code>运行<code class="notranslate">make</code> 。 </p><p>  打包源在nginx使用的相同的<a hhref="LICENSE">2条款BSD类许可证</a>下分发。 </p><a name="dynmodules"></a><center><h4>  动态模块 </h4></center><p>  主nginx包是使用所有模块构建的，这些模块不需要额外的库来避免额外的依赖性。  从版本1.9.11开始，nginx支持<a hhref="ngx_core_module.html#load_module">动态模块</a> ，以下模块构建为动态模块并作为单独的软件包提供： </p><blockquote class="example"><pre class="notranslate">nginx-module-geoip<br>nginx-module-image-filter<br>nginx-module-njs<br>nginx-module-perl<br>nginx-module-xslt<br></pre></blockquote><p></p><a name="signatures"></a><center><h4>  签名 </h4></center><p>   RPM软件包和Debian / Ubuntu存储库都使用数字签名来验证下载软件包的完整性和来源。  为了检查签名，有必要下载<a hhref="/keys/nginx_signing.key">nginx签名密钥</a>并将其导入<code class="notranslate">rpm</code>或<code class="notranslate">apt</code>程序的密钥环： </p><ul class="compact"><li>  在Debian / Ubuntu上： <blockquote class="example"><pre class="notranslate">sudo apt-key add nginx_signing.key</pre></blockquote></li><li>  在RHEL / CentOS上： <blockquote class="example"><pre class="notranslate">sudo rpm –import nginx_signing.key</pre></blockquote></li><li>  在SLES上： <blockquote class="example"><pre class="notranslate">sudo rpm –import nginx_signing.key</pre></blockquote></li></ul><p></p><p>  在Debian / Ubuntu / SLES上，默认情况下会检查签名，但在RHEL / CentOS上需要设置 </p><blockquote class="example"><pre class="notranslate">gpgcheck=1</pre></blockquote><p>  在<code class="notranslate">/etc/yum.repos.d/nginx.repo</code>文件中。 </p><p>  由于我们的<a hhref="en/pgp_keys.html">PGP密钥</a>和软件包位于同一台服务器上，因此它们同样受信任。  强烈建议另外验证下载的PGP密钥的真实性。   PGP具有“信任网”概念，当一个密钥由其他人的密钥签名时，该密钥又由另一个密钥签名，依此类推。  通常可以构建从任意密钥到您知道并亲自信任的某个人密钥的链，从而验证链中第一个密钥的真实性。   <a hhref="http://www.dewinter.com/gnupg_howto/english/GPGMiniHowto-1.html">GPG Mini Howto</a>详细描述了这一概念。  我们的密钥有足够的签名，其真实性相对容易检查。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/install.html</url>
      <content type="html"><![CDATA[<p></p><h2>  安装nginx </h2><p>   nginx的安装方式可能不同，具体取决于操作系统。 </p><a name="linux"></a><center><h4>  在Linux上安装 </h4></center><p>  对于Linux，可以使用nginx.org中的nginx <a hhref="linux_packages.html">包</a> 。 </p><a name="freebsd"></a><center><h4>  在FreeBSD上安装 </h4></center><p>  在FreeBSD上，可以从<a hhref="http://www.freebsd.org/doc/handbook/pkgng-intro.html">软件包</a>或通过<a hhref="http://www.freebsd.org/doc/handbook/ports-using.html">ports</a>系统安装nginx。   ports系统提供了更大的灵活性，允许在众多选项中进行选择。  该端口将使用指定的选项编译nginx并安装它。 </p><a name="source_install"></a><center><h4>  从源头构建 </h4></center><p>  如果需要一些特殊功能，包和端口不可用，也可以从源文件编译nginx。  虽然更灵活，但这种方法对初学者来说可能很复杂。  有关更多信息，请参阅<a hhref="configure.html">从源构建nginx</a> 。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/index.html</url>
      <content type="html"><![CDATA[<p></p><h2>   nginx文档 </h2><a name="introduction"></a><center><h4>  介绍 </h4></center><p></p><ul class="compact"><li>   <a hhref="install.html">安装nginx</a> </li><li>   <a hhref="configure.html">从Sources构建nginx</a> </li><li>   <a hhref="beginners_guide.html">初学者指南</a> </li><li>   <a hhref="https://www.nginx.com/resources/admin-guide/">管理员指南</a> </li><li>   <a hhref="control.html">控制nginx</a> </li><li>   <a hhref="events.html">连接处理方法</a> </li><li>   <a hhref="hash.html">设置哈希值</a> </li><li>   <a hhref="debugging_log.html">调试日志</a> </li><li>   <a hhref="syslog.html">记录到syslog</a> </li><li>   <a hhref="syntax.html">配置文件测量单位</a> </li><li>   <a hhref="switches.html">命令行参数</a> </li><li>   <a hhref="windows.html">适用于Windows的nginx</a> </li></ul><p></p><ul class="compact"><li>   <a hhref="http/request_processing.html">nginx如何处理请求</a> </li><li>   <a hhref="http/server_names.html">服务器名称</a> </li><li>   <a hhref="http/load_balancing.html">使用nginx作为HTTP负载均衡器</a> </li><li>   <a hhref="http/configuring_https_servers.html">配置HTTPS服务器</a> </li></ul><p></p><ul class="compact"><li>   <a hhref="stream/stream_processing.html">nginx如何处理TCP / UDP会话</a> </li></ul><p></p><ul class="compact"><li>   <a hhref="njs/index.html">用njs编写脚本</a> </li></ul><p></p><ul class="compact"><li>   <a hhref="http://www.aosabook.org/en/nginx.html">“开源应用程序架构”中的“nginx”一章</a> </li></ul><p></p><a name="howto"></a><center><h4>  如何 </h4></center><p></p><ul class="compact"><li>   <a hhref="howto_build_on_win32.html">使用Visual C在Win32平台上构建nginx</a> </li><li>   <a hhref="https://www.nginx.com/resources/admin-guide/setting-nginx-plus-environment-amazon-ec2/">在Amazon EC2上设置NGINX Plus环境</a> </li><li>   <a hhref="nginx_dtrace_pid_provider.html">使用DTrace pid提供程序调试nginx</a> </li></ul><p></p><ul class="compact"><li>   <a hhref="http/converting_rewrite_rules.html">转换重写规则</a> </li><li>   <a hhref="http/websocket.html">WebSocket代理</a> </li></ul><p></p><a name="development"></a><center><h4>  发展 </h4></center><p></p><ul class="compact"><li>   <a hhref="contributing_changes.html">贡献变化</a> </li><li>   <a hhref="dev/development_guide.html">开发指南</a> </li></ul><p></p><center><h4>  模块参考 </h4></center><p></p><ul class="compact"><li>   <a hhref="dirindex.html">按字母顺序排列的指令索引</a> </li><li>   <a hhref="varindex.html">按字母顺序排列的变量索引</a> </li></ul><p></p><p></p><ul class="compact"><li>   <a hhref="ngx_core_module.html">核心功能</a> </li></ul><p></p><p></p><ul class="compact"><li>   <a hhref="http/ngx_http_core_module.html">ngx_http_core_module</a> </li><li>   <a hhref="http/ngx_http_access_module.html">ngx_http_access_module</a> </li><li>   <a hhref="http/ngx_http_addition_module.html">ngx_http_addition_module</a> </li><li>   <a hhref="http/ngx_http_api_module.html">ngx_http_api_module</a> </li><li>   <a hhref="http/ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a> </li><li>   <a hhref="http/ngx_http_auth_jwt_module.html">ngx_http_auth_jwt_module</a> </li><li>   <a hhref="http/ngx_http_auth_request_module.html">ngx_http_auth_request_module</a> </li><li>   <a hhref="http/ngx_http_autoindex_module.html">ngx_http_autoindex_module</a> </li><li>   <a hhref="http/ngx_http_browser_module.html">ngx_http_browser_module</a> </li><li>   <a hhref="http/ngx_http_charset_module.html">ngx_http_charset_module</a> </li><li>   <a hhref="http/ngx_http_dav_module.html">ngx_http_dav_module</a> </li><li>   <a hhref="http/ngx_http_empty_gif_module.html">ngx_http_empty_gif_module</a> </li><li>   <a hhref="http/ngx_http_f4f_module.html">ngx_http_f4f_module</a> </li><li>   <a hhref="http/ngx_http_fastcgi_module.html">ngx_http_fastcgi_module</a> </li><li>   <a hhref="http/ngx_http_flv_module.html">ngx_http_flv_module</a> </li><li>   <a hhref="http/ngx_http_geo_module.html">ngx_http_geo_module</a> </li><li>   <a hhref="http/ngx_http_geoip_module.html">ngx_http_geoip_module</a> </li><li>   <a hhref="http/ngx_http_grpc_module.html">ngx_http_grpc_module</a> </li><li>   <a hhref="http/ngx_http_gunzip_module.html">ngx_http_gunzip_module</a> </li><li>   <a hhref="http/ngx_http_gzip_module.html">ngx_http_gzip_module</a> </li><li>   <a hhref="http/ngx_http_gzip_static_module.html">ngx_http_gzip_static_module</a> </li><li>   <a hhref="http/ngx_http_headers_module.html">ngx_http_headers_module</a> </li><li>   <a hhref="http/ngx_http_hls_module.html">ngx_http_hls_module</a> </li><li>   <a hhref="http/ngx_http_image_filter_module.html">ngx_http_image_filter_module</a> </li><li>   <a hhref="http/ngx_http_index_module.html">ngx_http_index_module</a> </li><li>   <a hhref="http/ngx_http_js_module.html">ngx_http_js_module</a> </li><li>   <a hhref="http/ngx_http_keyval_module.html">ngx_http_keyval_module</a> </li><li>   <a hhref="http/ngx_http_limit_conn_module.html">ngx_http_limit_conn_module</a> </li><li>   <a hhref="http/ngx_http_limit_req_module.html">ngx_http_limit_req_module</a> </li><li>   <a hhref="http/ngx_http_log_module.html">ngx_http_log_module</a> </li><li>   <a hhref="http/ngx_http_map_module.html">ngx_http_map_module</a> </li><li>   <a hhref="http/ngx_http_memcached_module.html">ngx_http_memcached_module</a> </li><li>   <a hhref="http/ngx_http_mirror_module.html">ngx_http_mirror_module</a> </li><li>   <a hhref="http/ngx_http_mp4_module.html">ngx_http_mp4_module</a> </li><li>   <a hhref="http/ngx_http_perl_module.html">ngx_http_perl_module</a> </li><li>   <a hhref="http/ngx_http_proxy_module.html">ngx_http_proxy_module</a> </li><li>   <a hhref="http/ngx_http_random_index_module.html">ngx_http_random_index_module</a> </li><li>   <a hhref="http/ngx_http_realip_module.html">ngx_http_realip_module</a> </li><li>   <a hhref="http/ngx_http_referer_module.html">ngx_http_referer_module</a> </li><li>   <a hhref="http/ngx_http_rewrite_module.html">ngx_http_rewrite_module</a> </li><li>   <a hhref="http/ngx_http_scgi_module.html">ngx_http_scgi_module</a> </li><li>   <a hhref="http/ngx_http_secure_link_module.html">ngx_http_secure_link_module</a> </li><li>   <a hhref="http/ngx_http_session_log_module.html">ngx_http_session_log_module</a> </li><li>   <a hhref="http/ngx_http_slice_module.html">ngx_http_slice_module</a> </li><li>   <a hhref="http/ngx_http_spdy_module.html">ngx_http_spdy_module</a> </li><li>   <a hhref="http/ngx_http_split_clients_module.html">ngx_http_split_clients_module</a> </li><li>   <a hhref="http/ngx_http_ssi_module.html">ngx_http_ssi_module</a> </li><li>   <a hhref="http/ngx_http_ssl_module.html">ngx_http_ssl_module</a> </li><li>   <a hhref="http/ngx_http_status_module.html">ngx_http_status_module</a> </li><li>   <a hhref="http/ngx_http_stub_status_module.html">ngx_http_stub_status_module</a> </li><li>   <a hhref="http/ngx_http_sub_module.html">ngx_http_sub_module</a> </li><li>   <a hhref="http/ngx_http_upstream_module.html">ngx_http_upstream_module</a> </li><li>   <a hhref="http/ngx_http_upstream_conf_module.html">ngx_http_upstream_conf_module</a> </li><li>   <a hhref="http/ngx_http_upstream_hc_module.html">ngx_http_upstream_hc_module</a> </li><li>   <a hhref="http/ngx_http_userid_module.html">ngx_http_userid_module</a> </li><li>   <a hhref="http/ngx_http_uwsgi_module.html">ngx_http_uwsgi_module</a> </li><li>   <a hhref="http/ngx_http_v2_module.html">ngx_http_v2_module</a> </li><li>   <a hhref="http/ngx_http_xslt_module.html">ngx_http_xslt_module</a> </li></ul><p></p><p></p><ul class="compact"><li>   <a hhref="mail/ngx_mail_core_module.html">ngx_mail_core_module</a> </li><li>   <a hhref="mail/ngx_mail_auth_http_module.html">ngx_mail_auth_http_module</a> </li><li>   <a hhref="mail/ngx_mail_proxy_module.html">ngx_mail_proxy_module</a> </li><li>   <a hhref="mail/ngx_mail_ssl_module.html">ngx_mail_ssl_module</a> </li><li>   <a hhref="mail/ngx_mail_imap_module.html">ngx_mail_imap_module</a> </li><li>   <a hhref="mail/ngx_mail_pop3_module.html">ngx_mail_pop3_module</a> </li><li>   <a hhref="mail/ngx_mail_smtp_module.html">ngx_mail_smtp_module</a> </li></ul><p></p><p></p><ul class="compact"><li>   <a hhref="stream/ngx_stream_core_module.html">ngx_stream_core_module</a> </li><li>   <a hhref="stream/ngx_stream_access_module.html">ngx_stream_access_module</a> </li><li>   <a hhref="stream/ngx_stream_geo_module.html">ngx_stream_geo_module</a> </li><li>   <a hhref="stream/ngx_stream_geoip_module.html">ngx_stream_geoip_module</a> </li><li>   <a hhref="stream/ngx_stream_js_module.html">ngx_stream_js_module</a> </li><li>   <a hhref="stream/ngx_stream_keyval_module.html">ngx_stream_keyval_module</a> </li><li>   <a hhref="stream/ngx_stream_limit_conn_module.html">ngx_stream_limit_conn_module</a> </li><li>   <a hhref="stream/ngx_stream_log_module.html">ngx_stream_log_module</a> </li><li>   <a hhref="stream/ngx_stream_map_module.html">ngx_stream_map_module</a> </li><li>   <a hhref="stream/ngx_stream_proxy_module.html">ngx_stream_proxy_module</a> </li><li>   <a hhref="stream/ngx_stream_realip_module.html">ngx_stream_realip_module</a> </li><li>   <a hhref="stream/ngx_stream_return_module.html">ngx_stream_return_module</a> </li><li>   <a hhref="stream/ngx_stream_split_clients_module.html">ngx_stream_split_clients_module</a> </li><li>   <a hhref="stream/ngx_stream_ssl_module.html">ngx_stream_ssl_module</a> </li><li>   <a hhref="stream/ngx_stream_ssl_preread_module.html">ngx_stream_ssl_preread_module</a> </li><li>   <a hhref="stream/ngx_stream_upstream_module.html">ngx_stream_upstream_module</a> </li><li>   <a hhref="stream/ngx_stream_upstream_hc_module.html">ngx_stream_upstream_hc_module</a> </li><li>   <a hhref="stream/ngx_stream_zone_sync_module.html">ngx_stream_zone_sync_module</a> </li></ul><p></p><p></p><ul class="compact"><li>   <a hhref="ngx_google_perftools_module.html">ngx_google_perftools_module</a> </li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/howto_build_on_win32.html</url>
      <content type="html"><![CDATA[<p></p><h2>  使用Visual C在Win32平台上构建nginx </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#build_steps">Build steps</a> <br> <a hhref="#see_also">See also</a> <br></td></tr></tbody></table><center><h4>  先决条件 </h4></center><p>  要在MicrosoftWin32®平台上构建nginx，您需要： </p><ul class="compact"><li>   Microsoft Visual C编译器。  已知Microsoft VisualStudio®8和10可以使用。 </li><li>   <a hhref="http://www.mingw.org/wiki/MSYS">MSYS</a> 。 </li><li>   Perl，如果你想用SSL支持构建OpenSSL®和nginx。  例如<a hhref="http://www.activestate.com/activeperl">ActivePerl</a>或<a hhref="http://strawberryperl.com">Strawberry Perl</a> 。 </li><li>   <a hhref="https://www.mercurial-scm.org">Mercurial</a>客户。 </li><li>   <a hhref="http://www.pcre.org">PCRE</a> ， <a hhref="http://zlib.net">zlib</a>和<a hhref="http://www.openssl.org">OpenSSL</a>库源。 </li></ul><p></p><a name="build_steps"></a><center><h4>  构建步骤 </h4></center><p>  确保在开始构建之前将Perl，Mercurial和MSYS bin目录的路径添加到PATH环境变量中。  要设置Visual C环境，请从Visual C目录运行vcvarsall.bat脚本。 </p><p>  要构建nginx： </p><ul class="compact"><li>  启动MSYS bash。 </li><li>  查看hg.nginx.org存储库中的nginx源代码。  例如： <blockquote class="example"><pre class="notranslate">hg clone <a href="http://hg.nginx.org/nginx" target="_blank" rel="noopener">http://hg.nginx.org/nginx</a><br></pre></blockquote></li><li>  创建一个build和lib目录，并将zlib，PCRE和OpenSSL库源解压缩到lib目录中： <blockquote class="example"><pre class="notranslate">mkdir objs<br>mkdir objs/lib<br>cd objs/lib<br>tar -xzf ../../pcre-8.42.tar.gz<br>tar -xzf ../../zlib-1.2.11.tar.gz<br>tar -xzf ../../openssl-1.0.2q.tar.gz<br></pre></blockquote></li><li>  运行configure脚本： <blockquote class="example"><pre class="notranslate">auto/configure \<br>    –with-cc=cl \<br>    –with-debug \<br>    –prefix= \<br>    –conf-path=conf/nginx.conf \<br>    –pid-path=logs/nginx.pid \<br>    –http-log-path=logs/access.log \<br>    –error-log-path=logs/error.log \<br>    –sbin-path=nginx.exe \<br>    –http-client-body-temp-path=temp/client_body_temp \<br>    –http-proxy-temp-path=temp/proxy_temp \<br>    –http-fastcgi-temp-path=temp/fastcgi_temp \<br>    –http-scgi-temp-path=temp/scgi_temp \<br>    –http-uwsgi-temp-path=temp/uwsgi_temp \<br>    –with-cc-opt=-DFD_SETSIZE=1024 \<br>    –with-pcre=objs/lib/pcre-8.42 \<br>    –with-zlib=objs/lib/zlib-1.2.11 \<br>    –with-openssl=objs/lib/openssl-1.0.2q \<br>    –with-openssl-opt=no-asm \<br>    –with-select_module \<br>    –with-http_ssl_module<br></pre></blockquote></li><li>  运行make： <blockquote class="example"><pre class="notranslate">nmake<br></pre></blockquote></li></ul><p></p><a name="see_also"></a><center><h4>  也可以看看 </h4></center><p></p><ul class="compact"><li>   <a hhref="windows.html">适用于Windows的nginx</a> </li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/hash.html</url>
      <content type="html"><![CDATA[<p></p><h2>  设置哈希值 </h2><p>  为了快速处理静态数据集，例如服务器名称， <a hhref="http/ngx_http_map_module.html#map">映射</a>指令的值，MIME类型，请求头字符串的名称，nginx使用哈希表。  在启动期间和每次重新配置时，nginx选择最小可能大小的散列表，使得存储具有相同散列值的密钥的桶大小不超过配置的参数（散列桶大小）。  表的大小以桶表示。  继续调整，直到表大小超过散列最大大小参数。  大多数哈希都有相应的指令允许更改这些参数，例如，对于服务器名称哈希，它们是<a hhref="http/ngx_http_core_module.html#server_names_hash_max_size">server_names_hash_max_size</a>和<a hhref="http/ngx_http_core_module.html#server_names_hash_bucket_size">server_names_hash_bucket_size</a> 。 </p><p>  散列桶大小参数与处理器的高速缓存行大小的倍数对齐。  这通过减少内存访问的数量来加速现代处理器上的散列中的密钥搜索。  如果散列桶大小等于一个处理器的高速缓存行大小，那么在最坏的情况下，密钥搜索期间的内存访问次数将是两次 - 首先计算存储区地址，第二次是在存储桶内的密钥搜索期间。  因此，如果nginx发出请求增加散列最大大小或散列桶大小的消息，则应首先增加第一个参数。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/examples.html</url>
      <content type="html"><![CDATA[<p></p><h2>  示例nginx配置 </h2><p>  示例站点配置，将所有请求传递给后端，但以“/ download /”开头的图像和请求除外。 </p><blockquote class="example"><pre class="notranslate">user  www www;<p></p>
<p>worker_processes  2;</p>
<p>pid /var/run/nginx.pid;</p>
<h1 id="debug-info-notice-warn-error-crit"><a href="#debug-info-notice-warn-error-crit" class="headerlink" title="[ debug | info | notice | warn | error | crit ]"></a>[ debug | info | notice | warn | error | crit ]</h1><p>error_log  /var/log/nginx.error_log  info;</p>
<p>events {<br>    worker_connections   2000;</p>
<pre><code># use [ kqueue | epoll | /dev/poll | select | poll ];
use kqueue;
</code></pre><p>}</p>
<p>http {</p>
<pre><code>include       conf/mime.types;
default_type  application/octet-stream;


log_format main      &apos;$remote_addr - $remote_user [$time_local] &apos;
                     &apos;&quot;$request&quot; $status $bytes_sent &apos;
                     &apos;&quot;$http_referer&quot; &quot;$http_user_agent&quot; &apos;
                     &apos;&quot;$gzip_ratio&quot;&apos;;

log_format download  &apos;$remote_addr - $remote_user [$time_local] &apos;
                     &apos;&quot;$request&quot; $status $bytes_sent &apos;
                     &apos;&quot;$http_referer&quot; &quot;$http_user_agent&quot; &apos;
                     &apos;&quot;$http_range&quot; &quot;$sent_http_content_range&quot;&apos;;

client_header_timeout  3m;
client_body_timeout    3m;
send_timeout           3m;

client_header_buffer_size    1k;
large_client_header_buffers  4 4k;

gzip on;
gzip_min_length  1100;
gzip_buffers     4 8k;
gzip_types       text/plain;

output_buffers   1 32k;
postpone_output  1460;

sendfile         on;
tcp_nopush       on;
tcp_nodelay      on;
send_lowat       12000;

keepalive_timeout  75 20;

#lingering_time     30;
#lingering_timeout  10;
#reset_timedout_connection  on;


server {
    listen        one.example.com;
    server_name   one.example.com  www.one.example.com;

    access_log   /var/log/nginx.access_log  main;

    location / {
        proxy_pass         http://127.0.0.1/;
        proxy_redirect     off;

        proxy_set_header   Host             $host;
        proxy_set_header   X-Real-IP        $remote_addr;
        #proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;

        client_max_body_size       10m;
        client_body_buffer_size    128k;

        client_body_temp_path      /var/nginx/client_body_temp;

        proxy_connect_timeout      70;
        proxy_send_timeout         90;
        proxy_read_timeout         90;
        proxy_send_lowat           12000;

        proxy_buffer_size          4k;
        proxy_buffers              4 32k;
        proxy_busy_buffers_size    64k;
        proxy_temp_file_write_size 64k;

        proxy_temp_path            /var/nginx/proxy_temp;

        charset  koi8-r;
    }

    error_page  404  /404.html;

    location = /404.html {
        root  /spool/www;
    }

    location /old_stuff/ {
        rewrite   ^/old_stuff/(.*)$  /new_stuff/$1  permanent;
    }

    location /download/ {

        valid_referers  none  blocked  server_names  *.example.com;

        if ($invalid_referer) {
            #rewrite   ^/   http://www.example.com/;
            return   403;
        }

        #rewrite_log  on;

        # rewrite /download/*/mp3/*.any_ext to /download/*/mp3/*.mp3
        rewrite ^/(download/.*)/mp3/(.*)\..*$
                /$1/mp3/$2.mp3                   break;

        root         /spool/www;
        #autoindex    on;
        access_log   /var/log/nginx-download.access_log  download;
    }

    location ~* \.(jpg|jpeg|gif)$ {
        root         /spool/www;
        access_log   off;
        expires      30d;
    }
}
</code></pre><p>}<br></p></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/events.html</url>
      <content type="html"><![CDATA[<p></p><h2>  连接处理方法 </h2><p>   nginx支持各种连接处理方法。  特定方法的可用性取决于所使用的平台。  在支持多种方法的平台上，nginx通常会自动选择最有效的方法。  但是，如果需要，可以<a hhref="ngx_core_module.html#use">使用use</a>指令显式选择连接处理方法。 </p><p>  支持以下连接处理方法： </p><ul class="compact"><li id="select"><p>   <code class="notranslate">select</code> - 标准方法。  支持模块自动构建在缺乏更有效方法的平台上。   <code class="notranslate">–with-select_module</code>和<code class="notranslate">–without-select_module</code>配置参数可用于强制启用或禁用此模块的构建。 </p></li><li id="poll"><p>   <code class="notranslate">poll</code> - 标准方法。  支持模块自动构建在缺乏更有效方法的平台上。   <code class="notranslate">–with-poll_module</code>和<code class="notranslate">–without-poll_module</code>配置参数可用于强制启用或禁用此模块的构建。 </p></li><li id="kqueue"><p>   <code class="notranslate">kqueue</code> - 在FreeBSD 4.1 +，OpenBSD 2.9 +，NetBSD 2.0和macOS上使用的有效方法。 </p></li><li id="epoll"><p>   Linux 2.6+上使用的<code class="notranslate">epoll</code> -efficient方法。 </p><blockquote class="note">  自1.11.3起，支持<code class="notranslate">EPOLLRDHUP</code> （Linux 2.6.17，glibc 2.8）和<code class="notranslate">EPOLLEXCLUSIVE</code> （Linux 4.5，glibc 2.24）标志。 </blockquote><p></p><blockquote class="note">  一些较旧的发行版（如SuSE 8.2）提供了为2.4内核添加epoll支持的补丁。 </blockquote><p></p></li><li id="devpoll"><p>   <code class="notranslate">/dev/poll</code> -  Solaris 7 11/99 +，HP / UX 11.22+（eventport），IRIX 6.5.15+和Tru64 UNIX 5.1A +上使用的有效方法。 </p></li><li id="eventport"><p>   <code class="notranslate">eventport</code> - 事件端口，Solaris 10+上使用的方法（由于已知问题，建议使用<code class="notranslate">/dev/poll</code>方法）。 </p></li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/dirindex.html</url>
      <content type="html"><![CDATA[<p></p><h2>  按字母顺序排列的指令索引 </h2><p>   <a hhref="http/ngx_http_core_module.html#absolute_redirect">absolute_redirect</a> <br>   <a hhref="ngx_core_module.html#accept_mutex">accept_mutex</a> <br>   <a hhref="ngx_core_module.html#accept_mutex_delay">accept_mutex_delay</a> <br>   <a hhref="http/ngx_http_log_module.html#access_log">access_log</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_log_module.html#access_log">access_log</a> （ngx_stream_log_module） <br>   <a hhref="http/ngx_http_addition_module.html#add_after_body">add_after_body</a> <br>   <a hhref="http/ngx_http_addition_module.html#add_before_body">add_before_body</a> <br>   <a hhref="http/ngx_http_headers_module.html#add_header">add_header</a> <br>   <a hhref="http/ngx_http_headers_module.html#add_trailer">add_trailer</a> <br>   <a hhref="http/ngx_http_addition_module.html#addition_types">addition_types</a> <br>   <a hhref="http/ngx_http_core_module.html#aio">AIO</a> <br>   <a hhref="http/ngx_http_core_module.html#aio_write">aio_write</a> <br>   <a hhref="http/ngx_http_core_module.html#alias">别号</a> <br>   <a hhref="http/ngx_http_access_module.html#allow">允许</a> （ngx_http_access_module） <br>   <a hhref="stream/ngx_stream_access_module.html#allow">允许</a> （ngx_stream_access_module） <br>   <a hhref="http/ngx_http_browser_module.html#ancient_browser">ancient_browser</a> <br>   <a hhref="http/ngx_http_browser_module.html#ancient_browser_value">ancient_browser_value</a> <br>   <a hhref="http/ngx_http_api_module.html#api">API</a> <br>   <a hhref="http/ngx_http_auth_basic_module.html#auth_basic">auth_basic</a> <br>   <a hhref="http/ngx_http_auth_basic_module.html#auth_basic_user_file">auth_basic_user_file</a> <br>   <a hhref="mail/ngx_mail_auth_http_module.html#auth_http">auth_http</a> <br>   <a hhref="mail/ngx_mail_auth_http_module.html#auth_http_header">auth_http_header</a> <br>   <a hhref="mail/ngx_mail_auth_http_module.html#auth_http_pass_client_cert">auth_http_pass_client_cert</a> <br>   <a hhref="mail/ngx_mail_auth_http_module.html#auth_http_timeout">auth_http_timeout</a> <br>   <a hhref="http/ngx_http_auth_jwt_module.html#auth_jwt">auth_jwt</a> <br>   <a hhref="http/ngx_http_auth_jwt_module.html#auth_jwt_claim_set">auth_jwt_claim_set</a> <br>   <a hhref="http/ngx_http_auth_jwt_module.html#auth_jwt_header_set">auth_jwt_header_set</a> <br>   <a hhref="http/ngx_http_auth_jwt_module.html#auth_jwt_key_file">auth_jwt_key_file</a> <br>   <a hhref="http/ngx_http_auth_jwt_module.html#auth_jwt_key_request">auth_jwt_key_request</a> <br>   <a hhref="http/ngx_http_auth_jwt_module.html#auth_jwt_leeway">auth_jwt_leeway</a> <br>   <a hhref="http/ngx_http_auth_request_module.html#auth_request">auth_request</a> <br>   <a hhref="http/ngx_http_auth_request_module.html#auth_request_set">auth_request_set</a> <br>   <a hhref="http/ngx_http_autoindex_module.html#autoindex">自动索引</a> <br>   <a hhref="http/ngx_http_autoindex_module.html#autoindex_exact_size">autoindex_exact_size</a> <br>   <a hhref="http/ngx_http_autoindex_module.html#autoindex_format">autoindex_format</a> <br>   <a hhref="http/ngx_http_autoindex_module.html#autoindex_localtime">autoindex_localtime</a> <br>   <a hhref="http/ngx_http_rewrite_module.html#break">打破</a> <br>   <a hhref="http/ngx_http_charset_module.html#charset">字符集</a> <br>   <a hhref="http/ngx_http_charset_module.html#charset_map">charset_map</a> <br>   <a hhref="http/ngx_http_charset_module.html#charset_types">charset_types</a> <br>   <a hhref="http/ngx_http_core_module.html#chunked_transfer_encoding">chunked_transfer_encoding</a> <br>   <a hhref="http/ngx_http_core_module.html#client_body_buffer_size">client_body_buffer_size</a> <br>   <a hhref="http/ngx_http_core_module.html#client_body_in_file_only">client_body_in_file_only</a> <br>   <a hhref="http/ngx_http_core_module.html#client_body_in_single_buffer">client_body_in_single_buffer</a> <br>   <a hhref="http/ngx_http_core_module.html#client_body_temp_path">client_body_temp_path</a> <br>   <a hhref="http/ngx_http_core_module.html#client_body_timeout">client_body_timeout</a> <br>   <a hhref="http/ngx_http_core_module.html#client_header_buffer_size">client_header_buffer_size</a> <br>   <a hhref="http/ngx_http_core_module.html#client_header_timeout">client_header_timeout</a> <br>   <a hhref="http/ngx_http_core_module.html#client_max_body_size">client_max_body_size</a> <br>   <a hhref="http/ngx_http_core_module.html#connection_pool_size">connection_pool_size</a> <br>   <a hhref="http/ngx_http_dav_module.html#create_full_put_path">create_full_put_path</a> <br>   <a hhref="ngx_core_module.html#daemon">守护进程</a> <br>   <a hhref="http/ngx_http_dav_module.html#dav_access">dav_access</a> <br>   <a hhref="http/ngx_http_dav_module.html#dav_methods">dav_methods</a> <br>   <a hhref="ngx_core_module.html#debug_connection">debug_connection</a> <br>   <a hhref="ngx_core_module.html#debug_points">debug_points</a> <br>   <a hhref="http/ngx_http_core_module.html#default_type">default_type文件</a> <br>   <a hhref="http/ngx_http_access_module.html#deny">拒绝</a> （ngx_http_access_module） <br>   <a hhref="stream/ngx_stream_access_module.html#deny">拒绝</a> （ngx_stream_access_module） <br>   <a hhref="http/ngx_http_core_module.html#directio">的directio</a> <br>   <a hhref="http/ngx_http_core_module.html#directio_alignment">directio_alignment</a> <br>   <a hhref="http/ngx_http_core_module.html#disable_symlinks">disable_symlinks</a> <br>   <a hhref="http/ngx_http_empty_gif_module.html#empty_gif">empty_gif</a> <br>   <a hhref="ngx_core_module.html#env">ENV</a> <br>   <a hhref="ngx_core_module.html#error_log">error_log中</a> <br>   <a hhref="http/ngx_http_core_module.html#error_page">error_page</a> <br>   <a hhref="http/ngx_http_core_module.html#etag">ETAG</a> <br>   <a hhref="ngx_core_module.html#events">事件</a> <br>   <a hhref="http/ngx_http_headers_module.html#expires">到期</a> <br>   <a hhref="http/ngx_http_f4f_module.html#f4f">F4F</a> <br>   <a hhref="http/ngx_http_f4f_module.html#f4f_buffer_size">f4f_buffer_size</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_bind">fastcgi_bind</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_buffer_size">fastcgi_buffer_size</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_buffering">fastcgi_buffering</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_buffers">fastcgi_buffers</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_busy_buffers_size">fastcgi_busy_buffers_size</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache">fastcgi_cache</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_background_update">fastcgi_cache_background_update</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_bypass">fastcgi_cache_bypass</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_key">fastcgi_cache_key</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_lock">fastcgi_cache_lock</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_lock_age">fastcgi_cache_lock_age</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_lock_timeout">fastcgi_cache_lock_timeout</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_max_range_offset">fastcgi_cache_max_range_offset</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_methods">fastcgi_cache_methods</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_min_uses">fastcgi_cache_min_uses</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_path">fastcgi_cache_path</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_purge">fastcgi_cache_purge</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_revalidate">fastcgi_cache_revalidate</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_use_stale">fastcgi_cache_use_stale</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_cache_valid">fastcgi_cache_valid</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_catch_stderr">fastcgi_catch_stderr</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_connect_timeout">fastcgi_connect_timeout</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_force_ranges">fastcgi_force_ranges</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_hide_header">fastcgi_hide_header</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_ignore_client_abort">fastcgi_ignore_client_abort</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_ignore_headers">fastcgi_ignore_headers</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_index">fastcgi_index</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_intercept_errors">fastcgi_intercept_errors</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_keep_conn">fastcgi_keep_conn</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_limit_rate">fastcgi_limit_rate</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_max_temp_file_size">fastcgi_max_temp_file_size</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_next_upstream">fastcgi_next_upstream</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_next_upstream_timeout">fastcgi_next_upstream_timeout</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_next_upstream_tries">fastcgi_next_upstream_tries</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_no_cache">fastcgi_no_cache</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_param">fastcgi_param</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_pass">fastcgi_pass</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_pass_header">fastcgi_pass_header</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_pass_request_body">fastcgi_pass_request_body</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_pass_request_headers">fastcgi_pass_request_headers</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_read_timeout">fastcgi_read_timeout</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_request_buffering">fastcgi_request_buffering</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_send_lowat">fastcgi_send_lowat</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_send_timeout">fastcgi_send_timeout</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_socket_keepalive">fastcgi_socket_keepalive</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_split_path_info">fastcgi_split_path_info</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_store">fastcgi_store</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_store_access">fastcgi_store_access</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_temp_file_write_size">fastcgi_temp_file_write_size</a> <br>   <a hhref="http/ngx_http_fastcgi_module.html#fastcgi_temp_path">fastcgi_temp_path</a> <br>   <a hhref="http/ngx_http_flv_module.html#flv">FLV</a> <br>   <a hhref="http/ngx_http_geo_module.html#geo">geo</a> （ngx_http_geo_module） <br>   <a hhref="stream/ngx_stream_geo_module.html#geo">geo</a> （ngx_stream_geo_module） <br>   <a hhref="http/ngx_http_geoip_module.html#geoip_city">geoip_city</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#geoip_city">geoip_city</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#geoip_country">geoip_country</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#geoip_country">geoip_country</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#geoip_org">geoip_org</a> （ngx_http_geoip_module） <br>   <a hhref="stream/ngx_stream_geoip_module.html#geoip_org">geoip_org</a> （ngx_stream_geoip_module） <br>   <a hhref="http/ngx_http_geoip_module.html#geoip_proxy">geoip_proxy</a> <br>   <a hhref="http/ngx_http_geoip_module.html#geoip_proxy_recursive">geoip_proxy_recursive</a> <br>   <a hhref="ngx_google_perftools_module.html#google_perftools_profiles">google_perftools_profiles</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_bind">grpc_bind</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_buffer_size">grpc_buffer_size</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_connect_timeout">grpc_connect_timeout</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_hide_header">grpc_hide_header</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ignore_headers">grpc_ignore_headers</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_intercept_errors">grpc_intercept_errors</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_next_upstream">grpc_next_upstream</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_next_upstream_timeout">grpc_next_upstream_timeout</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_next_upstream_tries">grpc_next_upstream_tries</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_pass">grpc_pass</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_pass_header">grpc_pass_header</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_read_timeout">grpc_read_timeout</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_send_timeout">grpc_send_timeout</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_set_header">grpc_set_header</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_socket_keepalive">grpc_socket_keepalive</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_certificate">grpc_ssl_certificate</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_certificate_key">grpc_ssl_certificate_key</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_ciphers">grpc_ssl_ciphers</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_crl">grpc_ssl_crl</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_name">grpc_ssl_name</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_password_file">grpc_ssl_password_file</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_protocols">grpc_ssl_protocols</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_server_name">grpc_ssl_server_name</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_session_reuse">grpc_ssl_session_reuse</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_trusted_certificate">grpc_ssl_trusted_certificate</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_verify">grpc_ssl_verify</a> <br>   <a hhref="http/ngx_http_grpc_module.html#grpc_ssl_verify_depth">grpc_ssl_verify_depth</a> <br>   <a hhref="http/ngx_http_gunzip_module.html#gunzip">gunzip解</a> <br>   <a hhref="http/ngx_http_gunzip_module.html#gunzip_buffers">gunzip_buffers</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip">gzip的</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip_buffers">gzip_buffers</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip_comp_level">gzip_comp_level</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip_disable">gzip_disable</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip_http_version">gzip_http_version</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip_min_length">gzip_min_length</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip_proxied">gzip_proxied</a> <br>   <a hhref="http/ngx_http_gzip_static_module.html#gzip_static">gzip_static</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip_types">gzip_types</a> <br>   <a hhref="http/ngx_http_gzip_module.html#gzip_vary">gzip_vary</a> <br>   <a hhref="http/ngx_http_upstream_module.html#hash">hash</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#hash">hash</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_upstream_hc_module.html#health_check">health_check</a> （ngx_http_upstream_hc_module） <br>   health_check（ngx_stream_upstream_hc_module） <br>   <a hhref="stream/ngx_stream_upstream_hc_module.html#health_check_timeout">health_check_timeout</a> <br>   <a hhref="http/ngx_http_hls_module.html#hls">HLS</a> <br>   <a hhref="http/ngx_http_hls_module.html#hls_buffers">hls_buffers</a> <br>   <a hhref="http/ngx_http_hls_module.html#hls_forward_args">hls_forward_args</a> <br>   <a hhref="http/ngx_http_hls_module.html#hls_fragment">hls_fragment</a> <br>   <a hhref="http/ngx_http_hls_module.html#hls_mp4_buffer_size">hls_mp4_buffer_size</a> <br>   <a hhref="http/ngx_http_hls_module.html#hls_mp4_max_buffer_size">hls_mp4_max_buffer_size</a> <br>   <a hhref="http/ngx_http_core_module.html#http">HTTP</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_body_preread_size">http2_body_preread_size</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_chunk_size">http2_chunk_size</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_idle_timeout">http2_idle_timeout</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_max_concurrent_pushes">http2_max_concurrent_pushes</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_max_concurrent_streams">http2_max_concurrent_streams</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_max_field_size">http2_max_field_size</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_max_header_size">http2_max_header_size</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_max_requests">http2_max_requests</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_push">http2_push</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_push_preload">http2_push_preload</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_recv_buffer_size">http2_recv_buffer_size</a> <br>   <a hhref="http/ngx_http_v2_module.html#http2_recv_timeout">http2_recv_timeout</a> <br>   <a hhref="http/ngx_http_rewrite_module.html#if">如果</a> <br>   <a hhref="http/ngx_http_core_module.html#if_modified_since">if_modified_since</a> <br>   <a hhref="http/ngx_http_core_module.html#ignore_invalid_headers">ignore_invalid_headers</a> <br>   <a hhref="http/ngx_http_image_filter_module.html#image_filter">image_filter</a> <br>   <a hhref="http/ngx_http_image_filter_module.html#image_filter_buffer">image_filter_buffer</a> <br>   <a hhref="http/ngx_http_image_filter_module.html#image_filter_interlace">image_filter_interlace</a> <br>   <a hhref="http/ngx_http_image_filter_module.html#image_filter_jpeg_quality">image_filter_jpeg_quality</a> <br>   <a hhref="http/ngx_http_image_filter_module.html#image_filter_sharpen">image_filter_sharpen</a> <br>   <a hhref="http/ngx_http_image_filter_module.html#image_filter_transparency">image_filter_transparency</a> <br>   <a hhref="http/ngx_http_image_filter_module.html#image_filter_webp_quality">image_filter_webp_quality</a> <br>   <a hhref="mail/ngx_mail_imap_module.html#imap_auth">imap_auth</a> <br>   <a hhref="mail/ngx_mail_imap_module.html#imap_capabilities">imap_capabilities</a> <br>   <a hhref="mail/ngx_mail_imap_module.html#imap_client_buffer">imap_client_buffer</a> <br>   <a hhref="ngx_core_module.html#include">包括</a> <br>   <a hhref="http/ngx_http_index_module.html#index">指数</a> <br>   <a hhref="http/ngx_http_core_module.html#internal">内部</a> <br>   <a hhref="http/ngx_http_upstream_module.html#ip_hash">ip_hash</a> <br>   <a hhref="stream/ngx_stream_js_module.html#js_access">js_access</a> <br>   <a hhref="http/ngx_http_js_module.html#js_content">js_content</a> <br>   <a hhref="stream/ngx_stream_js_module.html#js_filter">js_filter</a> <br>   <a hhref="http/ngx_http_js_module.html#js_include">js_include</a> （ngx_http_js_module） <br>   <a hhref="stream/ngx_stream_js_module.html#js_include">js_include</a> （ngx_stream_js_module） <br>   <a hhref="stream/ngx_stream_js_module.html#js_preread">js_preread</a> <br>   <a hhref="http/ngx_http_js_module.html#js_set">js_set</a> （ngx_http_js_module） <br>   <a hhref="stream/ngx_stream_js_module.html#js_set">js_set</a> （ngx_stream_js_module） <br>   <a hhref="http/ngx_http_upstream_module.html#keepalive">活着</a> <br>   <a hhref="http/ngx_http_core_module.html#keepalive_disable">keepalive_disable</a> <br>   <a hhref="http/ngx_http_core_module.html#keepalive_requests">keepalive_requests</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_upstream_module.html#keepalive_requests">keepalive_requests</a> （ngx_http_upstream_module） <br>   <a hhref="http/ngx_http_core_module.html#keepalive_timeout">keepalive_timeout</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_upstream_module.html#keepalive_timeout">keepalive_timeout</a> （ngx_http_upstream_module） <br>   <a hhref="http/ngx_http_keyval_module.html#keyval">keyval</a> （ngx_http_keyval_module） <br>   <a hhref="stream/ngx_stream_keyval_module.html#keyval">keyval</a> （ngx_stream_keyval_module） <br>   <a hhref="http/ngx_http_keyval_module.html#keyval_zone">keyval_zone</a> （ngx_http_keyval_module） <br>   <a hhref="stream/ngx_stream_keyval_module.html#keyval_zone">keyval_zone</a> （ngx_stream_keyval_module） <br>   <a hhref="http/ngx_http_core_module.html#large_client_header_buffers">large_client_header_buffers</a> <br>   <a hhref="http/ngx_http_upstream_module.html#least_conn">least_conn</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#least_conn">least_conn</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_upstream_module.html#least_time">least_time</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#least_time">least_time</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_limit_conn_module.html#limit_conn">limit_conn</a> （ngx_http_limit_conn_module） <br>   <a hhref="stream/ngx_stream_limit_conn_module.html#limit_conn">limit_conn</a> （ngx_stream_limit_conn_module） <br>   <a hhref="http/ngx_http_limit_conn_module.html#limit_conn_log_level">limit_conn_log_level</a> （ngx_http_limit_conn_module） <br>   <a hhref="stream/ngx_stream_limit_conn_module.html#limit_conn_log_level">limit_conn_log_level</a> （ngx_stream_limit_conn_module） <br>   <a hhref="http/ngx_http_limit_conn_module.html#limit_conn_status">limit_conn_status</a> <br>   <a hhref="http/ngx_http_limit_conn_module.html#limit_conn_zone">limit_conn_zone</a> （ngx_http_limit_conn_module） <br>   <a hhref="stream/ngx_stream_limit_conn_module.html#limit_conn_zone">limit_conn_zone</a> （ngx_stream_limit_conn_module） <br>   <a hhref="http/ngx_http_core_module.html#limit_except">limit_except</a> <br>   <a hhref="http/ngx_http_core_module.html#limit_rate">limit_rate</a> <br>   <a hhref="http/ngx_http_core_module.html#limit_rate_after">limit_rate_after</a> <br>   <a hhref="http/ngx_http_limit_req_module.html#limit_req">limit_req</a> <br>   <a hhref="http/ngx_http_limit_req_module.html#limit_req_log_level">limit_req_log_level</a> <br>   <a hhref="http/ngx_http_limit_req_module.html#limit_req_status">limit_req_status</a> <br>   <a hhref="http/ngx_http_limit_req_module.html#limit_req_zone">limit_req_zone</a> <br>   <a hhref="http/ngx_http_limit_conn_module.html#limit_zone">limit_zone</a> <br>   <a hhref="http/ngx_http_core_module.html#lingering_close">lingering_close</a> <br>   <a hhref="http/ngx_http_core_module.html#lingering_time">lingering_time</a> <br>   <a hhref="http/ngx_http_core_module.html#lingering_timeout">lingering_timeout</a> <br>   <a hhref="http/ngx_http_core_module.html#listen">听</a> （ngx_http_core_module） <br>   <a hhref="mail/ngx_mail_core_module.html#listen">听</a> （ngx_mail_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#listen">听</a> （ngx_stream_core_module） <br>   <a hhref="ngx_core_module.html#load_module">load_module</a> <br>   <a hhref="http/ngx_http_core_module.html#location">地点</a> <br>   <a hhref="ngx_core_module.html#lock_file">LOCK_FILE</a> <br>   <a hhref="http/ngx_http_log_module.html#log_format">log_format</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_log_module.html#log_format">log_format</a> （ngx_stream_log_module） <br>   <a hhref="http/ngx_http_core_module.html#log_not_found">log_not_found</a> <br>   <a hhref="http/ngx_http_core_module.html#log_subrequest">log_subrequest</a> <br>   <a hhref="mail/ngx_mail_core_module.html#mail">邮件</a> <br>   <a hhref="http/ngx_http_map_module.html#map">地图</a> （ngx_http_map_module） <br>   <a hhref="stream/ngx_stream_map_module.html#map">地图</a> （ngx_stream_map_module） <br>   <a hhref="http/ngx_http_map_module.html#map_hash_bucket_size">map_hash_bucket_size</a> （ngx_http_map_module） <br>   <a hhref="stream/ngx_stream_map_module.html#map_hash_bucket_size">map_hash_bucket_size</a> （ngx_stream_map_module） <br>   <a hhref="http/ngx_http_map_module.html#map_hash_max_size">map_hash_max_size</a> （ngx_http_map_module） <br>   <a hhref="stream/ngx_stream_map_module.html#map_hash_max_size">map_hash_max_size</a> （ngx_stream_map_module） <br>   <a hhref="ngx_core_module.html#master_process">master_process</a> <br>   <a hhref="http/ngx_http_upstream_hc_module.html#match">匹配</a> （ngx_http_upstream_hc_module） <br>   <a hhref="stream/ngx_stream_upstream_hc_module.html#match">匹配</a> （ngx_stream_upstream_hc_module） <br>   <a hhref="http/ngx_http_core_module.html#max_ranges">max_ranges</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_bind">memcached_bind</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_buffer_size">memcached_buffer_size</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_connect_timeout">memcached_connect_timeout</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_force_ranges">memcached_force_ranges</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_gzip_flag">memcached_gzip_flag</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_next_upstream">memcached_next_upstream</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_next_upstream_timeout">memcached_next_upstream_timeout</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_next_upstream_tries">memcached_next_upstream_tries</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_pass">memcached_pa​​ss</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_read_timeout">memcached_read_timeout</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_send_timeout">memcached_send_timeout</a> <br>   <a hhref="http/ngx_http_memcached_module.html#memcached_socket_keepalive">memcached_socket_keepalive</a> <br>   <a hhref="http/ngx_http_core_module.html#merge_slashes">merge_slashes</a> <br>   <a hhref="http/ngx_http_dav_module.html#min_delete_depth">min_delete_depth</a> <br>   <a hhref="http/ngx_http_mirror_module.html#mirror">镜子</a> <br>   <a hhref="http/ngx_http_mirror_module.html#mirror_request_body">mirror_request_body</a> <br>   <a hhref="http/ngx_http_browser_module.html#modern_browser">modern_browser</a> <br>   <a hhref="http/ngx_http_browser_module.html#modern_browser_value">modern_browser_value</a> <br>   <a hhref="http/ngx_http_mp4_module.html#mp4">MP4</a> <br>   <a hhref="http/ngx_http_mp4_module.html#mp4_buffer_size">mp4_buffer_size</a> <br>   <a hhref="http/ngx_http_mp4_module.html#mp4_limit_rate">mp4_limit_rate</a> <br>   <a hhref="http/ngx_http_mp4_module.html#mp4_limit_rate_after">mp4_limit_rate_after</a> <br>   <a hhref="http/ngx_http_mp4_module.html#mp4_max_buffer_size">mp4_max_buffer_size</a> <br>   <a hhref="http/ngx_http_core_module.html#msie_padding">msie_padding</a> <br>   <a hhref="http/ngx_http_core_module.html#msie_refresh">msie_refresh</a> <br>   <a hhref="ngx_core_module.html#multi_accept">multi_accept</a> <br>   <a hhref="http/ngx_http_upstream_module.html#ntlm">NTLM</a> <br>   <a hhref="http/ngx_http_core_module.html#open_file_cache">open_file_cache</a> <br>   <a hhref="http/ngx_http_core_module.html#open_file_cache_errors">open_file_cache_errors</a> <br>   <a hhref="http/ngx_http_core_module.html#open_file_cache_min_uses">open_file_cache_min_uses</a> <br>   <a hhref="http/ngx_http_core_module.html#open_file_cache_valid">open_file_cache_valid</a> <br>   <a hhref="http/ngx_http_log_module.html#open_log_file_cache">open_log_file_cache</a> （ngx_http_log_module） <br>   <a hhref="stream/ngx_stream_log_module.html#open_log_file_cache">open_log_file_cache</a> （ngx_stream_log_module） <br>   <a hhref="http/ngx_http_core_module.html#output_buffers">output_buffers</a> <br>   <a hhref="http/ngx_http_charset_module.html#override_charset">override_charset</a> <br>   <a hhref="ngx_core_module.html#pcre_jit">pcre_jit</a> <br>   <a hhref="http/ngx_http_perl_module.html#perl">perl的</a> <br>   <a hhref="http/ngx_http_perl_module.html#perl_modules">perl_modules</a> <br>   <a hhref="http/ngx_http_perl_module.html#perl_require">perl_require</a> <br>   <a hhref="http/ngx_http_perl_module.html#perl_set">perl_set</a> <br>   <a hhref="ngx_core_module.html#pid">PID</a> <br>   <a hhref="mail/ngx_mail_pop3_module.html#pop3_auth">pop3_auth</a> <br>   <a hhref="mail/ngx_mail_pop3_module.html#pop3_capabilities">pop3_capabilities</a> <br>   <a hhref="http/ngx_http_core_module.html#port_in_redirect">port_in_redirect</a> <br>   <a hhref="http/ngx_http_core_module.html#postpone_output">postpone_output</a> <br>   <a hhref="stream/ngx_stream_core_module.html#preread_buffer_size">preread_buffer_size</a> <br>   <a hhref="stream/ngx_stream_core_module.html#preread_timeout">preread_timeout</a> <br>   <a hhref="mail/ngx_mail_core_module.html#protocol">协议</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_bind">proxy_bind</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_bind">proxy_bind</a> （ngx_stream_proxy_module） <br>   <a hhref="mail/ngx_mail_proxy_module.html#proxy_buffer">proxy_buffer</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_buffer_size">proxy_buffer_size</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_buffer_size">proxy_buffer_size</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_buffering">proxy_buffering</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_buffers">proxy_buffers</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_busy_buffers_size">proxy_busy_buffers_size</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache">proxy_cache</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_background_update">proxy_cache_background_update</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_bypass">proxy_cache_bypass</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_convert_head">proxy_cache_convert_head</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_key">proxy_cache_key</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_lock">proxy_cache_lock</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_lock_age">proxy_cache_lock_age</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_lock_timeout">proxy_cache_lock_timeout</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_max_range_offset">proxy_cache_max_range_offset</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_methods">proxy_cache_methods</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_min_uses">proxy_cache_min_uses</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_path">proxy_cache_path</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_purge">proxy_cache_purge</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_revalidate">proxy_cache_revalidate</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_use_stale">proxy_cache_use_stale</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cache_valid">proxy_cache_valid</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_connect_timeout">proxy_connect_timeout</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_connect_timeout">proxy_connect_timeout</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cookie_domain">proxy_cookie_domain</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_cookie_path">proxy_cookie_path</a> <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_download_rate">proxy_download_rate</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_force_ranges">proxy_force_ranges</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_headers_hash_bucket_size">proxy_headers_hash_bucket_size</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_headers_hash_max_size">proxy_headers_hash_max_size</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_hide_header">proxy_hide_header</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_http_version">proxy_http_version</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ignore_client_abort">proxy_ignore_client_abort</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ignore_headers">proxy_ignore_headers</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_intercept_errors">proxy_intercept_errors</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_limit_rate">proxy_limit_rate</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_max_temp_file_size">proxy_max_temp_file_size</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_method">proxy_method</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_next_upstream">proxy_next_upstream</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_next_upstream">proxy_next_upstream</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_next_upstream_timeout">proxy_next_upstream_timeout</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_next_upstream_timeout">proxy_next_upstream_timeout</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_next_upstream_tries">proxy_next_upstream_tries</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_next_upstream_tries">proxy_next_upstream_tries</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_no_cache">proxy_no_cache</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_pass">proxy_pass</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_pass">proxy_pass</a> （ngx_stream_proxy_module） <br>   <a hhref="mail/ngx_mail_proxy_module.html#proxy_pass_error_message">proxy_pass_error_message</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_pass_header">proxy_pass_header</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_pass_request_body">proxy_pass_request_body</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_pass_request_headers">proxy_pass_request_headers</a> <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_protocol">proxy_protocol</a> <br>   <a hhref="stream/ngx_stream_core_module.html#proxy_protocol_timeout">proxy_protocol_timeout</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_read_timeout">proxy_read_timeout</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_redirect">proxy_redirect</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_request_buffering">proxy_request_buffering</a> <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_requests">proxy_requests</a> <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_responses">proxy_responses</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_send_lowat">proxy_send_lowat</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_send_timeout">proxy_send_timeout</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_set_body">proxy_set_body</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_set_header">proxy_set_header</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_socket_keepalive">proxy_socket_keepalive</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_socket_keepalive">proxy_socket_keepalive</a> （ngx_stream_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl">proxy_ssl</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_certificate">proxy_ssl_certificate</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_certificate">proxy_ssl_certificate</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_certificate_key">proxy_ssl_certificate_key</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_certificate_key">proxy_ssl_certificate_key</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_ciphers">proxy_ssl_ciphers</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_ciphers">proxy_ssl_ciphers</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_crl">proxy_ssl_crl</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_crl">proxy_ssl_crl</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_name">proxy_ssl_name</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_name">proxy_ssl_name</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_password_file">proxy_ssl_password_file</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_password_file">proxy_ssl_password_file</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_protocols">proxy_ssl_protocols</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_protocols">proxy_ssl_protocols</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_server_name">proxy_ssl_server_name</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_server_name">proxy_ssl_server_name</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_session_reuse">proxy_ssl_session_reuse</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_session_reuse">proxy_ssl_session_reuse</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_trusted_certificate">proxy_ssl_trusted_certificate</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_trusted_certificate">proxy_ssl_trusted_certificate</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_verify">proxy_ssl_verify</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_verify">proxy_ssl_verify</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_ssl_verify_depth">proxy_ssl_verify_depth</a> （ngx_http_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_ssl_verify_depth">proxy_ssl_verify_depth</a> （ngx_stream_proxy_module） <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_store">proxy_store</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_store_access">proxy_store_access</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_temp_file_write_size">proxy_temp_file_write_size</a> <br>   <a hhref="http/ngx_http_proxy_module.html#proxy_temp_path">proxy_temp_path</a> <br>   <a hhref="mail/ngx_mail_proxy_module.html#proxy_timeout">proxy_timeout</a> （ngx_mail_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_timeout">proxy_timeout</a> （ngx_stream_proxy_module） <br>   <a hhref="stream/ngx_stream_proxy_module.html#proxy_upload_rate">proxy_upload_rate</a> <br>   <a hhref="http/ngx_http_upstream_module.html#queue">队列</a> <br>   <a hhref="http/ngx_http_upstream_module.html#random">随机的</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#random">随机的</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_random_index_module.html#random_index">random_index</a> <br>   <a hhref="http/ngx_http_core_module.html#read_ahead">read_ahead</a> <br>   <a hhref="http/ngx_http_realip_module.html#real_ip_header">real_ip_header</a> <br>   <a hhref="http/ngx_http_realip_module.html#real_ip_recursive">real_ip_recursive</a> <br>   <a hhref="http/ngx_http_core_module.html#recursive_error_pages">recursive_error_pages</a> <br>   <a hhref="http/ngx_http_referer_module.html#referer_hash_bucket_size">referer_hash_bucket_size</a> <br>   <a hhref="http/ngx_http_referer_module.html#referer_hash_max_size">referer_hash_max_size</a> <br>   <a hhref="http/ngx_http_core_module.html#request_pool_size">request_pool_size</a> <br>   <a hhref="http/ngx_http_core_module.html#reset_timedout_connection">reset_timedout_connection</a> <br>   <a hhref="http/ngx_http_core_module.html#resolver">解析器</a> （ngx_http_core_module） <br>   <a hhref="mail/ngx_mail_core_module.html#resolver">解析器</a> （ngx_mail_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#resolver">解析器</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#resolver_timeout">resolver_timeout</a> （ngx_http_core_module） <br>   <a hhref="mail/ngx_mail_core_module.html#resolver_timeout">resolver_timeout</a> （ngx_mail_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#resolver_timeout">resolver_timeout</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_rewrite_module.html#return">return</a> （ngx_http_rewrite_module） <br>   <a hhref="stream/ngx_stream_return_module.html#return">return</a> （ngx_stream_return_module） <br>   <a hhref="http/ngx_http_rewrite_module.html#rewrite">改写</a> <br>   <a hhref="http/ngx_http_rewrite_module.html#rewrite_log">rewrite_log</a> <br>   <a hhref="http/ngx_http_core_module.html#root">根</a> <br>   <a hhref="http/ngx_http_core_module.html#satisfy">满足</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_bind">scgi_bind</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_buffer_size">scgi_buffer_size</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_buffering">scgi_buffering</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_buffers">scgi_buffers</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_busy_buffers_size">scgi_busy_buffers_size</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache">scgi_cache</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_background_update">scgi_cache_background_update</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_bypass">scgi_cache_bypass</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_key">scgi_cache_key</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_lock">scgi_cache_lock</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_lock_age">scgi_cache_lock_age</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_lock_timeout">scgi_cache_lock_timeout</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_max_range_offset">scgi_cache_max_range_offset</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_methods">scgi_cache_methods</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_min_uses">scgi_cache_min_uses</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_path">scgi_cache_path</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_purge">scgi_cache_purge</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_revalidate">scgi_cache_revalidate</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_use_stale">scgi_cache_use_stale</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_cache_valid">scgi_cache_valid</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_connect_timeout">scgi_connect_timeout</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_force_ranges">scgi_force_ranges</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_hide_header">scgi_hide_header</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_ignore_client_abort">scgi_ignore_client_abort</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_ignore_headers">scgi_ignore_headers</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_intercept_errors">scgi_intercept_errors</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_limit_rate">scgi_limit_rate</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_max_temp_file_size">scgi_max_temp_file_size</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_next_upstream">scgi_next_upstream</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_next_upstream_timeout">scgi_next_upstream_timeout</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_next_upstream_tries">scgi_next_upstream_tries</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_no_cache">scgi_no_cache</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_param">scgi_param</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_pass">scgi_pass</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_pass_header">scgi_pass_header</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_pass_request_body">scgi_pass_request_body</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_pass_request_headers">scgi_pass_request_headers</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_read_timeout">scgi_read_timeout</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_request_buffering">scgi_request_buffering</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_send_timeout">scgi_send_timeout</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_socket_keepalive">scgi_socket_keepalive</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_store">scgi_store</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_store_access">scgi_store_access</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_temp_file_write_size">scgi_temp_file_write_size</a> <br>   <a hhref="http/ngx_http_scgi_module.html#scgi_temp_path">scgi_temp_path</a> <br>   <a hhref="http/ngx_http_secure_link_module.html#secure_link">secure_link</a> <br>   <a hhref="http/ngx_http_secure_link_module.html#secure_link_md5">secure_link_md5</a> <br>   <a hhref="http/ngx_http_secure_link_module.html#secure_link_secret">secure_link_secret</a> <br>   <a hhref="http/ngx_http_core_module.html#send_lowat">send_lowat</a> <br>   <a hhref="http/ngx_http_core_module.html#send_timeout">send_timeout</a> <br>   <a hhref="http/ngx_http_core_module.html#sendfile">发送文件</a> <br>   <a hhref="http/ngx_http_core_module.html#sendfile_max_chunk">sendfile_max_chunk</a> <br>   <a hhref="http/ngx_http_core_module.html#server">服务器</a> （ngx_http_core_module） <br>   <a hhref="http/ngx_http_upstream_module.html#server">服务器</a> （ngx_http_upstream_module） <br>   <a hhref="mail/ngx_mail_core_module.html#server">服务器</a> （ngx_mail_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#server">服务器</a> （ngx_stream_core_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#server">服务器</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_core_module.html#server_name">server_name</a> （ngx_http_core_module） <br>   <a hhref="mail/ngx_mail_core_module.html#server_name">server_name</a> （ngx_mail_core_module） <br>   <a hhref="http/ngx_http_core_module.html#server_name_in_redirect">server_name_in_redirect</a> <br>   <a hhref="http/ngx_http_core_module.html#server_names_hash_bucket_size">server_names_hash_bucket_size</a> <br>   <a hhref="http/ngx_http_core_module.html#server_names_hash_max_size">server_names_hash_max_size</a> <br>   <a hhref="http/ngx_http_core_module.html#server_tokens">server_tokens</a> <br>   <a hhref="http/ngx_http_session_log_module.html#session_log">session_log</a> <br>   <a hhref="http/ngx_http_session_log_module.html#session_log_format">session_log_format</a> <br>   <a hhref="http/ngx_http_session_log_module.html#session_log_zone">session_log_zone</a> <br>   <a hhref="http/ngx_http_rewrite_module.html#set">组</a> <br>   <a hhref="http/ngx_http_realip_module.html#set_real_ip_from">set_real_ip_from</a> （ngx_http_realip_module） <br>   <a hhref="stream/ngx_stream_realip_module.html#set_real_ip_from">set_real_ip_from</a> （ngx_stream_realip_module） <br>   <a hhref="http/ngx_http_slice_module.html#slice">切片</a> <br>   <a hhref="mail/ngx_mail_smtp_module.html#smtp_auth">SMTP_AUTH</a> <br>   <a hhref="mail/ngx_mail_smtp_module.html#smtp_capabilities">smtp_capabilities</a> <br>   <a hhref="mail/ngx_mail_smtp_module.html#smtp_client_buffer">smtp_client_buffer</a> <br>   <a hhref="mail/ngx_mail_smtp_module.html#smtp_greeting_delay">smtp_greeting_delay</a> <br>   <a hhref="http/ngx_http_charset_module.html#source_charset">source_charset</a> <br>   <a hhref="http/ngx_http_spdy_module.html#spdy_chunk_size">spdy_chunk_size</a> <br>   <a hhref="http/ngx_http_spdy_module.html#spdy_headers_comp">spdy_headers_comp</a> <br>   <a hhref="http/ngx_http_split_clients_module.html#split_clients">split_clients</a> （ngx_http_split_clients_module） <br>   <a hhref="stream/ngx_stream_split_clients_module.html#split_clients">split_clients</a> （ngx_stream_split_clients_module） <br>   <a hhref="http/ngx_http_ssi_module.html#ssi">SSI</a> <br>   <a hhref="http/ngx_http_ssi_module.html#ssi_last_modified">ssi_last_modified</a> <br>   <a hhref="http/ngx_http_ssi_module.html#ssi_min_file_chunk">ssi_min_file_chunk</a> <br>   <a hhref="http/ngx_http_ssi_module.html#ssi_silent_errors">ssi_silent_errors</a> <br>   <a hhref="http/ngx_http_ssi_module.html#ssi_types">ssi_types</a> <br>   <a hhref="http/ngx_http_ssi_module.html#ssi_value_length">ssi_value_length</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl">ssl</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl">ssl</a> （ngx_mail_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_buffer_size">ssl_buffer_size</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_certificate">ssl_certificate</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_certificate">ssl_certificate</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_certificate">ssl_certificate</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_certificate_key">ssl_certificate_key</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_certificate_key">ssl_certificate_key</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_certificate_key">ssl_certificate_key</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_ciphers">ssl_ciphers</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_ciphers">ssl_ciphers</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_ciphers">ssl_ciphers</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_client_certificate">ssl_client_certificate</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_client_certificate">ssl_client_certificate</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_client_certificate">ssl_client_certificate</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_crl">ssl_crl</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_crl">ssl_crl</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_crl">ssl_crl</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_dhparam">ssl_dhparam</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_dhparam">ssl_dhparam</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_dhparam">ssl_dhparam</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_early_data">ssl_early_data</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_ecdh_curve">ssl_ecdh_curve</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_ecdh_curve">ssl_ecdh_curve</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_ecdh_curve">ssl_ecdh_curve</a> （ngx_stream_ssl_module） <br>   <a hhref="ngx_core_module.html#ssl_engine">ssl_engine</a> <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_handshake_timeout">ssl_handshake_timeout</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_password_file">ssl_password_file</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_password_file">ssl_password_file</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_password_file">ssl_password_file</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a> （ngx_stream_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_preread_module.html#ssl_preread">ssl_preread</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_protocols">ssl_protocols</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_protocols">ssl_protocols</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_protocols">ssl_protocols</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_session_cache">ssl_session_cache</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_session_cache">ssl_session_cache</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_session_cache">ssl_session_cache</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_session_ticket_key">ssl_session_ticket_key</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_session_ticket_key">ssl_session_ticket_key</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_session_ticket_key">ssl_session_ticket_key</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_session_tickets">ssl_session_tickets</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_session_tickets">ssl_session_tickets</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_session_tickets">ssl_session_tickets</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_session_timeout">ssl_session_timeout</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_session_timeout">ssl_session_timeout</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_session_timeout">ssl_session_timeout</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_stapling">ssl_stapling</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_stapling_file">ssl_stapling_file</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_stapling_responder">ssl_stapling_responder</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_stapling_verify">ssl_stapling_verify</a> <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_trusted_certificate">ssl_trusted_certificate</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_trusted_certificate">ssl_trusted_certificate</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_trusted_certificate">ssl_trusted_certificate</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_verify_client">ssl_verify_client</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_verify_client">ssl_verify_client</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_verify_client">ssl_verify_client</a> （ngx_stream_ssl_module） <br>   <a hhref="http/ngx_http_ssl_module.html#ssl_verify_depth">ssl_verify_depth</a> （ngx_http_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#ssl_verify_depth">ssl_verify_depth</a> （ngx_mail_ssl_module） <br>   <a hhref="stream/ngx_stream_ssl_module.html#ssl_verify_depth">ssl_verify_depth</a> （ngx_stream_ssl_module） <br>   <a hhref="mail/ngx_mail_ssl_module.html#starttls">STARTTLS</a> <br>   <a hhref="http/ngx_http_upstream_module.html#state">state</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#state">state</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_status_module.html#status">状态</a> <br>   <a hhref="http/ngx_http_status_module.html#status_format">status_format的</a> <br>   <a hhref="http/ngx_http_api_module.html#status_zone">status_zone</a> （ngx_http_api_module） <br>   <a hhref="http/ngx_http_status_module.html#status_zone">status_zone</a> （ngx_http_status_module） <br>   <a hhref="http/ngx_http_upstream_module.html#sticky">黏</a> <br>   <a hhref="http/ngx_http_upstream_module.html#sticky_cookie_insert">sticky_cookie_insert</a> <br>   <a hhref="stream/ngx_stream_core_module.html#stream">流</a> <br>   <a hhref="http/ngx_http_stub_status_module.html#stub_status">stub_status</a> <br>   <a hhref="http/ngx_http_sub_module.html#sub_filter">sub_filter</a> <br>   <a hhref="http/ngx_http_sub_module.html#sub_filter_last_modified">sub_filter_last_modified</a> <br>   <a hhref="http/ngx_http_sub_module.html#sub_filter_once">sub_filter_once</a> <br>   <a hhref="http/ngx_http_sub_module.html#sub_filter_types">sub_filter_types</a> <br>   <a hhref="http/ngx_http_core_module.html#subrequest_output_buffer_size">subrequest_output_buffer_size</a> <br>   <a hhref="http/ngx_http_core_module.html#tcp_nodelay">tcp_nodelay</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#tcp_nodelay">tcp_nodelay</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#tcp_nopush">tcp_nopush</a> <br>   <a hhref="ngx_core_module.html#thread_pool">thread_pool</a> <br>   <a hhref="mail/ngx_mail_core_module.html#timeout">超时</a> <br>   <a hhref="ngx_core_module.html#timer_resolution">timer_resolution</a> <br>   <a hhref="http/ngx_http_core_module.html#try_files">try_files</a> <br>   <a hhref="http/ngx_http_core_module.html#types">类型</a> <br>   <a hhref="http/ngx_http_core_module.html#types_hash_bucket_size">types_hash_bucket_size</a> <br>   <a hhref="http/ngx_http_core_module.html#types_hash_max_size">types_hash_max_size</a> <br>   <a hhref="http/ngx_http_core_module.html#underscores_in_headers">underscores_in_headers</a> <br>   <a hhref="http/ngx_http_rewrite_module.html#uninitialized_variable_warn">uninitialized_variable_warn</a> <br>   <a hhref="http/ngx_http_upstream_module.html#upstream">上游</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#upstream">上游</a> （ngx_stream_upstream_module） <br>   <a hhref="http/ngx_http_upstream_conf_module.html#upstream_conf">upstream_conf</a> <br>   <a hhref="ngx_core_module.html#use">使用</a> <br>   <a hhref="ngx_core_module.html#user">用户</a> <br>   <a hhref="http/ngx_http_userid_module.html#userid">用户身份</a> <br>   <a hhref="http/ngx_http_userid_module.html#userid_domain">userid_domain</a> <br>   <a hhref="http/ngx_http_userid_module.html#userid_expires">userid_expires</a> <br>   <a hhref="http/ngx_http_userid_module.html#userid_mark">userid_mark</a> <br>   <a hhref="http/ngx_http_userid_module.html#userid_name">userid_name</a> <br>   <a hhref="http/ngx_http_userid_module.html#userid_p3p">userid_p3p</a> <br>   <a hhref="http/ngx_http_userid_module.html#userid_path">userid_path</a> <br>   <a hhref="http/ngx_http_userid_module.html#userid_service">userid_service</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_bind">uwsgi_bind</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_buffer_size">uwsgi_buffer_size</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_buffering">uwsgi_buffering</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_buffers">uwsgi_buffers</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_busy_buffers_size">uwsgi_busy_buffers_size</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache">uwsgi_cache</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_background_update">uwsgi_cache_background_update</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_bypass">uwsgi_cache_bypass</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_key">uwsgi_cache_key</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_lock">uwsgi_cache_lock</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_lock_age">uwsgi_cache_lock_age</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_lock_timeout">uwsgi_cache_lock_timeout</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_max_range_offset">uwsgi_cache_max_range_offset</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_methods">uwsgi_cache_methods</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_min_uses">uwsgi_cache_min_uses</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_path">uwsgi_cache_path</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_purge">uwsgi_cache_purge</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_revalidate">uwsgi_cache_revalidate</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_use_stale">uwsgi_cache_use_stale</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_cache_valid">uwsgi_cache_valid</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_connect_timeout">uwsgi_connect_timeout</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_force_ranges">uwsgi_force_ranges</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_hide_header">uwsgi_hide_header</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ignore_client_abort">uwsgi_ignore_client_abort</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ignore_headers">uwsgi_ignore_headers</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_intercept_errors">uwsgi_intercept_errors</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_limit_rate">uwsgi_limit_rate</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_max_temp_file_size">uwsgi_max_temp_file_size</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_modifier1">uwsgi_modifier1</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_modifier2">uwsgi_modifier2</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_next_upstream">uwsgi_next_upstream</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_next_upstream_timeout">uwsgi_next_upstream_timeout</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_next_upstream_tries">uwsgi_next_upstream_tries</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_no_cache">uwsgi_no_cache</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_param">uwsgi_param</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_pass">uwsgi_pass</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_pass_header">uwsgi_pass_header</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_pass_request_body">uwsgi_pass_request_body</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_pass_request_headers">uwsgi_pass_request_headers</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_read_timeout">uwsgi_read_timeout</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_request_buffering">uwsgi_request_buffering</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_send_timeout">uwsgi_send_timeout</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_socket_keepalive">uwsgi_socket_keepalive</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_certificate">uwsgi_ssl_certificate</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_certificate_key">uwsgi_ssl_certificate_key</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_ciphers">uwsgi_ssl_ciphers</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_crl">uwsgi_ssl_crl</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_name">uwsgi_ssl_name</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_password_file">uwsgi_ssl_password_file</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_protocols">uwsgi_ssl_protocols</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_server_name">uwsgi_ssl_server_name</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_session_reuse">uwsgi_ssl_session_reuse</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_trusted_certificate">uwsgi_ssl_trusted_certificate</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_verify">uwsgi_ssl_verify</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_ssl_verify_depth">uwsgi_ssl_verify_depth</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_store">uwsgi_store</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_store_access">uwsgi_store_access</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_temp_file_write_size">uwsgi_temp_file_write_size</a> <br>   <a hhref="http/ngx_http_uwsgi_module.html#uwsgi_temp_path">uwsgi_temp_path</a> <br>   <a hhref="http/ngx_http_referer_module.html#valid_referers">valid_referers</a> <br>   <a hhref="http/ngx_http_core_module.html#variables_hash_bucket_size">variables_hash_bucket_size</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#variables_hash_bucket_size">variables_hash_bucket_size</a> （ngx_stream_core_module） <br>   <a hhref="http/ngx_http_core_module.html#variables_hash_max_size">variables_hash_max_size</a> （ngx_http_core_module） <br>   <a hhref="stream/ngx_stream_core_module.html#variables_hash_max_size">variables_hash_max_size</a> （ngx_stream_core_module） <br>   <a hhref="ngx_core_module.html#worker_aio_requests">worker_aio_requests</a> <br>   <a hhref="ngx_core_module.html#worker_connections">worker_connections</a> <br>   <a hhref="ngx_core_module.html#worker_cpu_affinity">worker_cpu_affinity</a> <br>   <a hhref="ngx_core_module.html#worker_priority">worker_priority</a> <br>   <a hhref="ngx_core_module.html#worker_processes">worker_processes</a> <br>   <a hhref="ngx_core_module.html#worker_rlimit_core">worker_rlimit_core</a> <br>   <a hhref="ngx_core_module.html#worker_rlimit_nofile">worker_rlimit_nofile</a> <br>   <a hhref="ngx_core_module.html#worker_shutdown_timeout">worker_shutdown_timeout</a> <br>   <a hhref="ngx_core_module.html#working_directory">working_directory的</a> <br>   <a hhref="mail/ngx_mail_proxy_module.html#xclient">X客户端</a> <br>   <a hhref="http/ngx_http_xslt_module.html#xml_entities">xml_entities</a> <br>   <a hhref="http/ngx_http_xslt_module.html#xslt_last_modified">xslt_last_modified</a> <br>   <a hhref="http/ngx_http_xslt_module.html#xslt_param">xslt_param</a> <br>   <a hhref="http/ngx_http_xslt_module.html#xslt_string_param">xslt_string_param</a> <br>   <a hhref="http/ngx_http_xslt_module.html#xslt_stylesheet">xslt_stylesheet</a> <br>   <a hhref="http/ngx_http_xslt_module.html#xslt_types">xslt_types</a> <br>   <a hhref="http/ngx_http_upstream_module.html#zone">zone</a> （ngx_http_upstream_module） <br>   <a hhref="stream/ngx_stream_upstream_module.html#zone">zone</a> （ngx_stream_upstream_module） <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync">zone_sync</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_buffers">zone_sync_buffers</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_connect_retry_interval">zone_sync_connect_retry_interval</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_connect_timeout">zone_sync_connect_timeout</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_interval">zone_sync_interval</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_recv_buffer_size">zone_sync_recv_buffer_size</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_server">zone_sync_server</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl">zone_sync_ssl</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_certificate">zone_sync_ssl_certificate</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_certificate_key">zone_sync_ssl_certificate_key</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_ciphers">zone_sync_ssl_ciphers</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_crl">zone_sync_ssl_crl</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_name">zone_sync_ssl_name</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_password_file">zone_sync_ssl_password_file</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_protocols">zone_sync_ssl_protocols</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_server_name">zone_sync_ssl_server_name</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_trusted_certificate">zone_sync_ssl_trusted_certificate</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_verify">zone_sync_ssl_verify</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_ssl_verify_depth">zone_sync_ssl_verify_depth</a> <br>   <a hhref="stream/ngx_stream_zone_sync_module.html#zone_sync_timeout">zone_sync_timeout</a> <br></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/debugging_log.html</url>
      <content type="html"><![CDATA[<p></p><h2>  调试日志 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#clients">Debugging log for selected clients</a> <br> <a hhref="#memory">Logging to a cyclic memory buffer</a> <br></td></tr></tbody></table><p>  要启用调试日志，需要配置nginx以在构建期间支持调试： </p><blockquote class="example"><pre class="notranslate">./configure –with-debug …<br></pre></blockquote><p>  然后应使用<a hhref="ngx_core_module.html#error_log">error_log</a>指令设置<code class="notranslate">debug</code>级别： </p><blockquote class="example"><pre class="notranslate">error_log /path/to/log debug;<br></pre></blockquote><p>  要验证nginx是否配置为支持调试，请运行<code class="notranslate">nginx -V</code>命令： </p><blockquote class="example"><pre class="notranslate">configure arguments: –with-debug …<br></pre></blockquote><p>  预构建的<a hhref="linux_packages.html">Linux</a>软件包为使用<code class="notranslate">nginx-debug</code>二进制文件（1.9.8）调试日志提供了开箱即用的支持，可以使用命令运行 </p><blockquote class="example"><pre class="notranslate">service nginx stop<br>service nginx-debug start<br></pre></blockquote><p>  然后设置<code class="notranslate">debug</code>级别。  用于Windows的nginx二进制版本始终使用调试日志支持构建，因此仅设置<code class="notranslate">debug</code>级别就足够了。 </p><p>  请注意，重新定义日志而不指定<code class="notranslate">debug</code>级别将禁用调试日志。  在下面的示例中，重新定义<a hhref="http/ngx_http_core_module.html#server">服务器</a>级别上的日志会禁用此服务器的调试日志： </p><blockquote class="example"><pre class="notranslate">error_log /path/to/log debug;<p></p>
<p>http {<br>    server {<br>        error_log /path/to/log;<br>        …<br></p></pre></blockquote><p>  为避免这种情况，应重新定义重新定义日志的行，或者还应添加<code class="notranslate">debug</code>级别规范： </p><blockquote class="example"><pre class="notranslate">error_log /path/to/log debug;<p></p>
<p>http {<br>    server {<br>        error_log /path/to/log debug;<br>        …<br></p></pre></blockquote><p></p><a name="clients"></a><center><h4>  调试所选客户端的日志 </h4></center><p>  也可以仅为<a hhref="ngx_core_module.html#debug_connection">选定的客户端地址</a>启用调试日志： </p><blockquote class="example"><pre class="notranslate">error_log /path/to/log;<p></p>
<p>events {<br>    debug_connection 192.168.1.1;<br>    debug_connection 192.168.10.0/24;<br>}<br></p></pre></blockquote><p></p><a name="memory"></a><center><h4>  记录到循环内存缓冲区 </h4></center><p>  调试日志可以写入循环内存缓冲区： </p><blockquote class="example"><pre class="notranslate">error_log memory:32m debug;<br></pre></blockquote><p>  即使在高负载下，在<code class="notranslate">debug</code>级别上记录到内存缓冲区也不会对性能产生重大影响。  在这种情况下，可以使用<code class="notranslate">gdb</code>脚本提取日志，如下所示： </p><blockquote class="example"><pre class="notranslate">set $log = ngx_cycle-&gt;log<p></p>
<p>while $log-&gt;writer != ngx_log_memory_writer<br>    set $log = $log-&gt;next<br>end</p>
<p>set $buf = (ngx_log_memory_buf_t *) $log-&gt;wdata<br>dump binary memory debug_log.txt $buf-&gt;start $buf-&gt;end<br></p></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/control.html</url>
      <content type="html"><![CDATA[<p></p><h2>  控制nginx </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#reconfiguration">Changing Configuration</a> <br> <a hhref="#logs">Rotating Log-files</a> <br> <a hhref="#upgrade">Upgrading Executable on the Fly</a> <br></td></tr></tbody></table><p>   nginx可以用信号控制。  默认情况下，主进程的进程ID将写入文件<code class="notranslate">/usr/local/nginx/logs/nginx.pid</code> 。  此名称可以在配置时更改，也可以使用<a hhref="ngx_core_module.html#pid">pid</a>指令在<code class="notranslate">nginx.conf</code>更改。  主进程支持以下信号： </p><blockquote class="note"><table width="100%"><tbody><tr><td width="20%" class="notranslate">TERM, INT</td><td class="notranslate">fast shutdown</td></tr><tr><td width="20%" class="notranslate">QUIT</td><td class="notranslate">graceful shutdown</td></tr><tr><td width="20%" class="notranslate">HUP</td><td class="notranslate">changing configuration,<br>keeping up with a changed time zone (only for FreeBSD and Linux),<br>starting new worker processes with a new configuration,<br>graceful shutdown of old worker processes</td></tr><tr><td width="20%" class="notranslate">USR1</td><td class="notranslate">re-opening log files</td></tr><tr><td width="20%" class="notranslate">USR2</td><td class="notranslate">upgrading an executable file</td></tr><tr><td width="20%" class="notranslate">WINCH</td><td class="notranslate">graceful shutdown of worker processes</td></tr></tbody></table></blockquote><p></p><p>  虽然不是必需的，但也可以通过信号控制单个工作进程。  支持的信号是： </p><blockquote class="note"><table width="100%"><tbody><tr><td width="20%" class="notranslate">TERM, INT</td><td class="notranslate">fast shutdown</td></tr><tr><td width="20%" class="notranslate">QUIT</td><td class="notranslate">graceful shutdown</td></tr><tr><td width="20%" class="notranslate">USR1</td><td class="notranslate">re-opening log files</td></tr><tr><td width="20%" class="notranslate">WINCH</td><td class="notranslate">abnormal termination for debugging<br>(requires <a hhref="ngx_core_module.html#debug_points">debug_points</a> to be enabled)<br></td></tr></tbody></table></blockquote><p></p><a name="reconfiguration"></a><center><h4>  改变配置 </h4></center><p>  为了让nginx重新读取配置文件，应该将HUP信号发送到主进程。  主进程首先检查语法有效性，然后尝试应用新配置，即打开日志文件和新的侦听套接字。  如果此操作失败，则会回滚更改并继续使用旧配置。  如果成功，它将启动新的工作进程，并向旧工作进程发送消息，请求它们正常关闭。  旧工作进程关闭侦听套接字并继续为旧客户端提供服务。  在为所有客户端提供服务后，将关闭旧工作进程。 </p><p>  让我们通过例子来说明这一点。  想象一下，nginx是在FreeBSD和命令上运行的 </p><blockquote class="example"><pre class="notranslate">ps axw -o pid,ppid,user,%cpu,vsz,wchan,command | egrep ‘(nginx|PID)’<br></pre></blockquote><p>  产生以下输出： </p><blockquote class="example"><pre class="notranslate">  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND<br>33126     1 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>33127 33126 nobody   0.0  1380 kqread nginx: worker process (nginx)<br>33128 33126 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>33129 33126 nobody   0.0  1364 kqread nginx: worker process (nginx)<br></pre></blockquote><p></p><p>  如果将HUP发送到主进程，则输出变为： </p><blockquote class="example"><pre class="notranslate">  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND<br>33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>33129 33126 nobody   0.0  1380 kqread nginx: worker process is shutting down (nginx)<br>33134 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)<br>33135 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)<br>33136 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)<br></pre></blockquote><p></p><p>   PID 33129的旧工作进程之一仍然继续工作。  退出一段时间后： </p><blockquote class="example"><pre class="notranslate">  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND<br>33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>33134 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)<br>33135 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)<br>33136 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)<br></pre></blockquote><p></p><a name="logs"></a><center><h4>  旋转日志文件 </h4></center><p>  为了旋转日志文件，需要先重命名它们。  之后，应将USR1信号发送到主进程。  然后，主进程将重新打开所有当前打开的日志文件，并为作为所有者的工作进程正在运行的非特权用户分配。  成功重新打开后，主进程将关闭所有打开的文件，并将消息发送到工作进程，要求他们重新打开文件。  工作进程还会立即打开新文件并关闭旧文件。  因此，旧文件几乎可立即用于后期处理，例如压缩。 </p><a name="upgrade"></a><center><h4>  即时升级可执行文件 </h4></center><p>  为了升级服务器可执行文件，应首先使用新的可执行文件代替旧文件。  之后，应将USR2信号发送到主进程。  主进程首先使用进程ID将其文件重命名为带有<code class="notranslate">.oldbin</code>后缀的新文件，例如<code class="notranslate">/usr/local/nginx/logs/nginx.pid.oldbin</code> ，然后启动一个新的可执行文件，该文件又启动新的工作进程： </p><blockquote class="example"><pre class="notranslate">  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND<br>33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>33134 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)<br>33135 33126 nobody   0.0  1380 kqread nginx: worker process (nginx)<br>33136 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)<br>36264 33126 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>36265 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>36266 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>36267 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br></pre></blockquote><p></p><p>  之后，所有工作进程（新旧进程）继续接受请求。  如果将WINCH信号发送到第一个主进程，它将向其工作进程发送消息，请求它们正常关闭，然后它们将开始退出： </p><blockquote class="example"><pre class="notranslate">  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND<br>33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>33135 33126 nobody   0.0  1380 kqread nginx: worker process is shutting down (nginx)<br>36264 33126 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>36265 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>36266 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>36267 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br></pre></blockquote><p></p><p>  一段时间后，只有新的工作进程才会处理请求： </p><blockquote class="example"><pre class="notranslate">  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND<br>33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>36264 33126 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>36265 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>36266 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>36267 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br></pre></blockquote><p></p><p>  应该注意的是，旧的主进程不会关闭其侦听套接字，并且可以管理它以在需要时再次启动其工作进程。  如果由于某种原因新的可执行文件无法接受，可以执行以下操作之一： </p><ul class="compact"><li><p>  将HUP信号发送到旧的主进程。  旧的主进程将启动新的工作进程，而无需重新读取配置。  之后，通过将QUIT信号发送到新的主进程，可以正常关闭所有新进程。 </p></li><li><p>  将TERM信号发送到新的主进程。  然后它会向其工作进程发送一条消息，要求它们立即退出，并且它们几乎都会立即退出。   （如果新进程由于某种原因没有退出，则应将KILL信号发送给它们以强制它们退出。）当新的主进程退出时，旧的主进程将自动启动新的进程进程。 </p></li></ul><p></p><p>  如果新的主进程退出，则旧的主进程将使用进程ID从文件名中丢弃<code class="notranslate">.oldbin</code>后缀。 </p><p>  如果升级成功，则应将QUIT信号发送到旧的主进程，并且只保留新进程： </p><blockquote class="example"><pre class="notranslate">  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND<br>36264     1 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx<br>36265 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>36266 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br>36267 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)<br></pre></blockquote><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/contributing_changes.html</url>
      <content type="html"><![CDATA[<p></p><h2>  贡献变化 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#getting_sources">Getting Sources</a> <br> <a hhref="#formatting_changes">Formatting Changes</a> <br> <a hhref="#before_submitting">Before Submitting</a> <br> <a hhref="#submitting_changes">Submitting Changes</a> <br> <a hhref="#license">License</a> <br></td></tr></tbody></table><a name="getting_sources"></a><center><h4>  获取资源 </h4></center><p>   <a hhref="https://www.mercurial-scm.org">Mercurial</a>用于存储源代码。  可以使用以下命令克隆<a hhref="http://hg.nginx.org/nginx">存储库</a> ： </p><blockquote class="example"><pre class="notranslate">hg clone <a href="http://hg.nginx.org/nginx" target="_blank" rel="noopener">http://hg.nginx.org/nginx</a><br></pre></blockquote><p></p><a name="formatting_changes"></a><center><h4>  格式化更改 </h4></center><p>  应根据nginx使用的<a hhref="dev/development_guide.html#code_style">代码样式</a>格式化更改。  有时，没有明确的规则;  在这种情况下，检查现有nginx源的格式并模仿这种风格。  如果样式与周围的代码相对应，则更有可能接受更改。 </p><p>  提交更改以创建Mercurial <a hhref="https://www.mercurial-scm.org/wiki/ChangeSet">变更集</a> 。  请确保更改作者的指定<a hhref="https://www.mercurial-scm.org/wiki/QuickStart#Setting_a_username">电子邮件</a>地址和真实姓名正确无误。 </p><p>  提交消息应该有一个单行的概要，后面跟一个空行后的详细描述。  希望第一行不超过67个符号。  可以使用<code class="notranslate">hg export</code>命令获取作为补丁的结果变更集： </p><blockquote class="example"><pre class="notranslate"># HG changeset patch<p></p>
<h1 id="User-Filipe-Da-Silva-lt-username-example-com-gt"><a href="#User-Filipe-Da-Silva-lt-username-example-com-gt" class="headerlink" title="User Filipe Da Silva &lt;username@example.com&gt;"></a>User Filipe Da Silva &lt;username@example.com&gt;</h1><h1 id="Date-1368089668-7200"><a href="#Date-1368089668-7200" class="headerlink" title="Date 1368089668 -7200"></a>Date 1368089668 -7200</h1><h1 id="Thu-May-09-10-54-28-2013-0200"><a href="#Thu-May-09-10-54-28-2013-0200" class="headerlink" title="Thu May 09 10:54:28 2013 +0200"></a>Thu May 09 10:54:28 2013 +0200</h1><h1 id="Node-ID-2220de0521ca2c0b664a8ea1e201ce1cb90fd7a2"><a href="#Node-ID-2220de0521ca2c0b664a8ea1e201ce1cb90fd7a2" class="headerlink" title="Node ID 2220de0521ca2c0b664a8ea1e201ce1cb90fd7a2"></a>Node ID 2220de0521ca2c0b664a8ea1e201ce1cb90fd7a2</h1><h1 id="Parent-822b82191940ef309cd1e6502f94d50d811252a1"><a href="#Parent-822b82191940ef309cd1e6502f94d50d811252a1" class="headerlink" title="Parent  822b82191940ef309cd1e6502f94d50d811252a1"></a>Parent  822b82191940ef309cd1e6502f94d50d811252a1</h1><p>Mail: removed surplus ngx_close_connection() call.</p>
<p>It is already called for a peer connection a few lines above.</p>
<p>diff -r 822b82191940 -r 2220de0521ca src/mail/ngx_mail_auth_http_module.c<br>— a/src/mail/ngx_mail_auth_http_module.c      Wed May 15 15:04:49 2013 +0400<br>+++ b/src/mail/ngx_mail_auth_http_module.c      Thu May 09 10:54:28 2013 +0200<br>@@ -699,7 +699,6 @@ ngx_mail_auth_http_process_headers(ngx_m</p>
<pre><code>p = ngx_pnalloc(s-&amp;gt;connection-&amp;gt;pool, ctx-&amp;gt;err.len);
if (p == NULL) {
</code></pre><ul>
<li>ngx_close_connection(ctx-&gt;peer.connection);<br>ngx_destroy_pool(ctx-&gt;pool);<br>ngx_mail_session_internal_server_error(s);<br>return;<br></li></ul></pre></blockquote><p></p><a name="before_submitting"></a><center><h4>  在提交之前 </h4></center><p>  在提交更改之前，有几点值得考虑： </p><ul class="compact"><li>  建议的更改应适用于广泛的<a hhref="index.html#tested_os_and_platforms">受支持平台</a> 。 </li><li>  尽量明确为什么需要建议的更改，并尽可能提供用例。 </li><li>  通过测试套件传递更改是确保它们不会导致回归的好方法。  可以使用以下命令克隆包含测试的<a hhref="http://hg.nginx.org/nginx-tests">存储库</a> ： <blockquote class="example"><pre class="notranslate">hg clone <a href="http://hg.nginx.org/nginx-tests" target="_blank" rel="noopener">http://hg.nginx.org/nginx-tests</a><br></pre></blockquote></li></ul><p></p><a name="submitting_changes"></a><center><h4>  提交更改 </h4></center><p>  建议的更改应发送到<a hhref="support.html#nginx_devel">nginx开发</a>邮件列表。  提交变更集的首选方便方法是使用<a hhref="https://www.mercurial-scm.org/wiki/PatchbombExtension">patchbomb</a>扩展。 </p><a name="license"></a><center><h4>  执照 </h4></center><p>  提交更改意味着授予项目在相应<a hhref="LICENSE">许可</a>下使用它的权限。 </p><br><span></span><div style="display: none;"></div>

]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/configure.html</url>
      <content type="html"><![CDATA[<p></p><h2>  从Sources构建nginx </h2><p>  使用<code class="notranslate">configure</code>命令配置构建。  它定义了系统的各个方面，包括允许nginx用于连接处理的方法。  最后它创建了一个<code class="notranslate">Makefile</code> 。 </p><p>   <code class="notranslate">configure</code>命令支持以下参数： </p><p></p><dl class="compact"><dt> <code class="notranslate">–help</code> </dt> <dd>  打印帮助信息。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–prefix= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  定义将保留服务器文件的目录。  该目录也将用于<code class="notranslate">configure</code>设置的所有相对路径（库源路径除外）和<code class="notranslate">nginx.conf</code>配置文件中。  默认设置为<code class="notranslate">/usr/local/nginx</code>目录。 </dd><dt> <code class="notranslate">–sbin-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置nginx可执行文件的名称。  此名称仅在安装期间使用。  默认情况下，该文件名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /sbin/nginx</code> 。 </dd><dt> <code class="notranslate">–modules-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  定义将安装nginx动态模块的目录。  默认情况下，使用<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /modules</code>目录。 </dd><dt> <code class="notranslate">–conf-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置<code class="notranslate">nginx.conf</code>配置文件的名称。  如果需要，可以始终使用不同的配置文件启动nginx，方法是在命令行参数<code class="notranslate">-c <code class="notranslate"><i>file</i></code></code>指定它。  默认情况下，该文件名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /conf/nginx.conf</code> 。 </dd><dt> <code class="notranslate">–error-log-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置主要错误，警告和诊断文件的名称。  安装后，可以使用<a hhref="ngx_core_module.html#error_log">error_log</a>指令在<code class="notranslate">nginx.conf</code>配置文件中更改文件名。  默认情况下，该文件名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /logs/error.log</code> 。 </dd><dt> <code class="notranslate">–pid-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置将存储主进程的进程ID的<code class="notranslate">nginx.pid</code>文件的名称。  安装后，可以使用<a hhref="ngx_core_module.html#pid">pid</a>指令在<code class="notranslate">nginx.conf</code>配置文件中始终更改文件名。  默认情况下，该文件名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /logs/nginx.pid</code> 。 </dd><dt> <code class="notranslate">–lock-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  为锁定文件的名称设置前缀。  安装后，可以使用<a hhref="ngx_core_module.html#lock_file">lock_file</a>指令在<code class="notranslate">nginx.conf</code>配置文件中始终更改该值。  默认情况下，该值为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /logs/nginx.lock</code> 。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–user= <code class="notranslate"><i>name</i></code></code> </dt> <dd>  设置非特权用户的名称，其凭据将由工作进程使用。  安装后，可以使用<a hhref="ngx_core_module.html#user">user</a>指令在<code class="notranslate">nginx.conf</code>配置文件中更改名称。  默认用户名是nobody。 </dd><dt> <code class="notranslate">–group= <code class="notranslate"><i>name</i></code></code> </dt> <dd>  设置其凭据将由工作进程使用的组的名称。  安装后，可以使用<a hhref="ngx_core_module.html#user">user</a>指令在<code class="notranslate">nginx.conf</code>配置文件中更改名称。  默认情况下，组名称设置为非特权用户的名称。 </dd></dl><p></p><p></p><dl class="compact"><dt id="build"> <code class="notranslate">–build= <code class="notranslate"><i>name</i></code></code> </dt> <dd>  设置可选的nginx构建名称。 </dd><dt> <code class="notranslate">–builddir= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置构建目录。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-select_module</code> <br> <code class="notranslate">–without-select_module</code> </dt> <dd>  启用或禁用构建允许服务器使用<code class="notranslate">select()</code>方法的模块。  如果平台似乎不支持更合适的方法（如kqueue，epoll或/ dev / poll），则会自动构建此模块。 </dd><dt> <code class="notranslate">–with-poll_module</code> <br> <code class="notranslate">–without-poll_module</code> </dt> <dd>  启用或禁用构建允许服务器使用<code class="notranslate">poll()</code>方法的模块。  如果平台似乎不支持更合适的方法（如kqueue，epoll或/ dev / poll），则会自动构建此模块。 </dd><dt> <code class="notranslate">–with-threads</code> </dt> <dd>  允许使用<a hhref="ngx_core_module.html#thread_pool">线程池</a> 。 </dd><dt> <code class="notranslate">–with-file-aio</code> </dt> <dd>  允许在FreeBSD和Linux上使用<a hhref="http/ngx_http_core_module.html#aio">异步文件I / O</a> （AIO）。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-http_ssl_module</code> </dt> <dd>  允许构建一个模块，将<a hhref="http/ngx_http_ssl_module.html">HTTPS协议支持</a>添加到HTTP服务器。  默认情况下不构建此模块。  需要OpenSSL库来构建和运行此模块。 </dd><dt> <code class="notranslate">–with-http_v2_module</code> </dt> <dd>  可以构建一个支持<a hhref="http/ngx_http_v2_module.html">HTTP / 2</a>的模块。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_realip_module</code> </dt> <dd>  允许构建<a hhref="http/ngx_http_realip_module.html">ngx_http_realip_module</a>模块，该模块将客户端地址更改为在指定的头字段中发送的地址。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_addition_module</code> </dt> <dd>  允许构建<a hhref="http/ngx_http_addition_module.html">ngx_http_addition_module</a>模块，该模块在响应之前和之后添加文本。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_xslt_module</code> <br> <code class="notranslate">–with-http_xslt_module=dynamic</code> </dt> <dd>  允许构建使用一个或多个XSLT样式表转换XML响应的<a hhref="http/ngx_http_xslt_module.html">ngx_http_xslt_module</a>模块。  默认情况下不构建此模块。  需要<a hhref="http://xmlsoft.org">libxml2</a>和<a hhref="http://xmlsoft.org/XSLT/">libxslt</a>库来构建和运行此模块。 </dd><dt> <code class="notranslate">–with-http_image_filter_module</code> <br> <code class="notranslate">–with-http_image_filter_module=dynamic</code> </dt> <dd>  可以构建<a hhref="http/ngx_http_image_filter_module.html">ngx_http_image_filter_module</a>模块，该模块可以转换JPEG，GIF，PNG和WebP格式的图像。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_geoip_module</code> <br> <code class="notranslate">–with-http_geoip_module=dynamic</code> </dt> <dd>  允许构建<a hhref="http/ngx_http_geoip_module.html">ngx_http_geoip_module</a>模块，该模块根据客户端IP地址和预编译的<a hhref="http://www.maxmind.com">MaxMind</a>数据库创建变量。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_sub_module</code> </dt> <dd>  允许构建<a hhref="http/ngx_http_sub_module.html">ngx_http_sub_module</a>模块，该模块通过将一个指定的字符串替换为另一个来修改响应。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_dav_module</code> </dt> <dd>  支持构建<a hhref="http/ngx_http_dav_module.html">ngx_http_dav_module</a>模块，该模块通过WebDAV协议提供文件管理自动化。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_flv_module</code> </dt> <dd>  支持构建<a hhref="http/ngx_http_flv_module.html">ngx_http_flv_module</a>模块，该模块为Flash Video（FLV）文件提供伪流服务器端支持。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_mp4_module</code> </dt> <dd>  支持构建<a hhref="http/ngx_http_mp4_module.html">ngx_http_mp4_module</a>模块，该模块为MP4文件提供伪流服务器端支持。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_gunzip_module</code> </dt> <dd>  对于不支持“gzip”编码方法的客户端，可以构建使用“ <code class="notranslate">Content-Encoding: gzip</code> ”解压缩响应的<a hhref="http/ngx_http_gunzip_module.html">ngx_http_gunzip_module</a>模块。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_gzip_static_module</code> </dt> <dd>  允许构建<a hhref="http/ngx_http_gzip_static_module.html">ngx_http_gzip_static_module</a>模块，该模块允许使用“ <code class="notranslate">.gz</code> ”文件扩展名而不是常规文件发送预压缩文件。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_auth_request_module</code> </dt> <dd>  允许构建<a hhref="http/ngx_http_auth_request_module.html">ngx_http_auth_request_module</a>模块，该模块基于子请求的结果实现客户端授权。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_random_index_module</code> </dt> <dd>  允许构建<a hhref="http/ngx_http_random_index_module.html">ngx_http_random_index_module</a>模块，该模块处理以斜杠字符（’ <code class="notranslate">/</code> ‘）结尾的请求，并选择目录中的随机文件作为索引文件。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_secure_link_module</code> </dt> <dd>  可以构建<a hhref="http/ngx_http_secure_link_module.html">ngx_http_secure_link_module</a>模块。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_degradation_module</code> </dt> <dd>  可以构建<code class="notranslate">ngx_http_degradation_module</code>模块。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_slice_module</code> </dt> <dd>  允许构建<a hhref="http/ngx_http_slice_module.html">ngx_http_slice_module</a>模块，该模块将请求拆分为子请求，每个模块都返回一定范围的响应。  该模块提供了更有效的大响应缓存。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-http_stub_status_module</code> </dt> <dd>  可以构建<a hhref="http/ngx_http_stub_status_module.html">ngx_http_stub_status_module</a>模块，该模块提供对基本状态信息的访问。  默认情况下不构建此模块。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–without-http_charset_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_charset_module.html">ngx_http_charset_module</a>模块，该模块将指定的字符集添加到“Content-Type”响应头字段，还可以将数据从一个字符集转换为另一个字符集。 </dd><dt> <code class="notranslate">–without-http_gzip_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_gzip_module.html">压缩</a> HTTP服务器<a hhref="http/ngx_http_gzip_module.html">响应</a>的模块。   zlib库是构建和运行此模块所必需的。 </dd><dt> <code class="notranslate">–without-http_ssi_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_ssi_module.html">ngx_http_ssi_module</a>模块，该模块在通过它的响应中处理SSI（服务器端包含）命令。 </dd><dt> <code class="notranslate">–without-http_userid_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_userid_module.html">ngx_http_userid_module</a>模块，该模块设置适合客户端识别的cookie。 </dd><dt> <code class="notranslate">–without-http_access_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_access_module.html">ngx_http_access_module</a>模块，该模块允许限制对某些客户端地址的访问。 </dd><dt> <code class="notranslate">–without-http_auth_basic_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a>模块，该模块允许通过使用“HTTP基本身份验证”协议验证用户名和密码来限制对资源的访问。 </dd><dt> <code class="notranslate">–without-http_mirror_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_mirror_module.html">ngx_http_mirror_module</a>模块，该模块通过创建后台镜像子请求来实现原始请求的镜像。 </dd><dt> <code class="notranslate">–without-http_autoindex_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_autoindex_module.html">ngx_http_autoindex_module</a>模块，该模块处理以斜杠字符（’ <code class="notranslate">/</code> ‘）结尾的请求，并在<a hhref="http/ngx_http_index_module.html">ngx_http_index_module</a>模块找不到索引文件的情况下生成目录列表。 </dd><dt> <code class="notranslate">–without-http_geo_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_geo_module.html">ngx_http_geo_module</a>模块，该模块使用取决于客户端IP地址的值创建变量。 </dd><dt> <code class="notranslate">–without-http_map_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_map_module.html">ngx_http_map_module</a>模块，该模块使用取决于其他变量值的值创建变量。 </dd><dt> <code class="notranslate">–without-http_split_clients_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_split_clients_module.html">ngx_http_split_clients_module</a>模块，该模块为A / B测试创建变量。 </dd><dt> <code class="notranslate">–without-http_referer_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_referer_module.html">ngx_http_referer_module</a>模块，该模块可以阻止对“Referer”头字段中具有无效值的请求访问站点。 </dd><dt> <code class="notranslate">–without-http_rewrite_module</code> </dt> <dd>  禁用构建允许HTTP服务器<a hhref="http/ngx_http_rewrite_module.html">重定向请求和更改请求URI的模块</a> 。  需要PCRE库来构建和运行此模块。 </dd><dt> <code class="notranslate">–without-http_proxy_module</code> </dt> <dd>  禁用构建HTTP服务器<a hhref="http/ngx_http_proxy_module.html">代理模块</a> 。 </dd><dt> <code class="notranslate">–without-http_fastcgi_module</code> </dt> <dd>  禁用构建将请求传递给FastCGI服务器的<a hhref="http/ngx_http_fastcgi_module.html">ngx_http_fastcgi_module</a>模块。 </dd><dt> <code class="notranslate">–without-http_uwsgi_module</code> </dt> <dd>  禁用构建将请求传递给uwsgi服务器的<a hhref="http/ngx_http_uwsgi_module.html">ngx_http_uwsgi_module</a>模块。 </dd><dt> <code class="notranslate">–without-http_scgi_module</code> </dt> <dd>  禁用构建将请求传递给SCGI服务器的<a hhref="http/ngx_http_scgi_module.html">ngx_http_scgi_module</a>模块。 </dd><dt> <code class="notranslate">–without-http_grpc_module</code> </dt> <dd>  禁用构建将请求传递给gRPC服务器的<a hhref="http/ngx_http_grpc_module.html">ngx_http_grpc_module</a>模块。 </dd><dt> <code class="notranslate">–without-http_memcached_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_memcached_module.html">ngx_http_memcached_module</a>模块，该模块从memcached服务器获取响应。 </dd><dt> <code class="notranslate">–without-http_limit_conn_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_limit_conn_module.html">ngx_http_limit_conn_module</a>模块，该模块限制每个密钥的连接数，例如，来自单个IP地址的连接数。 </dd><dt> <code class="notranslate">–without-http_limit_req_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_limit_req_module.html">ngx_http_limit_req_module</a>模块，该模块限制每个密钥的请求处理速率，例如，来自单个IP地址的请求的处理速率。 </dd><dt> <code class="notranslate">–without-http_empty_gif_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_empty_gif_module.html">发出单像素透明GIF</a>的模块。 </dd><dt> <code class="notranslate">–without-http_browser_module</code> </dt> <dd>  禁用构建<a hhref="http/ngx_http_browser_module.html">ngx_http_browser_module</a>模块，该模块创建的值取决于“User-Agent”请求标头字段的值。 </dd><dt> <code class="notranslate">–without-http_upstream_hash_module</code> </dt> <dd>  禁用构建实现<a hhref="http/ngx_http_upstream_module.html#hash">散列</a>负载平衡方法的模块。 </dd><dt> <code class="notranslate">–without-http_upstream_ip_hash_module</code> </dt> <dd>  禁用构建实现<a hhref="http/ngx_http_upstream_module.html#ip_hash">ip_hash</a>负载平衡方法的模块。 </dd><dt> <code class="notranslate">–without-http_upstream_least_conn_module</code> </dt> <dd>  禁用构建实现<a hhref="http/ngx_http_upstream_module.html#least_conn">least_conn</a>负载平衡方法的模块。 </dd><dt> <code class="notranslate">–without-http_upstream_keepalive_module</code> </dt> <dd>  禁用构建一个模块，该模块提供到上游服务器<a hhref="http/ngx_http_upstream_module.html#keepalive">的连接缓存</a> 。 </dd><dt> <code class="notranslate">–without-http_upstream_zone_module</code> </dt> <dd>  禁用构建模块，该模块可以将上游组的运行时状态存储在共享内存<a hhref="http/ngx_http_upstream_module.html#zone">区域中</a> 。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-http_perl_module</code> <br> <code class="notranslate">–with-http_perl_module=dynamic</code> </dt> <dd>  可以构建<a hhref="http/ngx_http_perl_module.html">嵌入式Perl模块</a> 。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-perl_modules_path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  定义一个将保留Perl模块的目录。 </dd><dt> <code class="notranslate">–with-perl= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置Perl二进制文件的名称。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–http-log-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置HTTP服务器的主要请求日志文件的名称。  安装后，可以使用<a hhref="http/ngx_http_log_module.html#access_log">access_log</a>指令在<code class="notranslate">nginx.conf</code>配置文件中始终更改文件名。  默认情况下，该文件名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /logs/access.log</code> 。 </dd><dt> <code class="notranslate">–http-client-body-temp-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  定义用于存储保存客户端请求主体的临时文件的目录。  安装后，可以使用<a hhref="http/ngx_http_core_module.html#client_body_temp_path">client_body_temp_path</a>指令在<code class="notranslate">nginx.conf</code>配置文件中始终更改目录。  默认情况下，该目录名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /client_body_temp</code> 。 </dd><dt> <code class="notranslate">–http-proxy-temp-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  定义一个目录，用于存储临时文件和从代理服务器接收的数据。  安装后，可以使用<a hhref="http/ngx_http_proxy_module.html#proxy_temp_path">proxy_temp_path</a>指令在<code class="notranslate">nginx.conf</code>配置文件中更改目录。  默认情况下，该目录名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /proxy_temp</code> 。 </dd><dt> <code class="notranslate">–http-fastcgi-temp-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  定义一个目录，用于存储从FastCGI服务器接收的数据的临时文件。  安装后，可以使用<a hhref="http/ngx_http_fastcgi_module.html#fastcgi_temp_path">fastcgi_temp_path</a>指令在<code class="notranslate">nginx.conf</code>配置文件中始终更改目录。  默认情况下，该目录名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /fastcgi_temp</code> 。 </dd><dt> <code class="notranslate">–http-uwsgi-temp-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  定义一个目录，用于存储从uwsgi服务器接收的数据的临时文件。  安装后，可以使用<a hhref="http/ngx_http_uwsgi_module.html#uwsgi_temp_path">uwsgi_temp_path</a>指令在<code class="notranslate">nginx.conf</code>配置文件中始终更改目录。  默认情况下，该目录名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /uwsgi_temp</code> 。 </dd><dt> <code class="notranslate">–http-scgi-temp-path= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  定义了一个目录，用于存储从SCGI服务器接收的数据的临时文件。  安装后，可以使用<a hhref="http/ngx_http_scgi_module.html#scgi_temp_path">scgi_temp_path</a>指令在<code class="notranslate">nginx.conf</code>配置文件中始终更改目录。  默认情况下，该目录名为<code class="notranslate"><code class="notranslate"><i>prefix</i></code> /scgi_temp</code> 。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–without-http</code> </dt> <dd>  禁用<a hhref="http/ngx_http_core_module.html">HTTP</a>服务器。 </dd><dt> <code class="notranslate">–without-http-cache</code> </dt> <dd>  禁用HTTP缓存。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-mail</code> <br> <code class="notranslate">–with-mail=dynamic</code> </dt> <dd>  启用POP3 / IMAP4 / SMTP <a hhref="mail/ngx_mail_core_module.html">邮件代理</a>服务器。 </dd><dt> <code class="notranslate">–with-mail_ssl_module</code> </dt> <dd>  允许构建一个模块，将<a hhref="mail/ngx_mail_ssl_module.html">SSL / TLS协议支持添加</a>到邮件代理服务器。  默认情况下不构建此模块。  需要OpenSSL库来构建和运行此模块。 </dd><dt> <code class="notranslate">–without-mail_pop3_module</code> </dt> <dd>  禁用邮件代理服务器中的<a hhref="mail/ngx_mail_pop3_module.html">POP3</a>协议。 </dd><dt> <code class="notranslate">–without-mail_imap_module</code> </dt> <dd>  禁用邮件代理服务器中的<a hhref="mail/ngx_mail_imap_module.html">IMAP</a>协议。 </dd><dt> <code class="notranslate">–without-mail_smtp_module</code> </dt> <dd>  禁用邮件代理服务器中的<a hhref="mail/ngx_mail_smtp_module.html">SMTP</a>协议。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-stream</code> <br> <code class="notranslate">–with-stream=dynamic</code> </dt> <dd>  允许构建<a hhref="stream/ngx_stream_core_module.html">流模块</a>以进行通用TCP / UDP代理和负载平衡。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-stream_ssl_module</code> </dt> <dd>  可以构建一个模块，为流模块添加<a hhref="stream/ngx_stream_ssl_module.html">SSL / TLS协议支持</a> 。  默认情况下不构建此模块。  需要OpenSSL库来构建和运行此模块。 </dd><dt> <code class="notranslate">–with-stream_realip_module</code> </dt> <dd>  允许构建<a hhref="http/ngx_stream_realip_module.html">ngx_stream_realip_module</a>模块，该模块将客户端地址更改为PROXY协议头中发送的地址。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-stream_geoip_module</code> <br> <code class="notranslate">–with-stream_geoip_module=dynamic</code> </dt> <dd>  允许构建<a hhref="stream/ngx_stream_geoip_module.html">ngx_stream_geoip_module</a>模块，该模块根据客户端IP地址和预编译的<a hhref="http://www.maxmind.com">MaxMind</a>数据库创建变量。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–with-stream_ssl_preread_module</code> </dt> <dd>  允许构建<a hhref="stream/ngx_stream_ssl_preread_module.html">ngx_stream_ssl_preread_module</a>模块，该模块允许从<a hhref="https://tools.ietf.org/html/rfc5246#section-7.4.1.2">ClientHello</a>消息中提取信息而不终止SSL / TLS。  默认情况下不构建此模块。 </dd><dt> <code class="notranslate">–without-stream_limit_conn_module</code> </dt> <dd>  禁用构建<a hhref="stream/ngx_stream_limit_conn_module.html">ngx_stream_limit_conn_module</a>模块，该模块限制每个密钥的连接数，例如，来自单个IP地址的连接数。 </dd><dt> <code class="notranslate">–without-stream_access_module</code> </dt> <dd>  禁用构建<a hhref="stream/ngx_stream_access_module.html">ngx_stream_access_module</a>模块，该模块允许限制对某些客户端地址的访问。 </dd><dt> <code class="notranslate">–without-stream_geo_module</code> </dt> <dd>  禁用构建<a hhref="stream/ngx_stream_geo_module.html">ngx_stream_geo_module</a>模块，该模块使用取决于客户端IP地址的值创建变量。 </dd><dt> <code class="notranslate">–without-stream_map_module</code> </dt> <dd>  禁用构建<a hhref="stream/ngx_stream_map_module.html">ngx_stream_map_module</a>模块，该模块使用取决于其他变量值的值创建变量。 </dd><dt> <code class="notranslate">–without-stream_split_clients_module</code> </dt> <dd>  禁用构建<a hhref="stream/ngx_stream_split_clients_module.html">ngx_stream_split_clients_module</a>模块，该模块为A / B测试创建变量。 </dd><dt> <code class="notranslate">–without-stream_return_module</code> </dt> <dd>  禁用构建<a hhref="stream/ngx_stream_return_module.html">ngx_stream_return_module</a>模块，该模块将一些指定值发送到客户端，然后关闭连接。 </dd><dt> <code class="notranslate">–without-stream_upstream_hash_module</code> </dt> <dd>  禁用构建实现<a hhref="stream/ngx_stream_upstream_module.html#hash">散列</a>负载平衡方法的模块。 </dd><dt> <code class="notranslate">–without-stream_upstream_least_conn_module</code> </dt> <dd>  禁用构建实现<a hhref="stream/ngx_stream_upstream_module.html#least_conn">least_conn</a>负载平衡方法的模块。 </dd><dt> <code class="notranslate">–without-stream_upstream_zone_module</code> </dt> <dd>  禁用构建模块，该模块可以将上游组的运行时状态存储在共享内存<a hhref="stream/ngx_stream_upstream_module.html#zone">区域中</a> 。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-google_perftools_module</code> </dt> <dd>  可以构建<a hhref="ngx_google_perftools_module.html">ngx_google_perftools_module</a>模块，该模块可以使用<a hhref="https://github.com/gperftools/gperftools">Google Performance Tools</a>分析nginx工作进程。  该模块适用于nginx开发人员，默认情况下不构建。 </dd><dt> <code class="notranslate">–with-cpp_test_module</code> </dt> <dd>  用于构建<code class="notranslate">ngx_cpp_test_module</code>模块。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–add-module= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  启用外部模块。 </dd><dt> <code class="notranslate">–add-dynamic-module= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  启用外部动态模块。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-compat</code> </dt> <dd>  启用动态模块兼容性。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-cc= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置C编译器的名称。 </dd><dt> <code class="notranslate">–with-cpp= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置C预处理器的名称。 </dd><dt> <code class="notranslate">–with-cc-opt= <code class="notranslate"><i>parameters</i></code></code> </dt> <dd>  设置将添加到CFLAGS变量的其他参数。  在FreeBSD下使用系统PCRE库时，应指定<code class="notranslate">–with-cc-opt=”-I /usr/local/include”</code> 。  如果需要增加<code class="notranslate">select()</code>支持的文件数，也可以在此处指定，例如： - <code class="notranslate">–with-cc-opt=”-D FD_SETSIZE=2048”</code> 。 </dd><dt> <code class="notranslate">–with-ld-opt= <code class="notranslate"><i>parameters</i></code></code> </dt> <dd>  设置将在链接期间使用的其他参数。  在FreeBSD下使用系统PCRE库时，应指定<code class="notranslate">–with-ld-opt=”-L /usr/local/lib”</code> 。 </dd><dt> <code class="notranslate">–with-cpu-opt= <code class="notranslate"><i>cpu</i></code></code> </dt> <dd>  支持按指定CPU构建： <code class="notranslate">pentium</code> ， <code class="notranslate">pentiumpro</code> ， <code class="notranslate">pentium3</code> ， <code class="notranslate">pentium4</code> ， <code class="notranslate">athlon</code> ， <code class="notranslate">pentium4</code> ， <code class="notranslate">sparc32</code> ， <code class="notranslate">sparc64</code> ， <code class="notranslate">ppc64</code> 。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–without-pcre</code> </dt> <dd>  禁用PCRE库的使用。 </dd><dt> <code class="notranslate">–with-pcre</code> </dt> <dd>  强制使用PCRE库。 </dd><dt> <code class="notranslate">–with-pcre= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置PCRE库源的路径。  库分发（版本4.4  -  8.42）需要从<a hhref="http://www.pcre.org">PCRE</a>站点下载并提取。  其余的由nginx的<code class="notranslate">./configure</code>和<code class="notranslate">make</code> 。  该<a hhref="http/ngx_http_core_module.html#location">位置</a>指令和<a hhref="http/ngx_http_rewrite_module.html">ngx_http_rewrite_module</a>模块中的正则表达式支持需要该库。 </dd><dt> <code class="notranslate">–with-pcre-opt= <code class="notranslate"><i>parameters</i></code></code> </dt> <dd>  为PCRE设置其他构建选项。 </dd><dt> <code class="notranslate">–with-pcre-jit</code> </dt> <dd>  使用“即时编译”支持（1.1.12， <a hhref="ngx_core_module.html#pcre_jit">pcre_jit</a>指令）构建PCRE库。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-zlib= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置zlib库源的路径。  库分发（版本1.1.3  -  1.2.11）需要从<a hhref="http://zlib.net">zlib</a>站点下载并解压缩。  其余的由nginx的<code class="notranslate">./configure</code>和<code class="notranslate">make</code> 。   <a hhref="http/ngx_http_gzip_module.html">ngx_http_gzip_module</a>模块需要该库。 </dd><dt> <code class="notranslate">–with-zlib-opt= <code class="notranslate"><i>parameters</i></code></code> </dt> <dd>  为zlib设置其他构建选项。 </dd><dt> <code class="notranslate">–with-zlib-asm= <code class="notranslate"><i>cpu</i></code></code> </dt> <dd>  允许使用针对其中一个指定CPU优化的zlib汇编程序源： <code class="notranslate">pentium</code> ， <code class="notranslate">pentiumpro</code> 。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-libatomic</code> </dt> <dd>  强制libatomic_ops库使用。 </dd><dt> <code class="notranslate">–with-libatomic= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置libatomic_ops库源的路径。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-openssl= <code class="notranslate"><i>path</i></code></code> </dt> <dd>  设置OpenSSL库源的路径。 </dd><dt> <code class="notranslate">–with-openssl-opt= <code class="notranslate"><i>parameters</i></code></code> </dt> <dd>  为OpenSSL设置其他构建选项。 </dd></dl><p></p><p></p><dl class="compact"><dt> <code class="notranslate">–with-debug</code> </dt> <dd>  启用<a hhref="debugging_log.html">调试日志</a> 。 </dd></dl><p></p><p>  参数用法示例（所有这些都需要在一行中输入）： </p><blockquote class="example"><pre class="notranslate">./configure<br>    –sbin-path=/usr/local/nginx/nginx<br>    –conf-path=/usr/local/nginx/nginx.conf<br>    –pid-path=/usr/local/nginx/nginx.pid<br>    –with-http_ssl_module<br>    –with-pcre=../pcre-8.42<br>    –with-zlib=../zlib-1.2.11<br></pre></blockquote><p></p><p>  配置完成后，使用<code class="notranslate">make</code>编译和安装nginx。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/compatibility.html</url>
      <content type="html"><![CDATA[<p></p><h2>  兼容性 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#supported">What is currently supported</a> <br> <a hhref="#not_supported">What is not supported yet</a> <br></td></tr></tbody></table><p>   njs是根据<a hhref="http://www.ecma-international.org/ecma-262/5.1/">ECMAScript 5.1</a> （严格模式）创建的，带有一些<a hhref="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript 6</a>及更高版本的扩展。  合规性仍在不断发展。 </p><a name="supported"></a><center><h4>  目前支持什么 </h4></center><p></p><ul class="compact"><li>  布尔值，数字，字符串，对象，数组，函数和正则表达式 </li><li>   ES5.1运算符，ES7指数运算符 </li><li>   ES5.1语句： <code class="notranslate">var</code> ， <code class="notranslate">if</code> ， <code class="notranslate">else</code> ， <code class="notranslate">switch</code> ， <code class="notranslate">for</code> ， <code class="notranslate">for in</code> ， <code class="notranslate">while</code> ， <code class="notranslate">do while</code> ， <code class="notranslate">break</code> ， <code class="notranslate">continue</code> ， <code class="notranslate">return</code> ， <code class="notranslate">try</code> ， <code class="notranslate">catch</code> ， <code class="notranslate">throw</code> ， <code class="notranslate">finally</code> </li><li>   ES6 <code class="notranslate">Number</code>和<code class="notranslate">Math</code>属性和方法 </li><li>   <code class="notranslate">String</code>方法： <ul class="compact"><li>   ES5.1： <a hhref="reference.html#string_fromcharcode"><code class="notranslate">fromCharCode</code></a> ， <a hhref="reference.html#string_concat"><code class="notranslate">concat</code></a> ， <a hhref="reference.html#string_slice"><code class="notranslate">slice</code></a> ， <a hhref="reference.html#string_substring"><code class="notranslate">substring</code></a> ， <a hhref="reference.html#string_substr"><code class="notranslate">substr</code></a> ， <a hhref="reference.html#string_charat"><code class="notranslate">charAt</code></a> ， <a hhref="reference.html#string_indexof"><code class="notranslate">indexOf</code></a> ， <a hhref="reference.html#string_lastindexof"><code class="notranslate">lastIndexOf</code></a> ， <a hhref="reference.html#string_tolowercase"><code class="notranslate">toLowerCase</code></a> ， <a hhref="reference.html#string_touppercase"><code class="notranslate">toUpperCase</code></a> ， <a hhref="reference.html#string_trim"><code class="notranslate">trim</code></a> ， <a hhref="reference.html#string_search"><code class="notranslate">search</code></a> ， <a hhref="reference.html#string_match"><code class="notranslate">match</code></a> ， <a hhref="reference.html#string_split"><code class="notranslate">split</code></a> ， <a hhref="reference.html#string_replace"><code class="notranslate">replace</code></a> </li><li>   ES6： <a hhref="reference.html#string_fromcodepoint"><code class="notranslate">fromCodePoint</code></a> ， <a hhref="reference.html#string_codepointat"><code class="notranslate">codePointAt</code></a> ， <a hhref="reference.html#string_includes"><code class="notranslate">includes</code></a> ， <a hhref="reference.html#string_startswith"><code class="notranslate">startsWith</code></a> ， <a hhref="reference.html#string_endswith"><code class="notranslate">endsWith</code></a> ， <a hhref="reference.html#string_repeat"><code class="notranslate">repeat</code></a> </li><li>   ES8： <a hhref="reference.html#string_padstart"><code class="notranslate">padStart</code></a> ， <a hhref="reference.html#string_padend"><code class="notranslate">padEnd</code></a> </li><li>  非标准： <a hhref="reference.html#string_bytesfrom"><code class="notranslate">bytesFrom</code></a> （ <a hhref="reference.html#string_bytesfrom"><code class="notranslate">bytesFrom</code></a> ） <a hhref="reference.html#string_fromutf8"><code class="notranslate">fromUTF8</code></a> ， <a hhref="reference.html#string_toutf8"><code class="notranslate">toUTF8</code></a> ， <a hhref="reference.html#string_frombytes"><code class="notranslate">fromBytes</code></a> ， <a hhref="reference.html#string_tobytes"><code class="notranslate">toBytes</code></a> </li></ul></li><li>   <code class="notranslate">Object</code>方法： <ul class="compact"><li>   ES5.1： <code class="notranslate">create</code> （不带属性列表的支持）， <code class="notranslate">keys</code> ， <code class="notranslate">defineProperty</code> ， <code class="notranslate">defineProperties</code> ， <code class="notranslate">getOwnPropertyDescriptor</code> ， <code class="notranslate">getPrototypeOf</code> ， <code class="notranslate">hasOwnProperty</code> ， <code class="notranslate">isPrototypeOf</code> ， <code class="notranslate">preventExtensions</code> ， <code class="notranslate">isExtensible</code> ， <code class="notranslate">freeze</code> ， <code class="notranslate">isFrozen</code> ， <code class="notranslate">seal</code> ， <code class="notranslate">isSealed</code> </li></ul></li><li>   <code class="notranslate">Array</code>方法： <ul class="compact"><li>   ES5.1： <code class="notranslate">isArray</code> ， <code class="notranslate">slice</code> ， <code class="notranslate">splice</code> ， <code class="notranslate">push</code> ， <code class="notranslate">pop</code> ， <code class="notranslate">unshift</code> ， <code class="notranslate">shift</code> ， <code class="notranslate">reverse</code> ， <code class="notranslate">sort</code> ， <code class="notranslate">join</code> ， <code class="notranslate">concat</code> ， <code class="notranslate">indexOf</code> ， <code class="notranslate">lastIndexOf</code> ， <code class="notranslate">forEach</code> ， <code class="notranslate">some</code> ， <code class="notranslate">every</code> ， <code class="notranslate">filter</code> ， <code class="notranslate">map</code> ， <code class="notranslate">reduce</code> ， <code class="notranslate">reduceRight</code> </li><li>   ES6： <code class="notranslate">of</code> ， <code class="notranslate">fill</code> ， <code class="notranslate">find</code> ， <code class="notranslate">findIndex</code> </li><li>   ES7： <code class="notranslate">includes</code> </li></ul></li><li>   ES5.1 <code class="notranslate">Function</code>方法： <code class="notranslate">call</code> ， <code class="notranslate">apply</code> ， <code class="notranslate">bind</code> </li><li>   ES5.1 <code class="notranslate">RegExp</code>方法： <code class="notranslate">test</code> ， <code class="notranslate">exec</code> </li><li>   ES5。1日期方法 </li><li>   ES5.1 <a hhref="reference.html#core_json"><code class="notranslate">JSON</code></a>对象 </li><li>   ES5.1 <code class="notranslate">arguments</code>对象（0.2.5） </li><li>   ES5.1全局函数： <code class="notranslate">isFinite</code> ， <code class="notranslate">isNaN</code> ， <code class="notranslate">parseFloat</code> ， <code class="notranslate">parseInt</code> ， <a hhref="reference.html#decodeuri"><code class="notranslate">decodeURI</code></a> ， <a hhref="reference.html#decodeuricomponent"><code class="notranslate">decodeURIComponent</code></a> ， <a hhref="reference.html#encodeuri"><code class="notranslate">encodeURI</code></a> ， <a hhref="reference.html#encodeuricomponent"><code class="notranslate">encodeURIComponent</code></a> </li><li>   <code class="notranslate">Error</code>对象： <code class="notranslate">Error</code> ， <code class="notranslate">EvalError</code> ， <code class="notranslate">InternalError</code> ， <code class="notranslate">RangeError</code> ， <code class="notranslate">ReferenceError</code> ， <code class="notranslate">SyntaxError</code> ， <code class="notranslate">TypeError</code> ， <code class="notranslate">URIError</code> </li><li>   <a hhref="reference.html#settimeout"><code class="notranslate">setTimeout</code></a>和<a hhref="reference.html#cleartimeout"><code class="notranslate">clearTimeout</code></a>函数（0.2.0） </li><li>   <a hhref="https://nodejs.org/api/fs.html#fs_file_system">Node.js样式</a> <code class="notranslate">File system</code>方法： <a hhref="reference.html#readfilesync"><code class="notranslate">fs.readFileSync</code></a> ， <a hhref="reference.html#appendfilesync"><code class="notranslate">fs.appendFileSync</code></a> ， <a hhref="reference.html#writefilesync"><code class="notranslate">fs.writeFileSync</code></a> </li><li>   <a hhref="https://nodejs.org/api/crypto.html#crypto_class_hash">Node.js样式</a> <code class="notranslate">Crypto</code>方法（0.2.0）： <a hhref="reference.html#crypto_createhash"><code class="notranslate">crypto.createHash</code></a> ， <a hhref="reference.html#crypto_createhmac"><code class="notranslate">crypto.createHmac</code></a> </li></ul><p></p><a name="not_supported"></a><center><h4>  什么是不支持的 </h4></center><p></p><ul class="compact"><li>   ES6 <code class="notranslate">let</code>和<code class="notranslate">const</code>声明 </li><li>  标签 </li><li>   <code class="notranslate">eval</code>功能 </li><li>   <code class="notranslate">new Function()</code>构造函数 </li><li>   <code class="notranslate">setInterval</code> ， <code class="notranslate">setImmediate</code>函数 </li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/changes.html</url>
      <content type="html"><![CDATA[<p></p><h2>  变化 </h2><a name="njs0.2.6"></a><center><h4>  变化为0.2.6 </h4></center><p>  发布日期：2018年11月27日 </p><p>  核心： </p><ul class="compact"><li><p>  特点：使内置原型可变。 </p></li><li><p>  特征：使全局对象变得可变。 </p></li><li><p>  功能： <code class="notranslate">console.time()</code>和<code class="notranslate">console.timeEnd()</code>方法。 </p></li><li><p>  功能：允许重新声明变量和函数。 </p></li><li><p>  功能：扩展<code class="notranslate">Object.defineProperty()</code>规范一致性。 </p></li><li><p>  功能：为CLI引入安静模式以处理来自stdin的简单表达式。 </p></li><li><p>  特点：引入紧凑形式的回溯来处理堆栈溢出。 </p></li><li><p>  改进：改进各种例外的措辞。 </p></li><li><p>  修正：修复闭包值处理。 </p></li><li><p>  修正：各种值类型的固定相等运算符。 </p></li><li><p>  修正：修复了各种范围内“this”关键字的处理。 </p></li><li><p>  修正：修复了<code class="notranslate">Object.keys()</code>处理非对象值的问题。 </p></li><li><p>  修正：在<code class="notranslate">if</code>语句中修复了throw语句的解析。 </p></li><li><p>  修正：修复throw语句后的换行符。 </p></li><li><p>  修正：修复if语句中没有换行符的语句解析。 </p></li><li><p>  修正： <code class="notranslate">njs_array_expand()</code>固定大小<code class="notranslate">uint32_t</code>溢出。 </p></li><li><p>  修正： <code class="notranslate">object_value</code>类型的固定<code class="notranslate">typeof</code>运算符。 </p></li><li><p>  修正：修复了各种其他错误。 </p></li></ul><p></p><a name="njs0.2.5"></a><center><h4>  变化为0.2.5 </h4></center><p>  发布日期：2018年10月30日 </p><p>   nginx模块： </p><ul class="compact"><li><p>  修正：在流模块中修复计数待处理事件。 </p></li><li><p>  修正：修复了流模块中的<code class="notranslate">s.off()</code> 。 </p></li><li><p>  修正：修复了流模块中<code class="notranslate">js_filter</code>中数据块的处理。 </p></li><li><p>  修正：在http模块中修复了http <code class="notranslate">status</code>和<code class="notranslate">contentType</code> getter。 </p></li><li><p>  修正：在http模块中修复了http响应和父getter。 </p></li></ul><p></p><p>  核心： </p><ul class="compact"><li><p>  功能：参数对象支持。 </p></li><li><p>  特征：非整数分数支持。 </p></li><li><p>  改进：处理<code class="notranslate">Array.prototype.slice()</code>非数组值。 </p></li><li><p>  修正：修复了<code class="notranslate">Array.prototype.length</code> setter </p></li><li><p>  修正：固定<code class="notranslate">njs_array_alloc()</code> ，长度&gt; 2 ** 31。 </p></li><li><p>  修正：处理32位<code class="notranslate">njs_array_alloc()</code>上的<code class="notranslate">njs_array_alloc()</code> int溢出。 </p></li><li><p>  修正：修复代码大小不匹配错误消息。 </p></li><li><p>  修正：修复循环中的删除操作符。 </p></li><li><p>  修正：修复了复杂对象的<code class="notranslate">Object.getOwnPropertyDescriptor()</code> （继承自<code class="notranslate">Array</code>和<code class="notranslate">string</code>值）。 </p></li><li><p>  修正：修复了非对象属性的<code class="notranslate">Object.prototype.hasOwnProperty()</code> </p></li><li><p>  修正：修复了各种其他错误。 </p></li></ul><p></p><a name="njs0.2.4"></a><center><h4>  变化为0.2.4 </h4></center><p>  发布日期：2018年9月18日 </p><p>   nginx模块： </p><ul class="compact"><li><p>  更改：重构的流模块处理程序。 </p><p>  新方法和属性： <a hhref="reference.html#s_on">s.on（）</a> ， <a hhref="reference.html#s_off">s.off（）</a> ， <a hhref="reference.html#s_allow">s.allow（）</a> ， <a hhref="reference.html#s_done">s.done（）</a> ， <a hhref="reference.html#s_decline">s.decline（）</a> ， <a hhref="reference.html#s_deny">s.deny（）</a> 。 </p><p>  删除了<a hhref="reference.html#stream">Stream</a>对象的属性： <code class="notranslate">s.OK</code> ， <code class="notranslate">s.ABORT</code> ， <code class="notranslate">s.AGAIN</code> ， <code class="notranslate">s.DECLINED</code> ， <code class="notranslate">s.ERROR</code> （替换为<a hhref="reference.html#s_allow">s.allow（）</a> ， <a hhref="reference.html#s_done">s.done（）</a> ， <a hhref="reference.html#s_deny">s.deny（）</a> ）。 </p><p>   <code class="notranslate">s.buffer</code> （用于读取替换为相应回调的数据参数，用于写入使用<a hhref="reference.html#s_send">s.send（）</a> ）。 </p><p>   <code class="notranslate">s.fromUpstream</code> （替换为相应事件的回调）。 </p><p>   <code class="notranslate">s.eof</code> （替换为 <code class="notranslate"></code>   <a hhref="reference.html#s_on_callback_last">flags.last</a> ）。 </p></li></ul><p></p><p>  核心： </p><ul class="compact"><li><p>  功能：添加了<code class="notranslate">Function.prototype.length</code> 。 </p></li><li><p>  功能：介绍沙盒模式。 </p></li><li><p>  改进：适当时添加异常字符串。 </p></li><li><p>  改进：改进了原始类型转换异常的措辞。 </p></li><li><p>  修正：为尝试更改冻结属性而抛出<code class="notranslate">TypeError</code> 。 </p></li><li><p>  修正：修复现有属性的<code class="notranslate">Object.defineProperty()</code> 。 </p></li><li><p>  修正：在for for迭代时尊重可枚举属性。 </p></li><li><p>  修正：尊重属性处理程序的可写属性。 </p></li><li><p>  修正：修复了函数参数中的异常处理。 </p></li><li><p>  修正：修复了不同值类型的<code class="notranslate">Object.prototype.toString</code> 。 </p></li><li><p>  修正：修复了对象类型参数的<code class="notranslate">Object()</code>构造函数。 </p></li><li><p>  修正：固定对象和字符串的比较。 </p></li><li><p>  修正：修复了未定义参数的<code class="notranslate">String.slice()</code> 。 </p></li><li><p>  修正：修复了各种其他错误。 </p></li></ul><p></p><a name="njs0.2.3"></a><center><h4>  变化为0.2.3 </h4></center><p>  发布日期：2018年7月31日 </p><p>   nginx模块： </p><ul class="compact"><li><p>  修正：从<code class="notranslate">Reply</code>对象进行子请求导致分段错误。 </p></li><li><p>  修正：获取主<a hhref="reference.html#http">HTTP Request</a>对象的parent属性导致了分段错误。 </p></li></ul><p></p><p>  核心： </p><ul class="compact"><li><p>  功能：为值添加了漂亮的字符串表示。 </p></li><li><p>  功能：正确打印浮点数。 </p></li><li><p>  功能：正确解析浮点数。 </p></li><li><p>  功能： <a hhref="reference.html#string_bytesfrom">String.bytesFrom（）</a>方法（将<code class="notranslate">hex</code> ， <code class="notranslate">base64</code> ， <code class="notranslate">base64url</code>解码为字节字符串）。 </p></li><li><p>  功能： <a hhref="reference.html#string_padstart">String.padStart（）</a>和<a hhref="reference.html#string_padend">String.padEnd（）</a>方法。 </p></li><li><p>  功能：增加了对二进制文字的支持。 </p></li><li><p>  改进：在数字解析中添加有关非法令牌的信息。 </p></li><li><p>  改进：允许在八进制文字值中使用大写字母<code class="notranslate">O</code> </p></li><li><p>  改进：在<code class="notranslate">console.log()</code>添加了对多个参数的支持。 </p></li><li><p>  修正：修复了将<code class="notranslate">call()</code>应用于外部值的方法。 </p></li><li><p>  修正：应用于对象的固定加法运算符。 </p></li><li><p>  修正：在<code class="notranslate">njs_vm_value_to_ext_string()</code>修复异常处理。 </p></li><li><p>  修正：使用布尔，null和未定义的参数修复<code class="notranslate">Number()</code> 。 </p></li><li><p>  修正：修复了设置非数字<code class="notranslate">Array.length</code>错误处理。 </p></li><li><p>  修正：修复全局对象的自动完成。 </p></li><li><p>  修正：修复了各种其他错误。 </p></li></ul><p></p><a name="njs0.2.2"></a><center><h4>  变化为0.2.2 </h4></center><p>  发布日期：2018年6月19日 </p><p>   nginx模块： </p><ul class="compact"><li><p>  更改：合并HTTP <code class="notranslate">Response</code>和<code class="notranslate">Reply</code>到<a hhref="reference.html#http">HTTP请求</a> 。  新成员<code class="notranslate">Request</code> ： </p><ul class="compact"><li><p>   <code class="notranslate">req.status</code> （ <code class="notranslate">res.status</code> ） </p></li><li><p>   <code class="notranslate">req.parent</code> （ <code class="notranslate">reply.parent</code> ） </p></li><li><p>   <code class="notranslate">req.requestBody</code> （ <code class="notranslate">req.body</code> ） </p></li><li><p>   <code class="notranslate">req.responseBody</code> （ <code class="notranslate">reply.body</code> ） </p></li><li><p>   <code class="notranslate">req.headersIn</code> （ <code class="notranslate">req.headers</code> ） </p></li><li><p>   <code class="notranslate">req.headersOut</code> （ <code class="notranslate">res.headers</code> ） </p></li><li><p>   <code class="notranslate">req.sendHeader()</code> （ <code class="notranslate">res.sendHeader()</code> ） </p></li><li><p>   <code class="notranslate">req.send()</code> （ <code class="notranslate">res.send()</code> ） </p></li><li><p>   <code class="notranslate">req.finish()</code> （ <code class="notranslate">res.finish()</code> ） </p></li><li><p>   <code class="notranslate">req.return()</code> （ <code class="notranslate">res.return()</code> ） </p></li></ul><p>  弃用的<code class="notranslate">Request</code>成员： </p><ul class="compact"><li><p>   <code class="notranslate">req.body</code> （使用<code class="notranslate">req.requestBody</code>或<code class="notranslate">req.responseBody</code> ） </p></li><li><p>   <code class="notranslate">req.headers</code> （使用<code class="notranslate">req.headersIn</code>或<code class="notranslate">req.headersOut</code> ） </p></li><li><p> <code class="notranslate">req.response</code> </p> </li></ul><p>  已弃用的属性将在下一版本中删除。 </p></li><li><p>  功能：HTTP <a hhref="reference.html#r_internal_redirect">internalRedirect（）</a>方法。 </p></li></ul><p></p><p>  核心： </p><ul class="compact"><li><p>  修正：在<code class="notranslate">crypto.createHmac()</code>修复了heap-buffer-overflow。 </p></li></ul><p></p><a name="njs0.2.1"></a><center><h4>  变化为0.2.1 </h4></center><p>  发布日期：2018年5月31日 </p><p>   nginx模块： </p><ul class="compact"><li><p>  功能：HTTP请求正文getter。 </p></li><li><p>  改进：将njs vm移动到<code class="notranslate">main</code>配置。 </p></li><li><p>  改进：改进了<a hhref="http/ngx_http_js_module.html#js_set">js_set</a>和<a hhref="http/ngx_http_js_module.html#js_content">js_content</a>指令的日志记录。 </p></li><li><p>  改进：在<a hhref="http/ngx_http_js_module.html#js_content">js_content</a>处理程序中默认将状态代码设置为500 </p></li><li><p>  改进：在<a hhref="http/ngx_http_js_module.html#js_content">js_content</a>处理程序中添加了返回状态代码的调试 </p></li><li><p>  修正：修复了<a hhref="http/ngx_http_js_module.html#js_include">js_include中的</a>错误记录。 </p></li></ul><p></p><p>  核心： </p><ul class="compact"><li><p>  功能：添加了数组长度设置器。 </p></li><li><p>  改进：公共标头<code class="notranslate">cleanup. njscript.h</code>   <code class="notranslate">cleanup. njscript.h</code>重命名为<code class="notranslate">njs.h</code> </p></li><li><p>  修正：调用<code class="notranslate">digest()</code>后修复了crypto <code class="notranslate">update()</code>方法。 </p></li><li><p>  修正：修复了大小&lt;= alg size&gt; 64的密钥的<code class="notranslate">crypto.createHmac()</code> 。 </p></li><li><p>  修正：修复了带空单元格的数组的<code class="notranslate">JSON.stringify()</code> 。 </p></li><li><p>  修正：修复了<code class="notranslate">JSON.stringify()</code>不支持的类型的异常类型。 </p></li><li><p>  修正：修复了函数未定义参数的处理。 </p></li><li><p>  修正：修复了对<code class="notranslate">Object.getOwnPropertyDescriptor()</code>缺失<code class="notranslate">arg</code>的处理。 </p></li><li><p>  修正：修复了<code class="notranslate">Object.getOwnPropertyDescriptor()</code>中属性的处理。 </p></li><li><p>  修正：修复了<code class="notranslate">Array.length</code>属性的可写标志。 </p></li><li><p>  修正： <code class="notranslate">clearTimeout()</code>固定返回值类型。 </p></li><li><p>  修正：修复了<code class="notranslate">njs_vm_external_bind()</code> 。 </p></li><li><p>  修正：修复了各种其他错误。 </p></li></ul><p></p><a name="njs0.2.0"></a><center><h4>  变化为0.2.0 </h4></center><p>  发布日期：2018年4月3日 </p><p></p><ul class="compact"><li><p>  功能：通过CLI报告njs版本。 </p></li><li><p>  功能：转换异常的类型的文本描述。 </p></li><li>  功能： <code class="notranslate">setTimeout()</code>和<code class="notranslate">clearTimeout()</code>方法。 </li><li><p>  功能：字节字符串为<code class="notranslate">hex</code> ， <code class="notranslate">base64</code> ， <code class="notranslate">base64url</code>编码。 </p></li><li><p>  功能： <a hhref="https://nodejs.org/api/crypto.html#crypto_class_hash">Node.js样式</a> <code class="notranslate">Crypto</code>方法。 </p></li><li><p>  功能：HTTP和流<code class="notranslate">warn()</code>和<code class="notranslate">error()</code>方法。 </p></li><li><p>  功能：HTTP <code class="notranslate">subrequest()</code>方法。 </p></li><li><p>  功能：HTTP <code class="notranslate">return()</code>方法。 </p></li><li><p>  修正：核心和交互式shell中修复了各种错误。 </p></li></ul><p></p><a name="njs0.1.15"></a><center><h4>  变化0.1.15 </h4></center><p>  发布日期：2017年11月20日 </p><p></p><ul class="compact"><li><p>  功能： <code class="notranslate">Error</code> ， <code class="notranslate">EvalError</code> ， <code class="notranslate">InternalError</code> ， <code class="notranslate">RangeError</code> ， <code class="notranslate">ReferenceError</code> ， <code class="notranslate">SyntaxError</code> ， <code class="notranslate">TypeError</code> ， <code class="notranslate">URIError</code>对象。 </p></li><li><p>  功能：八进制文字支持。 </p></li><li><p>  功能： <a hhref="https://nodejs.org/api/fs.html#fs_file_system">Node.js样式</a> <code class="notranslate">File system</code>访问方法： <code class="notranslate">fs.readFile()</code> ， <code class="notranslate">fs.readFileSync()</code> ， <code class="notranslate">fs.appendFile()</code> ， <code class="notranslate">fs.appendFileSync()</code> ， <code class="notranslate">fs.writeFile()</code> ， <code class="notranslate">fs.writeFileSync()</code> 。 </p></li><li><p>  功能：nginx模块在异常时打印回溯。 </p></li><li><p>  修正：杂项错误已得到修复。 </p></li></ul><p></p><a name="njs0.1.14"></a><center><h4>  变化0.1.14 </h4></center><p>  发布日期：2017年10月9日 </p><p></p><ul class="compact"><li><p>  功能：JSON对象。 </p></li><li><p>  功能：交互式shell中的对象级完成。 </p></li><li><p>  功能：各种配置改进。 </p></li><li><p>  修正：核心和交互式shell中修复了各种错误。 </p></li></ul><p></p><a name="njs0.1.13"></a><center><h4>  变化0.1.13 </h4></center><p>  发布日期：2017年8月31日 </p><p></p><ul class="compact"><li><p>  功能：交互式shell中的<code class="notranslate">console.log()</code>和<code class="notranslate">console.help()</code>方法。 </p></li><li><p>  功能：交互式shell在异常时打印回溯。 </p></li><li><p>  功能：如果<code class="notranslate">libedit</code>可用，默认情况下为交互式shell。 </p></li><li><p>  修正：在命令行模式下从<code class="notranslate">stdin</code>处理大文件。 </p></li><li><p>  修正：改进了<code class="notranslate">editline</code>检测。 </p></li></ul><p></p><a name="njs0.1.12"></a><center><h4>  变化0.1.12 </h4></center><p>  发布日期：2017年8月8日 </p><p></p><ul class="compact"><li><p>  功能：交互式shell。 </p></li><li><p>  修正：在<code class="notranslate">Object.isSealed()</code> 。 </p></li></ul><p></p><a name="njs0.1.11"></a><center><h4>   0.1.11的变化 </h4></center><p>  发行日期：2017年6月27日 </p><p></p><ul class="compact"><li><p>  功能： <code class="notranslate">Object.keys()</code> ， <code class="notranslate">Object.prototype.hasOwnProperty()</code>方法。 </p></li><li><p>  功能： <code class="notranslate">Object.defineProperty()</code> ， <code class="notranslate">Object.defineProperties()</code> ， <code class="notranslate">Object.getOwnPropertyDescriptor()</code>方法。 </p></li><li><p>  功能： <code class="notranslate">Object.getPrototypeOf()</code> ， <code class="notranslate">Object.prototype.isPrototypeOf()</code>方法。 </p></li><li><p>  功能： <code class="notranslate">Object.preventExtensions()</code> ， <code class="notranslate">Object.isExtensible()</code> ， <code class="notranslate">Object.freeze()</code> ， <code class="notranslate">Object.isFrozen()</code> ， <code class="notranslate">Object.seal()</code> ， <code class="notranslate">Object.isSealed()</code>方法。 </p></li><li><p>  特征：科学记数法（ <code class="notranslate">3.35e10</code> ）文字支持。 </p></li><li><p>  功能：十六进制（ <code class="notranslate">0x1123</code> ）文字支持。 </p></li><li><p>  修正：处理大型数组索引。 </p></li><li><p>  修正：在<code class="notranslate">parseInt()</code>和<code class="notranslate">Date.parse()</code> 。 </p></li></ul><p></p><a name="njs0.1.10"></a><center><h4>  变化0.1.10 </h4></center><p>  发行日期：2017年4月4日 </p><p></p><ul class="compact"><li><p>  功能：嵌套函数和函数闭包。 </p></li><li><p>  功能： <code class="notranslate">Array.of()</code> ， <code class="notranslate">Array.prototype.fill()</code> ， <code class="notranslate">Array.prototype.find()</code> ， <code class="notranslate">Array.prototype.findIndex()</code>方法。 </p></li><li><p>  修正：修复了各种错误和分段错误。 </p></li></ul><p></p><a name="njs0.1.9"></a><center><h4>  变化0.1.9 </h4></center><p>  发布日期：2017年2月1日 </p><p></p><ul class="compact"><li><p>  修正：在nginx中使用njs时，未初始化全局变量。 </p></li></ul><p></p><a name="njs0.1.8"></a><center><h4>  变化0.1.8 </h4></center><p>  发布日期：2017年1月24日 </p><p></p><ul class="compact"><li><p>  更改：强制执行<code class="notranslate">strict</code>模式，必须显式声明变量。 </p></li><li><p>  功能： <code class="notranslate">for</code>和<code class="notranslate">for-in</code>循环支持变量声明。 </p></li><li><p>  修正：全局和功能范围已得到修复。 </p></li><li><p>  修正：现在<code class="notranslate">for-in</code>循环不会丢弃属性变量的最后一个值。 </p></li><li><p>  修正：修复了各种错误和分段错误。 </p></li></ul><p></p><a name="njs0.1.7"></a><center><h4>  变化0.1.7 </h4></center><p>  发布日期：2016年12月27日 </p><p></p><ul class="compact"><li><p>  更改：已在服务器和位置级别禁用<a hhref="http/ngx_http_js_module.html#js_include">js_include</a>指令。 </p></li><li><p>  特征：取幂运算符。 </p></li><li><p>  修正：修复了各种错误和分段错误。 </p></li></ul><p></p><a name="njs0.1.6"></a><center><h4>  变化0.1.6 </h4></center><p>  发布日期：2016年12月13日 </p><p></p><ul class="compact"><li><p>  更改：已在服务器和位置级别禁用<a hhref="http/ngx_http_js_module.html#js_set">js_set</a>指令。 </p></li><li><p>  特征：ES6 <code class="notranslate">Math</code>方法。 </p></li><li><p>  修正：修复了各种错误和分段错误。 </p></li></ul><p></p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title></title>
      <url>/ngx/beginners_guide.html</url>
      <content type="html"><![CDATA[<p></p><h2>  初学者指南 </h2><table width="100%"><tbody><tr><td align="left" class="notranslate"> <a hhref="#control">Starting, Stopping, and Reloading Configuration</a> <br> <a hhref="#conf_structure">Configuration File’s Structure</a> <br> <a hhref="#static">Serving Static Content</a> <br> <a hhref="#proxy">Setting Up a Simple Proxy Server</a> <br> <a hhref="#fastcgi">Setting Up FastCGI Proxying</a> <br></td></tr></tbody></table><p>  本指南提供了对nginx的基本介绍，并介绍了可以使用它完成的一些简单任务。  据推测，nginx已安装在阅读器的机器上。  如果不是，请参阅<a hhref="install.html">安装nginx</a>页面。  本指南介绍如何启动和停止nginx，重新加载其配置，解释配置文件的结构，并介绍如何设置nginx以提供静态内容，如何将nginx配置为代理服务器，以及如何将其与一个FastCGI应用程序。 </p><p>   nginx有一个主进程和几个工作进程。  主进程的主要目的是读取和评估配置，并维护工作进程。  工作进程会对请求进行实际处理。   nginx使用基于事件的模型和依赖于操作系统的机制来有效地在工作进程之间分发请求。  工作进程数在配置文件中定义，可以针对给定配置进行修复，也可以自动调整为可用CPU内核数（请参阅<a hhref="ngx_core_module.html#worker_processes">worker_processes</a> ）。 </p><p>   nginx及其模块的工作方式在配置文件中确定。  默认情况下，配置文件名为<code class="notranslate">nginx.conf</code>并放在目录<code class="notranslate">/usr/local/nginx/conf</code> ， <code class="notranslate">/etc/nginx</code>或<code class="notranslate">/usr/local/etc/nginx</code> 。 </p><a name="control"></a><center><h4>  启动，停止和重新加载配置 </h4></center><p>  要启动nginx，请运行可执行文件。  启动nginx后，可以通过使用<code class="notranslate">-s</code>参数调用可执行文件来控制它。  使用以下语法： </p><blockquote class="example"><pre class="notranslate">nginx -s <i>signal</i><br></pre></blockquote><p>   <i>信号</i>可能是以下之一： </p><ul class="compact"><li>   <code class="notranslate">stop</code> - 快速关机 </li><li>   <code class="notranslate">quit</code> - 正常关机 </li><li>   <code class="notranslate">reload</code> - 重新加载配置文件 </li><li>   <code class="notranslate">reopen</code> - 重新打开日志文件 </li></ul><p>  例如，要在等待工作进程完成当前请求的服务时停止nginx进程，可以执行以下命令： </p><blockquote class="example"><pre class="notranslate">nginx -s quit<br></pre></blockquote><p></p><blockquote class="note">  此命令应在启动nginx的同一用户下执行。 </blockquote><p></p><p>  在将重新加载配置的命令发送到nginx或重新启动之前，将不会应用配置文件中所做的更改。  要重新加载配置，请执行： </p><blockquote class="example"><pre class="notranslate">nginx -s reload<br></pre></blockquote><p></p><p>  一旦主进程收到重新加载配置的信号，它将检查新配置文件的语法有效性并尝试应用其中提供的配置。  如果成功，主进程将启动新的工作进程并向旧工作进程发送消息，请求它们关闭。  否则，主进程将回滚更改并继续使用旧配置。  旧工作进程，接收命令关闭，停止接受新连接并继续为当前请求提供服务，直到所有此类请求都得到服务。  之后，旧工作进程退出。 </p><p>  也可以借助Unix工具（如<code class="notranslate">kill</code>实用程序）将信号发送到nginx进程。  在这种情况下，信号直接发送到具有给定进程ID的进程。  默认情况下，nginx主进程的进程ID写入目录<code class="notranslate">/usr/local/nginx/logs</code>或<code class="notranslate">/var/run</code>的<code class="notranslate">nginx.pid</code> 。  例如，如果主进程ID是1628，要发送导致nginx正常关闭的QUIT信号，请执行： </p><blockquote class="example"><pre class="notranslate">kill -s QUIT 1628<br></pre></blockquote><p>  要获取所有正在运行的nginx进程的列表，可以使用<code class="notranslate">ps</code>实用程序，例如，通过以下方式： </p><blockquote class="example"><pre class="notranslate">ps -ax | grep nginx<br></pre></blockquote><p>  有关向nginx发送信号的更多信息，请参阅<a hhref="control.html">控制nginx</a> 。 </p><a name="conf_structure"></a><center><h4>  配置文件的结构 </h4></center><p>   nginx由模块组成，这些模块由配置文件中指定的指令控制。  指令分为简单指令和块指令。  一个简单的指令包括由空格分隔的名称和参数，以分号（ <code class="notranslate">;</code> ）结尾。  块指令与简单指令具有相同的结构，但它不是以分号结尾，而是以大括号（ <code class="notranslate">{</code>和<code class="notranslate">}</code> ）包围的一组附加指令结束。  如果块指令可以在大括号内包含其他指令，则称为上下文（示例： <a hhref="ngx_core_module.html#events">events</a> ， <a hhref="http/ngx_http_core_module.html#http">http</a> ， <a hhref="http/ngx_http_core_module.html#server">server</a>和<a hhref="http/ngx_http_core_module.html#location">location</a> ）。 </p><p>  放置在任何上下文之外的配置文件中的指令被认为是在<a hhref="ngx_core_module.html">主</a>上下文中。   <code class="notranslate">events</code>和<code class="notranslate">http</code>指令驻留在<code class="notranslate">main</code>上下文中， <code class="notranslate">server</code>位于<code class="notranslate">http</code> ，位于<code class="notranslate">server</code> 。 </p><p>   <code class="notranslate">#</code>符号后面的其余部分被视为评论。 </p><a name="static"></a><center><h4>  提供静态内容 </h4></center><p>  一个重要的Web服务器任务是提供文件（例如图像或静态HTML页面）。  您将实现一个示例，根据请求，将从不同的本地目录提供文件： <code class="notranslate">/data/www</code> （可能包含HTML文件）和<code class="notranslate">/data/images</code> （包含图像）。  这将需要编辑配置文件并在<a hhref="http/ngx_http_core_module.html#http">http</a>块内设置具有两个<a hhref="http/ngx_http_core_module.html#location">位置</a>块的<a hhref="http/ngx_http_core_module.html#server">服务器</a>块。 </p><p>  首先，创建<code class="notranslate">/data/www</code>目录并将包含任何文本内容的<code class="notranslate">index.html</code>文件放入其中，然后创建<code class="notranslate">/data/images</code>目录并在其中放置一些图像。 </p><p>  接下来，打开配置文件。  默认配置文件已包含几个<code class="notranslate">server</code>块的示例，主要是注释掉的。  现在注释掉所有这些块并启动一个新的<code class="notranslate">server</code>块： </p><blockquote class="example"><pre class="notranslate">http {<br>    server {<br>    }<br>}<br></pre></blockquote><p>  通常，配置文件可以包括由它们<a hhref="http/ngx_http_core_module.html#listen">监听</a>的端口和<a hhref="http/server_names.html">服务器名称</a> <a hhref="http/request_processing.html">区分</a>的多个<code class="notranslate">server</code>块。  一旦nginx决定哪个<code class="notranslate">server</code>处理请求，它就会根据<code class="notranslate">server</code>块内定义的<code class="notranslate">location</code>指令的参数测试请求头中指定的URI。 </p><p>  将以下<code class="notranslate">location</code>块添加到<code class="notranslate">server</code>块： </p><blockquote class="example"><pre class="notranslate">location / {<br>    root /data/www;<br>}<br></pre></blockquote><p>  此<code class="notranslate">location</code>块指定与请求中的URI进行比较的“ <code class="notranslate">/</code> ”前缀。  对于匹配请求，URI将添加到<a hhref="http/ngx_http_core_module.html#root">根</a>指令中指定的路径，即<code class="notranslate">/data/www</code> ，以形成本地文件系统上所请求文件的路径。  如果存在多个匹配的<code class="notranslate">location</code>块，则nginx选择具有最长前缀的<code class="notranslate">location</code>块。  上面的<code class="notranslate">location</code>块提供长度为1的最短前缀，因此仅当所有其他<code class="notranslate">location</code>块无法提供匹配时，才会使用此块。 </p><p>  接下来，添加第二个<code class="notranslate">location</code>块： </p><blockquote class="example"><pre class="notranslate">location /images/ {<br>    root /data;<br>}<br></pre></blockquote><p>  它将匹配以<code class="notranslate">/images/</code>开头的请求（ <code class="notranslate">location /</code>也匹配此类请求，但前缀较短）。 </p><p>  生成的<code class="notranslate">server</code>块配置应如下所示： </p><blockquote class="example"><pre class="notranslate">server {<br>    location / {<br>        root /data/www;<br>    }<p></p>
<pre><code>location /images/ {
    root /data;
}
</code></pre><p>}<br></p></pre></blockquote><p>  这已经是服务器的工作配置，它可以侦听标准端口80，并且可以在本地计算机上访问<code class="notranslate"><a href="http://localhost/" target="_blank" rel="noopener">http://localhost/</a></code> 。  响应具有以<code class="notranslate">/images/</code>开头的URI的请求，服务器将从<code class="notranslate">/data/images</code>目录发送文件。  例如，响应<code class="notranslate"><a href="http://localhost/images/example.png" target="_blank" rel="noopener">http://localhost/images/example.png</a></code>请求，nginx将发送<code class="notranslate">/data/images/example.png</code>文件。  如果此类文件不存在，nginx将发送指示404错误的响应。   URI不以<code class="notranslate">/images/</code>开头的请求将映射到<code class="notranslate">/data/www</code>目录。  例如，响应<code class="notranslate"><a href="http://localhost/some/example.html" target="_blank" rel="noopener">http://localhost/some/example.html</a></code>请求，nginx将发送<code class="notranslate">/data/www/some/example.html</code>文件。 </p><p>  要应用新配置，请启动nginx（如果尚未启动）或通过执行以下命令将<code class="notranslate">reload</code>信号发送到nginx的主进程： </p><blockquote class="example"><pre class="notranslate">nginx -s reload<br></pre></blockquote><p></p><p></p><blockquote class="note">  如果某些内容无法按预期工作，您可以尝试在目录<code class="notranslate">/usr/local/nginx/logs</code>或<code class="notranslate">/var/log/nginx</code>中的<code class="notranslate">access.log</code>和<code class="notranslate">error.log</code>文件中找出原因。 </blockquote><p></p><a name="proxy"></a><center><h4>  设置简单的代理服务器 </h4></center><p>   nginx的一个常见用途是将其设置为代理服务器，这意味着服务器接收请求，将它们传递给代理服务器，从中检索响应，然后将它们发送给客户端。 </p><p>  我们将配置一个基本代理服务器，它使用来自本地目录的文件处理图像请求，并将所有其他请求发送到代理服务器。  在此示例中，将在单个nginx实例上定义两个服务器。 </p><p>  首先，通过向nginx的配置文件添加一个以上的<code class="notranslate">server</code>块来定义代理服务器，其中包含以下内容： </p><blockquote class="example"><pre class="notranslate">server {<br>    listen 8080;<br>    root /data/up1;<p></p>
<pre><code>location / {
}
</code></pre><p>}<br></p></pre></blockquote><p>  这将是一个侦听端口8080的简单服务器（之前，自使用标准端口80以来尚未指定<code class="notranslate">listen</code>指令）并将所有请求映射到本地文件系统上的<code class="notranslate">/data/up1</code>目录。  创建此目录并将<code class="notranslate">index.html</code>文件放入其中。  请注意， <code class="notranslate">root</code>指令放在<code class="notranslate">server</code>上下文中。  当选择用于提供请求的<code class="notranslate">location</code>块不包括自己的<code class="notranslate">root</code>指令时，使用这样的<code class="notranslate">root</code>指令。 </p><p>  接下来，使用上一节中的服务器配置并对其进行修改以使其成为代理服务器配置。  在第一个<code class="notranslate">location</code>块中，将<a hhref="http/ngx_http_proxy_module.html#proxy_pass">proxy_pass</a>指令与参数中指定的代理服务器的协议，名称和端口放在一起（在我们的示例中，它是<code class="notranslate"><a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a></code> ）： </p><blockquote class="example"><pre class="notranslate">server {<br>    location / {<br>        proxy_pass <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a>;<br>    }<p></p>
<pre><code>location /images/ {
    root /data;
}
</code></pre><p>}<br></p></pre></blockquote><p></p><p>  我们将修改第二个<code class="notranslate">location</code>块，该块当前将带有<code class="notranslate">/images/</code>前缀的请求映射到<code class="notranslate">/data/images</code>目录下的文件，以使其与具有典型文件扩展名的图像请求相匹配。  修改后的<code class="notranslate">location</code>块如下所示： </p><blockquote class="example"><pre class="notranslate">location ~ .(gif|jpg|png)$ {<br>    root /data/images;<br>}<br></pre></blockquote><p>  该参数是一个正则表达式，匹配以<code class="notranslate">.gif</code> ， <code class="notranslate">.jpg</code>或<code class="notranslate">.png</code>结尾的所有URI。  正则表达式应该以<code class="notranslate">~</code> 。  相应的请求将映射到<code class="notranslate">/data/images</code>目录。 </p><p>  当nginx选择一个<code class="notranslate">location</code>块来提供请求时，它首先检查指定前缀的<a hhref="http/ngx_http_core_module.html#location">位置</a>指令，记住具有最长前缀的<code class="notranslate">location</code> ，然后检查正则表达式。  如果与正则表达式匹配，则nginx选择此<code class="notranslate">location</code> ，否则，它会选择之前记住的那个。 </p><p>  生成的代理服务器配置如下所示： </p><blockquote class="example"><pre class="notranslate">server {<br>    location / {<br>        proxy_pass <a href="http://localhost:8080/" target="_blank" rel="noopener">http://localhost:8080/</a>;<br>    }<p></p>
<pre><code>location ~ \.(gif|jpg|png)$ {
    root /data/images;
}
</code></pre><p>}<br></p></pre></blockquote><p>  此服务器将过滤以<code class="notranslate">.gif</code> ， <code class="notranslate">.jpg</code>或<code class="notranslate">.png</code>结尾的请求，并将它们映射到<code class="notranslate">/data/images</code>目录（通过将URI添加到<code class="notranslate">root</code>指令的参数），并将所有其他请求传递给上面配置的代理服务器。 </p><p>  要应用新配置，请将<code class="notranslate">reload</code>信号发送到nginx，如前面部分所述。 </p><p>  可以使用<a hhref="http/ngx_http_proxy_module.html">更多</a>指令来进一步配置代理连接。 </p><a name="fastcgi"></a><center><h4>  设置FastCGI代理 </h4></center><p>   nginx可用于将请求路由到FastCGI服务器，这些服务器运行使用各种框架和编程语言（如PHP）构建的应用程序。 </p><p>  使用FastCGI服务器的最基本的nginx配置包括使用<a hhref="http/ngx_http_fastcgi_module.html#fastcgi_pass">fastcgi_pass</a>指令而不是<code class="notranslate">proxy_pass</code>指令，以及<a hhref="http/ngx_http_fastcgi_module.html#fastcgi_param">fastcgi_param</a>指令来设置传递给FastCGI服务器的参数。  假设可以在<code class="notranslate">localhost:9000</code>上访问FastCGI服务器。  以上一节中的代理配置为基础，将<code class="notranslate">proxy_pass</code>指令替换为<code class="notranslate">fastcgi_pass</code>指令，并将参数更改为<code class="notranslate">localhost:9000</code> 。  在PHP中， <code class="notranslate">SCRIPT_FILENAME</code>参数用于确定脚本名称， <code class="notranslate">QUERY_STRING</code>参数用于传递请求参数。  结果配置为： </p><blockquote class="example"><pre class="notranslate">server {<br>    location / {<br>        fastcgi_pass  localhost:9000;<br>        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br>        fastcgi_param QUERY_STRING    $query_string;<br>    }<p></p>
<pre><code>location ~ \.(gif|jpg|png)$ {
    root /data/images;
}
</code></pre><p>}<br></p></pre></blockquote><p>  这将设置一个服务器，该服务器将除静态图像请求之外的所有请求路由到通过FastCGI协议在<code class="notranslate">localhost:9000</code>上运行的代理服务器。 </p><br><span></span><div style="display: none;"></div><p></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[jvm学习]]></title>
      <url>/java/JVM%E5%AD%A6%E4%B9%A0.html</url>
      <content type="html"><![CDATA[<p>JVM Java Virtual Machine (java虚拟机)</p>
<a id="more"></a>
<h1 id="JDK8-以后-Hotspot-JRockit-优秀特性"><a href="#JDK8-以后-Hotspot-JRockit-优秀特性" class="headerlink" title="JDK8 以后 Hotspot+JRockit 优秀特性"></a>JDK8 以后 Hotspot+JRockit 优秀特性</h1>]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
            <tag> jvm </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[guava教程]]></title>
      <url>/java/guava%E6%95%99%E7%A8%8B.html</url>
      <content type="html"><![CDATA[<p>guava教程</p>
<blockquote>
<p>guava谷歌出品,高效工具类<br>目标：节约时间，资源，提高生产力  Guava工程包含了若干被Google的 Java项目广泛依赖 的核心库，例如：<br>集合 [collections]<br>缓存 [caching]<br>原生类型支持 [primitives support]<br>并发库 [concurrency libraries]<br>通用注解 [common annotations]<br>字符串处理 [string processing]<br>I/O 等等<br><a id="more"></a></p>
</blockquote>
<h1 id="集合的创建-可变，不可变"><a href="#集合的创建-可变，不可变" class="headerlink" title="集合的创建, 可变，不可变"></a>集合的创建, 可变，不可变</h1><h2 id="基本"><a href="#基本" class="headerlink" title="基本"></a>基本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 普通Collection的创建</span><br><span class="line">List&lt;String&gt; list = Lists.newArrayList();</span><br><span class="line">Set&lt;String&gt; set = Sets.newHashSet();</span><br><span class="line">Map&lt;String, String&gt; map = Maps.newHashMap();</span><br><span class="line"></span><br><span class="line">// 不变Collection的创建</span><br><span class="line">ImmutableList&lt;String&gt; iList = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);</span><br><span class="line">ImmutableSet&lt;String&gt; iSet = ImmutableSet.of(&quot;e1&quot;, &quot;e2&quot;);</span><br><span class="line">ImmutableMap&lt;String, String&gt; iMap = ImmutableMap.of(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;);</span><br><span class="line"></span><br><span class="line">immutable(不可变)对象</span><br><span class="line">1.在多线程操作下，是线程安全的。</span><br><span class="line">2.所有不可变集合会比可变集合更有效的利用资源。</span><br><span class="line">3.中途不可改变</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; names = Lists.newArrayList(&quot;Richard&quot;, &quot;Amy&quot;, &quot;Lily&quot;, &quot;Sarah&quot;);</span><br><span class="line">List&lt;Integer&gt; numbers = Lists.newArrayList(11, 78, 89, 45, 30);</span><br><span class="line">//创建加初始化</span><br></pre></td></tr></table></figure>
<h2 id="特殊的数据类型"><a href="#特殊的数据类型" class="headerlink" title="特殊的数据类型"></a>特殊的数据类型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MultiSet: 无序+可重复   count()方法获取单词的次数  增强了可读性+操作简单</span><br><span class="line">创建方式:  Multiset&lt;String&gt; set = HashMultiset.create();</span><br><span class="line">Multimap: key-value  key可以重复  </span><br><span class="line">创建方式: Multimap&lt;String, String&gt; teachers = ArrayListMultimap.create();</span><br><span class="line">BiMap: 双向Map(Bidirectional Map) 键与值都不能重复</span><br><span class="line">创建方式:  BiMap&lt;String, String&gt; biMap = HashBiMap.create();</span><br><span class="line">Table: 双键的Map Map--&gt; Table--&gt;rowKey+columnKey+value  //和sql中的联合主键有点像</span><br><span class="line">创建方式: Table&lt;String, String, Integer&gt; tables = HashBasedTable.create();</span><br></pre></td></tr></table></figure>
<h1 id="集合转字符串"><a href="#集合转字符串" class="headerlink" title="集合转字符串"></a>集合转字符串</h1><h2 id="list-转字符串"><a href="#list-转字符串" class="headerlink" title="list 转字符串"></a>list 转字符串</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//use java</span><br><span class="line">List&lt;String&gt; list = new ArrayList&lt;String&gt;();</span><br><span class="line">list.add(&quot;aa&quot;);</span><br><span class="line">list.add(&quot;bb&quot;);</span><br><span class="line">list.add(&quot;cc&quot;);</span><br><span class="line">String str = &quot;&quot;;</span><br><span class="line">for(int i=0; i&lt;list.size(); i++)&#123;</span><br><span class="line">	str = str + &quot;-&quot; +list.get(i);</span><br><span class="line">&#125;</span><br><span class="line">//str 为-aa-bb-cc</span><br><span class="line">//use guava</span><br><span class="line">List&lt;String&gt; list = new ArrayList&lt;String&gt;();</span><br><span class="line">list.add(&quot;aa&quot;);</span><br><span class="line">list.add(&quot;bb&quot;);</span><br><span class="line">list.add(&quot;cc&quot;);</span><br><span class="line">String result = Joiner.on(&quot;-&quot;).join(list);</span><br><span class="line">//result为  aa-bb-cc</span><br></pre></td></tr></table></figure>
<h2 id="map转字符串"><a href="#map转字符串" class="headerlink" title="map转字符串"></a>map转字符串</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Integer&gt; map = Maps.newHashMap();</span><br><span class="line">map.put(&quot;xiaoming&quot;, 12);</span><br><span class="line">map.put(&quot;xiaohong&quot;,13);</span><br><span class="line">String result = Joiner.on(&quot;,&quot;).withKeyValueSeparator(&quot;=&quot;).join(map);</span><br><span class="line">// result为 xiaoming=12,xiaohong=13</span><br></pre></td></tr></table></figure>
<h1 id="字符串转集合"><a href="#字符串转集合" class="headerlink" title="字符串转集合"></a>字符串转集合</h1><h2 id="字符串转list"><a href="#字符串转list" class="headerlink" title="字符串转list"></a>字符串转list</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//use java</span><br><span class="line">List&lt;String&gt; list = new ArrayList&lt;String&gt;();</span><br><span class="line">String a = &quot;1-2-3-4-5-6&quot;;</span><br><span class="line">String[] strs = a.split(&quot;-&quot;);</span><br><span class="line">for(int i=0; i&lt;strs.length; i++)&#123;</span><br><span class="line">	list.add(strs[i]);</span><br><span class="line">&#125;</span><br><span class="line">//use guava</span><br><span class="line">String str = &quot;1-2-3-4-5-6&quot;;</span><br><span class="line">List&lt;String&gt; list = Splitter.on(&quot;-&quot;).splitToList(str);</span><br><span class="line">//list为  [1, 2, 3, 4, 5, 6]</span><br></pre></td></tr></table></figure>
<h2 id="字符串转map"><a href="#字符串转map" class="headerlink" title="字符串转map"></a>字符串转map</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String str = &quot;xiaoming=11,xiaohong=23&quot;;</span><br><span class="line">Map&lt;String,String&gt; map = Splitter.on(&quot;,&quot;).withKeyValueSeparator(&quot;=&quot;).split(str);</span><br></pre></td></tr></table></figure>
<h1 id="字符串分隔"><a href="#字符串分隔" class="headerlink" title="字符串分隔"></a>字符串分隔</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String input = &quot;aa.dd,,ff,,.&quot;;</span><br><span class="line">List&lt;String&gt; result = Splitter.onPattern(&quot;[.|,]&quot;).omitEmptyStrings().splitToList(input);</span><br></pre></td></tr></table></figure>
<h1 id="差集合集并集"><a href="#差集合集并集" class="headerlink" title="差集合集并集"></a>差集合集并集</h1><h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">HashSet setA = newHashSet(1, 2, 3, 4, 5);  </span><br><span class="line">HashSet setB = newHashSet(4, 5, 6, 7, 8);  </span><br><span class="line">   </span><br><span class="line">SetView union = Sets.union(setA, setB);  </span><br><span class="line">System.out.println(&quot;union:&quot;);  </span><br><span class="line">for (Integer integer : union)  </span><br><span class="line">    System.out.println(integer);           //union:12345867</span><br><span class="line">   </span><br><span class="line">SetView difference = Sets.difference(setA, setB);  </span><br><span class="line">System.out.println(&quot;difference:&quot;);  </span><br><span class="line">for (Integer integer : difference)  </span><br><span class="line">    System.out.println(integer);        //difference:123</span><br><span class="line">   </span><br><span class="line">SetView intersection = Sets.intersection(setA, setB);  </span><br><span class="line">System.out.println(&quot;intersection:&quot;);  </span><br><span class="line">for (Integer integer : intersection)  </span><br><span class="line">    System.out.println(integer);  //intersection:45</span><br></pre></td></tr></table></figure>
<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MapDifference differenceMap = Maps.difference(mapA, mapB);  </span><br><span class="line">differenceMap.areEqual();  </span><br><span class="line">Map entriesDiffering = differenceMap.entriesDiffering();  </span><br><span class="line">Map entriesOnlyOnLeft = differenceMap.entriesOnlyOnLeft();  </span><br><span class="line">Map entriesOnlyOnRight = differenceMap.entriesOnlyOnRight();  </span><br><span class="line">Map entriesInCommon = differenceMap.entriesInCommon();</span><br></pre></td></tr></table></figure>
<h1 id="抓取网页"><a href="#抓取网页" class="headerlink" title="抓取网页"></a>抓取网页</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">URL url = new URL(&quot;http://www.baidu.com&quot;);</span><br><span class="line">       CharSource charSource = Resources.asByteSource(url).asCharSource(StandardCharsets.UTF_8);</span><br><span class="line">       charSource.readLines().forEach(System.out::println);</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
            <tag> guava </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[springboot常用的注解]]></title>
      <url>/spring-boot/springboot%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3.html</url>
      <content type="html"><![CDATA[<p>springboot 常用的注解<br><a id="more"></a></p>
<blockquote>
<p>@PropertySource(value = “classpath:test.properties”) 加载配置文件<br>@ConfigurationProperties(prefix=”spring”) 提取前缀<br>@ConditionOnProperty 根据配置文件加载class</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> springboot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[springboot @Import @ImportResource 注解]]></title>
      <url>/spring-boot/springboot%20@Import%20@ImportResource%20%E6%B3%A8%E8%A7%A3.html</url>
      <content type="html"><![CDATA[<p>springboot @Import @ImportResource 注解<br><a id="more"></a></p>
<h1 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h1><blockquote>
<p>@Import注解在4.2之前只支持导入配置类；在4.2以及之后，@Import注解支持导入普通java类，并将其声明成一个bean。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class DemoService &#123;  </span><br><span class="line">    public void doSomething()&#123;  </span><br><span class="line">        System.out.println(&quot;everything is all fine&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">@Configuration  </span><br><span class="line">@Import(DemoService.class)  </span><br><span class="line">public class DemoConfig &#123;  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line">    public static void main(String[] args) &#123;  </span><br><span class="line">        AnnotationConfigApplicationContext context =  </span><br><span class="line">                new AnnotationConfigApplicationContext(&quot;com.example&quot;);  </span><br><span class="line">        DemoService ds = context.getBean(DemoService.class);  </span><br><span class="line">        ds.doSomething();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a>@ImportResource</h1><h2 id="test-java"><a href="#test-java" class="headerlink" title="test.java"></a>test.java</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@Controller</span><br><span class="line">public class test &#123;</span><br><span class="line"></span><br><span class="line">	@Value(&quot;$&#123;url&#125;&quot;)</span><br><span class="line">	private String url;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(&quot;/hello&quot;)</span><br><span class="line">	@ResponseBody</span><br><span class="line">	public String hello() &#123;</span><br><span class="line">		System.err.println(url);</span><br><span class="line">		return &quot;hello&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		// TODO Auto-generated method stub</span><br><span class="line">		SpringApplication.run(test.class, args);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="cons-java"><a href="#cons-java" class="headerlink" title="cons.java"></a>cons.java</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package springboot;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.context.annotation.ImportResource;</span><br><span class="line"></span><br><span class="line">@ImportResource(&quot;classpath:test.xml&quot;)</span><br><span class="line">@Configuration</span><br><span class="line">public class cons &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="test-xml"><a href="#test-xml" class="headerlink" title="test.xml"></a>test.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd&quot; &gt;</span><br><span class="line">        </span><br><span class="line">    &lt;context:property-placeholder location=&quot;classpath:/test.properties&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<h2 id="test-properties"><a href="#test-properties" class="headerlink" title="test.properties"></a>test.properties</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jdbc.username=root</span><br><span class="line">password=root</span><br><span class="line">url=127.0.0.1</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> springboot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[简单服务器开发]]></title>
      <url>/c/%E7%AE%80%E5%8D%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91.html</url>
      <content type="html"><![CDATA[<p> 简单服务器开发</p>
 <a id="more"></a>
<h1 id="server"><a href="#server" class="headerlink" title="server"></a>server</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> #include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;sys/socket.h&gt;</span><br><span class="line">#include &lt;netinet/in.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;arpa/inet.h&gt;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">	 struct  sockaddr_in  server,client;</span><br><span class="line">	 char buf[1000];</span><br><span class="line">	 int cfd;</span><br><span class="line">	 int sfd=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);</span><br><span class="line">     server.sin_family=AF_INET;</span><br><span class="line">	 server.sin_port=htons(7006);</span><br><span class="line">	 server.sin_addr.s_addr=inet_addr(&quot;127.0.0.1&quot;);</span><br><span class="line">	 int ret=bind(sfd,(struct sockaddr *)&amp;server,sizeof(server));</span><br><span class="line">	 if(ret==-1)&#123;</span><br><span class="line">	 	printf(&quot;%s&quot;,&quot;bind error\n&quot;);</span><br><span class="line">	 	return -1; </span><br><span class="line">	 &#125;</span><br><span class="line">	 int lret=listen(sfd,10);</span><br><span class="line">	 if(lret==-1)&#123;</span><br><span class="line">	 	printf(&quot;%s&quot;,&quot;listen error\n&quot;);</span><br><span class="line">	 	return -1;</span><br><span class="line">	 &#125;</span><br><span class="line">	 int len=sizeof(client);</span><br><span class="line">	 while(1)&#123;</span><br><span class="line">	 	cfd=accept(sfd,(struct sockaddr *)&amp;client,&amp;len);</span><br><span class="line">	 	char str[]=&quot;hello world\n&quot;;</span><br><span class="line">	 	write(cfd,str,sizeof(str));</span><br><span class="line">	 	while(1)&#123;</span><br><span class="line">	 		read(cfd,buf,1000);</span><br><span class="line">		    printf(&quot;%s\n&quot;,buf);</span><br><span class="line">	 		</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">	 	</span><br><span class="line">	 	</span><br><span class="line">	 &#125;</span><br><span class="line">	 close(cfd);</span><br><span class="line">	 close(sfd);</span><br><span class="line">	 printf(&quot;over\n&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="client"><a href="#client" class="headerlink" title="client"></a>client</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;sys/socket.h&gt;</span><br><span class="line">#include &lt;netinet/in.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;arpa/inet.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int  main()&#123;</span><br><span class="line">	 struct sockaddr_in server;</span><br><span class="line">	 char buf[1000];</span><br><span class="line">	 char buff[1000];</span><br><span class="line">	 int fd=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);</span><br><span class="line">	 server.sin_family=AF_INET;</span><br><span class="line">	 server.sin_port=htons(7006);</span><br><span class="line">	 server.sin_addr.s_addr=inet_addr(&quot;127.0.0.1&quot;);</span><br><span class="line">	 connect(fd,(struct sockaddr*)&amp;server,sizeof(server));</span><br><span class="line">	 read(fd,buf,1000);</span><br><span class="line">	 printf(&quot;%s\n&quot;,buf);</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	 while(1)&#123;</span><br><span class="line">	 	 </span><br><span class="line">	     scanf(&quot;%s&quot;,buff);</span><br><span class="line">        </span><br><span class="line">	     write(fd,buff,sizeof(buff));</span><br><span class="line">	     </span><br><span class="line">	   	</span><br><span class="line">	 &#125; </span><br><span class="line">	</span><br><span class="line">	 close(fd);	  </span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> c </category>
            
        </categories>
        
        
        <tags>
            
            <tag> c </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ngx_http_image_filter_module应用]]></title>
      <url>/nginx/ngx_http_image_filter_module%E5%BA%94%E7%94%A8.html</url>
      <content type="html"><![CDATA[<p> ngx_http_image_filter_module 缩略图应用</p>
 <a id="more"></a>
<h1 id="安装yum-install-y-gd-devel"><a href="#安装yum-install-y-gd-devel" class="headerlink" title="安装yum install -y gd-devel"></a>安装yum install -y gd-devel</h1><h1 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf nginx.tar.gz</span><br><span class="line">./configure --prefix=/usr/local/nginx --with-hhtp_image_filter_module</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	image_filter off;</span><br><span class="line">image_filter test;</span><br><span class="line">image_filter size;</span><br><span class="line">image_filter rotate 90 | 180 | 270;</span><br><span class="line">image_filter resize width height;</span><br><span class="line">image_filter crop width height;</span><br><span class="line">Default:	</span><br><span class="line">image_filter off;</span><br><span class="line">Context:	location</span><br></pre></td></tr></table></figure>
<h1 id="配置nginx-conf"><a href="#配置nginx-conf" class="headerlink" title="配置nginx.conf"></a>配置nginx.conf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">location ~* /img/(.+)_(\d+)x(\d+)\.(jpg|gif|png)$ &#123;            </span><br><span class="line">    set $h $2;</span><br><span class="line">    set $w $3;</span><br><span class="line">    if ($h = &quot;0&quot;) &#123;</span><br><span class="line">        rewrite /img/(.+)_(\d+)x(\d+)\.(jpg|gif|png)$ /img/$1.$4 last;</span><br><span class="line">    &#125;</span><br><span class="line">    if ($w = &quot;0&quot;) &#123;</span><br><span class="line">        rewrite /img/(.+)_(\d+)x(\d+)\.(jpg|gif|png)$ /img/$1.$4 last;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    #根据给定的长宽生成缩略图</span><br><span class="line">    image_filter resize $h $w;</span><br><span class="line">    #原图最大2M，要裁剪的图片超过2M返回415错误，需要调节参数image_filter_buffer </span><br><span class="line">    image_filter_buffer 2M;                          </span><br><span class="line">     </span><br><span class="line">    #error_page  415              /img/notfound.jpg;</span><br><span class="line">    try_files /img/$1.$4  /img/notfound.jpg;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">访问缩略图方式</span><br><span class="line"></span><br><span class="line">http://nginx.im/img/9GUMJR7200AJ0003_90x90.jpg</span><br><span class="line"></span><br><span class="line">访问原图方式</span><br><span class="line"></span><br><span class="line">http://nginx.im/img/9GUMJR7200AJ0003.jpg</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> nginx </category>
            
        </categories>
        
        
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ngx_http_addition_module应用]]></title>
      <url>/nginx/ngx_http_addition_module%E5%BA%94%E7%94%A8.html</url>
      <content type="html"><![CDATA[<p>ngx_http_addition_module在响应之前或者之后追加文本内容，比如js,html</p>
<a id="more"></a>
<h1 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf nginx.tar.gz</span><br><span class="line">cd nginx</span><br><span class="line">./configure --prefix=/usr/local/nginx --with-http_addition_module</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h1 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h1><blockquote>
<p>Syntax:    add_before_body uri;<br>Default:    —<br>Context:    http, server, location</p>
<p>Syntax:    add_after_body uri;<br>Default:    —<br>Context:    http, server, location</p>
</blockquote>
<h1 id="nginx-conf-配置"><a href="#nginx-conf-配置" class="headerlink" title="nginx.conf 配置"></a>nginx.conf 配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    add_before_body /head.html;</span><br><span class="line">    add_after_body  /foot.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim index.html</span><br><span class="line">&lt;h1&gt;hello nginx &lt;/h1&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim head.html</span><br><span class="line">&lt;div&gt;head&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim foot.html</span><br><span class="line"></span><br><span class="line">&lt;div&gt;foot&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>启用后</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;head&lt;/div&gt;</span><br><span class="line">&lt;h1&gt;hello nginx &lt;/h1&gt;</span><br><span class="line">&lt;div&gt;foot&lt;/div&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> nginx </category>
            
        </categories>
        
        
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[springboot统一异常处理]]></title>
      <url>/java/springboot%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.html</url>
      <content type="html"><![CDATA[<p>springboot 统一异常处理</p>
<a id="more"></a>
<h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package nginx;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line">import org.springframework.context.annotation.ComponentScan;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line"></span><br><span class="line">@EnableAutoConfiguration  //1</span><br><span class="line">@ComponentScan         //2 </span><br><span class="line">public class test &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(&quot;/&quot;)</span><br><span class="line">	@ResponseBody</span><br><span class="line">	String home() &#123;</span><br><span class="line">		System.err.println(1 / 0);</span><br><span class="line">		return &quot;Hello World!&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) throws Exception &#123;</span><br><span class="line">		SpringApplication.run(test.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p> 标注 1,2 可以换成@SpringBootApplication<br> @SpringBootApplication //等同于 @Configuration @EnableAutoConfiguration @ComponentScan</p>
</blockquote>
</blockquote>
<h1 id="异常类"><a href="#异常类" class="headerlink" title="异常类"></a>异常类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package nginx;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line">import org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line">@ControllerAdvice</span><br><span class="line">public class ex &#123;</span><br><span class="line">	@ExceptionHandler(RuntimeException.class)</span><br><span class="line">	@ResponseBody // 拦截返回是 json返回结果</span><br><span class="line">	public Map&lt;String, Object&gt; exceptionHandler() &#123;</span><br><span class="line">		Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		result.put(&quot;code&quot;, &quot;500&quot;);</span><br><span class="line">		result.put(&quot;msg&quot;, &quot;亲,系统错误,请稍后重试....&quot;);</span><br><span class="line">		return result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ControllerAdvice-注解，用于拦截全局的Controller的异常，注意：ControllerAdvice注解只拦截Controller不会拦截Interceptor的异常"><a href="#ControllerAdvice-注解，用于拦截全局的Controller的异常，注意：ControllerAdvice注解只拦截Controller不会拦截Interceptor的异常" class="headerlink" title="@ControllerAdvice 注解，用于拦截全局的Controller的异常，注意：ControllerAdvice注解只拦截Controller不会拦截Interceptor的异常"></a>@ControllerAdvice 注解，用于拦截全局的Controller的异常，注意：ControllerAdvice注解只拦截Controller不会拦截Interceptor的异常</h1> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package com.cmc.schedule.handler;</span><br><span class="line"></span><br><span class="line">import com.gionee.base.entity.JsonResult;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.beans.ConversionNotSupportedException;</span><br><span class="line">import org.springframework.beans.TypeMismatchException;</span><br><span class="line">import org.springframework.http.converter.HttpMessageNotReadableException;</span><br><span class="line">import org.springframework.http.converter.HttpMessageNotWritableException;</span><br><span class="line">import org.springframework.web.HttpMediaTypeNotAcceptableException;</span><br><span class="line">import org.springframework.web.HttpRequestMethodNotSupportedException;</span><br><span class="line">import org.springframework.web.bind.MissingServletRequestParameterException;</span><br><span class="line">import org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line">import org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 异常拦截处理器</span><br><span class="line"> *</span><br><span class="line"> * @author chenmc</span><br><span class="line"> */</span><br><span class="line">@ControllerAdvice</span><br><span class="line">@ResponseBody</span><br><span class="line">public class GlobalExceptionHandler &#123;</span><br><span class="line"></span><br><span class="line">    private static final String logExceptionFormat = &quot;Capture Exception By GlobalExceptionHandler: Code: %s Detail: %s&quot;;</span><br><span class="line">    private static Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);</span><br><span class="line"></span><br><span class="line">    //运行时异常  </span><br><span class="line">    @ExceptionHandler(RuntimeException.class)</span><br><span class="line">    public String runtimeExceptionHandler(RuntimeException ex) &#123;</span><br><span class="line">        return resultFormat(1, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //空指针异常  </span><br><span class="line">    @ExceptionHandler(NullPointerException.class)</span><br><span class="line">    public String nullPointerExceptionHandler(NullPointerException ex) &#123;</span><br><span class="line">        return resultFormat(2, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //类型转换异常  </span><br><span class="line">    @ExceptionHandler(ClassCastException.class)</span><br><span class="line">    public String classCastExceptionHandler(ClassCastException ex) &#123;</span><br><span class="line">        return resultFormat(3, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //IO异常  </span><br><span class="line">    @ExceptionHandler(IOException.class)</span><br><span class="line">    public String iOExceptionHandler(IOException ex) &#123;</span><br><span class="line">        return resultFormat(4, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //未知方法异常  </span><br><span class="line">    @ExceptionHandler(NoSuchMethodException.class)</span><br><span class="line">    public String noSuchMethodExceptionHandler(NoSuchMethodException ex) &#123;</span><br><span class="line">        return resultFormat(5, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //数组越界异常  </span><br><span class="line">    @ExceptionHandler(IndexOutOfBoundsException.class)</span><br><span class="line">    public String indexOutOfBoundsExceptionHandler(IndexOutOfBoundsException ex) &#123;</span><br><span class="line">        return resultFormat(6, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //400错误  </span><br><span class="line">    @ExceptionHandler(&#123;HttpMessageNotReadableException.class&#125;)</span><br><span class="line">    public String requestNotReadable(HttpMessageNotReadableException ex) &#123;</span><br><span class="line">        System.out.println(&quot;400..requestNotReadable&quot;);</span><br><span class="line">        return resultFormat(7, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //400错误  </span><br><span class="line">    @ExceptionHandler(&#123;TypeMismatchException.class&#125;)</span><br><span class="line">    public String requestTypeMismatch(TypeMismatchException ex) &#123;</span><br><span class="line">        System.out.println(&quot;400..TypeMismatchException&quot;);</span><br><span class="line">        return resultFormat(8, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //400错误  </span><br><span class="line">    @ExceptionHandler(&#123;MissingServletRequestParameterException.class&#125;)</span><br><span class="line">    public String requestMissingServletRequest(MissingServletRequestParameterException ex) &#123;</span><br><span class="line">        System.out.println(&quot;400..MissingServletRequest&quot;);</span><br><span class="line">        return resultFormat(9, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //405错误  </span><br><span class="line">    @ExceptionHandler(&#123;HttpRequestMethodNotSupportedException.class&#125;)</span><br><span class="line">    public String request405(HttpRequestMethodNotSupportedException ex) &#123;</span><br><span class="line">        return resultFormat(10, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //406错误  </span><br><span class="line">    @ExceptionHandler(&#123;HttpMediaTypeNotAcceptableException.class&#125;)</span><br><span class="line">    public String request406(HttpMediaTypeNotAcceptableException ex) &#123;</span><br><span class="line">        System.out.println(&quot;406...&quot;);</span><br><span class="line">        return resultFormat(11, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //500错误  </span><br><span class="line">    @ExceptionHandler(&#123;ConversionNotSupportedException.class, HttpMessageNotWritableException.class&#125;)</span><br><span class="line">    public String server500(RuntimeException ex) &#123;</span><br><span class="line">        System.out.println(&quot;500...&quot;);</span><br><span class="line">        return resultFormat(12, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //栈溢出</span><br><span class="line">    @ExceptionHandler(&#123;StackOverflowError.class&#125;)</span><br><span class="line">    public String requestStackOverflow(StackOverflowError ex) &#123;</span><br><span class="line">        return resultFormat(13, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //其他错误</span><br><span class="line">    @ExceptionHandler(&#123;Exception.class&#125;)</span><br><span class="line">    public String exception(Exception ex) &#123;</span><br><span class="line">        return resultFormat(14, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private &lt;T extends Throwable&gt; String resultFormat(Integer code, T ex) &#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">        log.error(String.format(logExceptionFormat, code, ex.getMessage()));</span><br><span class="line">        return JsonResult.failed(code, ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springboot </tag>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[java动态代理实现连接池]]></title>
      <url>/java/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E8%BF%9E%E6%8E%A5%E6%B1%A0.html</url>
      <content type="html"><![CDATA[<p> java动态代理实现连接池</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.LinkedList;</span><br><span class="line"></span><br><span class="line">import sun.font.CreatedFontTracker;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * </span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author michael</span><br><span class="line"> * Description: </span><br><span class="line"> *代理：如果对某个接口中的某个指定的方法的功能进行扩展，而不想实现接口里所有方法，可以使用（动态代理）代理模式</span><br><span class="line"> *java中代理模式:静态/动态/cglib（Spring）</span><br><span class="line"> *使用动态代理，可以检测接口中方法的执行</span><br><span class="line"> *</span><br><span class="line"> *Proxy</span><br><span class="line"> *static Object newProxyInstance(</span><br><span class="line"> *ClassLoader loader,  定义代理类的类加载器</span><br><span class="line"> *Class&lt;?&gt;[] interfaces,   代理类要实现的接口列表</span><br><span class="line"> *InvocationHandler h)  指派方法调用的调用处理程序 </span><br><span class="line"> * 2017年5月1日</span><br><span class="line"> */</span><br><span class="line">public class Pool &#123;</span><br><span class="line">	private int init_count = 3;</span><br><span class="line">	private int max_count = 6;</span><br><span class="line">	private int current_count = 0;</span><br><span class="line">	private LinkedList&lt;Connection&gt; pool = new LinkedList&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	//1.构造函数，初始化连接放入连接池</span><br><span class="line">	public Pool()&#123;</span><br><span class="line">		for (int i = 0; i &lt; init_count; i++) &#123;</span><br><span class="line">			current_count++;</span><br><span class="line">			Connection conn = createConnection();</span><br><span class="line">			pool.add(conn);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	//2.创建一个新的连接方法</span><br><span class="line">	private Connection createConnection()&#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">			final Connection con = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8&quot;,&quot;root&quot;,&quot;123456&quot;);</span><br><span class="line">			//对con创建代理对象</span><br><span class="line">			Connection proxy = (Connection)Proxy.newProxyInstance(</span><br><span class="line">					con.getClass().getClassLoader(), </span><br><span class="line">					/*con.getClass().getInterfaces(),*/  //当目标对象是一个具体的类时</span><br><span class="line">					new Class[]&#123;Connection.class&#125;,   //目标对象实现的接口</span><br><span class="line">					new InvocationHandler() &#123;</span><br><span class="line">						</span><br><span class="line">						@Override</span><br><span class="line">						public Object invoke(Object proxy, Method method, Object[] args)</span><br><span class="line">								throws Throwable &#123;</span><br><span class="line">							//方法返回值</span><br><span class="line">							Object result = null;</span><br><span class="line">							//当前执行的方法名</span><br><span class="line">							String methodName = method.getName();</span><br><span class="line">							//判断是否执行了close方法的时候，把连接放到连接池</span><br><span class="line">							if(&quot;close&quot;.equals(methodName))&#123;</span><br><span class="line">								System.out.println(&quot;begin:当前执行了close方法&quot;);</span><br><span class="line">								//连接放入连接池</span><br><span class="line">								pool.addLast(con);</span><br><span class="line">								System.out.println(&quot;end:当前连接已经放入连接池&quot;);</span><br><span class="line">							&#125;else&#123;</span><br><span class="line">							//调用目标对象方法</span><br><span class="line">							method.invoke(con, args);</span><br><span class="line">							&#125;</span><br><span class="line">							return result;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					);</span><br><span class="line">			return proxy;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			// TODO Auto-generated catch block</span><br><span class="line">			throw new RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	//3.获取连接</span><br><span class="line">	public  Connection getConnection()&#123;</span><br><span class="line">		//3.1判断连接池中是否有链接，如果有连接，则直接用</span><br><span class="line">		if(pool.size()&gt;0)&#123;</span><br><span class="line">			return pool.removeFirst();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		//3.2连接池中没有连接，判断，如果没有达到最大连接数，创建</span><br><span class="line">		if(current_count&lt;max_count)&#123;</span><br><span class="line">			//记录当前使用的连接数</span><br><span class="line">			current_count++;</span><br><span class="line">			return createConnection();</span><br><span class="line">		&#125;</span><br><span class="line">		//3.3如果当前已经达到最大连接数，抛出异常</span><br><span class="line">		throw new RuntimeException(&quot;当前已经达到最大连接数！&quot;);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	//4.释放连接</span><br><span class="line">	public void realeaseConnection(Connection con)&#123;</span><br><span class="line">		//4.1 判断：池的数目如果小于初始化练级，就放入池中</span><br><span class="line">		if(pool.size()&lt;init_count)&#123;</span><br><span class="line">			pool.addLast(con);</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			//关闭</span><br><span class="line">			try &#123;</span><br><span class="line">				current_count-- ;</span><br><span class="line">				con.close();</span><br><span class="line">			&#125; catch (SQLException e) &#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;	</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args) throws SQLException &#123;</span><br><span class="line">		Pool pool = new Pool();</span><br><span class="line">		System.out.println(&quot;当前连接&quot;+pool.current_count);</span><br><span class="line">		</span><br><span class="line">		//使用连接</span><br><span class="line">		pool.getConnection();</span><br><span class="line">		pool.getConnection();</span><br><span class="line">		pool.getConnection();</span><br><span class="line">		pool.getConnection();</span><br><span class="line">		pool.getConnection();</span><br><span class="line">	</span><br><span class="line">		Connection con1 = pool.getConnection();</span><br><span class="line">		con1.close();//如果没用动态代理，连接就关闭了</span><br><span class="line">		//希望：当关闭连接的时候，要把连接放入连接池。（当调用Connetion接口的close方法时候，希望触发pool.addLast(con)操作）</span><br><span class="line">		//解决1:实现Connection接口，重写close方法（方法太多，不太现实）</span><br><span class="line">		//解决2：</span><br><span class="line">		pool.getConnection();</span><br><span class="line">		System.out.println(&quot;连接池&quot;+pool.pool.size());</span><br><span class="line">		System.out.println(&quot;当前连接&quot;+pool.current_count);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[JVM中GC Minor-GC Major-GC Full-GC区别]]></title>
      <url>/java/JVM%E4%B8%ADGC%20Minor-GC%20Major-GC%20Full-GC%E5%8C%BA%E5%88%AB.html</url>
      <content type="html"><![CDATA[<p>JVM中GC Minor-GC Major-GC Full-GC区别</p>
<a id="more"></a>
<p>#JVM 内存分布</p>
<p>JVM堆包含 ，Eden,Survivor,Old 区</p>
<h1 id="Minor-GC"><a href="#Minor-GC" class="headerlink" title="Minor-GC"></a>Minor-GC</h1><p>在Young space(Eden,survivor 区) 中的垃圾回收称为Minor-GC</p>
<blockquote>
<blockquote>
<p>不能为新对象分配空间的时候，Eden区满了，分配空间越快，Minor-GC越频繁<br>当内存池慢了后, 它的完整的内容会被复制出去，指针可以从0开始重新跟踪空闲内存。所以取代传统的标记-交换-压缩（Mark, Sweep , Compact）, Eden区和Survivor区使用标记-复制方式（Mark , Copy）. 因此在Eden区和Survivor区无内存碎片。写指针总是指向内存池的顶部。</p>
<p>在Minor GC时, 年老代（Tenured generation）可以被忽略. 年老代对年轻代的引用被认为是实际的GC根root。 在标记阶段年轻代对年老代的引用可以被简单的忽略。<br>出于常理, 所有的Minor GC都会触发stop-the-world暂停, 它意味着会暂停应用的所有线程. 对于大部分应用而言，暂停的延迟可以忽略不计。这是因为Eden中大部分的对象都可以垃圾回收掉，而不会被复制到Survivor/Old区。但如果相反，大部分的新对象不能被回收， Minor GC暂停会占用更多的时间。</p>
</blockquote>
</blockquote>
<h1 id="Major-GC"><a href="#Major-GC" class="headerlink" title="Major-GC"></a>Major-GC</h1><h2 id="Major-GC-清理年老区（old-space）"><a href="#Major-GC-清理年老区（old-space）" class="headerlink" title="Major GC 清理年老区（old space）"></a>Major GC 清理年老区（old space）</h2><h1 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full-GC"></a>Full-GC</h1><h2 id="清理年轻代，老年代"><a href="#清理年轻代，老年代" class="headerlink" title="清理年轻代，老年代"></a>清理年轻代，老年代</h2>]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
            <tag> jvm </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[JAVA自带的加密算法-MD5\SHA1\BASE64]]></title>
      <url>/java/BASE64.html</url>
      <content type="html"><![CDATA[<p>JAVA自带的加密算法-MD5\SHA1\BASE64<br>引入 commons-codec.jar<br><a id="more"></a></p>
<h1 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String str = &quot;123&quot;;</span><br><span class="line"></span><br><span class="line">DigestUtils.md5Hex(str);</span><br></pre></td></tr></table></figure>
<h1 id="SHA1"><a href="#SHA1" class="headerlink" title="SHA1"></a>SHA1</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String str = &quot;123&quot;;</span><br><span class="line"></span><br><span class="line">DigestUtils.shaHex(str);</span><br></pre></td></tr></table></figure>
<h1 id="BASE64"><a href="#BASE64" class="headerlink" title="BASE64"></a>BASE64</h1><blockquote>
<blockquote>
<p>加密<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String str= &quot;123&quot;;</span><br><span class="line"></span><br><span class="line">byte[] b = Base64.encodeBase64(str.getBytes(), true);</span><br><span class="line"></span><br><span class="line">System.out.println(new String(b));</span><br></pre></td></tr></table></figure></p>
<p>解密<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String  str = &quot;123&quot;;</span><br><span class="line">byte[] b = Base64.decodeBase64(str.getBytes());</span><br><span class="line"></span><br><span class="line">System.out.println(new String(b));</span><br></pre></td></tr></table></figure></p>
</blockquote>
</blockquote>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[java中常见的坑]]></title>
      <url>/java/java%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9D%91.html</url>
      <content type="html"><![CDATA[<p>Java中常见的坑</p>
<h1 id="System-out-println-Object-toString"><a href="#System-out-println-Object-toString" class="headerlink" title="System.out.println( Object.toString )"></a>System.out.println( Object.toString )</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String[] words = &#123; “Hello”, “World” &#125;;</span><br><span class="line">System.out.println(words);</span><br><span class="line"></span><br><span class="line">output: [Ljava.lang.String;@45ee12b7</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>改造</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(Arrays.toString(words));</span><br><span class="line"></span><br><span class="line">output: [Hello, World]</span><br></pre></td></tr></table></figure>
<h1 id="list-toArray-T-array"><a href="#list-toArray-T-array" class="headerlink" title="list.toArray(T[] array)"></a>list.toArray(T[] array)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = new ArrayList&lt;String&gt;(2);</span><br><span class="line">  list.add(&quot;222&quot;); </span><br><span class="line">  list.add(&quot;111&quot;); </span><br><span class="line">  String[] array = new String[list.size()];  #list.size()</span><br><span class="line">  array = list.toArray(array);</span><br></pre></td></tr></table></figure>
<h1 id="不要在foreach循环里进行元素的remove-add操作。remove元素请使用Iterator方式，如果并发操作，需要对Iterator对象加锁。"><a href="#不要在foreach循环里进行元素的remove-add操作。remove元素请使用Iterator方式，如果并发操作，需要对Iterator对象加锁。" class="headerlink" title="不要在foreach循环里进行元素的remove/add操作。remove元素请使用Iterator方式，如果并发操作，需要对Iterator对象加锁。"></a>不要在foreach循环里进行元素的remove/add操作。remove元素请使用Iterator方式，如果并发操作，需要对Iterator对象加锁。</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;String&gt; it = a.iterator(); </span><br><span class="line">  while(it.hasNext()) &#123; </span><br><span class="line">    String temp = it.next(); </span><br><span class="line">    if(删除元素的条件) &#123; </span><br><span class="line">        it.remove(); </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">#加锁</span><br><span class="line"></span><br><span class="line">Map m = Collections.synchronizedMap(new HashMap());</span><br><span class="line">synchronized(m) &#123;</span><br><span class="line">     while(it.hasNext()) &#123; </span><br><span class="line">    String temp = it.next(); </span><br><span class="line">    if(删除元素的条件) &#123; </span><br><span class="line">        it.remove(); </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> 创建线程安全集合</span><br><span class="line"> Collection c=Collections.synchronizedCollection(new ArrayList());</span><br><span class="line"> List list=Collections.synchronizedList(new ArrayList());</span><br><span class="line"> Set s=Collections.synchronizedSet(new HashSet());</span><br><span class="line"> Map m=Collections.synchronizedMap(new HashMap());</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[基于Three.js展示全景图]]></title>
      <url>/%E5%9F%BA%E4%BA%8EThree.js%E5%B1%95%E7%A4%BA%E5%85%A8%E6%99%AF%E5%9B%BE.html</url>
      <content type="html"><![CDATA[<p>基于Three.js展示全景图</p>
<a id="more"></a>
<h1 id="初始化插件-创建PhotoSphereViewer对象"><a href="#初始化插件-创建PhotoSphereViewer对象" class="headerlink" title="初始化插件,创建PhotoSphereViewer对象"></a>初始化插件,创建PhotoSphereViewer对象</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var PSV = new PhotoSphereViewer(&#123;</span><br><span class="line">        // 全景图的完整路径</span><br><span class="line">        panorama: img, </span><br><span class="line">        // 放全景图的元素</span><br><span class="line">        container: div,</span><br><span class="line">        // 可选，默认值为2000，全景图在time_anim毫秒后会自动进行动画。（设置为false禁用它）</span><br><span class="line">        time_anim: false,</span><br><span class="line">		tilt_up_max: 0,</span><br><span class="line">		tilt_down_max: 0,</span><br><span class="line"></span><br><span class="line">        // 可选值，默认为false。显示导航条。</span><br><span class="line">        navbar: true,</span><br><span class="line"></span><br><span class="line">        // 可选，默认值null，全景图容器的最终尺寸。例如：&#123;width: 500, height: 300&#125;。</span><br><span class="line">        size: &#123;</span><br><span class="line">            width: &apos;100%&apos;,</span><br><span class="line">            height: canvasHeight</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h1 id="配置参数备注"><a href="#配置参数备注" class="headerlink" title="配置参数备注"></a>配置参数备注</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">panorama：必填参数，全景图的路径。</span><br><span class="line">container：必填参数，放置全景图的div元素。</span><br><span class="line">autoload：可选，默认值为true，true为自动调用全景图，false为在后面加载全景图(通过.load()方法)。</span><br><span class="line">us empdata：可选，默认值为true，如果Photo Sphere Viewer必须读入XMP数据则为true。</span><br><span class="line">default_position：可选，默认值为&#123;&#125;，定义默认的位置，及用户看见的第一个点，例如：&#123;long: Math.PI, lat: Math.PI/2&#125;。</span><br><span class="line">min_fov：可选，默认值为30，观察的最小区域，单位degrees，在1-179之间。</span><br><span class="line">max_fov：可选，默认值为90，观察的最大区域，单位degrees，在1-179之间。</span><br><span class="line">allow_user_interactions：可选，默认值为true，设置为false则禁止用户和全景图交互(导航条不可用)。</span><br><span class="line">tilt_up_max：可选，默认值为Math.PI/2，向上倾斜的最大角度，单位radians。</span><br><span class="line">tilt_down_max：可选，默认值为Math.PI/2，向下倾斜的最大角度，单位radians。</span><br><span class="line">zoom_level：可选，默认值为0，默认的缩放级别，值在0-100之间。</span><br><span class="line">long_offset：可选，默认值为PI/360，mouse/touch移动时每像素经过的经度值。</span><br><span class="line">lat_offset：可选，默认值为PI/180，mouse/touch移动时每像素经过的纬度值。</span><br><span class="line">time_anim：可选，默认值为2000，全景图在time_anim毫秒后会自动进行动画。(设置为false禁用它)</span><br><span class="line">theta_offset：过时的选项，可选，默认值为1440，自动动画时水平方向的速度。</span><br><span class="line">anim_speed：可选，默认值为2rpm，动画的速度，每秒/分钟多少radians/degrees/revolutions。</span><br><span class="line">navbar：可选值，默认为false。显示导航条。</span><br><span class="line">navbar_style：可选值，默认为&#123;&#125;。导航条的自定义样式。下面是可用的样式列表：</span><br><span class="line">backgroundColor：导航条的背景颜色，默认值为rgba(61, 61, 61, 0.5)。</span><br><span class="line">buttonsColor：按钮的前景颜色，默认值为transparent。</span><br><span class="line">activeButtonsBackgroundColor：按钮激活状态的背景颜色，默认值为rgba(255, 255, 255, 0.1)。</span><br><span class="line">buttonsHeight：按钮的高度，单位像素，默认值为20。</span><br><span class="line">autorotateThickness：autorotate图标的厚度，单位像素，默认值为1。</span><br><span class="line">zoomRangeWidth：缩放的范围，单位显示，默认值50。</span><br><span class="line">zoomRangeThickness：缩放的范围的厚度，单位像素，默认值1。</span><br><span class="line">zoomRangeDisk：缩放范围的圆盘直径，单位像素，默认值为7。</span><br><span class="line">fullscreenRatio：全屏图标的比例，默认值为3/4。</span><br><span class="line">fullscreenThickness：全屏图标的厚度，单位像素，默认值为2。</span><br><span class="line">loading_msg：可选，默认值为Loading…，图片加载时的提示文字。</span><br><span class="line">loading_img：可选，默认值为null，在加载时显示的图片的路径。</span><br><span class="line">size：可选，默认值null，全景图容器的最终尺寸。例如：&#123;width: 500, height: 300&#125;。</span><br><span class="line">onready：可选值，默认值为null。当全景图准备就绪并且第一张图片显示时的回调函数。</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> Three.js </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Three.js </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[spring-boot自义定错误返回页面和json格式]]></title>
      <url>/spring-boot%E8%87%AA%E4%B9%89%E5%AE%9A%E9%94%99%E8%AF%AF%E8%BF%94%E5%9B%9E%E9%A1%B5%E9%9D%A2%E5%92%8Cjson%E6%A0%BC%E5%BC%8F.html</url>
      <content type="html"><![CDATA[<p>springboot发生错误时，在浏览器端访问和用测试接口的软件看到的返回页面是不一样的。</p>
<blockquote>
<p>浏览器端  返回 Whitelabel Error Page页面<br>测试接口的软件返回一个json 字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;timestamp&quot;: 1492063521109,</span><br><span class="line">&quot;status&quot;: 404,</span><br><span class="line">&quot;error&quot;: &quot;Not Found&quot;,</span><br><span class="line">&quot;message&quot;: &quot;No message available&quot;,</span><br><span class="line">&quot;path&quot;: &quot;/test/auth&quot;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<a id="more"></a>
<h1 id="spring根据请求的-produces返回不同值"><a href="#spring根据请求的-produces返回不同值" class="headerlink" title="spring根据请求的 produces返回不同值"></a>spring根据请求的 produces返回不同值</h1><blockquote>
<p>BasicErrorController.java源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(produces = &quot;text/html&quot;) #浏览器访问</span><br><span class="line">public ModelAndView errorHtml(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response) &#123;</span><br><span class="line">		HttpStatus status = getStatus(request);</span><br><span class="line">		Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">				request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">		response.setStatus(status.value());</span><br><span class="line">		ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">		return (modelAndView == null ? new ModelAndView(&quot;error&quot;, model) : modelAndView);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping  #接口测试软件  application/json 默认没写</span><br><span class="line">@ResponseBody</span><br><span class="line">public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">		Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">				isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line">		HttpStatus status = getStatus(request);</span><br><span class="line">		return new ResponseEntity&lt;Map&lt;String, Object&gt;&gt;(body, status);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>@RequestMapping(value = “/produces”, produces = “application/json”)：表示将功能处理方法将生产json格式的数据，此时根据请求头中的Accept进行匹配，如请求头“Accept:application/json”时即可匹配;<br>@RequestMapping(value = “/produces”, produces = “application/xml”)：表示将功能处理方法将生产xml格式的数据，此时根据请求头中的Accept进行匹配，如请求头“Accept:application/xml”时即可匹配。</p>
</blockquote>
<h1 id="自定义浏览器端错误的返回页面"><a href="#自定义浏览器端错误的返回页面" class="headerlink" title="自定义浏览器端错误的返回页面"></a>自定义浏览器端错误的返回页面</h1><h2 id="重写BasicErrorController"><a href="#重写BasicErrorController" class="headerlink" title="重写BasicErrorController"></a>重写BasicErrorController</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class MyErrorController extends BasicErrorController &#123;</span><br><span class="line"></span><br><span class="line">	public MyErrorController(ServerProperties serverProperties) &#123;</span><br><span class="line">		super(new DefaultErrorAttributes(), serverProperties.getError());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) &#123;</span><br><span class="line">		HttpStatus status = getStatus(request);</span><br><span class="line">		response.setStatus(getStatus(request).value());</span><br><span class="line">		Map&lt;String, Object&gt; model = getErrorAttributes(request, isIncludeStackTrace(request, MediaType.TEXT_HTML));</span><br><span class="line">		return new ModelAndView(&quot;error/404.html&quot;, model);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建-src-main-resources-public-error-404-html-页面"><a href="#创建-src-main-resources-public-error-404-html-页面" class="headerlink" title="创建 src/main/resources/public/error/404.html 页面"></a>创建 src/main/resources/public/error/404.html 页面</h2><h1 id="自定义测试软件返回json"><a href="#自定义测试软件返回json" class="headerlink" title="自定义测试软件返回json"></a>自定义测试软件返回json</h1><blockquote>
<p>重写BasicErrorController</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class MyErrorController extends BasicErrorController &#123;</span><br><span class="line"></span><br><span class="line">	public MyErrorController(ServerProperties serverProperties) &#123;</span><br><span class="line">		super(new DefaultErrorAttributes(), serverProperties.getError());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">		Map&lt;String, Object&gt; body = getErrorAttributes(request, isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line">		HttpStatus status = getStatus(request);</span><br><span class="line"></span><br><span class="line">		Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		map.put(&quot;msg&quot;, body.get(&quot;message&quot;));</span><br><span class="line">		map.put(&quot;code&quot;, body.get(&quot;status&quot;));</span><br><span class="line">		map.put(&quot;data&quot;, &quot;&quot;);</span><br><span class="line">		return new ResponseEntity&lt;Map&lt;String, Object&gt;&gt;(map, status);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> springboot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springboot </tag>
            
            <tag> json </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[tomcat启动流程]]></title>
      <url>/tomcat/tomcat%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.html</url>
      <content type="html"><![CDATA[<p>tomcat 启动启动过程分析<br><a id="more"></a></p>
<h1 id="org-apache-catalina-startup-Bootstrap-main"><a href="#org-apache-catalina-startup-Bootstrap-main" class="headerlink" title="org.apache.catalina.startup.Bootstrap.main"></a>org.apache.catalina.startup.Bootstrap.main</h1><blockquote>
<blockquote>
<p>org.apache.catalina.startup.Bootstrap.main 启动的入口方法</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String args[]) &#123;</span><br><span class="line"></span><br><span class="line">     ...</span><br><span class="line">           if (command.equals(&quot;startd&quot;)) &#123;</span><br><span class="line">               args[args.length - 1] = &quot;start&quot;;</span><br><span class="line">               daemon.load(args);</span><br><span class="line">               daemon.start();</span><br><span class="line">           &#125; else if (command.equals(&quot;stopd&quot;)) &#123;</span><br><span class="line">               args[args.length - 1] = &quot;stop&quot;;</span><br><span class="line">               daemon.stop();</span><br><span class="line">           &#125; else if (command.equals(&quot;start&quot;)) &#123;</span><br><span class="line">               daemon.setAwait(true);</span><br><span class="line">               daemon.load(args);</span><br><span class="line">               daemon.start();</span><br><span class="line">           &#125; else if (command.equals(&quot;stop&quot;)) &#123;</span><br><span class="line">               daemon.stopServer(args);</span><br><span class="line">           &#125; else if (command.equals(&quot;configtest&quot;)) &#123;</span><br><span class="line">               daemon.load(args);</span><br><span class="line">               if (null==daemon.getServer()) &#123;</span><br><span class="line">                   System.exit(1);</span><br><span class="line">               &#125;</span><br><span class="line">               System.exit(0);</span><br><span class="line">           &#125; else &#123;</span><br><span class="line">               log.warn(&quot;Bootstrap: command \&quot;&quot; + command + &quot;\&quot; does not exist.&quot;);</span><br><span class="line">           &#125;</span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="main-gt-initClassLoaders"><a href="#main-gt-initClassLoaders" class="headerlink" title="main()-&gt;initClassLoaders()"></a>main()-&gt;initClassLoaders()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">commonLoader = createClassLoader(&quot;common&quot;, null);</span><br><span class="line">#导入源码目录的 D:\apache-tomcat-xxxx-src\lib 的jar</span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; startupClass = catalinaLoader.loadClass(&quot;org.apache.catalina.startup.Catalina&quot;); </span><br><span class="line">#导入 org.apache.catalina.startup.Catalina</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  daemon.setAwait(true);</span><br><span class="line">  daemon.load(args);</span><br><span class="line">  daemon.start();</span><br><span class="line">  daemon 可以看成 org.apache.catalina.startup.Catalina类</span><br></pre></td></tr></table></figure>
<h1 id="org-apache-catalina-startup-Catalina"><a href="#org-apache-catalina-startup-Catalina" class="headerlink" title="org.apache.catalina.startup.Catalina"></a>org.apache.catalina.startup.Catalina</h1><blockquote>
<blockquote>
<p>start()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public void start() &#123;</span><br><span class="line"></span><br><span class="line">		if (getServer() == null) &#123;</span><br><span class="line">			load(); //重点处理server.xml</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	.......</span><br><span class="line">		try &#123;</span><br><span class="line">			getServer().start();</span><br><span class="line">		&#125; catch (LifecycleException e) &#123;</span><br><span class="line">			log.fatal(sm.getString(&quot;catalina.serverStartFail&quot;), e);</span><br><span class="line">			try &#123;</span><br><span class="line">				getServer().destroy();</span><br><span class="line">			&#125; catch (LifecycleException e1) &#123;</span><br><span class="line">				log.debug(&quot;destroy() failed for failed Server &quot;, e1);</span><br><span class="line">			&#125;</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		........</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>load()</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void load() &#123;</span><br><span class="line">.....</span><br><span class="line">Digester digester = createStartDigester(); </span><br><span class="line">.....</span><br><span class="line">getServer().setCatalina(this);</span><br><span class="line">getServer().setCatalinaHome(Bootstrap.getCatalinaHomeFile());</span><br><span class="line">getServer().setCatalinaBase(Bootstrap.getCatalinaBaseFile());</span><br><span class="line">#设置 catalina.home、catalina.base</span><br><span class="line">.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>createStartDigester() 加载解析server.xml</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// Add RuleSets for nested elements</span><br><span class="line">		digester.addRuleSet(new NamingRuleSet(&quot;Server/GlobalNamingResources/&quot;));</span><br><span class="line">		digester.addRuleSet(new EngineRuleSet(&quot;Server/Service/&quot;));</span><br><span class="line">		digester.addRuleSet(new HostRuleSet(&quot;Server/Service/Engine/&quot;));</span><br><span class="line">		digester.addRuleSet(new ContextRuleSet(&quot;Server/Service/Engine/Host/&quot;));</span><br><span class="line">		addClusterRuleSet(digester, &quot;Server/Service/Engine/Host/Cluster/&quot;);</span><br><span class="line">		digester.addRuleSet(new NamingRuleSet(&quot;Server/Service/Engine/Host/Context/&quot;));</span><br><span class="line"></span><br><span class="line">		// When the &apos;engine&apos; is found, set the parentClassLoader.</span><br><span class="line">		digester.addRule(&quot;Server/Service/Engine&quot;, new SetParentClassLoaderRule(parentClassLoader));</span><br><span class="line">		addClusterRuleSet(digester, &quot;Server/Service/Engine/Cluster/&quot;);</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>Catalina.java 创建 server service engine 添加监听器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Add RuleSets for nested elements</span><br><span class="line">		digester.addRuleSet(new NamingRuleSet(&quot;Server/GlobalNamingResources/&quot;));</span><br><span class="line">		digester.addRuleSet(new EngineRuleSet(&quot;Server/Service/&quot;));</span><br><span class="line">		digester.addRuleSet(new HostRuleSet(&quot;Server/Service/Engine/&quot;));</span><br><span class="line">		digester.addRuleSet(new ContextRuleSet(&quot;Server/Service/Engine/Host/&quot;));</span><br><span class="line">		addClusterRuleSet(digester, &quot;Server/Service/Engine/Host/Cluster/&quot;);</span><br><span class="line">		digester.addRuleSet(new NamingRuleSet(&quot;Server/Service/Engine/Host/Context/&quot;));</span><br></pre></td></tr></table></figure></p>
</blockquote>
</blockquote>
<h1 id="Server的启动过程"><a href="#Server的启动过程" class="headerlink" title="Server的启动过程"></a>Server的启动过程</h1><blockquote>
<blockquote>
<p>Server 的默认实现是 org.apache.catalina.core.StandardServer，StandardServer 继承自 LifecycleMBeanBase，LifecycleMBeanBase又继承自 LifecycleBase。 init 和 start 方法就定义在 LifecycleBase 中，LifecycleBase 里的init和start方法又调用initInternal和startInternal方法，这两个方法都是模板方法有子类实现。所以 StandardServer 执行  initInternal 和 startInternal 方法。<br>同时 init 和 start 方法分别循环调用了每个Service的 init 和 start 方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">org.apache.catalina.core.StandardServer</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">	protected void startInternal() throws LifecycleException &#123;</span><br><span class="line">		System.err.println(&quot;startInternal\n&quot;);</span><br><span class="line">		fireLifecycleEvent(CONFIGURE_START_EVENT, null);</span><br><span class="line">		setState(LifecycleState.STARTING);</span><br><span class="line"></span><br><span class="line">		globalNamingResources.start();</span><br><span class="line"></span><br><span class="line">		// Start our defined Services</span><br><span class="line">		synchronized (servicesLock) &#123;</span><br><span class="line">			for (int i = 0; i &lt; services.length; i++) &#123;</span><br><span class="line">				services[i].start(); //启动service</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
</blockquote>
<h1 id="Service-的启动过程"><a href="#Service-的启动过程" class="headerlink" title="Service 的启动过程"></a>Service 的启动过程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">org.apache.catalina.core.StandardService</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">	protected void startInternal() throws LifecycleException &#123;</span><br><span class="line"></span><br><span class="line">		if (log.isInfoEnabled())</span><br><span class="line">			log.info(sm.getString(&quot;standardService.start.name&quot;, this.name));</span><br><span class="line">		setState(LifecycleState.STARTING);</span><br><span class="line"></span><br><span class="line">		// Start our defined Container first</span><br><span class="line">		if (engine != null) &#123;</span><br><span class="line">			synchronized (engine) &#123;</span><br><span class="line">				engine.start();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		synchronized (executors) &#123;</span><br><span class="line">			for (Executor executor : executors) &#123;</span><br><span class="line">				executor.start();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		mapperListener.start();</span><br><span class="line"></span><br><span class="line">		// Start our defined Connectors second</span><br><span class="line">		synchronized (connectorsLock) &#123;</span><br><span class="line">			for (Connector connector : connectors) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					// If it has already failed, don&apos;t try and start it</span><br><span class="line">					if (connector.getState() != LifecycleState.FAILED) &#123;</span><br><span class="line">						connector.start();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; catch (Exception e) &#123;</span><br><span class="line">					log.error(sm.getString(&quot;standardService.connector.startFailed&quot;, connector), e);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Engine-的启动"><a href="#Engine-的启动" class="headerlink" title="Engine 的启动"></a>Engine 的启动</h1><blockquote>
<blockquote>
<p>org.apache.catalina.core.StandardEngine<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Override</span><br><span class="line">   protected synchronized void startInternal() throws LifecycleException &#123;</span><br><span class="line"></span><br><span class="line">       // Log our server identification information</span><br><span class="line">       if(log.isInfoEnabled())</span><br><span class="line">           log.info( &quot;Starting Servlet Engine: &quot; + ServerInfo.getServerInfo());</span><br><span class="line"></span><br><span class="line">       // Standard container startup</span><br><span class="line">       super.startInternal(); #调用父类方法</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p> org.apache.catalina.core.ContainerBase<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected synchronized void startInternal() throws LifecycleException &#123;</span><br><span class="line"></span><br><span class="line">        // Start our subordinate components, if any</span><br><span class="line">        logger = null;</span><br><span class="line">        getLogger();</span><br><span class="line">        Cluster cluster = getClusterInternal();</span><br><span class="line">        if (cluster instanceof Lifecycle) &#123;</span><br><span class="line">            ((Lifecycle) cluster).start();</span><br><span class="line">        &#125;</span><br><span class="line">        Realm realm = getRealmInternal();</span><br><span class="line">        if (realm instanceof Lifecycle) &#123;</span><br><span class="line">            ((Lifecycle) realm).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Start our child containers, if any</span><br><span class="line">        Container children[] = findChildren();</span><br><span class="line">        List&lt;Future&lt;Void&gt;&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        for (int i = 0; i &lt; children.length; i++) &#123;</span><br><span class="line">            results.add(startStopExecutor.submit(new StartChild(children[i])));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        boolean fail = false;</span><br><span class="line">        for (Future&lt;Void&gt; result : results) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                result.get();</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                log.error(sm.getString(&quot;containerBase.threadedStartFailed&quot;), e);</span><br><span class="line">                fail = true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        if (fail) &#123;</span><br><span class="line">            throw new LifecycleException(</span><br><span class="line">                    sm.getString(&quot;containerBase.threadedStartFailed&quot;));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Start the Valves in our pipeline (including the basic), if any</span><br><span class="line">        if (pipeline instanceof Lifecycle)</span><br><span class="line">            ((Lifecycle) pipeline).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        setState(LifecycleState.STARTING);</span><br><span class="line"></span><br><span class="line">        // Start our thread</span><br><span class="line">        threadStart(); #转Context 启动</span><br></pre></td></tr></table></figure></p>
</blockquote>
</blockquote>
<h1 id="Context-启动"><a href="#Context-启动" class="headerlink" title="Context 启动"></a>Context 启动</h1><blockquote>
<blockquote>
<p>threadStart(); </p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  protected void threadStart() &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">        thread = new Thread(new ContainerBackgroundProcessor(), threadName);</span><br><span class="line">        thread.setDaemon(true);</span><br><span class="line">        thread.start(); </span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">protected class ContainerBackgroundProcessor implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">       @Override</span><br><span class="line">       public void run() &#123;</span><br><span class="line">        ...</span><br><span class="line">                processChildren(ContainerBase.this);</span><br><span class="line">        ...</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>org.apache.catalina.core.ContainerBase.ContainerBackgroundProcessor.processChildren(Container)</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">protected void processChildren(Container container) &#123;</span><br><span class="line">         ...</span><br><span class="line">               container.backgroundProcess();</span><br><span class="line">        ...   </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>org.apache.catalina.core.StandardContext.backgroundProcess()</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void backgroundProcess() &#123;</span><br><span class="line"></span><br><span class="line">       ...</span><br><span class="line">	super.backgroundProcess();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>org.apache.catalina.core.ContainerBase.backgroundProcess()</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void backgroundProcess() &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    fireLifecycleEvent(Lifecycle.PERIODIC_EVENT, null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(String, Object)</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected void fireLifecycleEvent(String type, Object data) &#123;</span><br><span class="line">		LifecycleEvent event = new LifecycleEvent(this, type, data);</span><br><span class="line">		for (LifecycleListener listener : lifecycleListeners) &#123;</span><br><span class="line">			listener.lifecycleEvent(event);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	# 此时 listener 为org.apache.catalina.startup.HostConfig</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>org.apache.catalina.startup.HostConfig.lifecycleEvent(LifecycleEvent)</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">check();</span><br><span class="line"></span><br><span class="line">deployApps(); # 部署webapps 下的应用</span><br><span class="line"></span><br><span class="line">protected void deployApps() &#123;</span><br><span class="line"></span><br><span class="line">        File appBase = host.getAppBaseFile();</span><br><span class="line">        File configBase = host.getConfigBaseFile();</span><br><span class="line">        String[] filteredAppPaths = filterAppPaths(appBase.list());</span><br><span class="line">        // Deploy XML descriptors from configBase</span><br><span class="line">        deployDescriptors(configBase, configBase.list());</span><br><span class="line">        // Deploy WARs</span><br><span class="line">        deployWARs(appBase, filteredAppPaths);</span><br><span class="line">        // Deploy expanded folders</span><br><span class="line">        deployDirectories(appBase, filteredAppPaths);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>org.apache.catalina.startup.HostConfig.createDigester(String)</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">protected static Digester createDigester(String contextClassName) &#123;</span><br><span class="line">#contextClassName= org.apache.catalina.core.StandardContext</span><br><span class="line">       Digester digester = new Digester();</span><br><span class="line">       digester.setValidating(false);</span><br><span class="line">       // Add object creation rule</span><br><span class="line">       digester.addObjectCreate(&quot;Context&quot;, contextClassName, &quot;className&quot;);</span><br><span class="line">       // Set the properties on that object (it doesn&apos;t matter if extra</span><br><span class="line">       // properties are set)</span><br><span class="line">       digester.addSetProperties(&quot;Context&quot;);</span><br><span class="line">       return (digester);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<blockquote>
<p>org.apache.catalina.startup.ContextConfig监听StandardContext的事件</p>
<blockquote>
<p>调用 org.apache.catalina.core.StandardContext.startInternal()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected synchronized void startInternal() throws LifecycleException &#123; </span><br><span class="line">       ......</span><br><span class="line">       fireLifecycleEvent(Lifecycle.CONFIGURE_START_EVENT, null); // 解析web.xml的</span><br><span class="line"></span><br><span class="line">       ......</span><br><span class="line"> # 启动web.xml的 listener 例如 ：contextloaderlistener</span><br><span class="line">       if (ok) &#123;</span><br><span class="line">				if (!listenerStart()) &#123;</span><br><span class="line">log.error(sm.getString(&quot;standardContext.listenerFail&quot;));</span><br><span class="line">					ok = false;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">      ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
</blockquote>
<p> org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(String, Object)</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected void fireLifecycleEvent(String type, Object data) &#123;</span><br><span class="line">		LifecycleEvent event = new LifecycleEvent(this, type, data);</span><br><span class="line">		for (LifecycleListener listener : lifecycleListeners) &#123;</span><br><span class="line">			listener.lifecycleEvent(event);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	#此时的listener 为 org.apache.catalina.startup.ContextConfig</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>解析  web.xml org.apache.catalina.startup.ContextConfig.configureStart()</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">protected synchronized void configureStart() &#123;</span><br><span class="line">	</span><br><span class="line">        ...</span><br><span class="line">		webConfig();  #  真正解析 web.xml</span><br><span class="line">		...</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> tomcat </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tomcat </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[springboot过滤器验证token]]></title>
      <url>/spring-boot/spring-token.html</url>
      <content type="html"><![CDATA[<p>springboot过滤器验证token<br><a id="more"></a></p>
<h1 id="token-java"><a href="#token-java" class="headerlink" title="token.java"></a>token.java</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class TokenInterceptor extends HandlerInterceptorAdapter &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private UserService userService;</span><br><span class="line">    @Autowired</span><br><span class="line">    private AdminService adminService;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">        String ip = request.getRemoteAddr();</span><br><span class="line">        String token = request.getHeader(&quot;token&quot;);</span><br><span class="line">        String user = request.getHeader(&quot;userId&quot;);</span><br><span class="line">        if (token == null || user == null) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        Integer userId = Integer.valueOf(user);</span><br><span class="line">        //获取Service实例</span><br><span class="line">        if (userService == null) &#123;</span><br><span class="line">            BeanFactory factory = WebApplicationContextUtils.getRequiredWebApplicationContext(request.getServletContext());</span><br><span class="line">            userService = (UserService) factory.getBean(&quot;userService&quot;);</span><br><span class="line">            adminService = (AdminService) factory.getBean(&quot;adminService&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //增加日活量</span><br><span class="line">        if (ip != null) &#123;</span><br><span class="line">            adminService.addAccessCount(ip);</span><br><span class="line">        &#125;</span><br><span class="line">        String checkToken = userService.selectToken(userId);</span><br><span class="line">        //检查头部请求</span><br><span class="line">        if (!checkToken.equals(token)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> token </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springboot </tag>
            
            <tag> token </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[springboot-Access-Control-Allow-Origin]]></title>
      <url>/spring-boot/spring-boot-Access-Control-Allow-Origin.html</url>
      <content type="html"><![CDATA[<p>springboot 跨域研究</p>
<a id="more"></a>
<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><blockquote>
<p>在前后端开发的模式中，前端通常使用ajax调用后端服务器的接口，常见错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No ‘Access-Control-Allow-Origin’ header is present on the requested resource. Origin ‘http://localhost:8080’ is therefore not allowed access.</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="springboot-解决跨域的方案"><a href="#springboot-解决跨域的方案" class="headerlink" title="springboot 解决跨域的方案"></a>springboot 解决跨域的方案</h1><h2 id="通过UrlBasedCorsConfigurationSource解决"><a href="#通过UrlBasedCorsConfigurationSource解决" class="headerlink" title="通过UrlBasedCorsConfigurationSource解决"></a>通过UrlBasedCorsConfigurationSource解决</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class CorsConfig &#123;</span><br><span class="line">    private CorsConfiguration buildConfig() &#123;</span><br><span class="line">        CorsConfiguration corsConfiguration = new CorsConfiguration();</span><br><span class="line">        corsConfiguration.addAllowedOrigin(&quot;*&quot;); // 1 设置访问源地址</span><br><span class="line">        corsConfiguration.addAllowedHeader(&quot;*&quot;); // 2 设置访问源请求头</span><br><span class="line">        corsConfiguration.addAllowedMethod(&quot;*&quot;); // 3 设置访问源请求方法</span><br><span class="line">        return corsConfiguration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public CorsFilter corsFilter() &#123;</span><br><span class="line">        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();</span><br><span class="line">        source.registerCorsConfiguration(&quot;/**&quot;, buildConfig()); // 4 对接口配置跨域设置</span><br><span class="line">        return new CorsFilter(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="通过拦截器解决"><a href="#通过拦截器解决" class="headerlink" title="通过拦截器解决"></a>通过拦截器解决</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class CORSConfiguration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public WebMvcConfigurer corsConfigurer() &#123;</span><br><span class="line">		return new WebMvcConfigurerAdapter() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">				registry.addMapping(&quot;/**&quot;).allowedHeaders(&quot;*&quot;).allowedMethods(&quot;*&quot;).allowedOrigins(&quot;*&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="通过注解解决"><a href="#通过注解解决" class="headerlink" title="通过注解解决"></a>通过注解解决</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@CrossOrigin(origins = &quot;http://a.com&quot;, maxAge = 3600)</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/account&quot;)</span><br><span class="line">public class AccountController &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    public Account retrieve(@PathVariable Long id) &#123;</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    public void remove(@PathVariable Long id) &#123;</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> springboot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[spring-boot-mybatis-druid整合]]></title>
      <url>/spring-boot-mybatis-druid%E6%95%B4%E5%90%88.html</url>
      <content type="html"><![CDATA[<p>springboot mybatis  druid简单整合</p>
<a id="more"></a>
<h1 id="在eclipse-中创建maven-工程-修改pom-xml-文件"><a href="#在eclipse-中创建maven-工程-修改pom-xml-文件" class="headerlink" title="在eclipse 中创建maven 工程, 修改pom.xml 文件"></a>在eclipse 中创建maven 工程, 修改pom.xml 文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt; </span><br><span class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  </span><br><span class="line">   &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;  </span><br><span class="line">   &lt;version&gt;1.5.8.RELEASE&lt;/version&gt; </span><br><span class="line"> &lt;/parent&gt;  </span><br><span class="line"> &lt;dependencies&gt; </span><br><span class="line">   &lt;dependency&gt; </span><br><span class="line">     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  </span><br><span class="line">     &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; </span><br><span class="line">   &lt;/dependency&gt;  </span><br><span class="line">   &lt;dependency&gt; </span><br><span class="line">     &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line">     &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;  </span><br><span class="line">     &lt;version&gt;1.1.5&lt;/version&gt; </span><br><span class="line">   &lt;/dependency&gt;  </span><br><span class="line">   &lt;dependency&gt; </span><br><span class="line">     &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;  </span><br><span class="line">     &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;  </span><br><span class="line">     &lt;version&gt;1.3.0&lt;/version&gt; </span><br><span class="line">   &lt;/dependency&gt;  </span><br><span class="line">   &lt;dependency&gt; </span><br><span class="line">     &lt;groupId&gt;mysql&lt;/groupId&gt;  </span><br><span class="line">     &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;  </span><br><span class="line">     &lt;scope&gt;runtime&lt;/scope&gt; </span><br><span class="line">   &lt;/dependency&gt; </span><br><span class="line"> &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<h1 id="在-src-main-resources下创建application-properties"><a href="#在-src-main-resources下创建application-properties" class="headerlink" title="在 src/main/resources下创建application.properties"></a>在 src/main/resources下创建application.properties</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server.port=8088</span><br><span class="line">server.session.timeout=10</span><br><span class="line">server.tomcat.uri-encoding=UTF-8</span><br><span class="line"></span><br><span class="line">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/service_data?characterEncoding=utf8</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=root</span><br><span class="line"></span><br><span class="line">#mybatis</span><br><span class="line">mybatis.type-aliases-package=com.we.pojo</span><br><span class="line">mybatis.mapper-locations=classpath*:com/we/mapperxml/*.xml</span><br></pre></td></tr></table></figure>
<h1 id="编写Application-java-类"><a href="#编写Application-java-类" class="headerlink" title="编写Application.java 类"></a>编写Application.java 类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import org.mybatis.spring.annotation.MapperScan;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.context.annotation.ComponentScan;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication()</span><br><span class="line">@ComponentScan(&quot;com.we&quot;) #很重要不配  404 </span><br><span class="line">@MapperScan(value = &quot;com.we.mapper&quot;) #很重要</span><br><span class="line">public class Application &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) throws Exception &#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="编写业务逻辑-启动spring-boot"><a href="#编写业务逻辑-启动spring-boot" class="headerlink" title="编写业务逻辑,启动spring boot"></a>编写业务逻辑,启动spring boot</h1><h1 id="druid-sql-监控功能"><a href="#druid-sql-监控功能" class="headerlink" title="druid sql 监控功能"></a>druid sql 监控功能</h1><blockquote>
<p>项目启动后访问 <a href="http://localhost:8088/druid/" target="_blank" rel="noopener">http://localhost:8088/druid/</a> 可以看见登录界面<br>修改默认访问账号密码<br>新建一个java文件  例如：druidConfig.java</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import com.alibaba.druid.support.http.StatViewServlet;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class druidConfig &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public ServletRegistrationBean druidServlet() &#123;</span><br><span class="line">		ServletRegistrationBean servletRegistrationBean = new ServletRegistrationBean();</span><br><span class="line">		servletRegistrationBean.setServlet(new StatViewServlet());</span><br><span class="line">		servletRegistrationBean.addUrlMappings(&quot;/druid/*&quot;);</span><br><span class="line">		Map&lt;String, String&gt; initParameters = new HashMap&lt;String, String&gt;();</span><br><span class="line">		initParameters.put(&quot;loginUsername&quot;, &quot;admin&quot;); // ++监控页面登录用户名</span><br><span class="line">		initParameters.put(&quot;loginPassword&quot;, &quot;admin&quot;); // ++监控页面登录用户密码</span><br><span class="line">		servletRegistrationBean.setInitParameters(initParameters);</span><br><span class="line">		return servletRegistrationBean;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 这样就可以直接用 admin  admin 进入监控系统</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> springboot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springboot </tag>
            
            <tag> mybatis </tag>
            
            <tag> druid </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[spring-boot-feign伪rpc集成]]></title>
      <url>/spring-boot-feign%E4%BC%AArpc%E9%9B%86%E6%88%90.html</url>
      <content type="html"><![CDATA[<p>Feign使得 Java HTTP 客户端编写更方便。Feign 灵感来源于Retrofit、JAXRS-2.0和WebSocket。Feign最初是为了降低统一绑定Denominator到HTTP API的复杂度，不区分是否支持Restful。Feign旨在通过最少的资源和代码来实现和HTTP API的连接。通过可定制的解码器和错误处理，可以编写任意的HTTP API。可以认为是一种伪RPC。<br><a id="more"></a></p>
<h1 id="和springboot整合"><a href="#和springboot整合" class="headerlink" title="和springboot整合"></a>和springboot整合</h1><blockquote>
<p>pom.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.3.2.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="配置application-properties-文件"><a href="#配置application-properties-文件" class="headerlink" title="配置application.properties 文件"></a>配置application.properties 文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">feign.name=feignName</span><br><span class="line">feign.url=http://localhost:88</span><br><span class="line">feign.client.config.default.loggerLevel = full</span><br><span class="line">feign.connectTimeoutMillis=1000   #连接超时,单位毫秒</span><br><span class="line">feign.readTimeoutMillis=15000     #读超时,单位毫秒</span><br></pre></td></tr></table></figure>
<h1 id="编写feign的-interface"><a href="#编写feign的-interface" class="headerlink" title="编写feign的 interface"></a>编写feign的 interface</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@FeignClient(url = &quot;$&#123;feign.url&#125;&quot;, name = &quot;feign.name&quot;)</span><br><span class="line">public interface testfeign &#123;</span><br><span class="line">	@RequestMapping(value = &quot;/version&quot;, method = RequestMethod.GET)</span><br><span class="line">	public String version();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="在controller-注入上面的-interface"><a href="#在controller-注入上面的-interface" class="headerlink" title="在controller 注入上面的 interface"></a>在controller 注入上面的 interface</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private testfeign stestfeign;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">@RequestMapping(&quot;testfeign&quot;)</span><br><span class="line">	private String pub() &#123;</span><br><span class="line">		return stestfeign.version();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="配置项目启动文件"><a href="#配置项目启动文件" class="headerlink" title="配置项目启动文件"></a>配置项目启动文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">@EnableFeignClients(basePackages = &quot;im.nginx.test&quot;)</span><br><span class="line">#im.nginx.test 为feign interface 文件所在的包</span><br><span class="line">public class Application &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) throws Exception &#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> feign </category>
            
        </categories>
        
        
        <tags>
            
            <tag> springboot </tag>
            
            <tag> feign </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ngx_http_conf_get_module_loc_conf 分析]]></title>
      <url>/ngx_http_conf_get_module_loc_conf.html</url>
      <content type="html"><![CDATA[<p>自定义参数处理函数中会用到ngx_http_conf_get_module_loc_conf(cf, ngx_http_core_module);<br>获取配置块</p>
<a id="more"></a>
<h1 id="ngx-http-conf-get-module-loc-conf"><a href="#ngx-http-conf-get-module-loc-conf" class="headerlink" title="ngx_http_conf_get_module_loc_conf"></a>ngx_http_conf_get_module_loc_conf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define ngx_http_conf_get_module_loc_conf(cf, module)                         \</span><br><span class="line">    ((ngx_http_conf_ctx_t *) cf-&gt;ctx)-&gt;loc_conf[module.ctx_index]</span><br></pre></td></tr></table></figure>
<h1 id="引出loc-conf初始化函数-ngx-http-block"><a href="#引出loc-conf初始化函数-ngx-http-block" class="headerlink" title="引出loc_conf初始化函数 ngx_http_block"></a>引出loc_conf初始化函数 ngx_http_block</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><span class="line">/** </span><br><span class="line"> *ngx_http_commands 命令集的回调函数 </span><br><span class="line"> *HTTP模块初始化的入口函数 </span><br><span class="line"> * </span><br><span class="line"> */  </span><br><span class="line">static char *  </span><br><span class="line">ngx_http_block(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)  </span><br><span class="line">&#123;  </span><br><span class="line">    char                        *rv;  </span><br><span class="line">    ngx_uint_t                   mi, m, s;  </span><br><span class="line">    ngx_conf_t                   pcf;  </span><br><span class="line">    ngx_http_module_t           *module;  </span><br><span class="line">    ngx_http_conf_ctx_t         *ctx;  </span><br><span class="line">    ngx_http_core_loc_conf_t    *clcf;  </span><br><span class="line">    ngx_http_core_srv_conf_t   **cscfp;  </span><br><span class="line">    ngx_http_core_main_conf_t   *cmcf;  </span><br><span class="line">  </span><br><span class="line">    if (*(ngx_http_conf_ctx_t **) conf) &#123;  </span><br><span class="line">        return &quot;is duplicate&quot;;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    /* the main http context */  </span><br><span class="line">  </span><br><span class="line">    /* 分配一块内存，存放http配置上下文 */  </span><br><span class="line">    ctx = ngx_pcalloc(cf-&gt;pool, sizeof(ngx_http_conf_ctx_t));  </span><br><span class="line">    if (ctx == NULL) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    *(ngx_http_conf_ctx_t **) conf = ctx;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    /* count the number of the http modules and set up their indices */  </span><br><span class="line">  </span><br><span class="line">    /* 计算http模块个数 */  </span><br><span class="line">    ngx_http_max_module = ngx_count_modules(cf-&gt;cycle, NGX_HTTP_MODULE);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    /* the http main_conf context, it is the same in the all http contexts */  </span><br><span class="line">  </span><br><span class="line">    /** </span><br><span class="line">     * 最外层的HTTP配置 </span><br><span class="line">     * http </span><br><span class="line">      &#123; </span><br><span class="line">      include       mime.types; </span><br><span class="line">      default_type  application/octet-stream; </span><br><span class="line">     */  </span><br><span class="line">    ctx-&gt;main_conf = ngx_pcalloc(cf-&gt;pool,  </span><br><span class="line">                                 sizeof(void *) * ngx_http_max_module);  </span><br><span class="line">    if (ctx-&gt;main_conf == NULL) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    /* </span><br><span class="line">     * the http null srv_conf context, it is used to merge </span><br><span class="line">     * the server&#123;&#125;s&apos; srv_conf&apos;s </span><br><span class="line">     */  </span><br><span class="line">    /** </span><br><span class="line">     * server层的配置 </span><br><span class="line">     *   server </span><br><span class="line">  &#123; </span><br><span class="line">    listen       80; </span><br><span class="line">    #server_name  blog.s135.com; </span><br><span class="line">    index index.html index.htm index.php; </span><br><span class="line">    root   /home/wwwroot/; </span><br><span class="line">     */  </span><br><span class="line">    ctx-&gt;srv_conf = ngx_pcalloc(cf-&gt;pool, sizeof(void *) * ngx_http_max_module);  </span><br><span class="line">    if (ctx-&gt;srv_conf == NULL) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    /* </span><br><span class="line">     * the http null loc_conf context, it is used to merge </span><br><span class="line">     * the server&#123;&#125;s&apos; loc_conf&apos;s </span><br><span class="line">     */  </span><br><span class="line">  </span><br><span class="line">    /** </span><br><span class="line">     * location 层的配置 </span><br><span class="line">    location ~ .*\.(php|php5)?$ </span><br><span class="line">    &#123; </span><br><span class="line">      #fastcgi_pass  unix:/tmp/php-cgi.sock; </span><br><span class="line">      fastcgi_pass  127.0.0.1:9000; </span><br><span class="line">      fastcgi_index index.php; </span><br><span class="line">      include fcgi.conf; </span><br><span class="line">    &#125; </span><br><span class="line">     */  </span><br><span class="line">    ctx-&gt;loc_conf = ngx_pcalloc(cf-&gt;pool, sizeof(void *) * ngx_http_max_module);  </span><br><span class="line">    if (ctx-&gt;loc_conf == NULL) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    /* </span><br><span class="line">     * create the main_conf&apos;s, the null srv_conf&apos;s, and the null loc_conf&apos;s </span><br><span class="line">     * of the all http modules </span><br><span class="line">     */  </span><br><span class="line">     /** </span><br><span class="line">      * 调用：create_main_conf、create_srv_conf、create_loc_conf </span><br><span class="line">      * 创建配置 </span><br><span class="line">      */  </span><br><span class="line">    for (m = 0; cf-&gt;cycle-&gt;modules[m]; m++) &#123;  </span><br><span class="line">        if (cf-&gt;cycle-&gt;modules[m]-&gt;type != NGX_HTTP_MODULE) &#123;  </span><br><span class="line">            continue;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        module = cf-&gt;cycle-&gt;modules[m]-&gt;ctx;  </span><br><span class="line">        mi = cf-&gt;cycle-&gt;modules[m]-&gt;ctx_index;  </span><br><span class="line">  </span><br><span class="line">        if (module-&gt;create_main_conf) &#123;  </span><br><span class="line">            ctx-&gt;main_conf[mi] = module-&gt;create_main_conf(cf);  </span><br><span class="line">            if (ctx-&gt;main_conf[mi] == NULL) &#123;  </span><br><span class="line">                return NGX_CONF_ERROR;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        if (module-&gt;create_srv_conf) &#123;  </span><br><span class="line">            ctx-&gt;srv_conf[mi] = module-&gt;create_srv_conf(cf);  </span><br><span class="line">            if (ctx-&gt;srv_conf[mi] == NULL) &#123;  </span><br><span class="line">                return NGX_CONF_ERROR;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        if (module-&gt;create_loc_conf) &#123;  </span><br><span class="line">            ctx-&gt;loc_conf[mi] = module-&gt;create_loc_conf(cf);  </span><br><span class="line">            if (ctx-&gt;loc_conf[mi] == NULL) &#123;  </span><br><span class="line">                return NGX_CONF_ERROR;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    pcf = *cf;  </span><br><span class="line">    cf-&gt;ctx = ctx;  </span><br><span class="line">  </span><br><span class="line">    /** </span><br><span class="line">     * preconfiguration 预先初始化配置信息 </span><br><span class="line">     */  </span><br><span class="line">    for (m = 0; cf-&gt;cycle-&gt;modules[m]; m++) &#123;  </span><br><span class="line">        if (cf-&gt;cycle-&gt;modules[m]-&gt;type != NGX_HTTP_MODULE) &#123;  </span><br><span class="line">            continue;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        module = cf-&gt;cycle-&gt;modules[m]-&gt;ctx;  </span><br><span class="line">  </span><br><span class="line">        if (module-&gt;preconfiguration) &#123;  </span><br><span class="line">            if (module-&gt;preconfiguration(cf) != NGX_OK) &#123;  </span><br><span class="line">                return NGX_CONF_ERROR;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    /* parse inside the http&#123;&#125; block */  </span><br><span class="line">  </span><br><span class="line">    cf-&gt;module_type = NGX_HTTP_MODULE;  </span><br><span class="line">    cf-&gt;cmd_type = NGX_HTTP_MAIN_CONF;  </span><br><span class="line">    rv = ngx_conf_parse(cf, NULL);  </span><br><span class="line">  </span><br><span class="line">    if (rv != NGX_CONF_OK) &#123;  </span><br><span class="line">        goto failed;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    /* </span><br><span class="line">     * init http&#123;&#125; main_conf&apos;s, merge the server&#123;&#125;s&apos; srv_conf&apos;s </span><br><span class="line">     * and its location&#123;&#125;s&apos; loc_conf&apos;s </span><br><span class="line">     */  </span><br><span class="line">  </span><br><span class="line">    /** </span><br><span class="line">     * 初始化main配置 </span><br><span class="line">     * 合并 server srv_conf </span><br><span class="line">     * 合并location loc_conf </span><br><span class="line">     */  </span><br><span class="line">    cmcf = ctx-&gt;main_conf[ngx_http_core_module.ctx_index];  </span><br><span class="line">    cscfp = cmcf-&gt;servers.elts;  </span><br><span class="line">  </span><br><span class="line">    for (m = 0; cf-&gt;cycle-&gt;modules[m]; m++) &#123;  </span><br><span class="line">        if (cf-&gt;cycle-&gt;modules[m]-&gt;type != NGX_HTTP_MODULE) &#123;  </span><br><span class="line">            continue;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        module = cf-&gt;cycle-&gt;modules[m]-&gt;ctx;  </span><br><span class="line">        mi = cf-&gt;cycle-&gt;modules[m]-&gt;ctx_index;  </span><br><span class="line">  </span><br><span class="line">        /* init http&#123;&#125; main_conf&apos;s */  </span><br><span class="line">  </span><br><span class="line">        if (module-&gt;init_main_conf) &#123;  </span><br><span class="line">            rv = module-&gt;init_main_conf(cf, ctx-&gt;main_conf[mi]);  </span><br><span class="line">            if (rv != NGX_CONF_OK) &#123;  </span><br><span class="line">                goto failed;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        rv = ngx_http_merge_servers(cf, cmcf, module, mi);  </span><br><span class="line">        if (rv != NGX_CONF_OK) &#123;  </span><br><span class="line">            goto failed;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    /* create location trees */  </span><br><span class="line">  </span><br><span class="line">    /** </span><br><span class="line">     * 创建 location模块的trees </span><br><span class="line">     */  </span><br><span class="line">    for (s = 0; s &lt; cmcf-&gt;servers.nelts; s++) &#123;  </span><br><span class="line">  </span><br><span class="line">        clcf = cscfp[s]-&gt;ctx-&gt;loc_conf[ngx_http_core_module.ctx_index];  </span><br><span class="line">  </span><br><span class="line">        if (ngx_http_init_locations(cf, cscfp[s], clcf) != NGX_OK) &#123;  </span><br><span class="line">            return NGX_CONF_ERROR;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        if (ngx_http_init_static_location_trees(cf, clcf) != NGX_OK) &#123;  </span><br><span class="line">            return NGX_CONF_ERROR;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    if (ngx_http_init_phases(cf, cmcf) != NGX_OK) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    if (ngx_http_init_headers_in_hash(cf, cmcf) != NGX_OK) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    for (m = 0; cf-&gt;cycle-&gt;modules[m]; m++) &#123;  </span><br><span class="line">        if (cf-&gt;cycle-&gt;modules[m]-&gt;type != NGX_HTTP_MODULE) &#123;  </span><br><span class="line">            continue;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        module = cf-&gt;cycle-&gt;modules[m]-&gt;ctx;  </span><br><span class="line">  </span><br><span class="line">        if (module-&gt;postconfiguration) &#123;  </span><br><span class="line">            if (module-&gt;postconfiguration(cf) != NGX_OK) &#123;  </span><br><span class="line">                return NGX_CONF_ERROR;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    if (ngx_http_variables_init_vars(cf) != NGX_OK) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    /* </span><br><span class="line">     * http&#123;&#125;&apos;s cf-&gt;ctx was needed while the configuration merging </span><br><span class="line">     * and in postconfiguration process </span><br><span class="line">     */  </span><br><span class="line">  </span><br><span class="line">    *cf = pcf;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    if (ngx_http_init_phase_handlers(cf, cmcf) != NGX_OK) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    /* optimize the lists of ports, addresses and server names */  </span><br><span class="line">  </span><br><span class="line">    /* ngx_http_optimize_servers 初始化listen 端口号 ip地址 服务器等监听信息*/  </span><br><span class="line">    if (ngx_http_optimize_servers(cf, cmcf, cmcf-&gt;ports) != NGX_OK) &#123;  </span><br><span class="line">        return NGX_CONF_ERROR;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    return NGX_CONF_OK;  </span><br><span class="line">  </span><br><span class="line">failed:  </span><br><span class="line">  </span><br><span class="line">    *cf = pcf;  </span><br><span class="line">  </span><br><span class="line">    return rv;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-conf-ctx-t"><a href="#ngx-http-conf-ctx-t" class="headerlink" title="ngx_http_conf_ctx_t"></a>ngx_http_conf_ctx_t</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef struct &#123;</span><br><span class="line">     void        **main_conf;</span><br><span class="line">     void        **srv_conf;</span><br><span class="line">     void        **loc_conf;</span><br><span class="line"> &#125; ngx_http_conf_ctx_t;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> nginx </category>
            
        </categories>
        
        
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title></title>
      <url>/nginx%E5%B8%B8%E7%94%A8%E5%9F%BA%E6%9C%AC%E5%8F%98%E9%87%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html</url>
      <content type="html"><![CDATA[<p>title: nginx常用基本变量及数据结构<br>tags: [nginx]<br>categories: nginx</p>
<a id="more"></a>
<h1 id="nginx-常用基本变量"><a href="#nginx-常用基本变量" class="headerlink" title="nginx 常用基本变量"></a>nginx 常用基本变量</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef int  ngx_fd_t;</span><br><span class="line">typedef intptr_t        ngx_int_t;</span><br><span class="line">typedef uintptr_t       ngx_uint_t;</span><br><span class="line">typedef intptr_t        ngx_flag_t;</span><br><span class="line">typedef void *          ngx_buf_tag_t;</span><br></pre></td></tr></table></figure>
<h1 id="nginx常用数据结构"><a href="#nginx常用数据结构" class="headerlink" title="nginx常用数据结构"></a>nginx常用数据结构</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> typedef struct &#123;</span><br><span class="line">     size_t      len;</span><br><span class="line">     u_char     *data;</span><br><span class="line">&#125; ngx_str_t;</span><br><span class="line"></span><br><span class="line">typedef struct stat  ngx_file_info_t;</span><br></pre></td></tr></table></figure>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[nginx-location正则表达式匹配规则及动静分离]]></title>
      <url>/nginx-location%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7.html</url>
      <content type="html"><![CDATA[<p>nginx，location常用正则表达式，及nginx动静分离<br><a id="more"></a></p>
<h1 id="nginx匹配规则"><a href="#nginx匹配规则" class="headerlink" title="nginx匹配规则"></a>nginx匹配规则</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~      波浪线表示执行一个正则匹配，区分大小写</span><br><span class="line">~*    表示执行一个正则匹配，不区分大小写</span><br><span class="line">^~     ^~表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配别的选项，一般用来匹配目录</span><br><span class="line">=      进行普通字符精确匹配</span><br><span class="line">@      &quot;@&quot; 定义一个命名的 location，使用在内部定向时，例如 error_page, try_files</span><br><span class="line">!~（!~*） 表示区分大小写不正则匹配和不区分大小写不正则匹配</span><br></pre></td></tr></table></figure>
<h1 id="nginx正则表达式"><a href="#nginx正则表达式" class="headerlink" title="nginx正则表达式"></a>nginx正则表达式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">. ： 匹配除换行符以外的任意字符</span><br><span class="line">? ： 重复0次或1次</span><br><span class="line">+ ： 重复1次或更多次</span><br><span class="line">* ： 重复0次或更多次</span><br><span class="line">\d ：匹配数字</span><br><span class="line">^ ： 匹配字符串的开始</span><br><span class="line">$ ： 匹配字符串的介绍</span><br><span class="line">&#123;n&#125; ： 重复n次</span><br><span class="line">&#123;n,&#125; ： 重复n次或更多次</span><br><span class="line">[c] ： 匹配单个字符c</span><br><span class="line">[a-z] ： 匹配a-z小写字母的任意一个</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong> 当正则表达式中含有 {} 是,必须将 正则表达式用 “” 引起来否则会报错<br>nginx: [emerg] pcre_compile() failed: missing ) in “/one/(\d” in /usr/local/nginx/conf/nginx.conf:56</p>
<p>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#rewrite ^/test/([\d]&#123;3&#125;)/$ /index.php?id=$1 break;  #报错</span><br><span class="line">#修改为</span><br><span class="line">rewrite &quot;^/test/([\d]&#123;3&#125;)/$&quot; /index.php?id=$1 break;</span><br><span class="line"></span><br><span class="line">#本条可以不用引号</span><br><span class="line">rewrite ^/(\d+)/$ /index.php?id=$1 break;</span><br></pre></td></tr></table></figure></p>
<h1 id="动静分离清单"><a href="#动静分离清单" class="headerlink" title="动静分离清单"></a>动静分离清单</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 第一个必选规则</span><br><span class="line">location = / &#123;</span><br><span class="line">    proxy_pass http://127.0.0.1:9000/index</span><br><span class="line">&#125;</span><br><span class="line"># 第二个必选规则是处理静态文件请求，这是nginx作为http服务器的强项</span><br><span class="line"># 有两种配置模式，目录匹配或后缀匹配,任选其一或搭配使用</span><br><span class="line">location ^~ /static/ &#123;</span><br><span class="line">    root /web/static/;</span><br><span class="line">&#125;</span><br><span class="line">location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ &#123;</span><br><span class="line">    root /web/res/;</span><br><span class="line">&#125;</span><br><span class="line">#第三个规则就是通用规则，用来转发动态请求到后端应用服务器</span><br><span class="line">#非静态文件请求就默认是动态请求，自己根据实际把握</span><br><span class="line">#毕竟目前的一些框架的流行，带.php,.jsp后缀的情况很少了</span><br><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://127.0.0.1:9000/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> nginx </category>
            
        </categories>
        
        
        <tags>
            
            <tag> nginx </tag>
            
            <tag> location </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[nginx-if指令与全局变量]]></title>
      <url>/nginx-if%E6%8C%87%E4%BB%A4%E4%B8%8E%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F.html</url>
      <content type="html"><![CDATA[<p>if判断指令<br>语法为if(condition){…}，对给定的条件condition进行判断。如果为真，大括号内的rewrite指令将被执行，if条件(conditon)可以是如下任何内容：</p>
<blockquote>
<p>当表达式只是一个变量时，如果值为空或任何以0开头的字符串都会当做false<br>直接比较变量和内容时，使用=或!=<br>~正则表达式匹配，~*不区分大小写的匹配，!~区分大小写的不匹配</p>
</blockquote>
<a id="more"></a>
<h1 id="if-常用判断"><a href="#if-常用判断" class="headerlink" title="if 常用判断"></a>if 常用判断</h1><p>-f和!-f用来判断是否存在文件<br>-d和!-d用来判断是否存在目录<br>-e和!-e用来判断是否存在文件或目录<br>-x和!-x用来判断文件是否可执行</p>
<h2 id="if应用"><a href="#if应用" class="headerlink" title="if应用"></a>if应用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">if ($http_user_agent ~ MSIE) &#123;</span><br><span class="line">    rewrite ^(.*)$ /msie/$1 break;</span><br><span class="line">&#125; //如果UA包含&quot;MSIE&quot;，rewrite请求到/msid/目录下</span><br><span class="line">if ($http_cookie ~* &quot;id=([^;]+)(?:;|$)&quot;) &#123;</span><br><span class="line">    set $id $1;</span><br><span class="line"> &#125; //如果cookie匹配正则，设置变量$id等于正则引用部分</span><br><span class="line">if ($request_method = POST) &#123;</span><br><span class="line">    return 405;</span><br><span class="line">&#125; //如果提交方法为POST，则返回状态405（Method not allowed）。return不能返回301,302</span><br><span class="line">if ($slow) &#123;</span><br><span class="line">    limit_rate 10k;</span><br><span class="line">&#125; //限速，$slow可以通过 set 指令设置</span><br><span class="line">if (!-f $request_filename)&#123;</span><br><span class="line">    break;</span><br><span class="line">    proxy_pass  http://127.0.0.1;</span><br><span class="line">&#125; //如果请求的文件名不存在，则反向代理到localhost 。这里的break也是停止rewrite检查</span><br><span class="line">if ($args ~ post=140)&#123;</span><br><span class="line">    rewrite ^ http://example.com/ permanent;</span><br><span class="line">&#125; //如果query string中包含&quot;post=140&quot;，永久重定向到example.com</span><br><span class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123;</span><br><span class="line">    valid_referers none blocked www.jefflei.com www.leizhenfang.com;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        return 404;</span><br><span class="line">    &#125; //防盗链</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="nginx-常用全局变量"><a href="#nginx-常用全局变量" class="headerlink" title="nginx 常用全局变量"></a>nginx 常用全局变量</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$args ： #这个变量等于请求行中的参数，同$query_string</span><br><span class="line">$is_args : 如果请求带有参数, 值为 ? 否则为空字符串</span><br><span class="line">$content_length ： 请求头中的Content-length字段。</span><br><span class="line">$content_type ： 请求头中的Content-Type字段。</span><br><span class="line">$document_root ： 当前请求在root指令中指定的值。</span><br><span class="line">$host ： 请求主机头字段，否则为服务器名称。</span><br><span class="line">$http_user_agent ： 客户端agent信息</span><br><span class="line">$http_cookie ： 客户端cookie信息</span><br><span class="line">$limit_rate ： 这个变量可以限制连接速率。</span><br><span class="line">$request_method ： 客户端请求的动作，通常为GET或POST。</span><br><span class="line">$remote_addr ： 客户端的IP地址。</span><br><span class="line">$remote_port ： 客户端的端口。</span><br><span class="line">$remote_user ： 已经经过Auth Basic Module验证的用户名。</span><br><span class="line">$request_filename ： 当前请求的文件路径，由root或alias指令与URI请求生成。</span><br><span class="line">$scheme ： HTTP方法（如http，https）。</span><br><span class="line">$server_protocol ： 请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</span><br><span class="line">$server_addr ： 服务器地址，在完成一次系统调用后可以确定这个值。</span><br><span class="line">$server_name ： 服务器名称。</span><br><span class="line">$server_port ： 请求到达服务器的端口号。</span><br><span class="line">$request_uri ： 包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。</span><br><span class="line">$uri ： 不带请求参数的当前URI，$uri不包含主机名，如”/foo/bar.html”。</span><br><span class="line">$document_uri ： 与$uri相同。</span><br><span class="line">$nginx_version： 当前nginx版本</span><br><span class="line">$request: 原始请求 GET /one/2222 HTTP/1.1</span><br><span class="line">$status:  响应状态码</span><br><span class="line">$http_referer: url跳转来源</span><br><span class="line">$request_body : 客户端请求主体</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> nginx </category>
            
        </categories>
        
        
        <tags>
            
            <tag> nginx </tag>
            
            <tag> if </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[nginx-args-query-string-uri详解]]></title>
      <url>/nginx-args-query-string-uri%E8%AF%A6%E8%A7%A3.html</url>
      <content type="html"><![CDATA[<p>Nginx 中常见和url操作相关的变量</p>
<blockquote>
<p>$args<br>$query_string<br>$request_uri<br>$uri<br>$document_uri</p>
</blockquote>
<p>以上变量有什么联系和区别呢?</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">url:  http://nginx.im/nginx/im/?page=1</span><br><span class="line">$args -&gt;    page=1</span><br><span class="line">$query_string -&gt; page=1</span><br><span class="line">$request_uri  -&gt; /nginx/im/?page=1</span><br><span class="line">$uri       -&gt;  /nginx/im</span><br><span class="line">$document_uri -&gt; /nginx/im</span><br><span class="line">**总结**</span><br><span class="line">$args &lt;=&gt; $query_string 获取？后面的参数</span><br><span class="line">$request_uri  获取除了host 之外所有的</span><br><span class="line">$uri &lt;=&gt; $cocuemnt_uri 获取请求路径</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> nginx </category>
            
        </categories>
        
        
        <tags>
            
            <tag> nginx </tag>
            
            <tag> uri </tag>
            
            <tag> query_string </tag>
            
            <tag> request_uri </tag>
            
            <tag> document_uri </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[JSON字符串转换为Map]]></title>
      <url>/json/fastjson.html</url>
      <content type="html"><![CDATA[<p>JSON字符串转换为Map<br><a id="more"></a></p>
<h1 id="fastjson"><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package com.zkn.newlearn.json;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class JsonToMapTest01 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">        String str = &quot;&#123;\&quot;0\&quot;:\&quot;zhangsan\&quot;,\&quot;1\&quot;:\&quot;lisi\&quot;,\&quot;2\&quot;:\&quot;wangwu\&quot;,\&quot;3\&quot;:\&quot;maliu\&quot;&#125;&quot;;</span><br><span class="line">        //第一种方式</span><br><span class="line">        Map maps = (Map)JSON.parse(str);</span><br><span class="line">        System.out.println(&quot;这个是用JSON类来解析JSON字符串!!!&quot;);</span><br><span class="line">        for (Object map : maps.entrySet())&#123;</span><br><span class="line">            System.out.println(((Map.Entry)map).getKey()+&quot;     &quot; + ((Map.Entry)map).getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        //第二种方式</span><br><span class="line">        Map mapTypes = JSON.parseObject(str);</span><br><span class="line">        System.out.println(&quot;这个是用JSON类的parseObject来解析JSON字符串!!!&quot;);</span><br><span class="line">        for (Object obj : mapTypes.keySet())&#123;</span><br><span class="line">            System.out.println(&quot;key为：&quot;+obj+&quot;值为：&quot;+mapTypes.get(obj));</span><br><span class="line">        &#125;</span><br><span class="line">        //第三种方式</span><br><span class="line">        Map mapType = JSON.parseObject(str,Map.class);</span><br><span class="line">        System.out.println(&quot;这个是用JSON类,指定解析类型，来解析JSON字符串!!!&quot;);</span><br><span class="line">        for (Object obj : mapType.keySet())&#123;</span><br><span class="line">            System.out.println(&quot;key为：&quot;+obj+&quot;值为：&quot;+mapType.get(obj));</span><br><span class="line">        &#125;</span><br><span class="line">        //第四种方式</span><br><span class="line">        /**</span><br><span class="line">         * JSONObject是Map接口的一个实现类</span><br><span class="line">         */</span><br><span class="line">        Map json = (Map) JSONObject.parse(str);</span><br><span class="line">        System.out.println(&quot;这个是用JSONObject类的parse方法来解析JSON字符串!!!&quot;);</span><br><span class="line">        for (Object map : json.entrySet())&#123;</span><br><span class="line">            System.out.println(((Map.Entry)map).getKey()+&quot;  &quot;+((Map.Entry)map).getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        //第五种方式</span><br><span class="line">        /**</span><br><span class="line">         * JSONObject是Map接口的一个实现类</span><br><span class="line">         */</span><br><span class="line">        JSONObject jsonObject = JSONObject.parseObject(str);</span><br><span class="line">        System.out.println(&quot;这个是用JSONObject的parseObject方法来解析JSON字符串!!!&quot;);</span><br><span class="line">        for (Object map : json.entrySet())&#123;</span><br><span class="line">            System.out.println(((Map.Entry)map).getKey()+&quot;  &quot;+((Map.Entry)map).getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        //第六种方式</span><br><span class="line">        /**</span><br><span class="line">         * JSONObject是Map接口的一个实现类</span><br><span class="line">         */</span><br><span class="line">        Map mapObj = JSONObject.parseObject(str,Map.class);</span><br><span class="line">        System.out.println(&quot;这个是用JSONObject的parseObject方法并执行返回类型来解析JSON字符串!!!&quot;);</span><br><span class="line">        for (Object map: json.entrySet())&#123;</span><br><span class="line">            System.out.println(((Map.Entry)map).getKey()+&quot;  &quot;+((Map.Entry)map).getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        String strArr = &quot;&#123;&#123;\&quot;0\&quot;:\&quot;zhangsan\&quot;,\&quot;1\&quot;:\&quot;lisi\&quot;,\&quot;2\&quot;:\&quot;wangwu\&quot;,\&quot;3\&quot;:\&quot;maliu\&quot;&#125;,&quot; +</span><br><span class="line">                &quot;&#123;\&quot;00\&quot;:\&quot;zhangsan\&quot;,\&quot;11\&quot;:\&quot;lisi\&quot;,\&quot;22\&quot;:\&quot;wangwu\&quot;,\&quot;33\&quot;:\&quot;maliu\&quot;&#125;&#125;&quot;;</span><br><span class="line">       // JSONArray.parse()</span><br><span class="line">        System.out.println(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> json </category>
            
        </categories>
        
        
        <tags>
            
            <tag> fastjson </tag>
            
            <tag> json </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[java排列组合随机字符串应用]]></title>
      <url>/java%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88%E5%BA%94%E7%94%A8.html</url>
      <content type="html"><![CDATA[<p>已知固定长度的字符串字典</p>
<blockquote>
<p>ABCDEFGHIJKLMNOPQRSTUVWXYZ</p>
</blockquote>
<p>按字典序输出固定随机字符串</p>
<a id="more"></a>
<h1 id="直接上代码"><a href="#直接上代码" class="headerlink" title="直接上代码"></a>直接上代码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public static String randomChar(String dict, String pre, Integer len) &#123;</span><br><span class="line"></span><br><span class="line">		Integer dictLen = dict.length() - 1;</span><br><span class="line">		char[] preChar = pre.toCharArray();</span><br><span class="line">		char[] chArray = new char[len];</span><br><span class="line">		char achar = preChar[len - 1];</span><br><span class="line">		Integer preCharIndex = dict.indexOf(achar);</span><br><span class="line">		if ((preCharIndex + 1) &gt; dictLen) &#123;</span><br><span class="line">			chArray[len - 1] = dict.charAt(0);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			chArray[len - 1] = dict.charAt(preCharIndex + 1);</span><br><span class="line">		&#125;</span><br><span class="line">		for (int i = len - 2; i &gt;= 0; i--) &#123;</span><br><span class="line">			Integer preCharIndex1 = dict.indexOf(preChar[i + 1]); // 25</span><br><span class="line">			Integer preCharIndex2 = dict.indexOf(chArray[i + 1]); // 0</span><br><span class="line">			Integer preCharIndex3 = dict.indexOf(preChar[i]); //</span><br><span class="line">			if (Math.abs(preCharIndex1 - preCharIndex2) &gt; 1) &#123;</span><br><span class="line">				if (preCharIndex3 + 1 &gt; dictLen) &#123;</span><br><span class="line">					chArray[i] = dict.charAt(0);</span><br><span class="line">					continue;</span><br><span class="line">				&#125;</span><br><span class="line">				chArray[i] = dict.charAt(preCharIndex3 + 1);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				chArray[i] = preChar[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return new String(chArray);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
            <tag> 随机字符串 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[java常用的一些代码片段]]></title>
      <url>/java%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81.html</url>
      <content type="html"><![CDATA[<p>收集整理java开放中常用的一些代码片段（长期更新）</p>
<a id="more"></a>
<blockquote>
<p>字符串翻转</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static String reverse(String str)&#123;  </span><br><span class="line">        return new StringBuilder(str).reverse().toString();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>spring 中读取 src/main/resource 下的文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void testClassPathResource() throws IOException &#123;</span><br><span class="line">    Resource res = new      ClassPathResource(&quot;resource/ApplicationContext.xml&quot;);</span><br><span class="line">   InputStream input = res.getInputStream();</span><br><span class="line">   Assert.assertNotNull(input);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File file = ResourceUtils.getFile(&quot;classpath:doc&quot;);</span><br><span class="line">str = FileUtils.readFileToString(file, &quot;utf-8&quot;);</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
            <tag> java常用代码 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[java-zip压缩单文件]]></title>
      <url>/java-zip%E5%8E%8B%E7%BC%A9%E5%8D%95%E6%96%87%E4%BB%B6.html</url>
      <content type="html"><![CDATA[<p>java开发中经常用到压缩文件,在JDK中自带zip 压缩相关的类</p>
<blockquote>
<p>ZipOutputStream<br>ZipEntry</p>
<blockquote>
<p>在压缩文件中，每一个压缩的内容都可以用一个ZipEntry 表示，所以在进行压缩之前必须通过putNextEntry 设置一个ZipEntry 即可。</p>
</blockquote>
</blockquote>
<a id="more"></a>
<h1 id="单文件压缩"><a href="#单文件压缩" class="headerlink" title="单文件压缩"></a>单文件压缩</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># in为原始文件的绝对路径</span><br><span class="line">public static void zip(String in) throws Exception &#123;</span><br><span class="line">		File file = new File(in);</span><br><span class="line">		File zipFile = new File(in + &quot;.zip&quot;);</span><br><span class="line">		InputStream input = new FileInputStream(file);</span><br><span class="line">		ZipOutputStream zipOut = null;</span><br><span class="line">		zipOut = new ZipOutputStream(new FileOutputStream(zipFile));</span><br><span class="line">		zipOut.putNextEntry(new ZipEntry(file.getName()));</span><br><span class="line">		zipOut.setComment(&quot;这是一个压缩文件&quot;);</span><br><span class="line">		int temp = 0;</span><br><span class="line">		while ((temp = input.read()) != -1) &#123;</span><br><span class="line">			zipOut.write(temp);</span><br><span class="line">		&#125;</span><br><span class="line">		input.close();</span><br><span class="line">		zipOut.close();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
            <tag> zip </tag>
            
            <tag> ZipInputStream </tag>
            
            <tag> ZipFile </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[fastjson解析json字符串]]></title>
      <url>/fastjson%E8%A7%A3%E6%9E%90json%E5%AD%97%E7%AC%A6%E4%B8%B2.html</url>
      <content type="html"><![CDATA[<p>在微服务开发过程中,常要解析json 字符串, 用fastjson解析json 字符串</p>
<a id="more"></a>
<h1 id="获取单个value值"><a href="#获取单个value值" class="headerlink" title="获取单个value值"></a>获取单个value值</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String str = &quot;&#123;\&quot;msg\&quot;:\&quot;111\&quot;,\&quot;code\&quot;:200,\&quot;data\&quot;:&#123;\&quot;total\&quot;:15,\&quot;pages\&quot;:8,\&quot;list\&quot;:[&#123;\&quot;actid\&quot;:1,\&quot;name\&quot;:\&quot;1\&quot;,\&quot;userid\&quot;:1,\&quot;acttype\&quot;:true,\&quot;actbegintime\&quot;:1,\&quot;actendtime\&quot;:1,\&quot;ext\&quot;:\&quot;1\&quot;,\&quot;isactive\&quot;:true,\&quot;remark\&quot;:\&quot;1\&quot;&#125;,&#123;\&quot;actid\&quot;:1,\&quot;name\&quot;:\&quot;1\&quot;,\&quot;userid\&quot;:1,\&quot;acttype\&quot;:true,\&quot;actbegintime\&quot;:1,\&quot;actendtime\&quot;:1,\&quot;ext\&quot;:\&quot;1\&quot;,\&quot;isactive\&quot;:true,\&quot;remark\&quot;:\&quot;1\&quot;&#125;],\&quot;pageNum\&quot;:1&#125;&#125;&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public static Object test(String str, String key) &#123;</span><br><span class="line">		Map mapTypes = JSON.parseObject(str);</span><br><span class="line">		Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		return ((JSONObject) mapTypes).getString(key);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="如果json字符串是一个json数组"><a href="#如果json字符串是一个json数组" class="headerlink" title="如果json字符串是一个json数组"></a>如果json字符串是一个json数组</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public static List&lt;Map&lt;String, Object&gt;&gt; GetJsonList(String str) &#123;</span><br><span class="line">		List&lt;Map&lt;String, Object&gt;&gt; retmap = JSON.parseObject(str, new TypeReference&lt;List&lt;Map&lt;String, Object&gt;&gt;&gt;() &#123;</span><br><span class="line">		&#125;);</span><br><span class="line">		return retmap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> json </category>
            
        </categories>
        
        
        <tags>
            
            <tag> fastjson </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[error-assignment-to-expression-with-array-type-error]]></title>
      <url>/error-assignment-to-expression-with-array-type-error.html</url>
      <content type="html"><![CDATA[<p>在结构体赋值操作中，编译器报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: assignment to expression with array type error</span><br></pre></td></tr></table></figure></p>
<p>如何才能避免这种错误呢？<br><a id="more"></a></p>
<h1 id="代码现场"><a href="#代码现场" class="headerlink" title="代码现场"></a>代码现场</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">struct test</span><br><span class="line">&#123;</span><br><span class="line">        int a;</span><br><span class="line">        int b;</span><br><span class="line">        char ss[10];</span><br><span class="line">&#125;;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">        struct test t1;</span><br><span class="line">        t1.a=10;</span><br><span class="line">        t1.b=20;</span><br><span class="line">        t1.ss=&quot;1111111&quot;; # 编译器报错</span><br><span class="line">        printf(&quot;%d, %d, %s\n&quot;, t1.a, t1.b, t1.ss);</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="把一个字符串赋值给一个字符数组？"><a href="#把一个字符串赋值给一个字符数组？" class="headerlink" title="把一个字符串赋值给一个字符数组？"></a>把一个字符串赋值给一个字符数组？</h2><p>如果我们这样做<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">        char s[10]=&quot;ssssss&quot;;</span><br><span class="line">        printf(&quot;%s\n&quot;,s);</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>程序能完美运行。为什么在结构体中是不行的？</p>
<blockquote>
<p>C语言只有在定义字符数组的时候才能用“=”来初始化变量，其它情况下是不能直接用“=”来为字符数组赋值的，<br>结构体中数组成员ss表示数组名，是一个指针，具有常量特性，表示数组存储空间的开始地址，而C语言中不能对常量赋值。</p>
</blockquote>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><blockquote>
<p>声明字符串时直接赋值<br>用scanf函数给字符串输入值<br>用strcpy函数给字符串赋值</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strcpy(t1.ss,&quot;1111111&quot;);</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> c </category>
            
        </categories>
        
        
        <tags>
            
            <tag> struct </tag>
            
            <tag> c </tag>
            
            <tag> 结构体 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[nginx启动流程]]></title>
      <url>/Nginx%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.html</url>
      <content type="html"><![CDATA[<p>nginx启动流程，从main函数开始,一个重要的结构体ngx_cycle_s</p>
<a id="more"></a>
<h1 id="ngx-cycle-s"><a href="#ngx-cycle-s" class="headerlink" title="ngx_cycle_s"></a>ngx_cycle_s</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">0038 struct ngx_cycle_s &#123;</span><br><span class="line">0039     void                  ****conf_ctx;</span><br><span class="line">0040     ngx_pool_t               *pool;</span><br><span class="line">0041 </span><br><span class="line">0042     ngx_log_t                *log;</span><br><span class="line">0043     ngx_log_t                 new_log;</span><br><span class="line">0044 </span><br><span class="line">0045     ngx_uint_t                log_use_stderr;  /* unsigned  log_use_stderr:1; */</span><br><span class="line">0046 </span><br><span class="line">0047     ngx_connection_t        **files;</span><br><span class="line">0048     ngx_connection_t         *free_connections;</span><br><span class="line">0049     ngx_uint_t                free_connection_n;</span><br><span class="line">0050 </span><br><span class="line">0051     ngx_module_t            **modules;</span><br><span class="line">0052     ngx_uint_t                modules_n;</span><br><span class="line">0053     ngx_uint_t                modules_used;    /* unsigned  modules_used:1; */</span><br><span class="line">0054 </span><br><span class="line">0055     ngx_queue_t               reusable_connections_queue;</span><br><span class="line">0056     ngx_uint_t                reusable_connections_n;</span><br><span class="line">0057 </span><br><span class="line">0058     ngx_array_t               listening;</span><br><span class="line">0059     ngx_array_t               paths;</span><br><span class="line">0060 </span><br><span class="line">0061     ngx_array_t               config_dump;</span><br><span class="line">0062     ngx_rbtree_t              config_dump_rbtree;</span><br><span class="line">0063     ngx_rbtree_node_t         config_dump_sentinel;</span><br><span class="line">0064 </span><br><span class="line">0065     ngx_list_t                open_files;</span><br><span class="line">0066     ngx_list_t                shared_memory;</span><br><span class="line">0067 </span><br><span class="line">0068     ngx_uint_t                connection_n;</span><br><span class="line">0069     ngx_uint_t                files_n;</span><br><span class="line">0070 </span><br><span class="line">0071     ngx_connection_t         *connections;</span><br><span class="line">0072     ngx_event_t              *read_events;</span><br><span class="line">0073     ngx_event_t              *write_events;</span><br><span class="line">0074 </span><br><span class="line">0075     ngx_cycle_t              *old_cycle;</span><br><span class="line">0076 </span><br><span class="line">0077     ngx_str_t                 conf_file;</span><br><span class="line">0078     ngx_str_t                 conf_param;</span><br><span class="line">0079     ngx_str_t                 conf_prefix;</span><br><span class="line">0080     ngx_str_t                 prefix;</span><br><span class="line">0081     ngx_str_t                 lock_file;</span><br><span class="line">0082     ngx_str_t                 hostname;</span><br><span class="line">0083 &#125;;</span><br></pre></td></tr></table></figure>
<h1 id="填充ngx-cycle-t数据"><a href="#填充ngx-cycle-t数据" class="headerlink" title="填充ngx_cycle_t数据"></a>填充ngx_cycle_t数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line">int ngx_cdecl</span><br><span class="line">main(int argc, char *const *argv)</span><br><span class="line">&#123;</span><br><span class="line">    ngx_int_t         i;</span><br><span class="line">    ngx_log_t        *log;</span><br><span class="line">    ngx_cycle_t      *cycle, init_cycle;</span><br><span class="line">    ngx_core_conf_t  *ccf;</span><br><span class="line"></span><br><span class="line">    ngx_debug_init();</span><br><span class="line"></span><br><span class="line">    if (ngx_strerror_init() != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 解析命令行参数 */</span><br><span class="line">    if (ngx_get_options(argc, argv) != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 显示版本号与帮助信息 */</span><br><span class="line">    if (ngx_show_version) &#123;</span><br><span class="line">        ngx_write_stderr(&quot;nginx version: &quot; NGINX_VER NGX_LINEFEED);</span><br><span class="line"></span><br><span class="line">        if (ngx_show_help) &#123;</span><br><span class="line">            ngx_write_stderr(</span><br><span class="line">                &quot;Usage: nginx [-?hvVtq] [-s signal] [-c filename] &quot;</span><br><span class="line">                             &quot;[-p prefix] [-g directives]&quot; NGX_LINEFEED</span><br><span class="line">                             NGX_LINEFEED</span><br><span class="line">                &quot;Options:&quot; NGX_LINEFEED</span><br><span class="line">                &quot;  -?,-h         : this help&quot; NGX_LINEFEED</span><br><span class="line">                &quot;  -v            : show version and exit&quot; NGX_LINEFEED</span><br><span class="line">                &quot;  -V            : show version and configure options then exit&quot;</span><br><span class="line">                                   NGX_LINEFEED</span><br><span class="line">                &quot;  -t            : test configuration and exit&quot; NGX_LINEFEED</span><br><span class="line">                &quot;  -q            : suppress non-error messages &quot;</span><br><span class="line">                                   &quot;during configuration testing&quot; NGX_LINEFEED</span><br><span class="line">                &quot;  -s signal     : send signal to a master process: &quot;</span><br><span class="line">                                   &quot;stop, quit, reopen, reload&quot; NGX_LINEFEED</span><br><span class="line">#ifdef NGX_PREFIX</span><br><span class="line">                &quot;  -p prefix     : set prefix path (default: &quot;</span><br><span class="line">                                   NGX_PREFIX &quot;)&quot; NGX_LINEFEED</span><br><span class="line">#else</span><br><span class="line">                &quot;  -p prefix     : set prefix path (default: NONE)&quot; NGX_LINEFEED</span><br><span class="line">#endif</span><br><span class="line">                &quot;  -c filename   : set configuration file (default: &quot;</span><br><span class="line">                                   NGX_CONF_PATH &quot;)&quot; NGX_LINEFEED</span><br><span class="line">                &quot;  -g directives : set global directives out of configuration &quot;</span><br><span class="line">                                   &quot;file&quot; NGX_LINEFEED NGX_LINEFEED</span><br><span class="line">                );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (ngx_show_configure) &#123;</span><br><span class="line">            ngx_write_stderr(</span><br><span class="line">#ifdef NGX_COMPILER</span><br><span class="line">                &quot;built by &quot; NGX_COMPILER NGX_LINEFEED</span><br><span class="line">#endif</span><br><span class="line">#if (NGX_SSL)</span><br><span class="line">#ifdef SSL_CTRL_SET_TLSEXT_HOSTNAME</span><br><span class="line">                &quot;TLS SNI support enabled&quot; NGX_LINEFEED</span><br><span class="line">#else</span><br><span class="line">                &quot;TLS SNI support disabled&quot; NGX_LINEFEED</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br><span class="line">                &quot;configure arguments:&quot; NGX_CONFIGURE NGX_LINEFEED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (!ngx_test_config) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* TODO */ ngx_max_sockets = -1;</span><br><span class="line"></span><br><span class="line">    /* 初始化并更新时间 */</span><br><span class="line">    ngx_time_init();</span><br><span class="line"></span><br><span class="line">#if (NGX_PCRE)</span><br><span class="line">    ngx_regex_init();</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">    ngx_pid = ngx_getpid();</span><br><span class="line"></span><br><span class="line">    /* 初始化日志信息 */</span><br><span class="line">    log = ngx_log_init(ngx_prefix);</span><br><span class="line">    if (log == NULL) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* STUB */</span><br><span class="line">#if (NGX_OPENSSL)</span><br><span class="line">    ngx_ssl_init(log);</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">     * init_cycle-&gt;log is required for signal handlers and</span><br><span class="line">     * ngx_process_options()</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    /* 全局变量init_cycle清零，并创建改变量的内存池pool */</span><br><span class="line">    ngx_memzero(&amp;init_cycle, sizeof(ngx_cycle_t));</span><br><span class="line">    init_cycle.log = log;</span><br><span class="line">    ngx_cycle = &amp;init_cycle;</span><br><span class="line"></span><br><span class="line">    init_cycle.pool = ngx_create_pool(1024, log);</span><br><span class="line">    if (init_cycle.pool == NULL) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 保存命令行参数至全局变量ngx_os_argv、ngx_argc、ngx_argv */</span><br><span class="line">    if (ngx_save_argv(&amp;init_cycle, argc, argv) != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 初始化全局变量init_cycle中的成员：prefix、conf_prefix、conf_file、conf_param 等字段 */</span><br><span class="line">    if (ngx_process_options(&amp;init_cycle) != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 初始化系统相关变量，如：内存页面大小ngx_pagesize、最大连接数ngx_max_sockets等 */</span><br><span class="line">    if (ngx_os_init(log) != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">     * ngx_crc32_table_init() requires ngx_cacheline_size set in ngx_os_init()</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    /* 初始化 CRC 表（循环冗余校验表） */</span><br><span class="line">    if (ngx_crc32_table_init() != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 通过环境变量NGINX完成socket的继承，将其保存在全局变量init_cycle的listening数组中 */</span><br><span class="line">    if (ngx_add_inherited_sockets(&amp;init_cycle) != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 初始化每个模块module的index，并计算ngx_max_module */</span><br><span class="line">    ngx_max_module = 0;</span><br><span class="line">    for (i = 0; ngx_modules[i]; i++) &#123;</span><br><span class="line">        ngx_modules[i]-&gt;index = ngx_max_module++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 初始化全局变量init_cycle ，这里很重要 */</span><br><span class="line">    cycle = ngx_init_cycle(&amp;init_cycle);</span><br><span class="line">    if (cycle == NULL) &#123;</span><br><span class="line">        if (ngx_test_config) &#123;</span><br><span class="line">            ngx_log_stderr(0, &quot;configuration file %s test failed&quot;,</span><br><span class="line">                           init_cycle.conf_file.data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (ngx_test_config) &#123;</span><br><span class="line">        if (!ngx_quiet_mode) &#123;</span><br><span class="line">            ngx_log_stderr(0, &quot;configuration file %s test is successful&quot;,</span><br><span class="line">                           cycle-&gt;conf_file.data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 信号处理 */</span><br><span class="line">    if (ngx_signal) &#123;</span><br><span class="line">        return ngx_signal_process(cycle, ngx_signal);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngx_os_status(cycle-&gt;log);</span><br><span class="line"></span><br><span class="line">    ngx_cycle = cycle;</span><br><span class="line"></span><br><span class="line">    ccf = (ngx_core_conf_t *) ngx_get_conf(cycle-&gt;conf_ctx, ngx_core_module);</span><br><span class="line"></span><br><span class="line">    if (ccf-&gt;master &amp;&amp; ngx_process == NGX_PROCESS_SINGLE) &#123;</span><br><span class="line">        ngx_process = NGX_PROCESS_MASTER;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">#if !(NGX_WIN32)</span><br><span class="line"></span><br><span class="line">    /* 初始化信号，注册相关信号 */</span><br><span class="line">    if (ngx_init_signals(cycle-&gt;log) != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 若无socket继承，则创建守护进程，并设置守护进程标志 */</span><br><span class="line">    if (!ngx_inherited &amp;&amp; ccf-&gt;daemon) &#123;</span><br><span class="line">        if (ngx_daemon(cycle-&gt;log) != NGX_OK) &#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ngx_daemonized = 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (ngx_inherited) &#123;</span><br><span class="line">        ngx_daemonized = 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">    /* 记录进程ID */</span><br><span class="line">    if (ngx_create_pidfile(&amp;ccf-&gt;pid, cycle-&gt;log) != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (ngx_log_redirect_stderr(cycle) != NGX_OK) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (log-&gt;file-&gt;fd != ngx_stderr) &#123;</span><br><span class="line">        if (ngx_close_file(log-&gt;file-&gt;fd) == NGX_FILE_ERROR) &#123;</span><br><span class="line">            ngx_log_error(NGX_LOG_ALERT, cycle-&gt;log, ngx_errno,</span><br><span class="line">                          ngx_close_file_n &quot; built-in log failed&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngx_use_stderr = 0;</span><br><span class="line"></span><br><span class="line">    /* 进入进程处理 */</span><br><span class="line">    if (ngx_process == NGX_PROCESS_SINGLE) &#123;</span><br><span class="line">        /* 单进程工作模式 */</span><br><span class="line">        ngx_single_process_cycle(cycle);</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        /* master-worker 多进程模式工作 */</span><br><span class="line">        ngx_master_process_cycle(cycle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> nginx </category>
            
        </categories>
        
        
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[centos7-rc-local不起作用修复]]></title>
      <url>/centos7-rc-local%E4%B8%8D%E8%B5%B7%E4%BD%9C%E7%94%A8%E4%BF%AE%E5%A4%8D.html</url>
      <content type="html"><![CDATA[<p>在centos7版本以下的系统中, 尝尝用rc.local 自动启动一些软件. 但是在centos7 中 默认rc.local 是不起作用的, centos7 中把 SysV 替换成  system 。centos7保留了rc.local ,只需要简单的设置就可以开启.</p>
<a id="more"></a>
<h1 id="设置rc-local-权限"><a href="#设置rc-local-权限" class="headerlink" title="设置rc.local 权限"></a>设置rc.local 权限</h1><p>我们在一下目录可以看见rc.local<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/rc.local</span><br><span class="line">/etc/rc.d/rc.local</span><br><span class="line">#/etc/rc.local 是 /etc/rc.d/rc.local的软连接</span><br></pre></td></tr></table></figure></p>
<p>chmod +x /etc/rc.d/rc.local </p>
<h1 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable  rc-local.service</span><br></pre></td></tr></table></figure>
<h1 id="启动rc-local-service"><a href="#启动rc-local-service" class="headerlink" title="启动rc-local.service"></a>启动rc-local.service</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start   rc-local.service</span><br></pre></td></tr></table></figure>
<h1 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status rc-local.service</span><br></pre></td></tr></table></figure>
<h1 id="在-etc-rc-local-编写启动软件指令"><a href="#在-etc-rc-local-编写启动软件指令" class="headerlink" title="在/etc/rc.local 编写启动软件指令"></a>在/etc/rc.local 编写启动软件指令</h1>]]></content>
      
        <categories>
            
            <category> centos7 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> centos7 </tag>
            
            <tag> rc.local </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[The real difference between $host and $http_host]]></title>
      <url>/The-real-difference-between-$host-and-$http_host.html</url>
      <content type="html"><![CDATA[<p>Nginx中$host与$http_host的区别<br><a id="more"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">The wiki page of &quot;$host&quot; says $host and $host_addr are different only when there is no &quot;Host&quot; header or the &quot;Host&quot; header is empty. But I found when &quot;Host&quot; contains port number, $host never contains the port number while $http_host is equal to the value of &quot;Host&quot; header. </span><br><span class="line"></span><br><span class="line">That is, if &quot;Host: foo:8080&quot;, then </span><br><span class="line">$http_host = foo:8080 </span><br><span class="line">$host = foo </span><br><span class="line"></span><br><span class="line">$http_host是request里的host header </span><br><span class="line">$host是server&#123;&#125;里的server_name里的第一个</span><br><span class="line"></span><br><span class="line">&quot;192.168.160.1&quot; http_host:&quot;192.168.160.159:808&quot; host:&quot;192.168.160.159&quot; &quot;[08/Apr/2016:15:37:06 +0800]&quot; &quot;GET / HTTP/1.1&quot; &quot;304&quot; &quot;0&quot; &quot;171&quot; &quot;-&quot; &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.110 Safari/537.36&quot; &quot;-&quot; &quot;-&quot; &quot;-&quot; &quot;0.000&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> nginx </category>
            
        </categories>
        
        
        <tags>
            
            <tag> nginx </tag>
            
            <tag> host </tag>
            
            <tag> http_host </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Faile- to-star- component-Unable-to-register-MBean]]></title>
      <url>/Failed%20to%20start%20component.html</url>
      <content type="html"><![CDATA[<p>部署springboot war包到 tomcat出现以下错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.apache.catalina.LifecycleException: Failed to start component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[]]</span><br><span class="line">Caused by: org.springframework.jmx.export.UnableToRegisterMBeanException: Unable to register MBean</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><blockquote>
<p>需要为每个项目配置JMX的域，  修改application.properties中的属性spring.jmx.default-domain=applicationname</p>
</blockquote>
<h1 id="spring-jmx-default-domain"><a href="#spring-jmx-default-domain" class="headerlink" title="spring.jmx.default-domain"></a>spring.jmx.default-domain</h1><blockquote>
<p>解决tomcat同时部署两个SpringBoot应用提示InstanceAlreadyExistsException</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> springboot </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tomcat </tag>
            
            <tag> springboot </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[C语言结构体研究]]></title>
      <url>/C%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84%E4%BD%93%E7%A0%94%E7%A9%B6.html</url>
      <content type="html"><![CDATA[<p>总结一些C语言结构体中常用的知识点</p>
<a id="more"></a>
<h1 id="C-语言结构体之点运算符-和箭头运算符-gt-的区别"><a href="#C-语言结构体之点运算符-和箭头运算符-gt-的区别" class="headerlink" title="C 语言结构体之点运算符( . )和箭头运算符( -&gt; )的区别"></a>C 语言结构体之点运算符( . )和箭头运算符( -&gt; )的区别</h1><blockquote>
<p>相同点：两者都是二元操作符，而且右边的操作数都是成员的名称。<br>不通点：点运算符( . )的左边操作数是一个结果为结构的表达式；</p>
<blockquote>
<p>箭头运算符( -&gt; )的左边的操作数是一个指向结构体的指针。</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef struct          // 定义一个结构体类型：TEST</span><br><span class="line">&#123;</span><br><span class="line">    int age;            // 结构体成员：age</span><br><span class="line">&#125;TEST;</span><br><span class="line">TEST data;              // 声明一个结构体变量</span><br><span class="line">TEST *pdata;            // 声明一个指向结构体的指针</span><br><span class="line">// 访问数据操作如下：</span><br><span class="line">data.age = 24;          // 结构体变量通过点运算符( . )访问</span><br><span class="line">pdata-&gt;age = 24;        // 指向结构体的指针通过箭头运算符( -&gt; )访问</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> c </category>
            
        </categories>
        
        
        <tags>
            
            <tag> struct </tag>
            
            <tag> c </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
